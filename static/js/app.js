/*! For license information please see main.03690a18.js.LICENSE.txt */
(()=>{var e={764:function(e,t,n){!function(e){"use strict";void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"===typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype===!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");const t=Object(e);for(let n=1;n<arguments.length;n++){const e=arguments[n];if(void 0!==e&&null!==e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t});const t="118",i=0,r=1,o=2,s=1,a=2,l=3,c=0,u=1,h=2,d=1,p=0,f=1,m=2,g=3,y=4,v=5,b=100,x=101,w=102,_=103,S=104,M=200,A=201,C=202,T=203,E=204,P=205,I=206,L=207,R=208,k=209,D=210,O=0,N=1,B=2,F=3,z=4,U=5,H=6,G=7,V=0,j=1,$=2,W=0,q=1,X=2,Y=3,Z=4,K=5,Q=300,J=301,ee=302,te=303,ne=304,ie=306,re=307,oe=1e3,se=1001,ae=1002,le=1003,ce=1004,ue=1005,he=1006,de=1007,pe=1008,fe=1009,me=1010,ge=1011,ye=1012,ve=1013,be=1014,xe=1015,we=1016,_e=1017,Se=1018,Me=1019,Ae=1020,Ce=1021,Te=1022,Ee=1023,Pe=1024,Ie=1025,Le=1026,Re=1027,ke=1028,De=1029,Oe=1030,Ne=1031,Be=1032,Fe=1033,ze=33776,Ue=33777,He=33778,Ge=33779,Ve=35840,je=35841,$e=35842,We=35843,qe=36196,Xe=37492,Ye=37496,Ze=37808,Ke=37809,Qe=37810,Je=37811,et=37812,tt=37813,nt=37814,it=37815,rt=37816,ot=37817,st=37818,at=37819,lt=37820,ct=37821,ut=36492,ht=37840,dt=37841,pt=37842,ft=37843,mt=37844,gt=37845,yt=37846,vt=37847,bt=37848,xt=37849,wt=37850,_t=37851,St=37852,Mt=37853,At=2200,Ct=2201,Tt=2202,Et=2300,Pt=2301,It=2302,Lt=2400,Rt=2401,kt=2402,Dt=2500,Ot=2501,Nt=0,Bt=3e3,Ft=3001,zt=3007,Ut=3002,Ht=3003,Gt=3004,Vt=3005,jt=3006,$t=3200,Wt=3201,qt=0,Xt=1,Yt=7680,Zt=519,Kt=35044,Qt=35048;function Jt(){}Object.assign(Jt.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}},dispatchEvent:function(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e)}}});const en=[];for(let n=0;n<256;n++)en[n]=(n<16?"0":"")+n.toString(16);const tn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(en[255&e]+en[e>>8&255]+en[e>>16&255]+en[e>>24&255]+"-"+en[255&t]+en[t>>8&255]+"-"+en[t>>16&15|64]+en[t>>24&255]+"-"+en[63&n|128]+en[n>>8&255]+"-"+en[n>>16&255]+en[n>>24&255]+en[255&i]+en[i>>8&255]+en[i>>16&255]+en[i>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*tn.DEG2RAD},radToDeg:function(e){return e*tn.RAD2DEG},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,r){const o=Math.cos,s=Math.sin,a=o(n/2),l=s(n/2),c=o((t+i)/2),u=s((t+i)/2),h=o((t-i)/2),d=s((t-i)/2),p=o((i-t)/2),f=s((i-t)/2);switch(r){case"XYX":e.set(a*u,l*h,l*d,a*c);break;case"YZY":e.set(l*d,a*u,l*h,a*c);break;case"ZXZ":e.set(l*h,l*d,a*u,a*c);break;case"XZX":e.set(a*u,l*f,l*p,a*c);break;case"YXY":e.set(l*p,a*u,l*f,a*c);break;case"ZYZ":e.set(l*f,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}};function nn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=e,this.y=t}function rn(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}let on;Object.defineProperties(nn.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(nn.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this},random:function(){return this.x=Math.random(),this.y=Math.random(),this}}),Object.assign(rn.prototype,{isMatrix3:!0,set:function(e,t,n,i,r,o,s,a,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=s,c[3]=t,c[4]=r,c[5]=a,c[6]=n,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},extractBasis:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],y=i[1],v=i[4],b=i[7],x=i[2],w=i[5],_=i[8];return r[0]=o*f+s*y+a*x,r[3]=o*m+s*v+a*w,r[6]=o*g+s*b+a*_,r[1]=l*f+c*y+u*x,r[4]=l*m+c*v+u*w,r[7]=l*g+c*b+u*_,r[2]=h*f+d*y+p*x,r[5]=h*m+d*v+p*w,r[8]=h*g+d*b+p*_,this},multiplyScalar:function(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*s*l-n*r*c+n*s*a+i*r*l-i*o*a},getInverse:function(e,t){void 0!==t&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");const n=e.elements,i=this.elements,r=n[0],o=n[1],s=n[2],a=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],p=d*l-c*h,f=c*u-d*a,m=h*a-l*u,g=r*p+o*f+s*m;if(0===g)return this.set(0,0,0,0,0,0,0,0,0);const y=1/g;return i[0]=p*y,i[1]=(s*h-d*o)*y,i[2]=(c*o-s*l)*y,i[3]=f*y,i[4]=(d*r-s*u)*y,i[5]=(s*a-c*r)*y,i[6]=m*y,i[7]=(o*u-h*r)*y,i[8]=(l*r-o*a)*y,this},transpose:function(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,i,r,o,s){const a=Math.cos(r),l=Math.sin(r);this.set(n*a,n*l,-n*(a*o+l*s)+o+e,-i*l,i*a,-i*(-l*o+a*s)+s+t,0,0,1)},scale:function(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],o=i[3],s=i[6],a=i[1],l=i[4],c=i[7];return i[0]=t*r+n*a,i[3]=t*o+n*l,i[6]=t*s+n*c,i[1]=-n*r+t*a,i[4]=-n*o+t*l,i[7]=-n*s+t*c,this},translate:function(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});const sn={getDataURL:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===on&&(on=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),on.width=e.width,on.height=e.height;const n=on.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=on}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}};let an=0;function ln(e,t,n,i,r,o,s,a,l,c){Object.defineProperty(this,"id",{value:an++}),this.uuid=tn.generateUUID(),this.name="",this.image=void 0!==e?e:ln.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:ln.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:se,this.wrapT=void 0!==i?i:se,this.magFilter=void 0!==r?r:he,this.minFilter=void 0!==o?o:pe,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:Ee,this.internalFormat=null,this.type=void 0!==a?a:fe,this.offset=new nn(0,0),this.repeat=new nn(1,1),this.center=new nn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new rn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:Bt,this.version=0,this.onUpdate=null}function cn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.x=e,this.y=t,this.z=n,this.w=i}function un(e,t,n){this.width=e,this.height=t,this.scissor=new cn(0,0,e,t),this.scissorTest=!1,this.viewport=new cn(0,0,e,t),n=n||{},this.texture=new ln(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:he,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function hn(e,t,n){un.call(this,e,t,n),this.samples=4}function dn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._x=e,this._y=t,this._z=n,this._w=i}ln.DEFAULT_IMAGE=void 0,ln.DEFAULT_MAPPING=Q,ln.prototype=Object.assign(Object.create(Jt.prototype),{constructor:ln,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=tn.generateUUID()),!t&&void 0===e.images[i.uuid]){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)t.push(sn.getDataURL(i[e]))}else t=sn.getDataURL(i);e.images[i.uuid]={uuid:i.uuid,url:t}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==Q)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case oe:e.x=e.x-Math.floor(e.x);break;case se:e.x=e.x<0?0:1;break;case ae:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case oe:e.y=e.y-Math.floor(e.y);break;case se:e.y=e.y<0?0:1;break;case ae:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(ln.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(cn.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(cn.prototype,{isVector4:!0,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){let t,n,i,r;const o=.01,s=.1,a=e.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<o&&Math.abs(u-f)<o&&Math.abs(p-m)<o){if(Math.abs(c+h)<s&&Math.abs(u+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(d+1)/2,y=(g+1)/2,v=(c+h)/4,b=(u+f)/4,x=(p+m)/4;return e>a&&e>y?e<o?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=v/n,r=b/n):a>y?a<o?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=v/i,r=x/i):y<o?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(y),n=b/r,i=x/r),this.set(n,i,r,t),this}let y=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(u-f)/y,this.z=(h-c)/y,this.w=Math.acos((l+d+g-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}),un.prototype=Object.assign(Object.create(Jt.prototype),{constructor:un,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),hn.prototype=Object.assign(Object.create(un.prototype),{constructor:hn,isWebGLMultisampleRenderTarget:!0,copy:function(e){return un.prototype.copy.call(this,e),this.samples=e.samples,this}}),Object.assign(dn,{slerp:function(e,t,n,i){return n.copy(e).slerp(t,i)},slerpFlat:function(e,t,n,i,r,o,s){let a=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const h=r[o+0],d=r[o+1],p=r[o+2],f=r[o+3];if(u!==f||a!==h||l!==d||c!==p){let e=1-s,t=a*h+l*d+c*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,t*n);e=Math.sin(e*o)/r,s=Math.sin(s*o)/r}const r=s*n;if(a=a*e+h*r,l=l*e+d*r,c=c*e+p*r,u=u*e+f*r,e===1-s){const e=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=e,l*=e,c*=e,u*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u},multiplyQuaternionsFlat:function(e,t,n,i,r,o){const s=n[i],a=n[i+1],l=n[i+2],c=n[i+3],u=r[o],h=r[o+1],d=r[o+2],p=r[o+3];return e[t]=s*p+c*u+a*d-l*h,e[t+1]=a*p+c*h+l*u-s*d,e[t+2]=l*p+c*d+s*h-a*u,e[t+3]=c*p-s*u-a*h-l*d,e}}),Object.defineProperties(dn.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(dn.prototype,{isQuaternion:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,i=e._y,r=e._z,o=e.order,s=Math.cos,a=Math.sin,l=s(n/2),c=s(i/2),u=s(r/2),h=a(n/2),d=a(i/2),p=a(r/2);switch(o){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],s=t[5],a=t[9],l=t[2],c=t[6],u=t[10],h=n+s+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-a)*e,this._y=(r-l)*e,this._z=(o-i)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(c-a)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(r+l)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(r-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(o-i)/e,this._x=(r+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this},setFromUnitVectors:function(e,t){const n=1e-6;let i=e.dot(t)+1;return i<n?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(tn.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,s=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+o*s+i*l-r*a,this._y=i*c+o*a+r*s-n*l,this._z=r*c+o*l+n*a-i*s,this._w=o*c-n*s-i*a-r*l,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let s=o*e._w+n*e._x+i*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const a=1-s*s;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},fromBufferAttribute:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});const pn=new mn,fn=new dn;function mn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=e,this.y=t,this.z=n}Object.assign(mn.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(fn.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(fn.setFromAxisAngle(e,t))},applyMatrix3:function(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this},applyQuaternion:function(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*i-s*n,c=a*n+s*t-r*i,u=a*i+r*n-o*t,h=-r*t-o*n-s*i;return this.x=l*a+h*-r+c*-s-u*-o,this.y=c*a+h*-o+u*-r-l*-s,this.z=u*a+h*-s+l*-o-c*-r,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,s=t.y,a=t.z;return this.x=i*a-r*s,this.y=r*o-n*a,this.z=n*s-i*o,this},projectOnVector:function(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)},projectOnPlane:function(e){return pn.copy(this).projectOnVector(e),this.sub(pn)},reflect:function(e){return this.sub(pn.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(tn.clamp(n,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,3*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}});const gn=new mn,yn=new Sn,vn=new mn(0,0,0),bn=new mn(1,1,1),xn=new mn,wn=new mn,_n=new mn;function Sn(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Sn.prototype,{isMatrix4:!0,set:function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Sn).fromArray(this.elements)},copy:function(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(e){const t=this.elements,n=e.elements,i=1/gn.setFromMatrixColumn(e,0).length(),r=1/gn.setFromMatrixColumn(e,1).length(),o=1/gn.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=o*c,n=o*u,i=s*c,r=s*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-s*a,t[2]=r-e*l,t[6]=i+n*l,t[10]=o*a}else if("YXZ"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e+r*s,t[4]=i*s-n,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-s,t[2]=n*s-i,t[6]=r+e*s,t[10]=o*a}else if("ZXY"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e-r*s,t[4]=-o*u,t[8]=i+n*s,t[1]=n+i*s,t[5]=o*c,t[9]=r-e*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){const e=o*c,n=o*u,i=s*c,r=s*u;t[0]=a*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=a*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,n=o*l,i=s*a,r=s*l;t[0]=a*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=o*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=o*a,n=o*l,i=s*a,r=s*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=o*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=s*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(vn,e,bn)},lookAt:function(e,t,n){const i=this.elements;return _n.subVectors(e,t),0===_n.lengthSq()&&(_n.z=1),_n.normalize(),xn.crossVectors(n,_n),0===xn.lengthSq()&&(1===Math.abs(n.z)?_n.x+=1e-4:_n.z+=1e-4,_n.normalize(),xn.crossVectors(n,_n)),xn.normalize(),wn.crossVectors(_n,xn),i[0]=xn.x,i[4]=wn.x,i[8]=_n.x,i[1]=xn.y,i[5]=wn.y,i[9]=_n.y,i[2]=xn.z,i[6]=wn.z,i[10]=_n.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],y=n[3],v=n[7],b=n[11],x=n[15],w=i[0],_=i[4],S=i[8],M=i[12],A=i[1],C=i[5],T=i[9],E=i[13],P=i[2],I=i[6],L=i[10],R=i[14],k=i[3],D=i[7],O=i[11],N=i[15];return r[0]=o*w+s*A+a*P+l*k,r[4]=o*_+s*C+a*I+l*D,r[8]=o*S+s*T+a*L+l*O,r[12]=o*M+s*E+a*R+l*N,r[1]=c*w+u*A+h*P+d*k,r[5]=c*_+u*C+h*I+d*D,r[9]=c*S+u*T+h*L+d*O,r[13]=c*M+u*E+h*R+d*N,r[2]=p*w+f*A+m*P+g*k,r[6]=p*_+f*C+m*I+g*D,r[10]=p*S+f*T+m*L+g*O,r[14]=p*M+f*E+m*R+g*N,r[3]=y*w+v*A+b*P+x*k,r[7]=y*_+v*C+b*I+x*D,r[11]=y*S+v*T+b*L+x*O,r[15]=y*M+v*E+b*R+x*N,this},multiplyScalar:function(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*a*u-i*l*u-r*s*h+n*l*h+i*s*d-n*a*d)+e[7]*(+t*a*d-t*l*h+r*o*h-i*o*d+i*l*c-r*a*c)+e[11]*(+t*l*u-t*s*d-r*o*u+n*o*d+r*s*c-n*l*c)+e[15]*(-i*s*c-t*a*u+t*s*h+i*o*u-n*o*h+n*a*c)},transpose:function(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this},getInverse:function(e,t){void 0!==t&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");const n=this.elements,i=e.elements,r=i[0],o=i[1],s=i[2],a=i[3],l=i[4],c=i[5],u=i[6],h=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],y=i[13],v=i[14],b=i[15],x=p*v*h-y*f*h+y*u*m-c*v*m-p*u*b+c*f*b,w=g*f*h-d*v*h-g*u*m+l*v*m+d*u*b-l*f*b,_=d*y*h-g*p*h+g*c*m-l*y*m-d*c*b+l*p*b,S=g*p*u-d*y*u-g*c*f+l*y*f+d*c*v-l*p*v,M=r*x+o*w+s*_+a*S;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/M;return n[0]=x*A,n[1]=(y*f*a-p*v*a-y*s*m+o*v*m+p*s*b-o*f*b)*A,n[2]=(c*v*a-y*u*a+y*s*h-o*v*h-c*s*b+o*u*b)*A,n[3]=(p*u*a-c*f*a-p*s*h+o*f*h+c*s*m-o*u*m)*A,n[4]=w*A,n[5]=(d*v*a-g*f*a+g*s*m-r*v*m-d*s*b+r*f*b)*A,n[6]=(g*u*a-l*v*a-g*s*h+r*v*h+l*s*b-r*u*b)*A,n[7]=(l*f*a-d*u*a+d*s*h-r*f*h-l*s*m+r*u*m)*A,n[8]=_*A,n[9]=(g*p*a-d*y*a-g*o*m+r*y*m+d*o*b-r*p*b)*A,n[10]=(l*y*a-g*c*a+g*o*h-r*y*h-l*o*b+r*c*b)*A,n[11]=(d*c*a-l*p*a-d*o*h+r*p*h+l*o*m-r*c*m)*A,n[12]=S*A,n[13]=(d*y*s-g*p*s+g*o*f-r*y*f-d*o*v+r*p*v)*A,n[14]=(g*c*s-l*y*s-g*o*u+r*y*u+l*o*v-r*c*v)*A,n[15]=(l*p*s-d*c*s+d*o*u-r*p*u-l*o*f+r*c*f)*A,this},scale:function(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},getMaxScaleOnAxis:function(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,s=e.y,a=e.z,l=r*o,c=r*s;return this.set(l*o+n,l*s-i*a,l*a+i*s,0,l*s+i*a,c*s+n,c*a-i*o,0,l*a-i*s,c*a+i*o,r*a*a+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){const i=this.elements,r=t._x,o=t._y,s=t._z,a=t._w,l=r+r,c=o+o,u=s+s,h=r*l,d=r*c,p=r*u,f=o*c,m=o*u,g=s*u,y=a*l,v=a*c,b=a*u,x=n.x,w=n.y,_=n.z;return i[0]=(1-(f+g))*x,i[1]=(d+b)*x,i[2]=(p-v)*x,i[3]=0,i[4]=(d-b)*w,i[5]=(1-(h+g))*w,i[6]=(m+y)*w,i[7]=0,i[8]=(p+v)*_,i[9]=(m-y)*_,i[10]=(1-(h+f))*_,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},decompose:function(e,t,n){const i=this.elements;let r=gn.set(i[0],i[1],i[2]).length(),o=gn.set(i[4],i[5],i[6]).length(),s=gn.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],yn.copy(this);const a=1/r,l=1/o,c=1/s;return yn.elements[0]*=a,yn.elements[1]*=a,yn.elements[2]*=a,yn.elements[4]*=l,yn.elements[5]*=l,yn.elements[6]*=l,yn.elements[8]*=c,yn.elements[9]*=c,yn.elements[10]*=c,t.setFromRotationMatrix(yn),n.x=r,n.y=o,n.z=s,this},makePerspective:function(e,t,n,i,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,a=2*r/(t-e),l=2*r/(n-i),c=(t+e)/(t-e),u=(n+i)/(n-i),h=-(o+r)/(o-r),d=-2*o*r/(o-r);return s[0]=a,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=l,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(e,t,n,i,r,o){const s=this.elements,a=1/(t-e),l=1/(n-i),c=1/(o-r),u=(t+e)*a,h=(n+i)*l,d=(o+r)*c;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*c,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}});const Mn=new Sn,An=new dn;function Cn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Cn.DefaultOrder;this._x=e,this._y=t,this._z=n,this._order=i}function Tn(){this.mask=1}Cn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Cn.DefaultOrder="XYZ",Object.defineProperties(Cn.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(Cn.prototype,{isEuler:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){const i=tn.clamp,r=e.elements,o=r[0],s=r[4],a=r[8],l=r[1],c=r[5],u=r[9],h=r[2],d=r[6],p=r[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(i(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-i(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-i(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(i(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-i(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,n){return Mn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Mn,t,n)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return An.setFromEuler(this),this.setFromQuaternion(An,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new mn(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(Tn.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return 0!==(this.mask&e.mask)}});let En=0;const Pn=new mn,In=new dn,Ln=new Sn,Rn=new mn,kn=new mn,Dn=new mn,On=new dn,Nn=new mn(1,0,0),Bn=new mn(0,1,0),Fn=new mn(0,0,1),zn={type:"added"},Un={type:"removed"};function Hn(){Object.defineProperty(this,"id",{value:En++}),this.uuid=tn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Hn.DefaultUp.clone();const e=new mn,t=new Cn,n=new dn,i=new mn(1,1,1);function r(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Sn},normalMatrix:{value:new rn}}),this.matrix=new Sn,this.matrixWorld=new Sn,this.matrixAutoUpdate=Hn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Tn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Gn(){Hn.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Hn.DefaultUp=new mn(0,1,0),Hn.DefaultMatrixAutoUpdate=!0,Hn.prototype=Object.assign(Object.create(Jt.prototype),{constructor:Hn,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return In.setFromAxisAngle(e,t),this.quaternion.multiply(In),this},rotateOnWorldAxis:function(e,t){return In.setFromAxisAngle(e,t),this.quaternion.premultiply(In),this},rotateX:function(e){return this.rotateOnAxis(Nn,e)},rotateY:function(e){return this.rotateOnAxis(Bn,e)},rotateZ:function(e){return this.rotateOnAxis(Fn,e)},translateOnAxis:function(e,t){return Pn.copy(e).applyQuaternion(this.quaternion),this.position.add(Pn.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(Nn,e)},translateY:function(e){return this.translateOnAxis(Bn,e)},translateZ:function(e){return this.translateOnAxis(Fn,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(Ln.getInverse(this.matrixWorld))},lookAt:function(e,t,n){e.isVector3?Rn.copy(e):Rn.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),kn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ln.lookAt(kn,Rn,this.up):Ln.lookAt(Rn,kn,this.up),this.quaternion.setFromRotationMatrix(Ln),i&&(Ln.extractRotation(i.matrixWorld),In.setFromRotationMatrix(Ln),this.quaternion.premultiply(In.inverse()))},add:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(zn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Un)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),Ln.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Ln.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ln),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new mn),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new dn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(kn,e,Dn),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new mn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(kn,On,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new mn),this.updateMatrixWorld(!0);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)},traverseAncestors:function(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}},toJSON:function(e){const t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(t){const t=o(e.geometries),i=o(e.materials),r=o(e.textures),s=o(e.images),a=o(e.shapes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a)}return n.object=i,n;function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}),Gn.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Gn,isScene:!0,copy:function(e,t){return Hn.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){const t=Hn.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Vn=[new mn,new mn,new mn,new mn,new mn,new mn,new mn,new mn],jn=new mn,$n=new ni,Wn=new mn,qn=new mn,Xn=new mn,Yn=new mn,Zn=new mn,Kn=new mn,Qn=new mn,Jn=new mn,ei=new mn,ti=new mn;function ni(e,t){this.min=void 0!==e?e:new mn(1/0,1/0,1/0),this.max=void 0!==t?t:new mn(-1/0,-1/0,-1/0)}function ii(e,t,n,i,r){for(let o=0,s=e.length-3;o<=s;o+=3){ti.fromArray(e,o);const s=r.x*Math.abs(ti.x)+r.y*Math.abs(ti.y)+r.z*Math.abs(ti.z),a=t.dot(ti),l=n.dot(ti),c=i.dot(ti);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>s)return!1}return!0}Object.assign(ni.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],u=e[a+2];l<t&&(t=l),c<n&&(n=c),u<i&&(i=u),l>r&&(r=l),c>o&&(o=c),u>s&&(s=u)}return this.min.set(t,n,i),this.max.set(r,o,s),this},setFromBufferAttribute:function(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,l=e.count;a<l;a++){const l=e.getX(a),c=e.getY(a),u=e.getZ(a);l<t&&(t=l),c<n&&(n=c),u<i&&(i=u),l>r&&(r=l),c>o&&(o=c),u>s&&(s=u)}return this.min.set(t,n,i),this.max.set(r,o,s),this},setFromPoints:function(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){const n=jn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new mn),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new mn),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),$n.copy(t.boundingBox),$n.applyMatrix4(e.matrixWorld),this.union($n));const n=e.children;for(let i=0,r=n.length;i<r;i++)this.expandByObject(n[i]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new mn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,jn),jn.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(Qn),Jn.subVectors(this.max,Qn),Wn.subVectors(e.a,Qn),qn.subVectors(e.b,Qn),Xn.subVectors(e.c,Qn),Yn.subVectors(qn,Wn),Zn.subVectors(Xn,qn),Kn.subVectors(Wn,Xn);let t=[0,-Yn.z,Yn.y,0,-Zn.z,Zn.y,0,-Kn.z,Kn.y,Yn.z,0,-Yn.x,Zn.z,0,-Zn.x,Kn.z,0,-Kn.x,-Yn.y,Yn.x,0,-Zn.y,Zn.x,0,-Kn.y,Kn.x,0];return!!ii(t,Wn,qn,Xn,Jn)&&(t=[1,0,0,0,1,0,0,0,1],!!ii(t,Wn,qn,Xn,Jn)&&(ei.crossVectors(Yn,Zn),t=[ei.x,ei.y,ei.z],ii(t,Wn,qn,Xn,Jn)))},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new mn),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return jn.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(jn).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()||(Vn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Vn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Vn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Vn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Vn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Vn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Vn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Vn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Vn)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});const ri=new ni;function oi(e,t){this.center=void 0!==e?e:new mn,this.radius=void 0!==t?t:-1}Object.assign(oi.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){const n=this.center;void 0!==t?n.copy(t):ri.setFromPoints(e).getCenter(n);let i=0;for(let r=0,o=e.length;r<o;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},isEmpty:function(){return this.radius<0},makeEmpty:function(){return this.center.set(0,0,0),this.radius=-1,this},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){const n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new mn),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new ni),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});const si=new mn,ai=new mn,li=new mn,ci=new mn,ui=new mn,hi=new mn,di=new mn;function pi(e,t){this.origin=void 0!==e?e:new mn,this.direction=void 0!==t?t:new mn(0,0,-1)}Object.assign(pi.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new mn),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,si)),this},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new mn),t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){const t=si.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(si.copy(this.direction).multiplyScalar(t).add(this.origin),si.distanceToSquared(e))},distanceSqToSegment:function(e,t,n,i){ai.copy(e).add(t).multiplyScalar(.5),li.copy(t).sub(e).normalize(),ci.copy(this.origin).sub(ai);const r=.5*e.distanceTo(t),o=-this.direction.dot(li),s=ci.dot(this.direction),a=-ci.dot(li),l=ci.lengthSq(),c=Math.abs(1-o*o);let u,h,d,p;if(c>0)if(u=o*a-s,h=o*s-a,p=r*c,u>=0)if(h>=-p)if(h<=p){const e=1/c;u*=e,h*=e,d=u*(u+o*h+2*s)+h*(o*u+h+2*a)+l}else h=r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h=-r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-o*r+s)),h=u>0?-r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-a),r),d=h*(h+2*a)+l):(u=Math.max(0,-(o*r+s)),h=u>0?r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l);else h=o>0?-r:r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),i&&i.copy(li).multiplyScalar(h).add(ai),d},intersectSphere:function(e,t){si.subVectors(e.center,this.origin);const n=si.dot(this.direction),i=si.dot(si)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),s=n-o,a=n+o;return s<0&&a<0?null:s<0?this.at(a,t):this.at(s,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},intersectsPlane:function(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){let n,i,r,o,s,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),n>o||r>i?null:((r>n||n!==n)&&(n=r),(o<i||i!==i)&&(i=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),n>a||s>i?null:((s>n||n!==n)&&(n=s),(a<i||i!==i)&&(i=a),i<0?null:this.at(n>=0?n:i,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,si)},intersectTriangle:function(e,t,n,i,r){ui.subVectors(t,e),hi.subVectors(n,e),di.crossVectors(ui,hi);let o,s=this.direction.dot(di);if(s>0){if(i)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}ci.subVectors(this.origin,e);const a=o*this.direction.dot(hi.crossVectors(ci,hi));if(a<0)return null;const l=o*this.direction.dot(ui.cross(ci));if(l<0)return null;if(a+l>s)return null;const c=-o*ci.dot(di);return c<0?null:this.at(c/s,r)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});const fi=new mn,mi=new mn,gi=new rn;function yi(e,t){this.normal=void 0!==e?e:new mn(1,0,0),this.constant=void 0!==t?t:0}Object.assign(yi.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,n){const i=fi.subVectors(n,t).cross(mi.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new mn),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new mn);const n=e.delta(fi),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?void 0:t.copy(n).multiplyScalar(r).add(e.start)},intersectsLine:function(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new mn),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){const n=t||gi.getNormalMatrix(e),i=this.coplanarPoint(fi).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});const vi=new mn,bi=new mn,xi=new mn,wi=new mn,_i=new mn,Si=new mn,Mi=new mn,Ai=new mn,Ci=new mn,Ti=new mn;function Ei(e,t,n){this.a=void 0!==e?e:new mn,this.b=void 0!==t?t:new mn,this.c=void 0!==n?n:new mn}Object.assign(Ei,{getNormal:function(e,t,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new mn),i.subVectors(n,t),vi.subVectors(e,t),i.cross(vi);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)},getBarycoord:function(e,t,n,i,r){vi.subVectors(i,t),bi.subVectors(n,t),xi.subVectors(e,t);const o=vi.dot(vi),s=vi.dot(bi),a=vi.dot(xi),l=bi.dot(bi),c=bi.dot(xi),u=o*l-s*s;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new mn),0===u)return r.set(-2,-1,-1);const h=1/u,d=(l*a-s*c)*h,p=(o*c-s*a)*h;return r.set(1-d-p,p,d)},containsPoint:function(e,t,n,i){return Ei.getBarycoord(e,t,n,i,wi),wi.x>=0&&wi.y>=0&&wi.x+wi.y<=1},getUV:function(e,t,n,i,r,o,s,a){return this.getBarycoord(e,t,n,i,wi),a.set(0,0),a.addScaledVector(r,wi.x),a.addScaledVector(o,wi.y),a.addScaledVector(s,wi.z),a},isFrontFacing:function(e,t,n,i){return vi.subVectors(n,t),bi.subVectors(e,t),vi.cross(bi).dot(i)<0}}),Object.assign(Ei.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return vi.subVectors(this.c,this.b),bi.subVectors(this.a,this.b),.5*vi.cross(bi).length()},getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new mn),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Ei.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new yi),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Ei.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,n,i,r){return Ei.getUV(e,this.a,this.b,this.c,t,n,i,r)},containsPoint:function(e){return Ei.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return Ei.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new mn);const n=this.a,i=this.b,r=this.c;let o,s;_i.subVectors(i,n),Si.subVectors(r,n),Ai.subVectors(e,n);const a=_i.dot(Ai),l=Si.dot(Ai);if(a<=0&&l<=0)return t.copy(n);Ci.subVectors(e,i);const c=_i.dot(Ci),u=Si.dot(Ci);if(c>=0&&u<=c)return t.copy(i);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return o=a/(a-c),t.copy(n).addScaledVector(_i,o);Ti.subVectors(e,r);const d=_i.dot(Ti),p=Si.dot(Ti);if(p>=0&&d<=p)return t.copy(r);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),t.copy(n).addScaledVector(Si,s);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return Mi.subVectors(r,i),s=(u-c)/(u-c+(d-p)),t.copy(i).addScaledVector(Mi,s);const g=1/(m+f+h);return o=f*g,s=h*g,t.copy(n).addScaledVector(_i,o).addScaledVector(Si,s)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});const Pi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ii={h:0,s:0,l:0},Li={h:0,s:0,l:0};function Ri(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}function ki(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Di(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Oi(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function Ni(e,t,n,i,r,o){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new mn,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new Ri,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==o?o:0}Object.assign(Ri.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(e=tn.euclideanModulo(e,1),t=tn.clamp(t,0,1),n=tn.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=ki(r,i,e+1/3),this.g=ki(r,i,e),this.b=ki(r,i,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){let e;const i=n[1],r=n[2];switch(i){case"rgb":case"rgba":if(e=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[5]),this;if(e=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[5]),this;break;case"hsl":case"hsla":if(e=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r)){const n=parseFloat(e[1])/360,i=parseInt(e[2],10)/100,r=parseInt(e[3],10)/100;return t(e[5]),this.setHSL(n,i,r)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){const t=Pi[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=Di(e.r),this.g=Di(e.g),this.b=Di(e.b),this},copyLinearToSRGB:function(e){return this.r=Oi(e.r),this.g=Oi(e.g),this.b=Oi(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,n=this.g,i=this.b,r=Math.max(t,n,i),o=Math.min(t,n,i);let s,a;const l=(o+r)/2;if(o===r)s=0,a=0;else{const e=r-o;switch(a=l<=.5?e/(r+o):e/(2-r-o),r){case t:s=(n-i)/e+(n<i?6:0);break;case n:s=(i-t)/e+2;break;case i:s=(t-n)/e+4}s/=6}return e.h=s,e.s=a,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){return this.getHSL(Ii),Ii.h+=e,Ii.s+=t,Ii.l+=n,this.setHSL(Ii.h,Ii.s,Ii.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(Ii),e.getHSL(Li);const n=tn.lerp(Ii.h,Li.h,t),i=tn.lerp(Ii.s,Li.s,t),r=tn.lerp(Ii.l,Li.l,t);return this.setHSL(n,i,r),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},fromBufferAttribute:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this},toJSON:function(){return this.getHex()}}),Ri.NAMES=Pi,Object.assign(Ni.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});let Bi=0;function Fi(){Object.defineProperty(this,"id",{value:Bi++}),this.uuid=tn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=f,this.side=c,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=E,this.blendDst=P,this.blendEquation=b,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=F,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Zt,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Yt,this.stencilZFail=Yt,this.stencilZPass=Yt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function zi(e){Fi.call(this),this.type="MeshBasicMaterial",this.color=new Ri(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=V,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}Fi.prototype=Object.assign(Object.create(Jt.prototype),{constructor:Fi,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===d;continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}},toJSON:function(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==f&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==c&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Fi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),zi.prototype=Object.create(Fi.prototype),zi.prototype.constructor=zi,zi.prototype.isMeshBasicMaterial=!0,zi.prototype.copy=function(e){return Fi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};const Ui=new mn,Hi=new nn;function Gi(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=Kt,this.updateRange={offset:0,count:-1},this.version=0}function Vi(e,t,n){Gi.call(this,new Int8Array(e),t,n)}function ji(e,t,n){Gi.call(this,new Uint8Array(e),t,n)}function $i(e,t,n){Gi.call(this,new Uint8ClampedArray(e),t,n)}function Wi(e,t,n){Gi.call(this,new Int16Array(e),t,n)}function qi(e,t,n){Gi.call(this,new Uint16Array(e),t,n)}function Xi(e,t,n){Gi.call(this,new Int32Array(e),t,n)}function Yi(e,t,n){Gi.call(this,new Uint32Array(e),t,n)}function Zi(e,t,n){Gi.call(this,new Float32Array(e),t,n)}function Ki(e,t,n){Gi.call(this,new Float64Array(e),t,n)}function Qi(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Ji(e){if(0===e.length)return-1/0;let t=e[0];for(let n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}Object.defineProperty(Gi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Gi.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new Ri),t[n++]=r.r,t[n++]=r.g,t[n++]=r.b}return this},copyVector2sArray:function(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new nn),t[n++]=r.x,t[n++]=r.y}return this},copyVector3sArray:function(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new mn),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z}return this},copyVector4sArray:function(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new cn),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z,t[n++]=r.w}return this},applyMatrix3:function(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Hi.fromBufferAttribute(this,t),Hi.applyMatrix3(e),this.setXY(t,Hi.x,Hi.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Ui.fromBufferAttribute(this,t),Ui.applyMatrix3(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this},applyMatrix4:function(e){for(let t=0,n=this.count;t<n;t++)Ui.x=this.getX(t),Ui.y=this.getY(t),Ui.z=this.getZ(t),Ui.applyMatrix4(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this},applyNormalMatrix:function(e){for(let t=0,n=this.count;t<n;t++)Ui.x=this.getX(t),Ui.y=this.getY(t),Ui.z=this.getZ(t),Ui.applyNormalMatrix(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this},transformDirection:function(e){for(let t=0,n=this.count;t<n;t++)Ui.x=this.getX(t),Ui.y=this.getY(t),Ui.z=this.getZ(t),Ui.transformDirection(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Vi.prototype=Object.create(Gi.prototype),Vi.prototype.constructor=Vi,ji.prototype=Object.create(Gi.prototype),ji.prototype.constructor=ji,$i.prototype=Object.create(Gi.prototype),$i.prototype.constructor=$i,Wi.prototype=Object.create(Gi.prototype),Wi.prototype.constructor=Wi,qi.prototype=Object.create(Gi.prototype),qi.prototype.constructor=qi,Xi.prototype=Object.create(Gi.prototype),Xi.prototype.constructor=Xi,Yi.prototype=Object.create(Gi.prototype),Yi.prototype.constructor=Yi,Zi.prototype=Object.create(Gi.prototype),Zi.prototype.constructor=Zi,Ki.prototype=Object.create(Gi.prototype),Ki.prototype.constructor=Ki,Object.assign(Qi.prototype,{computeGroups:function(e){const t=[];let n,i,r;const o=e.faces;for(i=0;i<o.length;i++){const e=o[i];e.materialIndex!==r&&(r=e.materialIndex,void 0!==n&&(n.count=3*i-n.start,t.push(n)),n={start:3*i,materialIndex:r})}void 0!==n&&(n.count=3*i-n.start,t.push(n)),this.groups=t},fromGeometry:function(e){const t=e.faces,n=e.vertices,i=e.faceVertexUvs,r=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=e.morphTargets,a=s.length;let l;if(a>0){l=[];for(let e=0;e<a;e++)l[e]={name:s[e].name,data:[]};this.morphTargets.position=l}const c=e.morphNormals,u=c.length;let h;if(u>0){h=[];for(let e=0;e<u;e++)h[e]={name:c[e].name,data:[]};this.morphTargets.normal=h}const d=e.skinIndices,p=e.skinWeights,f=d.length===n.length,m=p.length===n.length;n.length>0&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<t.length;g++){const e=t[g];this.vertices.push(n[e.a],n[e.b],n[e.c]);const y=e.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{const t=e.normal;this.normals.push(t,t,t)}const v=e.vertexColors;if(3===v.length)this.colors.push(v[0],v[1],v[2]);else{const t=e.color;this.colors.push(t,t,t)}if(!0===r){const e=i[0][g];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new nn,new nn,new nn))}if(!0===o){const e=i[1][g];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new nn,new nn,new nn))}for(let t=0;t<a;t++){const n=s[t].vertices;l[t].data.push(n[e.a],n[e.b],n[e.c])}for(let t=0;t<u;t++){const e=c[t].vertexNormals[g];h[t].data.push(e.a,e.b,e.c)}f&&this.skinIndices.push(d[e.a],d[e.b],d[e.c]),m&&this.skinWeights.push(p[e.a],p[e.b],p[e.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});let er=1;const tr=new Sn,nr=new Hn,ir=new mn,rr=new ni,or=new ni,sr=new mn;function ar(){Object.defineProperty(this,"id",{value:er+=2}),this.uuid=tn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}ar.prototype=Object.assign(Object.create(Jt.prototype),{constructor:ar,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(Ji(e)>65535?Yi:qi)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new rn).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return tr.makeRotationX(e),this.applyMatrix4(tr),this},rotateY:function(e){return tr.makeRotationY(e),this.applyMatrix4(tr),this},rotateZ:function(e){return tr.makeRotationZ(e),this.applyMatrix4(tr),this},translate:function(e,t,n){return tr.makeTranslation(e,t,n),this.applyMatrix4(tr),this},scale:function(e,t,n){return tr.makeScale(e,t,n),this.applyMatrix4(tr),this},lookAt:function(e){return nr.lookAt(e),nr.updateMatrix(),this.applyMatrix4(nr.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ir).negate(),this.translate(ir.x,ir.y,ir.z),this},setFromObject:function(e){const t=e.geometry;if(e.isPoints||e.isLine){const e=new Zi(3*t.vertices.length,3),n=new Zi(3*t.colors.length,3);if(this.setAttribute("position",e.copyVector3sArray(t.vertices)),this.setAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){const e=new Zi(t.lineDistances.length,1);this.setAttribute("lineDistance",e.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Zi(t,3)),this},updateFromObject:function(e){let t=e.geometry;if(e.isMesh){let e=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(e=void 0,t.elementsNeedUpdate=!1),void 0===e)return this.fromGeometry(t);e.verticesNeedUpdate=t.verticesNeedUpdate,e.normalsNeedUpdate=t.normalsNeedUpdate,e.colorsNeedUpdate=t.colorsNeedUpdate,e.uvsNeedUpdate=t.uvsNeedUpdate,e.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=e}if(!0===t.verticesNeedUpdate){const e=this.attributes.position;void 0!==e&&(e.copyVector3sArray(t.vertices),e.needsUpdate=!0),t.verticesNeedUpdate=!1}if(!0===t.normalsNeedUpdate){const e=this.attributes.normal;void 0!==e&&(e.copyVector3sArray(t.normals),e.needsUpdate=!0),t.normalsNeedUpdate=!1}if(!0===t.colorsNeedUpdate){const e=this.attributes.color;void 0!==e&&(e.copyColorsArray(t.colors),e.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){const e=this.attributes.uv;void 0!==e&&(e.copyVector2sArray(t.uvs),e.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){const e=this.attributes.lineDistance;void 0!==e&&(e.copyArray(t.lineDistances),e.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Qi).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){const t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new Gi(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){const t=new Float32Array(3*e.normals.length);this.setAttribute("normal",new Gi(t,3).copyVector3sArray(e.normals))}if(e.colors.length>0){const t=new Float32Array(3*e.colors.length);this.setAttribute("color",new Gi(t,3).copyColorsArray(e.colors))}if(e.uvs.length>0){const t=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new Gi(t,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){const t=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new Gi(t,2).copyVector2sArray(e.uvs2))}this.groups=e.groups;for(const n in e.morphTargets){const t=[],i=e.morphTargets[n];for(let e=0,n=i.length;e<n;e++){const n=i[e],r=new Zi(3*n.data.length,3);r.name=n.name,t.push(r.copyVector3sArray(n.data))}this.morphAttributes[n]=t}if(e.skinIndices.length>0){const t=new Zi(4*e.skinIndices.length,4);this.setAttribute("skinIndex",t.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){const t=new Zi(4*e.skinWeights.length,4);this.setAttribute("skinWeight",t.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new ni);const e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const e=t[n];rr.setFromBufferAttribute(e),this.morphTargetsRelative?(sr.addVectors(this.boundingBox.min,rr.min),this.boundingBox.expandByPoint(sr),sr.addVectors(this.boundingBox.max,rr.max),this.boundingBox.expandByPoint(sr)):(this.boundingBox.expandByPoint(rr.min),this.boundingBox.expandByPoint(rr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new oi);const e=this.attributes.position,t=this.morphAttributes.position;if(e){const n=this.boundingSphere.center;if(rr.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const n=t[e];or.setFromBufferAttribute(n),this.morphTargetsRelative?(sr.addVectors(rr.min,or.min),rr.expandByPoint(sr),sr.addVectors(rr.max,or.max),rr.expandByPoint(sr)):(rr.expandByPoint(or.min),rr.expandByPoint(or.max))}rr.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)sr.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(sr));if(t)for(let r=0,o=t.length;r<o;r++){const o=t[r],s=this.morphTargetsRelative;for(let t=0,r=o.count;t<r;t++)sr.fromBufferAttribute(o,t),s&&(ir.fromBufferAttribute(e,t),sr.add(ir)),i=Math.max(i,n.distanceToSquared(sr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Gi(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new mn,r=new mn,o=new mn,s=new mn,a=new mn,l=new mn,c=new mn,u=new mn;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),o.fromBufferAttribute(t,f),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),s.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),s.add(c),a.add(c),l.add(c),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,h=t.count;e<h;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===e.attributes[i])continue;const r=n[i].array,o=e.attributes[i],s=o.array,a=o.itemSize*t,l=Math.min(s.length,r.length-a);for(let e=0,t=a;e<l;e++,t++)r[t]=s[e]}return this},normalizeNormals:function(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)sr.fromBufferAttribute(e,t),sr.normalize(),e.setXYZ(t,sr.x,sr.y,sr.z)},toNonIndexed:function(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,o=new n.constructor(t.length*i);let s=0,a=0;for(let l=0,c=t.length;l<c;l++){s=t[l]*i;for(let e=0;e<i;e++)o[a++]=n[s++]}return new Gi(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const t=new ar,n=this.index.array,i=this.attributes;for(const s in i){const r=e(i[s],n);t.setAttribute(s,r)}const r=this.morphAttributes;for(const s in r){const i=[],o=r[s];for(let t=0,r=o.length;t<r;t++){const r=e(o[t],n);i.push(r)}t.morphAttributes[s]=i}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let s=0,a=o.length;s<a;s++){const e=o[s];t.addGroup(e.start,e.count,e.materialIndex)}return t},toJSON:function(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const a in n){const t=n[a],i=t.toJSON(e.data);""!==t.name&&(i.name=t.name),e.data.attributes[a]=i}const i={};let r=!1;for(const a in this.morphAttributes){const t=this.morphAttributes[a],n=[];for(let i=0,r=t.length;i<r;i++){const r=t[i],o=r.toJSON(e.data);""!==r.name&&(o.name=r.name),n.push(o)}n.length>0&&(i[a]=n,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e},clone:function(){return(new ar).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const l in i){const e=i[l];this.setAttribute(l,e.clone(t))}const r=e.morphAttributes;for(const l in r){const e=[],n=r[l];for(let i=0,r=n.length;i<r;i++)e.push(n[i].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,c=o.length;l<c;l++){const e=o[l];this.addGroup(e.start,e.count,e.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const lr=new Sn,cr=new pi,ur=new oi,hr=new mn,dr=new mn,pr=new mn,fr=new mn,mr=new mn,gr=new mn,yr=new mn,vr=new mn,br=new mn,xr=new nn,wr=new nn,_r=new nn,Sr=new mn,Mr=new mn;function Ar(e,t){Hn.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new ar,this.material=void 0!==t?t:new zi,this.updateMorphTargets()}function Cr(e,t,n,i,r,o,s,a){let l;if(l=t.side===u?i.intersectTriangle(s,o,r,!0,a):i.intersectTriangle(r,o,s,t.side!==h,a),null===l)return null;Mr.copy(a),Mr.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Mr);return c<n.near||c>n.far?null:{distance:c,point:Mr.clone(),object:e}}function Tr(e,t,n,i,r,o,s,a,l,c,u,h){hr.fromBufferAttribute(r,c),dr.fromBufferAttribute(r,u),pr.fromBufferAttribute(r,h);const d=e.morphTargetInfluences;if(t.morphTargets&&o&&d){yr.set(0,0,0),vr.set(0,0,0),br.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=d[e],n=o[e];0!==t&&(fr.fromBufferAttribute(n,c),mr.fromBufferAttribute(n,u),gr.fromBufferAttribute(n,h),s?(yr.addScaledVector(fr,t),vr.addScaledVector(mr,t),br.addScaledVector(gr,t)):(yr.addScaledVector(fr.sub(hr),t),vr.addScaledVector(mr.sub(dr),t),br.addScaledVector(gr.sub(pr),t)))}hr.add(yr),dr.add(vr),pr.add(br)}e.isSkinnedMesh&&(e.boneTransform(c,hr),e.boneTransform(u,dr),e.boneTransform(h,pr));const p=Cr(e,t,n,i,hr,dr,pr,Sr);if(p){a&&(xr.fromBufferAttribute(a,c),wr.fromBufferAttribute(a,u),_r.fromBufferAttribute(a,h),p.uv=Ei.getUV(Sr,hr,dr,pr,xr,wr,_r,new nn)),l&&(xr.fromBufferAttribute(l,c),wr.fromBufferAttribute(l,u),_r.fromBufferAttribute(l,h),p.uv2=Ei.getUV(Sr,hr,dr,pr,xr,wr,_r,new nn));const e=new Ni(c,u,h);Ei.getNormal(hr,dr,pr,e.normal),p.face=e}return p}Ar.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Ar,isMesh:!0,copy:function(e){return Hn.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),ur.copy(n.boundingSphere),ur.applyMatrix4(r),!1===e.ray.intersectsSphere(ur))return;if(lr.getInverse(r),cr.copy(e.ray).applyMatrix4(lr),null!==n.boundingBox&&!1===cr.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const r=n.index,s=n.attributes.position,a=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,u=n.attributes.uv2,h=n.groups,d=n.drawRange;if(null!==r)if(Array.isArray(i))for(let n=0,p=h.length;n<p;n++){const p=h[n],f=i[p.materialIndex];for(let n=Math.max(p.start,d.start),i=Math.min(p.start+p.count,d.start+d.count);n<i;n+=3){const i=r.getX(n),h=r.getX(n+1),d=r.getX(n+2);o=Tr(this,f,e,cr,s,a,l,c,u,i,h,d),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=p.materialIndex,t.push(o))}}else for(let n=Math.max(0,d.start),p=Math.min(r.count,d.start+d.count);n<p;n+=3){const h=r.getX(n),d=r.getX(n+1),p=r.getX(n+2);o=Tr(this,i,e,cr,s,a,l,c,u,h,d,p),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else if(void 0!==s)if(Array.isArray(i))for(let n=0,p=h.length;n<p;n++){const r=h[n],p=i[r.materialIndex];for(let n=Math.max(r.start,d.start),i=Math.min(r.start+r.count,d.start+d.count);n<i;n+=3)o=Tr(this,p,e,cr,s,a,l,c,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=r.materialIndex,t.push(o))}else for(let n=Math.max(0,d.start),p=Math.min(s.count,d.start+d.count);n<p;n+=3)o=Tr(this,i,e,cr,s,a,l,c,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else if(n.isGeometry){const r=Array.isArray(i),s=n.vertices,a=n.faces;let l;const c=n.faceVertexUvs[0];c.length>0&&(l=c);for(let n=0,u=a.length;n<u;n++){const c=a[n],u=r?i[c.materialIndex]:i;if(void 0===u)continue;const h=s[c.a],d=s[c.b],p=s[c.c];if(o=Cr(this,u,e,cr,h,d,p,Sr),o){if(l&&l[n]){const e=l[n];xr.copy(e[0]),wr.copy(e[1]),_r.copy(e[2]),o.uv=Ei.getUV(Sr,h,d,p,xr,wr,_r,new nn)}o.face=c,o.faceIndex=n,t.push(o)}}}}});let Er=0;const Pr=new Sn,Ir=new Hn,Lr=new mn;function Rr(){Object.defineProperty(this,"id",{value:Er+=2}),this.uuid=tn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Rr.prototype=Object.assign(Object.create(Jt.prototype),{constructor:Rr,isGeometry:!0,applyMatrix4:function(e){const t=(new rn).getNormalMatrix(e);for(let n=0,i=this.vertices.length;n<i;n++)this.vertices[n].applyMatrix4(e);for(let n=0,i=this.faces.length;n<i;n++){const e=this.faces[n];e.normal.applyMatrix3(t).normalize();for(let n=0,i=e.vertexNormals.length;n<i;n++)e.vertexNormals[n].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Pr.makeRotationX(e),this.applyMatrix4(Pr),this},rotateY:function(e){return Pr.makeRotationY(e),this.applyMatrix4(Pr),this},rotateZ:function(e){return Pr.makeRotationZ(e),this.applyMatrix4(Pr),this},translate:function(e,t,n){return Pr.makeTranslation(e,t,n),this.applyMatrix4(Pr),this},scale:function(e,t,n){return Pr.makeScale(e,t,n),this.applyMatrix4(Pr),this},lookAt:function(e){return Ir.lookAt(e),Ir.updateMatrix(),this.applyMatrix4(Ir.matrix),this},fromBufferGeometry:function(e){const t=this,n=null!==e.index?e.index:void 0,i=e.attributes;if(void 0===i.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const r=i.position,o=i.normal,s=i.color,a=i.uv,l=i.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let h=0;h<r.count;h++)t.vertices.push((new mn).fromBufferAttribute(r,h)),void 0!==s&&t.colors.push((new Ri).fromBufferAttribute(s,h));function c(e,n,i,r){const c=void 0===s?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[i].clone()],u=new Ni(e,n,i,void 0===o?[]:[(new mn).fromBufferAttribute(o,e),(new mn).fromBufferAttribute(o,n),(new mn).fromBufferAttribute(o,i)],c,r);t.faces.push(u),void 0!==a&&t.faceVertexUvs[0].push([(new nn).fromBufferAttribute(a,e),(new nn).fromBufferAttribute(a,n),(new nn).fromBufferAttribute(a,i)]),void 0!==l&&t.faceVertexUvs[1].push([(new nn).fromBufferAttribute(l,e),(new nn).fromBufferAttribute(l,n),(new nn).fromBufferAttribute(l,i)])}const u=e.groups;if(u.length>0)for(let h=0;h<u.length;h++){const e=u[h],t=e.start;for(let i=t,r=t+e.count;i<r;i+=3)void 0!==n?c(n.getX(i),n.getX(i+1),n.getX(i+2),e.materialIndex):c(i,i+1,i+2,e.materialIndex)}else if(void 0!==n)for(let h=0;h<n.count;h+=3)c(n.getX(h),n.getX(h+1),n.getX(h+2));else for(let h=0;h<r.count;h+=3)c(h,h+1,h+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Lr).negate(),this.translate(Lr.x,Lr.y,Lr.z),this},normalize:function(){this.computeBoundingSphere();const e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,i=new Sn;return i.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(i),this},computeFaceNormals:function(){const e=new mn,t=new mn;for(let n=0,i=this.faces.length;n<i;n++){const i=this.faces[n],r=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),t.subVectors(r,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){void 0===e&&(e=!0);const t=new Array(this.vertices.length);for(let n=0,i=this.vertices.length;n<i;n++)t[n]=new mn;if(e){const e=new mn,n=new mn;for(let i=0,r=this.faces.length;i<r;i++){const r=this.faces[i],o=this.vertices[r.a],s=this.vertices[r.b],a=this.vertices[r.c];e.subVectors(a,s),n.subVectors(o,s),e.cross(n),t[r.a].add(e),t[r.b].add(e),t[r.c].add(e)}}else{this.computeFaceNormals();for(let e=0,n=this.faces.length;e<n;e++){const n=this.faces[e];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let n=0,i=this.vertices.length;n<i;n++)t[n].normalize();for(let n=0,i=this.faces.length;n<i;n++){const e=this.faces[n],i=e.vertexNormals;3===i.length?(i[0].copy(t[e.a]),i[1].copy(t[e.b]),i[2].copy(t[e.c])):(i[0]=t[e.a].clone(),i[1]=t[e.b].clone(),i[2]=t[e.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],n=t.vertexNormals;3===n.length?(n[0].copy(t.normal),n[1].copy(t.normal),n[2].copy(t.normal)):(n[0]=t.normal.clone(),n[1]=t.normal.clone(),n[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let t=0,n=this.faces.length;t<n;t++){const e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,n=e.vertexNormals.length;t<n;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}const e=new Rr;e.faces=this.faces;for(let t=0,n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];const e=this.morphNormals[t].faceNormals,n=this.morphNormals[t].vertexNormals;for(let t=0,i=this.faces.length;t<i;t++){const t=new mn,i={a:new mn,b:new mn,c:new mn};e.push(t),n.push(i)}}const n=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],i=n.faceNormals[e],r=n.vertexNormals[e];i.copy(t.normal),r.a.copy(t.vertexNormals[0]),r.b.copy(t.vertexNormals[1]),r.c.copy(t.vertexNormals[2])}}for(let t=0,n=this.faces.length;t<n;t++){const e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new ni),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new oi),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let i,r=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,l=e.faces,c=this.colors,u=e.colors;void 0===n&&(n=0),void 0!==t&&(i=(new rn).getNormalMatrix(t));for(let h=0,d=s.length;h<d;h++){const e=s[h].clone();void 0!==t&&e.applyMatrix4(t),o.push(e)}for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone());for(let h=0,d=l.length;h<d;h++){let e,t,o,s=l[h],c=s.vertexNormals,u=s.vertexColors;e=new Ni(s.a+r,s.b+r,s.c+r),e.normal.copy(s.normal),void 0!==i&&e.normal.applyMatrix3(i).normalize();for(let n=0,r=c.length;n<r;n++)t=c[n].clone(),void 0!==i&&t.applyMatrix3(i).normalize(),e.vertexNormals.push(t);e.color.copy(s.color);for(let n=0,i=u.length;n<i;n++)o=u[n],e.vertexColors.push(o.clone());e.materialIndex=s.materialIndex+n,a.push(e)}for(let h=0,d=e.faceVertexUvs.length;h<d;h++){const t=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(let e=0,n=t.length;e<n;e++){const n=t[e],i=[];for(let e=0,t=n.length;e<t;e++)i.push(n[e].clone());this.faceVertexUvs[h].push(i)}}},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){const e={},t=[],n=[],i=4,r=Math.pow(10,i);for(let a=0,l=this.vertices.length;a<l;a++){const i=this.vertices[a],o=Math.round(i.x*r)+"_"+Math.round(i.y*r)+"_"+Math.round(i.z*r);void 0===e[o]?(e[o]=a,t.push(this.vertices[a]),n[a]=t.length-1):n[a]=n[e[o]]}const o=[];for(let a=0,l=this.faces.length;a<l;a++){const e=this.faces[a];e.a=n[e.a],e.b=n[e.b],e.c=n[e.c];const t=[e.a,e.b,e.c];for(let n=0;n<3;n++)if(t[n]===t[(n+1)%3]){o.push(a);break}}for(let a=o.length-1;a>=0;a--){const e=o[a];this.faces.splice(e,1);for(let t=0,n=this.faceVertexUvs.length;t<n;t++)this.faceVertexUvs[t].splice(e,1)}const s=this.vertices.length-t.length;return this.vertices=t,s},setFromPoints:function(e){this.vertices=[];for(let t=0,n=e.length;t<n;t++){const n=e[t];this.vertices.push(new mn(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){const e=this.faces,t=e.length;for(let a=0;a<t;a++)e[a]._id=a;function n(e,t){return e.materialIndex-t.materialIndex}e.sort(n);const i=this.faceVertexUvs[0],r=this.faceVertexUvs[1];let o,s;i&&i.length===t&&(o=[]),r&&r.length===t&&(s=[]);for(let a=0;a<t;a++){const t=e[a]._id;o&&o.push(i[t]),s&&s.push(r[t])}o&&(this.faceVertexUvs[0]=o),s&&(this.faceVertexUvs[1]=s)},toJSON:function(){const e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}const t=[];for(let p=0;p<this.vertices.length;p++){const e=this.vertices[p];t.push(e.x,e.y,e.z)}const n=[],i=[],r={},o=[],s={},a=[],l={};for(let p=0;p<this.faces.length;p++){const e=this.faces[p],t=!0,i=!1,r=void 0!==this.faceVertexUvs[0][p],o=e.normal.length()>0,s=e.vertexNormals.length>0,a=1!==e.color.r||1!==e.color.g||1!==e.color.b,l=e.vertexColors.length>0;let f=0;if(f=c(f,0,0),f=c(f,1,t),f=c(f,2,i),f=c(f,3,r),f=c(f,4,o),f=c(f,5,s),f=c(f,6,a),f=c(f,7,l),n.push(f),n.push(e.a,e.b,e.c),n.push(e.materialIndex),r){const e=this.faceVertexUvs[0][p];n.push(d(e[0]),d(e[1]),d(e[2]))}if(o&&n.push(u(e.normal)),s){const t=e.vertexNormals;n.push(u(t[0]),u(t[1]),u(t[2]))}if(a&&n.push(h(e.color)),l){const t=e.vertexColors;n.push(h(t[0]),h(t[1]),h(t[2]))}}function c(e,t,n){return n?e|1<<t:e&~(1<<t)}function u(e){const t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==r[t]||(r[t]=i.length/3,i.push(e.x,e.y,e.z)),r[t]}function h(e){const t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==s[t]||(s[t]=o.length,o.push(e.getHex())),s[t]}function d(e){const t=e.x.toString()+e.y.toString();return void 0!==l[t]||(l[t]=a.length/2,a.push(e.x,e.y)),l[t]}return e.data={},e.data.vertices=t,e.data.normals=i,o.length>0&&(e.data.colors=o),a.length>0&&(e.data.uvs=[a]),e.data.faces=n,e},clone:function(){return(new Rr).copy(this)},copy:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;const t=e.vertices;for(let h=0,d=t.length;h<d;h++)this.vertices.push(t[h].clone());const n=e.colors;for(let h=0,d=n.length;h<d;h++)this.colors.push(n[h].clone());const i=e.faces;for(let h=0,d=i.length;h<d;h++)this.faces.push(i[h].clone());for(let h=0,d=e.faceVertexUvs.length;h<d;h++){const t=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(let e=0,n=t.length;e<n;e++){const n=t[e],i=[];for(let e=0,t=n.length;e<t;e++){const t=n[e];i.push(t.clone())}this.faceVertexUvs[h].push(i)}}const r=e.morphTargets;for(let h=0,d=r.length;h<d;h++){const e={};if(e.name=r[h].name,void 0!==r[h].vertices){e.vertices=[];for(let t=0,n=r[h].vertices.length;t<n;t++)e.vertices.push(r[h].vertices[t].clone())}if(void 0!==r[h].normals){e.normals=[];for(let t=0,n=r[h].normals.length;t<n;t++)e.normals.push(r[h].normals[t].clone())}this.morphTargets.push(e)}const o=e.morphNormals;for(let h=0,d=o.length;h<d;h++){const e={};if(void 0!==o[h].vertexNormals){e.vertexNormals=[];for(let t=0,n=o[h].vertexNormals.length;t<n;t++){const n=o[h].vertexNormals[t],i={};i.a=n.a.clone(),i.b=n.b.clone(),i.c=n.c.clone(),e.vertexNormals.push(i)}}if(void 0!==o[h].faceNormals){e.faceNormals=[];for(let t=0,n=o[h].faceNormals.length;t<n;t++)e.faceNormals.push(o[h].faceNormals[t].clone())}this.morphNormals.push(e)}const s=e.skinWeights;for(let h=0,d=s.length;h<d;h++)this.skinWeights.push(s[h].clone());const a=e.skinIndices;for(let h=0,d=a.length;h<d;h++)this.skinIndices.push(a[h].clone());const l=e.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);const c=e.boundingBox;null!==c&&(this.boundingBox=c.clone());const u=e.boundingSphere;return null!==u&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class kr extends Rr{constructor(e,t,n,i,r,o){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o},this.fromBufferGeometry(new Dr(e,t,n,i,r,o)),this.mergeVertices()}}class Dr extends ar{constructor(e,t,n,i,r,o){super(),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const s=this;e=e||1,t=t||1,n=n||1,i=Math.floor(i)||1,r=Math.floor(r)||1,o=Math.floor(o)||1;const a=[],l=[],c=[],u=[];let h=0,d=0;function p(e,t,n,i,r,o,p,f,m,g,y){const v=o/m,b=p/g,x=o/2,w=p/2,_=f/2,S=m+1,M=g+1;let A=0,C=0;const T=new mn;for(let s=0;s<M;s++){const o=s*b-w;for(let a=0;a<S;a++){const h=a*v-x;T[e]=h*i,T[t]=o*r,T[n]=_,l.push(T.x,T.y,T.z),T[e]=0,T[t]=0,T[n]=f>0?1:-1,c.push(T.x,T.y,T.z),u.push(a/m),u.push(1-s/g),A+=1}}for(let s=0;s<g;s++)for(let e=0;e<m;e++){const t=h+e+S*s,n=h+e+S*(s+1),i=h+(e+1)+S*(s+1),r=h+(e+1)+S*s;a.push(t,n,r),a.push(n,i,r),C+=6}s.addGroup(d,C,y),d+=C,h+=A}p("z","y","x",-1,-1,n,t,e,o,r,0),p("z","y","x",1,-1,n,t,-e,o,r,1),p("x","z","y",1,1,e,n,t,i,o,2),p("x","z","y",1,-1,e,n,-t,i,o,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new Zi(l,3)),this.setAttribute("normal",new Zi(c,3)),this.setAttribute("uv",new Zi(u,2))}}function Or(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function Nr(e){const t={};for(let n=0;n<e.length;n++){const i=Or(e[n]);for(const e in i)t[e]=i[e]}return t}const Br={clone:Or,merge:Nr};var Fr="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",zr="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function Ur(e){Fi.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Fr,this.fragmentShader=zr,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Hr(){Hn.call(this),this.type="Camera",this.matrixWorldInverse=new Sn,this.projectionMatrix=new Sn,this.projectionMatrixInverse=new Sn}function Gr(e,t,n,i){Hr.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Ur.prototype=Object.create(Fi.prototype),Ur.prototype.constructor=Ur,Ur.prototype.isShaderMaterial=!0,Ur.prototype.copy=function(e){return Fi.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Or(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this},Ur.prototype.toJSON=function(e){const t=Fi.prototype.toJSON.call(this,e);t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t},Hr.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Hr,isCamera:!0,copy:function(e,t){return Hn.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new mn),this.updateMatrixWorld(!0);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Hn.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){Hn.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Gr.prototype=Object.assign(Object.create(Hr.prototype),{constructor:Gr,isPerspectiveCamera:!0,copy:function(e,t){return Hr.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){const t=.5*this.getFilmHeight()/e;this.fov=2*tn.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){const e=Math.tan(.5*tn.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*tn.RAD2DEG*Math.atan(Math.tan(.5*tn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,i,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){let e=this.near,t=e*Math.tan(.5*tn.DEG2RAD*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;r+=o.offsetX*i/e,t-=o.offsetY*n/s,i*=o.width/e,n*=o.height/s}const s=this.filmOffset;0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){const t=Hn.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});const Vr=90,jr=1;function $r(e,t,n){if(Hn.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new Gr(Vr,jr,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new mn(1,0,0)),this.add(i);const r=new Gr(Vr,jr,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new mn(-1,0,0)),this.add(r);const o=new Gr(Vr,jr,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new mn(0,1,0)),this.add(o);const s=new Gr(Vr,jr,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new mn(0,-1,0)),this.add(s);const a=new Gr(Vr,jr,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new mn(0,0,1)),this.add(a);const l=new Gr(Vr,jr,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new mn(0,0,-1)),this.add(l),this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();const c=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,a),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(u),e.xr.enabled=c},this.clear=function(e,t,i,r){const o=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(n,s),e.clear(t,i,r);e.setRenderTarget(o)}}function Wr(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),un.call(this,e,e,t)}function qr(e,t,n,i,r,o,s,a,l,c,u,h){ln.call(this,null,o,s,a,l,c,i,r,u,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:le,this.minFilter=void 0!==c?c:le,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}$r.prototype=Object.create(Hn.prototype),$r.prototype.constructor=$r,Wr.prototype=Object.create(un.prototype),Wr.prototype.constructor=Wr,Wr.prototype.isWebGLCubeRenderTarget=!0,Wr.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;const n=new Gn,i={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#include <common>","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV = equirectUv( direction );","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},r=new Ur({name:"CubemapFromEquirect",uniforms:Or(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:u,blending:p});r.uniforms.tEquirect.value=t;const o=new Ar(new Dr(5,5,5),r);return n.add(o),new $r(1,10,this).update(e,n),o.geometry.dispose(),o.material.dispose(),this},qr.prototype=Object.create(ln.prototype),qr.prototype.constructor=qr,qr.prototype.isDataTexture=!0;const Xr=new oi,Yr=new mn;function Zr(e,t,n,i,r,o){this.planes=[void 0!==e?e:new yi,void 0!==t?t:new yi,void 0!==n?n:new yi,void 0!==i?i:new yi,void 0!==r?r:new yi,void 0!==o?o:new yi]}Object.assign(Zr.prototype,{set:function(e,t,n,i,r,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(i),s[4].copy(r),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromProjectionMatrix:function(e){const t=this.planes,n=e.elements,i=n[0],r=n[1],o=n[2],s=n[3],a=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],y=n[14],v=n[15];return t[0].setComponents(s-i,u-a,f-h,v-m).normalize(),t[1].setComponents(s+i,u+a,f+h,v+m).normalize(),t[2].setComponents(s+r,u+l,f+d,v+g).normalize(),t[3].setComponents(s-r,u-l,f-d,v-g).normalize(),t[4].setComponents(s-o,u-c,f-p,v-y).normalize(),t[5].setComponents(s+o,u+c,f+p,v+y).normalize(),this},intersectsObject:function(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Xr.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Xr)},intersectsSprite:function(e){return Xr.center.set(0,0,0),Xr.radius=.7071067811865476,Xr.applyMatrix4(e.matrixWorld),this.intersectsSphere(Xr)},intersectsSphere:function(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0},intersectsBox:function(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Yr.x=i.normal.x>0?e.max.x:e.min.x,Yr.y=i.normal.y>0?e.max.y:e.min.y,Yr.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Yr)<0)return!1}return!0},containsPoint:function(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}});const Kr={common:{diffuse:{value:new Ri(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new rn},uv2Transform:{value:new rn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new nn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ri(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Ri(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new rn}},sprite:{diffuse:{value:new Ri(15658734)},opacity:{value:1},center:{value:new nn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new rn}}};function Qr(){let e=null,t=!1,n=null,i=null;function r(t,o){n(t,o),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Jr(e,t){const n=t.isWebGL2,i=new WeakMap;function r(t,n){const i=t.array,r=t.usage,o=e.createBuffer();e.bindBuffer(n,o),e.bufferData(n,i,r),t.onUploadCallback();let s=5126;return i instanceof Float32Array?s=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?s=5123:i instanceof Int16Array?s=5122:i instanceof Uint32Array?s=5125:i instanceof Int32Array?s=5124:i instanceof Int8Array?s=5120:i instanceof Uint8Array&&(s=5121),{buffer:o,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}function o(t,i,r){const o=i.array,s=i.updateRange;e.bindBuffer(r,t),-1===s.count?e.bufferSubData(r,0,o):(n?e.bufferSubData(r,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):e.bufferSubData(r,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}function s(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)}function a(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))}function l(e,t){e.isInterleavedBufferAttribute&&(e=e.data);const n=i.get(e);void 0===n?i.set(e,r(e,t)):n.version<e.version&&(o(n.buffer,e,t),n.version=e.version)}return{get:s,remove:a,update:l}}function eo(e,t,n,i){Rr.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new to(e,t,n,i)),this.mergeVertices()}function to(e,t,n,i){ar.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=(e=e||1)/2,o=(t=t||1)/2,s=Math.floor(n)||1,a=Math.floor(i)||1,l=s+1,c=a+1,u=e/s,h=t/a,d=[],p=[],f=[],m=[];for(let g=0;g<c;g++){const e=g*h-o;for(let t=0;t<l;t++){const n=t*u-r;p.push(n,-e,0),f.push(0,0,1),m.push(t/s),m.push(1-g/a)}}for(let g=0;g<a;g++)for(let e=0;e<s;e++){const t=e+l*g,n=e+l*(g+1),i=e+1+l*(g+1),r=e+1+l*g;d.push(t,n,r),d.push(n,i,r)}this.setIndex(d),this.setAttribute("position",new Zi(p,3)),this.setAttribute("normal",new Zi(f,3)),this.setAttribute("uv",new Zi(m,2))}eo.prototype=Object.create(Rr.prototype),eo.prototype.constructor=eo,to.prototype=Object.create(ar.prototype),to.prototype.constructor=to;const no={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);    } else if (face == 1.0) {\n      uv = vec2(-direction.x, -direction.z) / abs(direction.y);    } else if (face == 2.0) {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);    } else if (face == 3.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);    } else if (face == 4.0) {\n      uv = vec2(-direction.x, direction.z) / abs(direction.y);    } else {\n      uv = vec2(direction.x, direction.y) / abs(direction.z);    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},io={basic:{uniforms:Nr([Kr.common,Kr.specularmap,Kr.envmap,Kr.aomap,Kr.lightmap,Kr.fog]),vertexShader:no.meshbasic_vert,fragmentShader:no.meshbasic_frag},lambert:{uniforms:Nr([Kr.common,Kr.specularmap,Kr.envmap,Kr.aomap,Kr.lightmap,Kr.emissivemap,Kr.fog,Kr.lights,{emissive:{value:new Ri(0)}}]),vertexShader:no.meshlambert_vert,fragmentShader:no.meshlambert_frag},phong:{uniforms:Nr([Kr.common,Kr.specularmap,Kr.envmap,Kr.aomap,Kr.lightmap,Kr.emissivemap,Kr.bumpmap,Kr.normalmap,Kr.displacementmap,Kr.fog,Kr.lights,{emissive:{value:new Ri(0)},specular:{value:new Ri(1118481)},shininess:{value:30}}]),vertexShader:no.meshphong_vert,fragmentShader:no.meshphong_frag},standard:{uniforms:Nr([Kr.common,Kr.envmap,Kr.aomap,Kr.lightmap,Kr.emissivemap,Kr.bumpmap,Kr.normalmap,Kr.displacementmap,Kr.roughnessmap,Kr.metalnessmap,Kr.fog,Kr.lights,{emissive:{value:new Ri(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:no.meshphysical_vert,fragmentShader:no.meshphysical_frag},toon:{uniforms:Nr([Kr.common,Kr.aomap,Kr.lightmap,Kr.emissivemap,Kr.bumpmap,Kr.normalmap,Kr.displacementmap,Kr.gradientmap,Kr.fog,Kr.lights,{emissive:{value:new Ri(0)}}]),vertexShader:no.meshtoon_vert,fragmentShader:no.meshtoon_frag},matcap:{uniforms:Nr([Kr.common,Kr.bumpmap,Kr.normalmap,Kr.displacementmap,Kr.fog,{matcap:{value:null}}]),vertexShader:no.meshmatcap_vert,fragmentShader:no.meshmatcap_frag},points:{uniforms:Nr([Kr.points,Kr.fog]),vertexShader:no.points_vert,fragmentShader:no.points_frag},dashed:{uniforms:Nr([Kr.common,Kr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:no.linedashed_vert,fragmentShader:no.linedashed_frag},depth:{uniforms:Nr([Kr.common,Kr.displacementmap]),vertexShader:no.depth_vert,fragmentShader:no.depth_frag},normal:{uniforms:Nr([Kr.common,Kr.bumpmap,Kr.normalmap,Kr.displacementmap,{opacity:{value:1}}]),vertexShader:no.normal_vert,fragmentShader:no.normal_frag},sprite:{uniforms:Nr([Kr.sprite,Kr.fog]),vertexShader:no.sprite_vert,fragmentShader:no.sprite_frag},background:{uniforms:{uvTransform:{value:new rn},t2D:{value:null}},vertexShader:no.background_vert,fragmentShader:no.background_frag},cube:{uniforms:Nr([Kr.envmap,{opacity:{value:1}}]),vertexShader:no.cube_vert,fragmentShader:no.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:no.equirect_vert,fragmentShader:no.equirect_frag},distanceRGBA:{uniforms:Nr([Kr.common,Kr.displacementmap,{referencePosition:{value:new mn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:no.distanceRGBA_vert,fragmentShader:no.distanceRGBA_frag},shadow:{uniforms:Nr([Kr.lights,Kr.fog,{color:{value:new Ri(0)},opacity:{value:1}}]),vertexShader:no.shadow_vert,fragmentShader:no.shadow_frag}};function ro(e,t,n,i){const r=new Ri(0);let o,s,a=0,l=null,h=0,d=null;function p(t,i,p,m){let g=!0===i.isScene?i.background:null;const y=e.xr,v=y.getSession&&y.getSession();if(v&&"additive"===v.environmentBlendMode&&(g=null),null===g?f(r,a):g&&g.isColor&&(f(g,1),m=!0),(e.autoClear||m)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),g&&(g.isCubeTexture||g.isWebGLCubeRenderTarget||g.mapping===ie)){void 0===s&&(s=new Ar(new Dr(1,1,1),new Ur({name:"BackgroundCubeMaterial",uniforms:Or(io.cube.uniforms),vertexShader:io.cube.vertexShader,fragmentShader:io.cube.fragmentShader,side:u,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(s));const i=g.isWebGLCubeRenderTarget?g.texture:g;s.material.uniforms.envMap.value=i,s.material.uniforms.flipEnvMap.value=i.isCubeTexture?-1:1,l===g&&h===i.version&&d===e.toneMapping||(s.material.needsUpdate=!0,l=g,h=i.version,d=e.toneMapping),t.unshift(s,s.geometry,s.material,0,0,null)}else g&&g.isTexture&&(void 0===o&&(o=new Ar(new to(2,2),new Ur({name:"BackgroundMaterial",uniforms:Or(io.background.uniforms),vertexShader:io.background.vertexShader,fragmentShader:io.background.fragmentShader,side:c,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),o.material.uniforms.uvTransform.value.copy(g.matrix),l===g&&h===g.version&&d===e.toneMapping||(o.material.needsUpdate=!0,l=g,h=g.version,d=e.toneMapping),t.unshift(o,o.geometry,o.material,0,0,null))}function f(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,i)}return{getClearColor:function(){return r},setClearColor:function(e,t){r.set(e),a=void 0!==t?t:1,f(r,a)},getClearAlpha:function(){return a},setClearAlpha:function(e){a=e,f(r,a)},render:p}}function oo(e,t,n,i){const r=e.getParameter(34921),o=i.isWebGL2?null:t.get("OES_vertex_array_object"),s=i.isWebGL2||null!==o,a={},l=m(null);let c=l;function u(t,i,r,o,a){let l=!1;if(s){const e=f(o,r,i);c!==e&&(c=e,d(c.object)),l=g(o),l&&y(o)}else{const e=!0===i.wireframe;c.geometry===o.id&&c.program===r.id&&c.wireframe===e||(c.geometry=o.id,c.program=r.id,c.wireframe=e,l=!0)}!0===t.isInstancedMesh&&(l=!0),null!==a&&n.update(a,34963),l&&(S(t,i,r,o),null!==a&&e.bindBuffer(34963,n.get(a).buffer))}function h(){return i.isWebGL2?e.createVertexArray():o.createVertexArrayOES()}function d(t){return i.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function p(t){return i.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function f(e,t,n){const i=!0===n.wireframe;let r=a[e.id];void 0===r&&(r={},a[e.id]=r);let o=r[t.id];void 0===o&&(o={},r[t.id]=o);let s=o[i];return void 0===s&&(s=m(h()),o[i]=s),s}function m(e){const t=[],n=[],i=[];for(let o=0;o<r;o++)t[o]=0,n[o]=0,i[o]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{}}}function g(e){const t=c.attributes,n=e.attributes;if(Object.keys(t).length!==Object.keys(n).length)return!0;for(const i in n){const e=t[i],r=n[i];if(e.attribute!==r)return!0;if(e.data!==r.data)return!0}return!1}function y(e){const t={},n=e.attributes;for(const i in n){const e=n[i],r={};r.attribute=e,e.data&&(r.data=e.data),t[i]=r}c.attributes=t}function v(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function b(e){x(e,0)}function x(n,r){const o=c.newAttributes,s=c.enabledAttributes,a=c.attributeDivisors;o[n]=1,0===s[n]&&(e.enableVertexAttribArray(n),s[n]=1),a[n]!==r&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),a[n]=r)}function w(){const t=c.newAttributes,n=c.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function _(t,n,r,o,s,a){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,o,s,a):e.vertexAttribIPointer(t,n,r,o,s,a)}function S(r,o,s,a){if(!1===i.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;v();const l=a.attributes,c=s.getAttributes(),u=o.defaultAttributeValues;for(const t in c){const i=c[t];if(i>=0){const o=l[t];if(void 0!==o){const t=o.normalized,r=o.itemSize,s=n.get(o);if(void 0===s)continue;const l=s.buffer,c=s.type,u=s.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,s=n.stride,h=o.offset;n&&n.isInstancedInterleavedBuffer?(x(i,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):b(i),e.bindBuffer(34962,l),_(i,r,c,t,s*u,h*u)}else o.isInstancedBufferAttribute?(x(i,o.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)):b(i),e.bindBuffer(34962,l),_(i,r,c,t,0,0)}else if("instanceMatrix"===t){const t=n.get(r.instanceMatrix);if(void 0===t)continue;const o=t.buffer,s=t.type;x(i+0,1),x(i+1,1),x(i+2,1),x(i+3,1),e.bindBuffer(34962,o),e.vertexAttribPointer(i+0,4,s,!1,64,0),e.vertexAttribPointer(i+1,4,s,!1,64,16),e.vertexAttribPointer(i+2,4,s,!1,64,32),e.vertexAttribPointer(i+3,4,s,!1,64,48)}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(i,n);break;case 3:e.vertexAttrib3fv(i,n);break;case 4:e.vertexAttrib4fv(i,n);break;default:e.vertexAttrib1fv(i,n)}}}}w()}function M(){T();for(const e in a){const t=a[e];for(const e in t){const n=t[e];for(const e in n)p(n[e].object),delete n[e];delete t[e]}delete a[e]}}function A(e){if(void 0===a[e.id])return;const t=a[e.id];for(const n in t){const e=t[n];for(const t in e)p(e[t].object),delete e[t];delete t[n]}delete a[e.id]}function C(e){for(const t in a){const n=a[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)p(i[e].object),delete i[e];delete n[e.id]}}function T(){E(),c!==l&&(c=l,d(c.object))}function E(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:T,resetDefaultState:E,dispose:M,releaseStatesOfGeometry:A,releaseStatesOfProgram:C,initAttributes:v,enableAttribute:b,disableUnusedAttributes:w}}function so(e,t,n,i){const r=i.isWebGL2;let o;function s(e){o=e}function a(t,i){e.drawArrays(o,t,i),n.update(i,o)}function l(i,s,a,l){if(0===l)return;let c,u;if(r)c=e,u="drawArraysInstanced";else if(c=t.get("ANGLE_instanced_arrays"),u="drawArraysInstancedANGLE",null===c)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](o,s,a,l),n.update(a,o,l)}this.setMode=s,this.render=a,this.renderInstances=l}function ao(e,t,n){let i;function r(){if(void 0!==i)return i;const n=t.get("EXT_texture_filter_anisotropic");return i=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,i}function o(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let a=void 0!==n.precision?n.precision:"highp";const l=o(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),y=e.getParameter(36349),v=h>0,b=s||!!t.get("OES_texture_float");return{isWebGL2:s,getMaxAnisotropy:r,getMaxPrecision:o,precision:a,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:y,vertexTextures:v,floatFragmentTextures:b,floatVertexTextures:v&&b,maxSamples:s?e.getParameter(36183):0}}function lo(){const e=this;let t=null,n=0,i=!1,r=!1;const o=new yi,s=new rn,a={value:null,needsUpdate:!1};function l(){a.value!==t&&(a.value=t,a.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function c(t,n,i,r){let l=null!==t?t.length:0,c=null;if(0!==l){if(c=a.value,!0!==r||null===c){const e=i+4*l,r=n.matrixWorldInverse;s.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let n=0,a=i;n!==l;++n,a+=4)o.copy(t[n]).applyMatrix4(r,s),o.normal.toArray(c,a),c[a+3]=o.constant}a.value=c,a.needsUpdate=!0}return e.numPlanes=l,e.numIntersection=0,c}this.uniform=a,this.numPlanes=0,this.numIntersection=0,this.init=function(e,r,o){const s=0!==e.length||r||0!==n||i;return i=r,t=c(e,o,0),n=e.length,s},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1,l()},this.setState=function(e,o,s,u,h,d){if(!i||null===e||0===e.length||r&&!s)r?c(null):l();else{const i=r?0:n,s=4*i;let l=h.clippingState||null;a.value=l,l=c(e,u,s,d);for(let e=0;e!==s;++e)l[e]=t[e];h.clippingState=l,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=i}}}function co(e){const t={};return{get:function(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return null===i&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=i,i}}}function uo(e,t,n,i){const r=new WeakMap,o=new WeakMap;function s(e){const a=e.target,l=r.get(a);null!==l.index&&t.remove(l.index);for(const n in l.attributes)t.remove(l.attributes[n]);a.removeEventListener("dispose",s),r.delete(a);const c=o.get(l);c&&(t.remove(c),o.delete(l)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e,t){let i=r.get(t);return i||(t.addEventListener("dispose",s),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new ar).setFromObject(e)),i=t._bufferGeometry),r.set(t,i),n.memory.geometries++,i)}function l(e){const n=e.attributes;for(const r in n)t.update(n[r],34962);const i=e.morphAttributes;for(const r in i){const e=i[r];for(let n=0,i=e.length;n<i;n++)t.update(e[n],34962)}}function c(e){const n=[],i=e.index,r=e.attributes.position;let s=0;if(null!==i){const e=i.array;s=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],o=e[t+2];n.push(i,r,r,o,o,i)}}else{const e=r.array;s=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}const a=new(Ji(n)>65535?Yi:qi)(n,1);a.version=s;const l=o.get(e);l&&t.remove(l),o.set(e,a)}function u(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&c(e)}else c(e);return o.get(e)}return{get:a,update:l,getWireframeAttribute:u}}function ho(e,t,n,i){const r=i.isWebGL2;let o,s,a;function l(e){o=e}function c(e){s=e.type,a=e.bytesPerElement}function u(t,i){e.drawElements(o,i,s,t*a),n.update(i,o)}function h(i,l,c,u){if(0===u)return;let h,d;if(r)h=e,d="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[d](o,c,s,l*a,u),n.update(c,o,u)}this.setMode=l,this.setIndex=c,this.render=u,this.renderInstances=h}function po(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(e,n,i){switch(i=i||1,t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}function i(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:i,update:n}}function fo(e,t){return e[0]-t[0]}function mo(e,t){return Math.abs(t[1])-Math.abs(e[1])}function go(e){const t={},n=new Float32Array(8),i=[];for(let o=0;o<8;o++)i[o]=[o,0];function r(r,o,s,a){const l=r.morphTargetInfluences,c=void 0===l?0:l.length;let u=t[o.id];if(void 0===u){u=[];for(let e=0;e<c;e++)u[e]=[e,0];t[o.id]=u}for(let e=0;e<c;e++){const t=u[e];t[0]=e,t[1]=l[e]}u.sort(mo);for(let e=0;e<8;e++)e<c&&u[e][1]?(i[e][0]=u[e][0],i[e][1]=u[e][1]):(i[e][0]=Number.MAX_SAFE_INTEGER,i[e][1]=0);i.sort(fo);const h=s.morphTargets&&o.morphAttributes.position,d=s.morphNormals&&o.morphAttributes.normal;let p=0;for(let e=0;e<8;e++){const t=i[e],r=t[0],s=t[1];r!==Number.MAX_SAFE_INTEGER&&s?(h&&o.getAttribute("morphTarget"+e)!==h[r]&&o.setAttribute("morphTarget"+e,h[r]),d&&o.getAttribute("morphNormal"+e)!==d[r]&&o.setAttribute("morphNormal"+e,d[r]),n[e]=s,p+=s):(h&&void 0!==o.getAttribute("morphTarget"+e)&&o.deleteAttribute("morphTarget"+e),d&&void 0!==o.getAttribute("morphNormal"+e)&&o.deleteAttribute("morphNormal"+e),n[e]=0)}const f=o.morphTargetsRelative?1:1-p;a.getUniforms().setValue(e,"morphTargetBaseInfluence",f),a.getUniforms().setValue(e,"morphTargetInfluences",n)}return{update:r}}function yo(e,t,n,i){let r=new WeakMap;function o(e){const o=i.render.frame,s=e.geometry,a=t.get(e,s);return r.get(a)!==o&&(s.isGeometry&&a.updateFromObject(e),t.update(a),r.set(a,o)),e.isInstancedMesh&&n.update(e.instanceMatrix,34962),a}function s(){r=new WeakMap}return{update:o,dispose:s}}function vo(e,t,n,i,r,o,s,a,l,c){e=void 0!==e?e:[],t=void 0!==t?t:J,s=void 0!==s?s:Te,ln.call(this,e,t,n,i,r,o,s,a,l,c),this.flipY=!1}function bo(e,t,n,i){ln.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:i||1},this.magFilter=le,this.minFilter=le,this.wrapR=se,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function xo(e,t,n,i){ln.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:i||1},this.magFilter=le,this.minFilter=le,this.wrapR=se,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}io.physical={uniforms:Nr([io.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new nn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Ri(0)},transparency:{value:0}}]),vertexShader:no.meshphysical_vert,fragmentShader:no.meshphysical_frag},vo.prototype=Object.create(ln.prototype),vo.prototype.constructor=vo,vo.prototype.isCubeTexture=!0,Object.defineProperty(vo.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),bo.prototype=Object.create(ln.prototype),bo.prototype.constructor=bo,bo.prototype.isDataTexture2DArray=!0,xo.prototype=Object.create(ln.prototype),xo.prototype.constructor=xo,xo.prototype.isDataTexture3D=!0;const wo=new ln,_o=new bo,So=new xo,Mo=new vo,Ao=[],Co=[],To=new Float32Array(16),Eo=new Float32Array(9),Po=new Float32Array(4);function Io(e,t,n){const i=e[0];if(i<=0||i>0)return e;let r=t*n,o=Ao[r];if(void 0===o&&(o=new Float32Array(r),Ao[r]=o),0!==t){i.toArray(o,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(o,r)}return o}function Lo(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function Ro(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function ko(e,t){let n=Co[t];void 0===n&&(n=new Int32Array(t),Co[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Do(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Oo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Lo(n,t))return;e.uniform2fv(this.addr,t),Ro(n,t)}}function No(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Lo(n,t))return;e.uniform3fv(this.addr,t),Ro(n,t)}}function Bo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Lo(n,t))return;e.uniform4fv(this.addr,t),Ro(n,t)}}function Fo(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Lo(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Ro(n,t)}else{if(Lo(n,i))return;Po.set(i),e.uniformMatrix2fv(this.addr,!1,Po),Ro(n,i)}}function zo(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Lo(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Ro(n,t)}else{if(Lo(n,i))return;Eo.set(i),e.uniformMatrix3fv(this.addr,!1,Eo),Ro(n,i)}}function Uo(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Lo(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Ro(n,t)}else{if(Lo(n,i))return;To.set(i),e.uniformMatrix4fv(this.addr,!1,To),Ro(n,i)}}function Ho(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(t||wo,r)}function Go(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||_o,r)}function Vo(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||So,r)}function jo(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(t||Mo,r)}function $o(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Wo(e,t){const n=this.cache;Lo(n,t)||(e.uniform2iv(this.addr,t),Ro(n,t))}function qo(e,t){const n=this.cache;Lo(n,t)||(e.uniform3iv(this.addr,t),Ro(n,t))}function Xo(e,t){const n=this.cache;Lo(n,t)||(e.uniform4iv(this.addr,t),Ro(n,t))}function Yo(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Zo(e){switch(e){case 5126:return Do;case 35664:return Oo;case 35665:return No;case 35666:return Bo;case 35674:return Fo;case 35675:return zo;case 35676:return Uo;case 5124:case 35670:return $o;case 35667:case 35671:return Wo;case 35668:case 35672:return qo;case 35669:case 35673:return Xo;case 5125:return Yo;case 35678:case 36198:case 36298:case 36306:case 35682:return Ho;case 35679:case 36299:case 36307:return Vo;case 35680:case 36300:case 36308:case 36293:return jo;case 36289:case 36303:case 36311:case 36292:return Go}}function Ko(e,t){e.uniform1fv(this.addr,t)}function Qo(e,t){e.uniform1iv(this.addr,t)}function Jo(e,t){e.uniform2iv(this.addr,t)}function es(e,t){e.uniform3iv(this.addr,t)}function ts(e,t){e.uniform4iv(this.addr,t)}function ns(e,t){const n=Io(t,this.size,2);e.uniform2fv(this.addr,n)}function is(e,t){const n=Io(t,this.size,3);e.uniform3fv(this.addr,n)}function rs(e,t){const n=Io(t,this.size,4);e.uniform4fv(this.addr,n)}function os(e,t){const n=Io(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function ss(e,t){const n=Io(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function as(e,t){const n=Io(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function ls(e,t,n){const i=t.length,r=ko(n,i);e.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)n.safeSetTexture2D(t[o]||wo,r[o])}function cs(e,t,n){const i=t.length,r=ko(n,i);e.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)n.safeSetTextureCube(t[o]||Mo,r[o])}function us(e){switch(e){case 5126:return Ko;case 35664:return ns;case 35665:return is;case 35666:return rs;case 35674:return os;case 35675:return ss;case 35676:return as;case 5124:case 35670:return Qo;case 35667:case 35671:return Jo;case 35668:case 35672:return es;case 35669:case 35673:return ts;case 35678:case 36198:case 36298:case 36306:case 35682:return ls;case 35680:case 36300:case 36308:case 36293:return cs}}function hs(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=Zo(t.type)}function ds(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=us(t.type)}function ps(e){this.id=e,this.seq=[],this.map={}}ds.prototype.updateCache=function(e){let t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Ro(t,e)},ps.prototype.setValue=function(e,t,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const o=i[r];o.setValue(e,t[o.id],n)}};const fs=/([\w\d_]+)(\])?(\[|\.)?/g;function ms(e,t){e.seq.push(t),e.map[t.id]=t}function gs(e,t,n){const i=e.name,r=i.length;for(fs.lastIndex=0;;){const o=fs.exec(i),s=fs.lastIndex;let a=o[1],l="]"===o[2],c=o[3];if(l&&(a|=0),void 0===c||"["===c&&s+2===r){ms(n,void 0===c?new hs(a,e,t):new ds(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new ps(a),ms(n,e)),n=e}}}function ys(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);gs(n,e.getUniformLocation(t,n.name),this)}}function vs(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}ys.prototype.setValue=function(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)},ys.prototype.setOptional=function(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)},ys.upload=function(e,t,n,i){for(let r=0,o=t.length;r!==o;++r){const o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}},ys.seqWithValue=function(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n};let bs=0;function xs(e){const t=e.split("\n");for(let n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}function ws(e){switch(e){case Bt:return["Linear","( value )"];case Ft:return["sRGB","( value )"];case Ut:return["RGBE","( value )"];case Gt:return["RGBM","( value, 7.0 )"];case Vt:return["RGBM","( value, 16.0 )"];case jt:return["RGBD","( value, 256.0 )"];case zt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Ht:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function _s(e,t,n){const i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return i&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+r+xs(e.getShaderSource(t))}function Ss(e,t){const n=ws(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Ms(e,t){const n=ws(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function As(e,t){let n;switch(t){case q:n="Linear";break;case X:n="Reinhard";break;case Y:n="OptimizedCineon";break;case Z:n="ACESFilmic";break;case K:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Cs(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ps).join("\n")}function Ts(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}function Es(e,t){const n={},i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r).name;n[i]=e.getAttribLocation(t,i)}return n}function Ps(e){return""!==e}function Is(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ls(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Rs=/^[ \t]*#include +<([\w\d./]+)>/gm;function ks(e){return e.replace(Rs,Ds)}function Ds(e,t){const n=no[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return ks(n)}const Os=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Ns=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g;function Bs(e){return e.replace(Ns,zs).replace(Os,Fs)}function Fs(e,t,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),zs(e,t,n,i)}function zs(e,t,n,i){let r="";for(let o=parseInt(t);o<parseInt(n);o++)r+=i.replace(/\[ i \]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function Us(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Hs(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===s?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===a?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===l&&(t="SHADOWMAP_TYPE_VSM"),t}function Gs(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case J:case ee:t="ENVMAP_TYPE_CUBE";break;case ie:case re:t="ENVMAP_TYPE_CUBE_UV";break;case te:case ne:t="ENVMAP_TYPE_EQUIREC"}return t}function Vs(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case ee:case ne:t="ENVMAP_MODE_REFRACTION"}return t}function js(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case V:t="ENVMAP_BLENDING_MULTIPLY";break;case j:t="ENVMAP_BLENDING_MIX";break;case $:t="ENVMAP_BLENDING_ADD"}return t}function $s(e,t,n,i){const r=e.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const l=Hs(n),c=Gs(n),u=Vs(n),h=js(n),d=e.gammaFactor>0?e.gammaFactor:1,p=n.isWebGL2?"":Cs(n),f=Ts(o),m=r.createProgram();let g,y;if(n.isRawShaderMaterial?(g=[f].filter(Ps).join("\n"),g.length>0&&(g+="\n"),y=[p,f].filter(Ps).join("\n"),y.length>0&&(y+="\n")):(g=[Us(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ps).join("\n"),y=[p,Us(n),"#define SHADER_NAME "+n.shaderName,f,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==W?"#define TONE_MAPPING":"",n.toneMapping!==W?no.tonemapping_pars_fragment:"",n.toneMapping!==W?As("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",no.encodings_pars_fragment,n.map?Ss("mapTexelToLinear",n.mapEncoding):"",n.matcap?Ss("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?Ss("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?Ss("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?Ss("lightMapTexelToLinear",n.lightMapEncoding):"",Ms("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Ps).join("\n")),s=ks(s),s=Is(s,n),s=Ls(s,n),a=ks(a),a=Is(a,n),a=Ls(a,n),s=Bs(s),a=Bs(a),n.isWebGL2&&!n.isRawShaderMaterial){let e=!1;const t=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&null!==s.match(t)&&null!==a.match(t)&&(e=!0,s=s.replace(t,""),a=a.replace(t,"")),g=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,y=["#version 300 es\n","#define varying in",e?"":"out highp vec4 pc_fragColor;",e?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y}const v=y+a,b=vs(r,35633,g+s),x=vs(r,35632,v);if(r.attachShader(m,b),r.attachShader(m,x),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),e.debug.checkShaderErrors){const e=r.getProgramInfoLog(m).trim(),t=r.getShaderInfoLog(b).trim(),n=r.getShaderInfoLog(x).trim();let i=!0,o=!0;if(!1===r.getProgramParameter(m,35714)){i=!1;const t=_s(r,b,"vertex"),n=_s(r,x,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(m,35715),"gl.getProgramInfoLog",e,t,n)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==n||(o=!1);o&&(this.diagnostics={runnable:i,programLog:e,vertexShader:{log:t,prefix:g},fragmentShader:{log:n,prefix:y}})}let w,_;return r.deleteShader(b),r.deleteShader(x),this.getUniforms=function(){return void 0===w&&(w=new ys(r,m)),w},this.getAttributes=function(){return void 0===_&&(_=Es(r,m)),_},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=bs++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=b,this.fragmentShader=x,this}function Ws(e,t,n,i){const r=[],o=n.isWebGL2,s=n.logarithmicDepthBuffer,a=n.floatVertexTextures,l=n.maxVertexUniforms,c=n.vertexTextures;let d=n.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function m(e,t){let n;if(t){const i=io[t];n={name:e.name||e.type,uniforms:Br.clone(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}}else n={name:e.name||e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};return n}function g(e){const t=e.skeleton.bones;if(a)return 1024;{const e=l,n=Math.floor((e-20)/4),i=Math.min(n,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}}function y(e){let t;return e?e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=Bt,t}function v(i,r,l,f,v,b,x){const w=f.fog,_=i.isMeshStandardMaterial?f.environment:null,S=i.envMap||_,M=p[i.type],A=x.isSkinnedMesh?g(x):0;null!==i.precision&&(d=n.getMaxPrecision(i.precision),d!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",d,"instead."));const C=m(i,M);i.onBeforeCompile(C,e);const T=e.getRenderTarget();return{isWebGL2:o,shaderID:M,shaderName:C.name,uniforms:C.uniforms,vertexShader:C.vertexShader,fragmentShader:C.fragmentShader,defines:i.defines,isRawShaderMaterial:i.isRawShaderMaterial,isShaderMaterial:i.isShaderMaterial,precision:d,instancing:!0===x.isInstancedMesh,supportsVertexTextures:c,outputEncoding:null!==T?y(T.texture):e.outputEncoding,map:!!i.map,mapEncoding:y(i.map),matcap:!!i.matcap,matcapEncoding:y(i.matcap),envMap:!!S,envMapMode:S&&S.mapping,envMapEncoding:y(S),envMapCubeUV:!!S&&(S.mapping===ie||S.mapping===re),lightMap:!!i.lightMap,lightMapEncoding:y(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:y(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:i.normalMapType===Xt,tangentSpaceNormalMap:i.normalMapType===qt,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!i.map||!!i.bumpMap||!!i.normalMap||!!i.specularMap||!!i.alphaMap||!!i.emissiveMap||!!i.roughnessMap||!!i.metalnessMap||!!i.clearcoatMap||!!i.clearcoatRoughnessMap||!!i.clearcoatNormalMap||!!i.displacementMap,uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap)&&!!i.displacementMap,fog:!!w,useFog:i.fog,fogExp2:w&&w.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:s,skinning:i.skinning&&A>0,maxBones:A,useVertexTexture:a,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numDirLightShadows:r.directionalShadowMap.length,numPointLightShadows:r.pointShadowMap.length,numSpotLightShadows:r.spotShadowMap.length,numClippingPlanes:v,numClipIntersection:b,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&l.length>0,shadowMapType:e.shadowMap.type,toneMapping:i.toneMapped?e.toneMapping:W,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:i.side===h,flipSided:i.side===u,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||null!==t.get("EXT_frag_depth"),rendererExtensionDrawBuffers:o||null!==t.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:o||null!==t.get("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}}function b(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(void 0===t.isRawShaderMaterial){for(let e=0;e<f.length;e++)n.push(t[f[e]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()}function x(t,n){let o;for(let e=0,i=r.length;e<i;e++){const t=r[e];if(t.cacheKey===n){o=t,++o.usedTimes;break}}return void 0===o&&(o=new $s(e,n,t,i),r.push(o)),o}function w(e){if(0===--e.usedTimes){const t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}}return{getParameters:v,getProgramCacheKey:b,acquireProgram:x,releaseProgram:w,programs:r}}function qs(){let e=new WeakMap;function t(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n}function n(t){e.delete(t)}function i(t,n,i){e.get(t)[n]=i}function r(){e=new WeakMap}return{get:t,remove:n,update:i,dispose:r}}function Xs(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ys(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Zs(){const e=[];let t=0;const n=[],i=[],r={id:-1};function o(){t=0,n.length=0,i.length=0}function s(n,i,o,s,a,l){let c=e[t];return void 0===c?(c={id:n.id,object:n,geometry:i,material:o,program:o.program||r,groupOrder:s,renderOrder:n.renderOrder,z:a,group:l},e[t]=c):(c.id=n.id,c.object=n,c.geometry=i,c.material=o,c.program=o.program||r,c.groupOrder=s,c.renderOrder=n.renderOrder,c.z=a,c.group=l),t++,c}function a(e,t,r,o,a,l){const c=s(e,t,r,o,a,l);(!0===r.transparent?i:n).push(c)}function l(e,t,r,o,a,l){const c=s(e,t,r,o,a,l);(!0===r.transparent?i:n).unshift(c)}function c(e,t){n.length>1&&n.sort(e||Xs),i.length>1&&i.sort(t||Ys)}function u(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.program=null,t.group=null}}return{opaque:n,transparent:i,init:o,push:a,unshift:l,finish:u,sort:c}}function Ks(){let e=new WeakMap;function t(n){const i=n.target;i.removeEventListener("dispose",t),e.delete(i)}function n(n,i){const r=e.get(n);let o;return void 0===r?(o=new Zs,e.set(n,new WeakMap),e.get(n).set(i,o),n.addEventListener("dispose",t)):(o=r.get(i),void 0===o&&(o=new Zs,r.set(i,o))),o}function i(){e=new WeakMap}return{get:n,dispose:i}}function Qs(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new mn,color:new Ri};break;case"SpotLight":n={position:new mn,direction:new mn,color:new Ri,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new mn,color:new Ri,distance:0,decay:0};break;case"HemisphereLight":n={direction:new mn,skyColor:new Ri,groundColor:new Ri};break;case"RectAreaLight":n={color:new Ri,position:new mn,halfWidth:new mn,halfHeight:new mn}}return e[t.id]=n,n}}}function Js(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new nn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new nn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}let ea=0;function ta(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function na(){const e=new Qs,t=Js(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let a=0;a<9;a++)n.probe.push(new mn);const i=new mn,r=new Sn,o=new Sn;function s(s,a,l){let c=0,u=0,h=0;for(let e=0;e<9;e++)n.probe[e].set(0,0,0);let d=0,p=0,f=0,m=0,g=0,y=0,v=0,b=0;const x=l.matrixWorldInverse;s.sort(ta);for(let _=0,S=s.length;_<S;_++){const a=s[_],l=a.color,w=a.intensity,S=a.distance,M=a.shadow&&a.shadow.map?a.shadow.map.texture:null;if(a.isAmbientLight)c+=l.r*w,u+=l.g*w,h+=l.b*w;else if(a.isLightProbe)for(let e=0;e<9;e++)n.probe[e].addScaledVector(a.sh.coefficients[e],w);else if(a.isDirectionalLight){const r=e.get(a);if(r.color.copy(a.color).multiplyScalar(a.intensity),r.direction.setFromMatrixPosition(a.matrixWorld),i.setFromMatrixPosition(a.target.matrixWorld),r.direction.sub(i),r.direction.transformDirection(x),a.castShadow){const e=a.shadow,i=t.get(a);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,n.directionalShadow[d]=i,n.directionalShadowMap[d]=M,n.directionalShadowMatrix[d]=a.shadow.matrix,y++}n.directional[d]=r,d++}else if(a.isSpotLight){const r=e.get(a);if(r.position.setFromMatrixPosition(a.matrixWorld),r.position.applyMatrix4(x),r.color.copy(l).multiplyScalar(w),r.distance=S,r.direction.setFromMatrixPosition(a.matrixWorld),i.setFromMatrixPosition(a.target.matrixWorld),r.direction.sub(i),r.direction.transformDirection(x),r.coneCos=Math.cos(a.angle),r.penumbraCos=Math.cos(a.angle*(1-a.penumbra)),r.decay=a.decay,a.castShadow){const e=a.shadow,i=t.get(a);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,n.spotShadow[f]=i,n.spotShadowMap[f]=M,n.spotShadowMatrix[f]=a.shadow.matrix,b++}n.spot[f]=r,f++}else if(a.isRectAreaLight){const t=e.get(a);t.color.copy(l).multiplyScalar(w),t.position.setFromMatrixPosition(a.matrixWorld),t.position.applyMatrix4(x),o.identity(),r.copy(a.matrixWorld),r.premultiply(x),o.extractRotation(r),t.halfWidth.set(.5*a.width,0,0),t.halfHeight.set(0,.5*a.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),n.rectArea[m]=t,m++}else if(a.isPointLight){const i=e.get(a);if(i.position.setFromMatrixPosition(a.matrixWorld),i.position.applyMatrix4(x),i.color.copy(a.color).multiplyScalar(a.intensity),i.distance=a.distance,i.decay=a.decay,a.castShadow){const e=a.shadow,i=t.get(a);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,n.pointShadow[p]=i,n.pointShadowMap[p]=M,n.pointShadowMatrix[p]=a.shadow.matrix,v++}n.point[p]=i,p++}else if(a.isHemisphereLight){const t=e.get(a);t.direction.setFromMatrixPosition(a.matrixWorld),t.direction.transformDirection(x),t.direction.normalize(),t.skyColor.copy(a.color).multiplyScalar(w),t.groundColor.copy(a.groundColor).multiplyScalar(w),n.hemi[g]=t,g++}}n.ambient[0]=c,n.ambient[1]=u,n.ambient[2]=h;const w=n.hash;w.directionalLength===d&&w.pointLength===p&&w.spotLength===f&&w.rectAreaLength===m&&w.hemiLength===g&&w.numDirectionalShadows===y&&w.numPointShadows===v&&w.numSpotShadows===b||(n.directional.length=d,n.spot.length=f,n.rectArea.length=m,n.point.length=p,n.hemi.length=g,n.directionalShadow.length=y,n.directionalShadowMap.length=y,n.pointShadow.length=v,n.pointShadowMap.length=v,n.spotShadow.length=b,n.spotShadowMap.length=b,n.directionalShadowMatrix.length=y,n.pointShadowMatrix.length=v,n.spotShadowMatrix.length=b,w.directionalLength=d,w.pointLength=p,w.spotLength=f,w.rectAreaLength=m,w.hemiLength=g,w.numDirectionalShadows=y,w.numPointShadows=v,w.numSpotShadows=b,n.version=ea++)}return{setup:s,state:n}}function ia(){const e=new na,t=[],n=[];function i(){t.length=0,n.length=0}function r(e){t.push(e)}function o(e){n.push(e)}function s(i){e.setup(t,n,i)}return{init:i,state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:s,pushLight:r,pushShadow:o}}function ra(){let e=new WeakMap;function t(n){const i=n.target;i.removeEventListener("dispose",t),e.delete(i)}function n(n,i){let r;return!1===e.has(n)?(r=new ia,e.set(n,new WeakMap),e.get(n).set(i,r),n.addEventListener("dispose",t)):!1===e.get(n).has(i)?(r=new ia,e.get(n).set(i,r)):r=e.get(n).get(i),r}function i(){e=new WeakMap}return{get:n,dispose:i}}function oa(e){Fi.call(this),this.type="MeshDepthMaterial",this.depthPacking=$t,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function sa(e){Fi.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new mn,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}oa.prototype=Object.create(Fi.prototype),oa.prototype.constructor=oa,oa.prototype.isMeshDepthMaterial=!0,oa.prototype.copy=function(e){return Fi.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},sa.prototype=Object.create(Fi.prototype),sa.prototype.constructor=sa,sa.prototype.isMeshDistanceMaterial=!0,sa.prototype.copy=function(e){return Fi.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var aa="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",la="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function ca(e,t,n){let i=new Zr;const r=new nn,o=new nn,a=new cn,d=[],f=[],m={},g={0:u,1:c,2:h},y=new Ur({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new nn},radius:{value:4}},vertexShader:la,fragmentShader:aa}),v=y.clone();v.defines.HORIZONAL_PASS=1;const b=new ar;b.setAttribute("position",new Gi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new Ar(b,y),w=this;function _(n,i){const r=t.update(x);y.uniforms.shadow_pass.value=n.map.texture,y.uniforms.resolution.value=n.mapSize,y.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,y,x,null),v.uniforms.shadow_pass.value=n.mapPass.texture,v.uniforms.resolution.value=n.mapSize,v.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,v,x,null)}function S(e,t,n){const i=e<<0|t<<1|n<<2;let r=d[i];return void 0===r&&(r=new oa({depthPacking:Wt,morphTargets:e,skinning:t}),d[i]=r),r}function M(e,t,n){const i=e<<0|t<<1|n<<2;let r=f[i];return void 0===r&&(r=new sa({morphTargets:e,skinning:t}),f[i]=r),r}function A(t,n,i,r,o,s,a){let c=null,u=S,h=t.customDepthMaterial;if(!0===r.isPointLight&&(u=M,h=t.customDistanceMaterial),void 0===h){let e=!1;!0===i.morphTargets&&(e=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let r=!1;!0===t.isSkinnedMesh&&(!0===i.skinning?r=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),c=u(e,r,!0===t.isInstancedMesh)}else c=h;if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){const e=c.uuid,t=i.uuid;let n=m[e];void 0===n&&(n={},m[e]=n);let r=n[t];void 0===r&&(r=c.clone(),n[t]=r),c=r}return c.visible=i.visible,c.wireframe=i.wireframe,c.side=a===l?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:g[i.side],c.clipShadows=i.clipShadows,c.clippingPlanes=i.clippingPlanes,c.clipIntersection=i.clipIntersection,c.wireframeLinewidth=i.wireframeLinewidth,c.linewidth=i.linewidth,!0===r.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(r.matrixWorld),c.nearDistance=o,c.farDistance=s),c}function C(n,r,o,s,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===l)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const i=t.update(n),r=n.material;if(Array.isArray(r)){const t=i.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=r[c.materialIndex];if(u&&u.visible){const t=A(n,i,u,s,o.near,o.far,a);e.renderBufferDirect(o,null,i,t,n,c)}}}else if(r.visible){const t=A(n,i,r,s,o.near,o.far,a);e.renderBufferDirect(o,null,i,t,n,null)}}const c=n.children;for(let e=0,t=c.length;e<t;e++)C(c[e],r,o,s,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=s,this.render=function(t,s,c){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===t.length)return;const u=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),f=e.state;f.setBlending(p),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(let p=0,m=t.length;p<m;p++){const u=t[p],h=u.shadow;if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;if(void 0===h){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}r.copy(h.mapSize);const d=h.getFrameExtents();if(r.multiply(d),o.copy(h.mapSize),(r.x>n||r.y>n)&&(r.x>n&&(o.x=Math.floor(n/d.x),r.x=o.x*d.x,h.mapSize.x=o.x),r.y>n&&(o.y=Math.floor(n/d.y),r.y=o.y*d.y,h.mapSize.y=o.y)),null===h.map&&!h.isPointLightShadow&&this.type===l){const e={minFilter:he,magFilter:he,format:Ee};h.map=new un(r.x,r.y,e),h.map.texture.name=u.name+".shadowMap",h.mapPass=new un(r.x,r.y,e),h.camera.updateProjectionMatrix()}if(null===h.map){const e={minFilter:le,magFilter:le,format:Ee};h.map=new un(r.x,r.y,e),h.map.texture.name=u.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const m=h.getViewportCount();for(let e=0;e<m;e++){const t=h.getViewport(e);a.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),f.viewport(a),h.updateMatrices(u,e),i=h.getFrustum(),C(s,c,h.camera,u,this.type)}h.isPointLightShadow||this.type!==l||_(h,c),h.needsUpdate=!1}w.needsUpdate=!1,e.setRenderTarget(u,h,d)}}function ua(e,t,n){const s=n.isWebGL2;function a(){let t=!1;const n=new cn;let i=null;const r=new cn(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,o,s,a){!0===a&&(t*=s,i*=s,o*=s),n.set(t,i,o,s),!1===r.equals(n)&&(e.clearColor(t,i,o,s),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}}function l(){let t=!1,n=null,i=null,r=null;return{setTest:function(e){e?ye(2929):ve(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case O:e.depthFunc(512);break;case N:e.depthFunc(519);break;case B:e.depthFunc(513);break;case F:e.depthFunc(515);break;case z:e.depthFunc(514);break;case U:e.depthFunc(518);break;case H:e.depthFunc(516);break;case G:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}}function c(){let t=!1,n=null,i=null,r=null,o=null,s=null,a=null,l=null,c=null;return{setTest:function(e){t||(e?ye(2960):ve(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,s){i===t&&r===n&&o===s||(e.stencilFunc(t,n,s),i=t,r=n,o=s)},setOp:function(t,n,i){s===t&&a===n&&l===i||(e.stencilOp(t,n,i),s=t,a=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,o=null,s=null,a=null,l=null,c=null}}}const d=new a,V=new l,j=new c;let $={},W=null,q=null,X=null,Y=null,Z=null,K=null,Q=null,J=null,ee=null,te=!1,ne=null,ie=null,re=null,oe=null,se=null;const ae=e.getParameter(35661);let le=!1,ce=0;const ue=e.getParameter(7938);-1!==ue.indexOf("WebGL")?(ce=parseFloat(/^WebGL\ ([0-9])/.exec(ue)[1]),le=ce>=1):-1!==ue.indexOf("OpenGL ES")&&(ce=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(ue)[1]),le=ce>=2);let he=null,de={};const pe=new cn,fe=new cn;function me(t,n,i){const r=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let s=0;s<i;s++)e.texImage2D(n+s,0,6408,1,1,0,6408,5121,r);return o}const ge={};function ye(t){!0!==$[t]&&(e.enable(t),$[t]=!0)}function ve(t){!1!==$[t]&&(e.disable(t),$[t]=!1)}function be(t){return W!==t&&(e.useProgram(t),W=t,!0)}ge[3553]=me(3553,3553,1),ge[34067]=me(34067,34069,6),d.setClear(0,0,0,1),V.setClear(1),j.setClear(0),ye(2929),V.setFunc(F),Me(!1),Ae(r),ye(2884),_e(p);const xe={[b]:32774,[x]:32778,[w]:32779};if(s)xe[_]=32775,xe[S]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(xe[_]=e.MIN_EXT,xe[S]=e.MAX_EXT)}const we={[M]:0,[A]:1,[C]:768,[E]:770,[D]:776,[R]:774,[I]:772,[T]:769,[P]:771,[k]:775,[L]:773};function _e(t,n,i,r,o,s,a,l){if(t!==p){if(q||(ye(3042),q=!0),t===v)o=o||n,s=s||i,a=a||r,n===Y&&o===Q||(e.blendEquationSeparate(xe[n],xe[o]),Y=n,Q=o),i===Z&&r===K&&s===J&&a===ee||(e.blendFuncSeparate(we[i],we[r],we[s],we[a]),Z=i,K=r,J=s,ee=a),X=t,te=null;else if(t!==X||l!==te){if(Y===b&&Q===b||(e.blendEquation(32774),Y=b,Q=b),l)switch(t){case f:e.blendFuncSeparate(1,771,1,771);break;case m:e.blendFunc(1,1);break;case g:e.blendFuncSeparate(0,0,769,771);break;case y:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case f:e.blendFuncSeparate(770,771,1,771);break;case m:e.blendFunc(770,1);break;case g:e.blendFunc(0,769);break;case y:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Z=null,K=null,J=null,ee=null,X=t,te=l}}else q&&(ve(3042),q=!1)}function Se(e,t){e.side===h?ve(2884):ye(2884);let n=e.side===u;t&&(n=!n),Me(n),e.blending===f&&!1===e.transparent?_e(p):_e(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),V.setFunc(e.depthFunc),V.setTest(e.depthTest),V.setMask(e.depthWrite),d.setMask(e.colorWrite);const i=e.stencilWrite;j.setTest(i),i&&(j.setMask(e.stencilWriteMask),j.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),j.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Te(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function Me(t){ne!==t&&(t?e.frontFace(2304):e.frontFace(2305),ne=t)}function Ae(t){t!==i?(ye(2884),t!==ie&&(t===r?e.cullFace(1029):t===o?e.cullFace(1028):e.cullFace(1032))):ve(2884),ie=t}function Ce(t){t!==re&&(le&&e.lineWidth(t),re=t)}function Te(t,n,i){t?(ye(32823),oe===n&&se===i||(e.polygonOffset(n,i),oe=n,se=i)):ve(32823)}function Ee(e){e?ye(3089):ve(3089)}function Pe(t){void 0===t&&(t=33984+ae-1),he!==t&&(e.activeTexture(t),he=t)}function Ie(t,n){null===he&&Pe();let i=de[he];void 0===i&&(i={type:void 0,texture:void 0},de[he]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||ge[t]),i.type=t,i.texture=n)}function Le(){const t=de[he];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)}function Re(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function ke(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function De(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function Oe(t){!1===pe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),pe.copy(t))}function Ne(t){!1===fe.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),fe.copy(t))}function Be(){$={},he=null,de={},W=null,X=null,ne=null,ie=null,d.reset(),V.reset(),j.reset()}return{buffers:{color:d,depth:V,stencil:j},enable:ye,disable:ve,useProgram:be,setBlending:_e,setMaterial:Se,setFlipSided:Me,setCullFace:Ae,setLineWidth:Ce,setPolygonOffset:Te,setScissorTest:Ee,activeTexture:Pe,bindTexture:Ie,unbindTexture:Le,compressedTexImage2D:Re,texImage2D:ke,texImage3D:De,scissor:Oe,viewport:Ne,reset:Be}}function ha(e,t,n,i,r,o,s){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,d=new WeakMap;let p,f=!1;try{f="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(J){}function m(e,t){return f?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(e,t,n,i){let r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?tn.floorPowerOfTwo:Math.floor,o=i(r*e.width),s=i(r*e.height);void 0===p&&(p=m(o,s));const a=n?m(o,s):p;return a.width=o,a.height=s,a.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function y(e){return tn.isPowerOfTwo(e.width)&&tn.isPowerOfTwo(e.height)}function v(e){return!a&&(e.wrapS!==se||e.wrapT!==se||e.minFilter!==le&&e.minFilter!==he)}function b(e,t){return e.generateMipmaps&&t&&e.minFilter!==le&&e.minFilter!==he}function x(t,n,r,o){e.generateMipmap(t),i.get(n).__maxMipLevel=Math.log(Math.max(r,o))*Math.LOG2E}function w(n,i,r){if(!1===a)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=i;return 6403===i&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),6407===i&&(5126===r&&(o=34837),5131===r&&(o=34843),5121===r&&(o=32849)),6408===i&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function _(e){return e===le||e===ce||e===ue?9728:9729}function S(e){const t=e.target;t.removeEventListener("dispose",S),A(t),t.isVideoTexture&&d.delete(t),s.memory.textures--}function M(e){const t=e.target;t.removeEventListener("dispose",M),C(t),s.memory.textures--}function A(t){const n=i.get(t);void 0!==n.__webglInit&&(e.deleteTexture(n.__webglTexture),i.remove(t))}function C(t){const n=i.get(t),r=i.get(t.texture);if(t){if(void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&e.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer);i.remove(t.texture),i.remove(t)}}let T=0;function E(){T=0}function P(){const e=T;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),T+=1,e}function I(e,t){const r=i.get(e);if(e.isVideoTexture&&X(e),e.version>0&&r.__version!==e.version){const n=e.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void z(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}function L(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?z(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))}function R(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?z(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))}function k(t,r){if(6!==t.image.length)return;const s=i.get(t);if(t.version>0&&s.__version!==t.version){F(s,t),n.activeTexture(33984+r),n.bindTexture(34067,s.__webglTexture),e.pixelStorei(37440,t.flipY);const i=t&&(t.isCompressedTexture||t.image[0].isCompressedTexture),l=t.image[0]&&t.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=i||l?l?t.image[e].image:t.image[e]:g(t.image[e],!1,!0,c);const h=u[0],d=y(h)||a,p=o.convert(t.format),f=o.convert(t.type),m=w(t.internalFormat,p,f);let v;if(B(34067,t,d),i){for(let e=0;e<6;e++){v=u[e].mipmaps;for(let i=0;i<v.length;i++){const r=v[i];t.format!==Ee&&t.format!==Te?null!==p?n.compressedTexImage2D(34069+e,i,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+e,i,m,r.width,r.height,0,p,f,r.data)}}s.__maxMipLevel=v.length-1}else{v=t.mipmaps;for(let e=0;e<6;e++)if(l){n.texImage2D(34069+e,0,m,u[e].width,u[e].height,0,p,f,u[e].data);for(let t=0;t<v.length;t++){const i=v[t].image[e].image;n.texImage2D(34069+e,t+1,m,i.width,i.height,0,p,f,i.data)}}else{n.texImage2D(34069+e,0,m,p,f,u[e]);for(let t=0;t<v.length;t++){const i=v[t];n.texImage2D(34069+e,t+1,m,p,f,i.image[e])}}s.__maxMipLevel=v.length}b(t,d)&&x(34067,t,h.width,h.height),s.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(33984+r),n.bindTexture(34067,s.__webglTexture)}function D(e,t){n.activeTexture(33984+t),n.bindTexture(34067,i.get(e).__webglTexture)}const O={[oe]:10497,[se]:33071,[ae]:33648},N={[le]:9728,[ce]:9984,[ue]:9986,[he]:9729,[de]:9985,[pe]:9987};function B(n,o,s){s?(e.texParameteri(n,10242,O[o.wrapS]),e.texParameteri(n,10243,O[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,O[o.wrapR]),e.texParameteri(n,10240,N[o.magFilter]),e.texParameteri(n,10241,N[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),o.wrapS===se&&o.wrapT===se||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,_(o.magFilter)),e.texParameteri(n,10241,_(o.minFilter)),o.minFilter!==le&&o.minFilter!==he&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const l=t.get("EXT_texture_filter_anisotropic");if(l){if(o.type===xe&&null===t.get("OES_texture_float_linear"))return;if(o.type===we&&null===(a||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(e.texParameterf(n,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function F(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",S),t.__webglTexture=e.createTexture(),s.memory.textures++)}function z(t,i,r){let s=3553;i.isDataTexture2DArray&&(s=35866),i.isDataTexture3D&&(s=32879),F(t,i),n.activeTexture(33984+r),n.bindTexture(s,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment);const l=v(i)&&!1===y(i.image),c=g(i.image,l,!1,u),h=y(c)||a,d=o.convert(i.format);let p,f=o.convert(i.type),m=w(i.internalFormat,d,f);B(s,i,h);const _=i.mipmaps;if(i.isDepthTexture)m=6402,a?m=i.type===xe?36012:i.type===be?33190:i.type===Ae?35056:33189:i.type===xe&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===Le&&6402===m&&i.type!==ye&&i.type!==be&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=ye,f=o.convert(i.type)),i.format===Re&&6402===m&&(m=34041,i.type!==Ae&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=Ae,f=o.convert(i.type))),n.texImage2D(3553,0,m,c.width,c.height,0,d,f,null);else if(i.isDataTexture)if(_.length>0&&h){for(let e=0,t=_.length;e<t;e++)p=_[e],n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);i.generateMipmaps=!1,t.__maxMipLevel=_.length-1}else n.texImage2D(3553,0,m,c.width,c.height,0,d,f,c.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(let e=0,t=_.length;e<t;e++)p=_[e],i.format!==Ee&&i.format!==Te?null!==d?n.compressedTexImage2D(3553,e,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);t.__maxMipLevel=_.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(_.length>0&&h){for(let e=0,t=_.length;e<t;e++)p=_[e],n.texImage2D(3553,e,m,d,f,p);i.generateMipmaps=!1,t.__maxMipLevel=_.length-1}else n.texImage2D(3553,0,m,d,f,c),t.__maxMipLevel=0;b(i,h)&&x(s,i,c.width,c.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function U(t,r,s,a){const l=o.convert(r.texture.format),c=o.convert(r.texture.type),u=w(r.texture.internalFormat,l,c);n.texImage2D(a,0,u,r.width,r.height,0,l,c,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,s,a,i.get(r.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function H(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===xe?r=36012:t.type===be&&(r=33190));const i=q(n);e.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(i){const t=q(n);e.renderbufferStorageMultisample(36161,t,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=o.convert(n.texture.format),r=o.convert(n.texture.type),s=w(n.texture.internalFormat,t,r);if(i){const t=q(n);e.renderbufferStorageMultisample(36161,t,s,n.width,n.height)}else e.renderbufferStorage(36161,s,n.width,n.height)}e.bindRenderbuffer(36161,null)}function G(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),I(n.depthTexture,0);const r=i.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===Le)e.framebufferTexture2D(36160,36096,3553,r,0);else{if(n.depthTexture.format!==Re)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,r,0)}}function V(t){const n=i.get(t),r=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");G(n.__webglFramebuffer,t)}else if(r){n.__webglDepthbuffer=[];for(let i=0;i<6;i++)e.bindFramebuffer(36160,n.__webglFramebuffer[i]),n.__webglDepthbuffer[i]=e.createRenderbuffer(),H(n.__webglDepthbuffer[i],t,!1)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),H(n.__webglDepthbuffer,t,!1);e.bindFramebuffer(36160,null)}function j(t){const r=i.get(t),l=i.get(t.texture);t.addEventListener("dispose",M),l.__webglTexture=e.createTexture(),s.memory.textures++;const c=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultisampleRenderTarget,h=y(t)||a;if(!a||t.texture.format!==Te||t.texture.type!==xe&&t.texture.type!==we||(t.texture.format=Ee,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),c){r.__webglFramebuffer=[];for(let t=0;t<6;t++)r.__webglFramebuffer[t]=e.createFramebuffer()}else if(r.__webglFramebuffer=e.createFramebuffer(),u)if(a){r.__webglMultisampledFramebuffer=e.createFramebuffer(),r.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,r.__webglColorRenderbuffer);const n=o.convert(t.texture.format),i=o.convert(t.texture.type),s=w(t.texture.internalFormat,n,i),a=q(t);e.renderbufferStorageMultisample(36161,a,s,t.width,t.height),e.bindFramebuffer(36160,r.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,r.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(r.__webglDepthRenderbuffer=e.createRenderbuffer(),H(r.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){n.bindTexture(34067,l.__webglTexture),B(34067,t.texture,h);for(let e=0;e<6;e++)U(r.__webglFramebuffer[e],t,36064,34069+e);b(t.texture,h)&&x(34067,t.texture,t.width,t.height),n.bindTexture(34067,null)}else n.bindTexture(3553,l.__webglTexture),B(3553,t.texture,h),U(r.__webglFramebuffer,t,36064,3553),b(t.texture,h)&&x(3553,t.texture,t.width,t.height),n.bindTexture(3553,null);t.depthBuffer&&V(t)}function $(e){const t=e.texture;if(b(t,y(e)||a)){const r=e.isWebGLCubeRenderTarget?34067:3553,o=i.get(t).__webglTexture;n.bindTexture(r,o),x(r,t,e.width,e.height),n.bindTexture(r,null)}}function W(t){if(t.isWebGLMultisampleRenderTarget)if(a){const n=i.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);const r=t.width,o=t.height;let s=16384;t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024),e.blitFramebuffer(0,0,r,o,0,0,r,o,s,9728),e.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function q(e){return a&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}function X(e){const t=s.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}let Y=!1,Z=!1;function K(e,t){e&&e.isWebGLRenderTarget&&(!1===Y&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Y=!0),e=e.texture),I(e,t)}function Q(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===Z&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Z=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?k(e,t):D(e,t)}this.allocateTextureUnit=P,this.resetTextureUnits=E,this.setTexture2D=I,this.setTexture2DArray=L,this.setTexture3D=R,this.setTextureCube=k,this.setTextureCubeDynamic=D,this.setupRenderTarget=j,this.updateRenderTargetMipmap=$,this.updateMultisampleRenderTarget=W,this.safeSetTexture2D=K,this.safeSetTextureCube=Q}function da(e,t,n){const i=n.isWebGL2;function r(e){let n;if(e===fe)return 5121;if(e===_e)return 32819;if(e===Se)return 32820;if(e===Me)return 33635;if(e===me)return 5120;if(e===ge)return 5122;if(e===ye)return 5123;if(e===ve)return 5124;if(e===be)return 5125;if(e===xe)return 5126;if(e===we)return i?5131:(n=t.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(e===Ce)return 6406;if(e===Te)return 6407;if(e===Ee)return 6408;if(e===Pe)return 6409;if(e===Ie)return 6410;if(e===Le)return 6402;if(e===Re)return 34041;if(e===ke)return 6403;if(e===De)return 36244;if(e===Oe)return 33319;if(e===Ne)return 33320;if(e===Be)return 36248;if(e===Fe)return 36249;if(e===ze||e===Ue||e===He||e===Ge){if(n=t.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(e===ze)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Ue)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===He)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Ge)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===Ve||e===je||e===$e||e===We){if(n=t.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(e===Ve)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===je)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===$e)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===We)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===qe)return n=t.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===Xe||e===Ye)&&(n=t.get("WEBGL_compressed_texture_etc"),null!==n)){if(e===Xe)return n.COMPRESSED_RGB8_ETC2;if(e===Ye)return n.COMPRESSED_RGBA8_ETC2_EAC}return e===Ze||e===Ke||e===Qe||e===Je||e===et||e===tt||e===nt||e===it||e===rt||e===ot||e===st||e===at||e===lt||e===ct||e===ht||e===dt||e===pt||e===ft||e===mt||e===gt||e===yt||e===vt||e===bt||e===xt||e===wt||e===_t||e===St||e===Mt?(n=t.get("WEBGL_compressed_texture_astc"),null!==n?e:null):e===ut?(n=t.get("EXT_texture_compression_bptc"),null!==n?e:null):e===Ae?i?34042:(n=t.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}return{convert:r}}function pa(e){Gr.call(this),this.cameras=e||[]}function fa(){Hn.call(this),this.type="Group"}function ma(){this._targetRay=null,this._grip=null}function ga(e,t){const n=this;let i=null,r=1,o=null,s="local-floor",a=null;const l=[],c=new Map,u=new Gr;u.layers.enable(1),u.viewport=new cn;const h=new Gr;h.layers.enable(2),h.viewport=new cn;const d=[u,h],p=new pa;p.layers.enable(1),p.layers.enable(2);let f=null,m=null;function g(e){const t=c.get(e.inputSource);t&&t.dispatchEvent({type:e.type})}function y(){c.forEach((function(e,t){e.disconnect(t)})),c.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),C.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function v(e){o=e,C.setContext(i),C.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function b(e){const t=i.inputSources;for(let n=0;n<l.length;n++)c.set(t[n],l[n]);for(let n=0;n<e.removed.length;n++){const t=e.removed[n],i=c.get(t);i&&(i.dispatchEvent({type:"disconnected",data:t}),c.delete(t))}for(let n=0;n<e.added.length;n++){const t=e.added[n],i=c.get(t);i&&i.dispatchEvent({type:"connected",data:t})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=l[e];return void 0===t&&(t=new ma,l[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=l[e];return void 0===t&&(t=new ma,l[e]=t),t.getGripSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return i},this.setSession=function(e){if(i=e,null!==i){i.addEventListener("select",g),i.addEventListener("selectstart",g),i.addEventListener("selectend",g),i.addEventListener("squeeze",g),i.addEventListener("squeezestart",g),i.addEventListener("squeezeend",g),i.addEventListener("end",y);const e=t.getContextAttributes();!0!==e.xrCompatible&&t.makeXRCompatible();const n={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:r},o=new XRWebGLLayer(i,t,n);i.updateRenderState({baseLayer:o}),i.requestReferenceSpace(s).then(v),i.addEventListener("inputsourceschange",b)}};const x=new mn,w=new mn;function _(e,t,n){x.setFromMatrixPosition(t.matrixWorld),w.setFromMatrixPosition(n.matrixWorld);const i=x.distanceTo(w),r=t.projectionMatrix.elements,o=n.projectionMatrix.elements,s=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(o[8]+1)/o[0],d=s*u,p=s*h,f=i/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);const g=s+f,y=a+f,v=d-m,b=p+(i-m),_=l*a/y*g,S=c*a/y*g;e.projectionMatrix.makePerspective(v,b,_,S,g,y)}function S(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}this.getCamera=function(e){p.near=h.near=u.near=e.near,p.far=h.far=u.far=e.far,f===p.near&&m===p.far||(i.updateRenderState({depthNear:p.near,depthFar:p.far}),f=p.near,m=p.far);const t=e.parent,n=p.cameras;S(p,t);for(let i=0;i<n.length;i++)S(n[i],t);e.matrixWorld.copy(p.matrixWorld);const r=e.children;for(let i=0,o=r.length;i<o;i++)r[i].updateMatrixWorld(!0);return 2===n.length?_(p,u,h):p.projectionMatrix.copy(u.projectionMatrix),p};let M=null;function A(t,n){if(a=n.getViewerPose(o),null!==a){const t=a.views,n=i.renderState.baseLayer;e.setFramebuffer(n.framebuffer);let r=!1;t.length!==p.cameras.length&&(p.cameras.length=0,r=!0);for(let e=0;e<t.length;e++){const i=t[e],o=n.getViewport(i),s=d[e];s.matrix.fromArray(i.transform.matrix),s.projectionMatrix.fromArray(i.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===e&&p.matrix.copy(s.matrix),!0===r&&p.cameras.push(s)}}const r=i.inputSources;for(let e=0;e<l.length;e++){const t=l[e],i=r[e];t.update(i,n,o)}M&&M(t,n)}const C=new Qr;C.setAnimationLoop(A),this.setAnimationLoop=function(e){M=e},this.dispose=function(){}}function ya(e){function t(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}function n(e,t,n,u,v){t.isMeshBasicMaterial?i(e,t):t.isMeshLambertMaterial?(i(e,t),l(e,t)):t.isMeshToonMaterial?(i(e,t),h(e,t)):t.isMeshPhongMaterial?(i(e,t),c(e,t)):t.isMeshStandardMaterial?(i(e,t,n),t.isMeshPhysicalMaterial?p(e,t,n):d(e,t,n)):t.isMeshMatcapMaterial?(i(e,t),f(e,t)):t.isMeshDepthMaterial?(i(e,t),m(e,t)):t.isMeshDistanceMaterial?(i(e,t),g(e,t)):t.isMeshNormalMaterial?(i(e,t),y(e,t)):t.isLineBasicMaterial?(r(e,t),t.isLineDashedMaterial&&o(e,t)):t.isPointsMaterial?s(e,t,u,v):t.isSpriteMaterial?a(e,t):t.isShadowMaterial?(e.color.value.copy(t.color),e.opacity.value=t.opacity):t.isShaderMaterial&&(t.uniformsNeedUpdate=!1)}function i(t,n,i){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);const r=n.envMap||i;let o,s;r&&(t.envMap.value=r,t.flipEnvMap.value=r.isCubeTexture?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio,t.maxMipLevel.value=e.get(r).__maxMipLevel),n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?o=n.map:n.specularMap?o=n.specularMap:n.displacementMap?o=n.displacementMap:n.normalMap?o=n.normalMap:n.bumpMap?o=n.bumpMap:n.roughnessMap?o=n.roughnessMap:n.metalnessMap?o=n.metalnessMap:n.alphaMap?o=n.alphaMap:n.emissiveMap&&(o=n.emissiveMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uvTransform.value.copy(o.matrix)),n.aoMap?s=n.aoMap:n.lightMap&&(s=n.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),t.uv2Transform.value.copy(s.matrix))}function r(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}function o(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function s(e,t,n,i){let r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}function a(e,t){let n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}function l(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}function c(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===u&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===u&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function h(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===u&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===u&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function d(e,t,n){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===u&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===u&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),(t.envMap||n)&&(e.envMapIntensity.value=t.envMapIntensity)}function p(e,t,n){d(e,t,n),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===u&&e.clearcoatNormalScale.value.negate()),e.transparency.value=t.transparency}function f(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===u&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===u&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function m(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function g(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}function y(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===u&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===u&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}return{refreshFogUniforms:t,refreshMaterialUniforms:n}}function va(e){const t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h=null,d=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Bt,this.physicallyCorrectLights=!1,this.toneMapping=W,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const p=this;let f=!1,m=null,g=0,y=0,v=null,b=null,x=-1,w=null,_=null;const S=new cn,M=new cn;let A=null,C=t.width,T=t.height,E=1,P=null,I=null;const L=new cn(0,0,C,T),R=new cn(0,0,C,T);let k=!1;const D=new Zr,O=new lo;let N=!1,B=!1;const F=new Sn,z=new mn,U={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function H(){return null===v?E:1}let G,V,j,$,q,X,Y,Z,K,Q,J,ee,te,ne,ie,re,oe,se,ae,le=n;function ce(e,n){for(let i=0;i<e.length;i++){const r=e[i],o=t.getContext(r,n);if(null!==o)return o}return null}try{const e={alpha:i,depth:r,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(t.addEventListener("webglcontextlost",pe,!1),t.addEventListener("webglcontextrestored",me,!1),null===le){const t=["webgl2","webgl","experimental-webgl"];if(!0===p.isWebGL1Renderer&&t.shift(),le=ce(t,e),null===le)throw ce(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===le.getShaderPrecisionFormat&&(le.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ke){throw console.error("THREE.WebGLRenderer: "+ke.message),ke}function ue(){G=new co(le),V=new ao(le,G,e),!1===V.isWebGL2&&(G.get("WEBGL_depth_texture"),G.get("OES_texture_float"),G.get("OES_texture_half_float"),G.get("OES_texture_half_float_linear"),G.get("OES_standard_derivatives"),G.get("OES_element_index_uint"),G.get("OES_vertex_array_object"),G.get("ANGLE_instanced_arrays")),G.get("OES_texture_float_linear"),se=new da(le,G,V),j=new ua(le,G,V),j.scissor(M.copy(R).multiplyScalar(E).floor()),j.viewport(S.copy(L).multiplyScalar(E).floor()),$=new po(le),q=new qs,X=new ha(le,G,j,q,V,se,$),Y=new Jr(le,V),ae=new oo(le,G,Y,V),Z=new uo(le,Y,$,ae),K=new yo(le,Z,Y,$),ie=new go(le),Q=new Ws(p,G,V,ae),J=new ya(q),ee=new Ks,te=new ra,ne=new ro(p,j,K,a),re=new so(le,G,$,V),oe=new ho(le,G,$,V),$.programs=Q.programs,p.capabilities=V,p.extensions=G,p.properties=q,p.renderLists=ee,p.state=j,p.info=$}ue();const he=new ga(p,le);this.xr=he;const de=new ca(p,K,V.maxTextureSize);function pe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),f=!0}function me(){console.log("THREE.WebGLRenderer: Context Restored."),f=!1,ue()}function ge(e){const t=e.target;t.removeEventListener("dispose",ge),ye(t)}function ye(e){ve(e),q.remove(e)}function ve(e){const t=q.get(e).program;e.program=void 0,void 0!==t&&Q.releaseProgram(t)}function be(e,t){e.render((function(e){p.renderBufferImmediate(e,t)}))}this.shadowMap=de,this.getContext=function(){return le},this.getContextAttributes=function(){return le.getContextAttributes()},this.forceContextLoss=function(){const e=G.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=G.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return E},this.setPixelRatio=function(e){void 0!==e&&(E=e,this.setSize(C,T,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new nn),e.set(C,T)},this.setSize=function(e,n,i){he.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(C=e,T=n,t.width=Math.floor(e*E),t.height=Math.floor(n*E),!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new nn),e.set(C*E,T*E).floor()},this.setDrawingBufferSize=function(e,n,i){C=e,T=n,E=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new cn),e.copy(S)},this.getViewport=function(e){return e.copy(L)},this.setViewport=function(e,t,n,i){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,n,i),j.viewport(S.copy(L).multiplyScalar(E).floor())},this.getScissor=function(e){return e.copy(R)},this.setScissor=function(e,t,n,i){e.isVector4?R.set(e.x,e.y,e.z,e.w):R.set(e,t,n,i),j.scissor(M.copy(R).multiplyScalar(E).floor())},this.getScissorTest=function(){return k},this.setScissorTest=function(e){j.setScissorTest(k=e)},this.setOpaqueSort=function(e){P=e},this.setTransparentSort=function(e){I=e},this.getClearColor=function(){return ne.getClearColor()},this.setClearColor=function(){ne.setClearColor.apply(ne,arguments)},this.getClearAlpha=function(){return ne.getClearAlpha()},this.setClearAlpha=function(){ne.setClearAlpha.apply(ne,arguments)},this.clear=function(e,t,n){let i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===n||n)&&(i|=1024),le.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",pe,!1),t.removeEventListener("webglcontextrestored",me,!1),ee.dispose(),te.dispose(),q.dispose(),K.dispose(),ae.dispose(),he.dispose(),Me.stop()},this.renderBufferImmediate=function(e,t){ae.initAttributes();const n=q.get(e);e.hasPositions&&!n.position&&(n.position=le.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=le.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=le.createBuffer()),e.hasColors&&!n.color&&(n.color=le.createBuffer());const i=t.getAttributes();e.hasPositions&&(le.bindBuffer(34962,n.position),le.bufferData(34962,e.positionArray,35048),ae.enableAttribute(i.position),le.vertexAttribPointer(i.position,3,5126,!1,0,0)),e.hasNormals&&(le.bindBuffer(34962,n.normal),le.bufferData(34962,e.normalArray,35048),ae.enableAttribute(i.normal),le.vertexAttribPointer(i.normal,3,5126,!1,0,0)),e.hasUvs&&(le.bindBuffer(34962,n.uv),le.bufferData(34962,e.uvArray,35048),ae.enableAttribute(i.uv),le.vertexAttribPointer(i.uv,2,5126,!1,0,0)),e.hasColors&&(le.bindBuffer(34962,n.color),le.bufferData(34962,e.colorArray,35048),ae.enableAttribute(i.color),le.vertexAttribPointer(i.color,3,5126,!1,0,0)),ae.disableUnusedAttributes(),le.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,i,r,o){null===t&&(t=U);const s=r.isMesh&&r.matrixWorld.determinant()<0,a=Ie(e,t,i,r);j.setMaterial(i,s);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===i.wireframe&&(l=Z.getWireframeAttribute(n),h=2),(i.morphTargets||i.morphNormals)&&ie.update(r,n,i,a),ae.setup(r,i,a,n,l);let d=re;null!==l&&(u=Y.get(l),d=oe,d.setIndex(u));const p=null!==l?l.count:c.count,f=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==o?o.start*h:0,y=null!==o?o.count*h:1/0,v=Math.max(f,g),b=Math.min(p,f+m,g+y)-1,x=Math.max(0,b-v+1);if(0!==x){if(r.isMesh)!0===i.wireframe?(j.setLineWidth(i.wireframeLinewidth*H()),d.setMode(1)):d.setMode(4);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),j.setLineWidth(e*H()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(n,v,x,r.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(n,v,x,e)}else d.render(v,x)}},this.compile=function(e,t){d=te.get(e,t),d.init(),e.traverse((function(e){e.isLight&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(t);const n=new WeakMap;e.traverse((function(t){let i=t.material;if(i)if(Array.isArray(i))for(let r=0;r<i.length;r++){let o=i[r];!1===n.has(o)&&(Pe(o,e,t),n.set(o))}else!1===n.has(i)&&(Pe(i,e,t),n.set(i))}))};let _e=null;function Se(e){he.isPresenting||_e&&_e(e)}const Me=new Qr;function Ae(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||D.intersectsSprite(e)){i&&z.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);const t=K.update(e),r=e.material;r.visible&&h.push(e,t,r,n,z.z,null)}}else if(e.isImmediateRenderObject)i&&z.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F),h.push(e,null,e.material,n,z.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==$.render.frame&&(e.skeleton.update(),e.skeleton.frame=$.render.frame),!e.frustumCulled||D.intersectsObject(e))){i&&z.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);const t=K.update(e),r=e.material;if(Array.isArray(r)){const i=t.groups;for(let o=0,s=i.length;o<s;o++){const s=i[o],a=r[s.materialIndex];a&&a.visible&&h.push(e,t,a,n,z.z,s)}}else r.visible&&h.push(e,t,r,n,z.z,null)}const r=e.children;for(let o=0,s=r.length;o<s;o++)Ae(r[o],t,n,i)}function Ce(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,o=e.length;r<o;r++){const o=e[r],s=o.object,a=o.geometry,l=null===i?o.material:i,c=o.group;if(n.isArrayCamera){_=n;const e=n.cameras;for(let n=0,i=e.length;n<i;n++){const i=e[n];s.layers.test(i.layers)&&(j.viewport(S.copy(i.viewport)),d.setupLights(i),Te(s,t,i,a,l,c))}}else _=null,Te(s,t,n,a,l,c)}}function Te(e,t,n,i,r,o){if(e.onBeforeRender(p,t,n,i,r,o),d=te.get(t,_||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const i=Ie(n,t,r,e);j.setMaterial(r),ae.reset(),be(e,i)}else p.renderBufferDirect(n,t,i,r,e,o);e.onAfterRender(p,t,n,i,r,o),d=te.get(t,_||n)}function Pe(e,t,n){!0!==t.isScene&&(t=U);const i=q.get(e),r=d.state.lights,o=d.state.shadowsArray,s=r.state.version,a=Q.getParameters(e,r.state,o,t,O.numPlanes,O.numIntersection,n),l=Q.getProgramCacheKey(a);let c=i.program,u=!0;if(void 0===c)e.addEventListener("dispose",ge);else if(c.cacheKey!==l)ve(e);else if(i.lightsStateVersion!==s)i.lightsStateVersion=s,u=!1;else{if(void 0!==a.shaderID)return;u=!1}u&&(c=Q.acquireProgram(a,l),i.program=c,i.uniforms=a.uniforms,i.outputEncoding=a.outputEncoding,e.program=c);const h=c.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(let t=0;t<p.maxMorphTargets;t++)h["morphTarget"+t]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(let t=0;t<p.maxMorphNormals;t++)h["morphNormal"+t]>=0&&e.numSupportedMorphNormals++}const f=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(i.numClippingPlanes=O.numPlanes,i.numIntersection=O.numIntersection,f.clippingPlanes=O.uniform),i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.needsLights=Re(e),i.lightsStateVersion=s,i.needsLights&&(f.ambientLightColor.value=r.state.ambient,f.lightProbe.value=r.state.probe,f.directionalLights.value=r.state.directional,f.directionalLightShadows.value=r.state.directionalShadow,f.spotLights.value=r.state.spot,f.spotLightShadows.value=r.state.spotShadow,f.rectAreaLights.value=r.state.rectArea,f.pointLights.value=r.state.point,f.pointLightShadows.value=r.state.pointShadow,f.hemisphereLights.value=r.state.hemi,f.directionalShadowMap.value=r.state.directionalShadowMap,f.directionalShadowMatrix.value=r.state.directionalShadowMatrix,f.spotShadowMap.value=r.state.spotShadowMap,f.spotShadowMatrix.value=r.state.spotShadowMatrix,f.pointShadowMap.value=r.state.pointShadowMap,f.pointShadowMatrix.value=r.state.pointShadowMatrix);const m=i.program.getUniforms(),g=ys.seqWithValue(m.seq,f);i.uniformsList=g}function Ie(e,t,n,i){!0!==t.isScene&&(t=U),X.resetTextureUnits();const r=t.fog,o=n.isMeshStandardMaterial?t.environment:null,s=null===v?p.outputEncoding:v.texture.encoding,a=q.get(n),l=d.state.lights;if(!0===N&&(!0===B||e!==w)){const t=e===w&&n.id===x;O.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,a,t)}n.version===a.__version?void 0===a.program||n.fog&&a.fog!==r||a.environment!==o||a.needsLights&&a.lightsStateVersion!==l.state.version?Pe(n,t,i):void 0===a.numClippingPlanes||a.numClippingPlanes===O.numPlanes&&a.numIntersection===O.numIntersection?a.outputEncoding!==s&&Pe(n,t,i):Pe(n,t,i):(Pe(n,t,i),a.__version=n.version);let c=!1,u=!1,h=!1;const f=a.program,m=f.getUniforms(),g=a.uniforms;if(j.useProgram(f.program)&&(c=!0,u=!0,h=!0),n.id!==x&&(x=n.id,u=!0),c||w!==e){if(m.setValue(le,"projectionMatrix",e.projectionMatrix),V.logarithmicDepthBuffer&&m.setValue(le,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),w!==e&&(w=e,u=!0,h=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=m.map.cameraPosition;void 0!==t&&t.setValue(le,z.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&m.setValue(le,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&m.setValue(le,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){m.setOptional(le,i,"bindMatrix"),m.setOptional(le,i,"bindMatrixInverse");const e=i.skeleton;if(e){const t=e.bones;if(V.floatVertexTextures){if(void 0===e.boneTexture){let n=Math.sqrt(4*t.length);n=tn.ceilPowerOfTwo(n),n=Math.max(n,4);const i=new Float32Array(n*n*4);i.set(e.boneMatrices);const r=new qr(i,n,n,Ee,xe);e.boneMatrices=i,e.boneTexture=r,e.boneTextureSize=n}m.setValue(le,"boneTexture",e.boneTexture,X),m.setValue(le,"boneTextureSize",e.boneTextureSize)}else m.setOptional(le,e,"boneMatrices")}}return(u||a.receiveShadow!==i.receiveShadow)&&(a.receiveShadow=i.receiveShadow,m.setValue(le,"receiveShadow",i.receiveShadow)),u&&(m.setValue(le,"toneMappingExposure",p.toneMappingExposure),a.needsLights&&Le(g,h),r&&n.fog&&J.refreshFogUniforms(g,r),J.refreshMaterialUniforms(g,n,o,E,T),void 0!==g.ltc_1&&(g.ltc_1.value=Kr.LTC_1),void 0!==g.ltc_2&&(g.ltc_2.value=Kr.LTC_2),ys.upload(le,a.uniformsList,g,X)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(ys.upload(le,a.uniformsList,g,X),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&m.setValue(le,"center",i.center),m.setValue(le,"modelViewMatrix",i.modelViewMatrix),m.setValue(le,"normalMatrix",i.normalMatrix),m.setValue(le,"modelMatrix",i.matrixWorld),f}function Le(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function Re(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}Me.setAnimationLoop(Se),"undefined"!==typeof window&&Me.setContext(window),this.setAnimationLoop=function(e){_e=e,he.setAnimationLoop(e),null===e?Me.stop():Me.start()},this.render=function(e,t){let n,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===f)return;ae.resetDefaultState(),x=-1,w=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===he.enabled&&!0===he.isPresenting&&(t=he.getCamera(t)),!0===e.isScene&&e.onBeforeRender(p,e,t,n||v),d=te.get(e,t),d.init(),F.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),D.setFromProjectionMatrix(F),B=this.localClippingEnabled,N=O.init(this.clippingPlanes,B,t),h=ee.get(e,t),h.init(),Ae(e,t,0,p.sortObjects),h.finish(),!0===p.sortObjects&&h.sort(P,I),!0===N&&O.beginShadows();const r=d.state.shadowsArray;de.render(r,e,t),d.setupLights(t),!0===N&&O.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),ne.render(h,e,t,i);const o=h.opaque,s=h.transparent;o.length>0&&Ce(o,e,t),s.length>0&&Ce(s,e,t),!0===e.isScene&&e.onAfterRender(p,e,t),null!==v&&(X.updateRenderTargetMipmap(v),X.updateMultisampleRenderTarget(v)),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1),h=null,d=null},this.setFramebuffer=function(e){m!==e&&null===v&&le.bindFramebuffer(36160,e),m=e},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return v},this.setRenderTarget=function(e,t,n){v=e,g=t,y=n,e&&void 0===q.get(e).__webglFramebuffer&&X.setupRenderTarget(e);let i=m,r=!1;if(e){const n=q.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=n[t||0],r=!0):i=e.isWebGLMultisampleRenderTarget?q.get(e).__webglMultisampledFramebuffer:n,S.copy(e.viewport),M.copy(e.scissor),A=e.scissorTest}else S.copy(L).multiplyScalar(E).floor(),M.copy(R).multiplyScalar(E).floor(),A=k;if(b!==i&&(le.bindFramebuffer(36160,i),b=i),j.viewport(S),j.scissor(M),j.setScissorTest(A),r){const i=q.get(e.texture);le.framebufferTexture2D(36160,36064,34069+(t||0),i.__webglTexture,n||0)}},this.readRenderTargetPixels=function(e,t,n,i,r,o,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=q.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){let s=!1;a!==b&&(le.bindFramebuffer(36160,a),s=!0);try{const s=e.texture,a=s.format,l=s.type;if(a!==Ee&&se.convert(a)!==le.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(l!==fe&&se.convert(l)!==le.getParameter(35738)&&(l!==xe||!(V.isWebGL2||G.get("OES_texture_float")||G.get("WEBGL_color_buffer_float")))&&(l!==we||!(V.isWebGL2?G.get("EXT_color_buffer_float"):G.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===le.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&le.readPixels(t,n,i,r,se.convert(a),se.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&le.bindFramebuffer(36160,b)}}},this.copyFramebufferToTexture=function(e,t,n){void 0===n&&(n=0);const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),o=Math.floor(t.image.height*i),s=se.convert(t.format);X.setTexture2D(t,0),le.copyTexImage2D(3553,n,s,e.x,e.y,r,o,0),j.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i){void 0===i&&(i=0);const r=t.image.width,o=t.image.height,s=se.convert(n.format),a=se.convert(n.type);X.setTexture2D(n,0),le.pixelStorei(37440,n.flipY),le.pixelStorei(37441,n.premultiplyAlpha),le.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?le.texSubImage2D(3553,i,e.x,e.y,r,o,s,a,t.image.data):t.isCompressedTexture?le.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):le.texSubImage2D(3553,i,e.x,e.y,s,a,t.image),0===i&&n.generateMipmaps&&le.generateMipmap(3553),j.unbindTexture()},this.initTexture=function(e){X.setTexture2D(e,0),j.unbindTexture()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function ba(e){va.call(this,e)}function xa(e,t){this.name="",this.color=new Ri(e),this.density=void 0!==t?t:25e-5}function wa(e,t,n){this.name="",this.color=new Ri(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3}function _a(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Kt,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=tn.generateUUID()}pa.prototype=Object.assign(Object.create(Gr.prototype),{constructor:pa,isArrayCamera:!0}),fa.prototype=Object.assign(Object.create(Hn.prototype),{constructor:fa,isGroup:!0}),Object.assign(ma.prototype,{constructor:ma,getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new fa,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new fa,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),this},update:function(e,t,n){let i=null,r=null;const o=this._targetRay,s=this._grip;return e&&(null!==o&&(i=t.getPose(e.targetRaySpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale))),null!==s&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale)))),null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==r),this}}),Object.assign(ga.prototype,Jt.prototype),ba.prototype=Object.assign(Object.create(va.prototype),{constructor:ba,isWebGL1Renderer:!0}),Object.assign(xa.prototype,{isFogExp2:!0,clone:function(){return new xa(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(wa.prototype,{isFog:!0,clone:function(){return new wa(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(_a.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(_a.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=tn.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new _a(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=tn.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const Sa=new mn;function Ma(e,t,n,i){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}function Aa(e){Fi.call(this),this.type="SpriteMaterial",this.color=new Ri(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}let Ca;Object.defineProperties(Ma.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Ma.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(let t=0,n=this.data.count;t<n;t++)Sa.x=this.getX(t),Sa.y=this.getY(t),Sa.z=this.getZ(t),Sa.applyMatrix4(e),this.setXYZ(t,Sa.x,Sa.y,Sa.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this},clone:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Gi(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ma(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),Aa.prototype=Object.create(Fi.prototype),Aa.prototype.constructor=Aa,Aa.prototype.isSpriteMaterial=!0,Aa.prototype.copy=function(e){return Fi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};const Ta=new mn,Ea=new mn,Pa=new mn,Ia=new nn,La=new nn,Ra=new Sn,ka=new mn,Da=new mn,Oa=new mn,Na=new nn,Ba=new nn,Fa=new nn;function za(e){if(Hn.call(this),this.type="Sprite",void 0===Ca){Ca=new ar;const e=new _a(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Ca.setIndex([0,1,2,0,2,3]),Ca.setAttribute("position",new Ma(e,3,0,!1)),Ca.setAttribute("uv",new Ma(e,2,3,!1))}this.geometry=Ca,this.material=void 0!==e?e:new Aa,this.center=new nn(.5,.5)}function Ua(e,t,n,i,r,o){Ia.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(La.x=o*Ia.x-r*Ia.y,La.y=r*Ia.x+o*Ia.y):La.copy(Ia),e.copy(t),e.x+=La.x,e.y+=La.y,e.applyMatrix4(Ra)}za.prototype=Object.assign(Object.create(Hn.prototype),{constructor:za,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ea.setFromMatrixScale(this.matrixWorld),Ra.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Pa.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ea.multiplyScalar(-Pa.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const o=this.center;Ua(ka.set(-.5,-.5,0),Pa,o,Ea,i,r),Ua(Da.set(.5,-.5,0),Pa,o,Ea,i,r),Ua(Oa.set(.5,.5,0),Pa,o,Ea,i,r),Na.set(0,0),Ba.set(1,0),Fa.set(1,1);let s=e.ray.intersectTriangle(ka,Da,Oa,!1,Ta);if(null===s&&(Ua(Da.set(-.5,.5,0),Pa,o,Ea,i,r),Ba.set(0,1),s=e.ray.intersectTriangle(ka,Oa,Da,!1,Ta),null===s))return;const a=e.ray.origin.distanceTo(Ta);a<e.near||a>e.far||t.push({distance:a,point:Ta.clone(),uv:Ei.getUV(Ta,ka,Da,Oa,Na,Ba,Fa,new nn),face:null,object:this})},copy:function(e){return Hn.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}});const Ha=new mn,Ga=new mn;function Va(){Hn.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function ja(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Ar.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Sn,this.bindMatrixInverse=new Sn}Va.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Va,isLOD:!0,copy:function(e){Hn.prototype.copy.call(this,e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const e=t[n];this.addLevel(e.object.clone(),e.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);const n=this.levels;let i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){Ha.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Ha);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){const t=this.levels;if(t.length>1){Ha.setFromMatrixPosition(e.matrixWorld),Ga.setFromMatrixPosition(this.matrixWorld);const n=Ha.distanceTo(Ga)/e.zoom;let i,r;for(t[0].object.visible=!0,i=1,r=t.length;i<r&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}},toJSON:function(e){const t=Hn.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const e=n[i];t.object.levels.push({object:e.object.uuid,distance:e.distance})}return t}}),ja.prototype=Object.assign(Object.create(Ar.prototype),{constructor:ja,isSkinnedMesh:!0,copy:function(e){return Ar.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const e=new cn,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Ar.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(){const e=new mn,t=new cn,n=new cn,i=new mn,r=new Sn;return function(o,s){const a=this.skeleton,l=this.geometry;t.fromBufferAttribute(l.attributes.skinIndex,o),n.fromBufferAttribute(l.attributes.skinWeight,o),e.fromBufferAttribute(l.attributes.position,o).applyMatrix4(this.bindMatrix),s.set(0,0,0);for(let c=0;c<4;c++){const o=n.getComponent(c);if(0!==o){const n=t.getComponent(c);r.multiplyMatrices(a.bones[n].matrixWorld,a.boneInverses[n]),s.addScaledVector(i.copy(e).applyMatrix4(r),o)}}return s.applyMatrix4(this.bindMatrixInverse)}}()});const $a=new Sn,Wa=new Sn;function qa(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Sn)}}function Xa(){Hn.call(this),this.type="Bone"}Object.assign(qa.prototype,{calculateInverses:function(){this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++){const t=new Sn;this.bones[e]&&t.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(t)}},pose:function(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.getInverse(this.boneInverses[e])}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}},update:function(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const i=e[r]?e[r].matrixWorld:Wa;$a.multiplyMatrices(i,t[r]),$a.toArray(n,16*r)}void 0!==i&&(i.needsUpdate=!0)},clone:function(){return new qa(this.bones,this.boneInverses)},getBoneByName:function(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),Xa.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Xa,isBone:!0});const Ya=new Sn,Za=new Sn,Ka=[],Qa=new Ar;function Ja(e,t,n){Ar.call(this,e,t),this.instanceMatrix=new Gi(new Float32Array(16*n),16),this.count=n,this.frustumCulled=!1}function el(e){Fi.call(this),this.type="LineBasicMaterial",this.color=new Ri(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}Ja.prototype=Object.assign(Object.create(Ar.prototype),{constructor:Ja,isInstancedMesh:!0,copy:function(e){return Ar.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),this.count=e.count,this},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){const n=this.matrixWorld,i=this.count;if(Qa.geometry=this.geometry,Qa.material=this.material,void 0!==Qa.material)for(let r=0;r<i;r++){this.getMatrixAt(r,Ya),Za.multiplyMatrices(n,Ya),Qa.matrixWorld=Za,Qa.raycast(e,Ka);for(let e=0,n=Ka.length;e<n;e++){const n=Ka[e];n.instanceId=r,n.object=this,t.push(n)}Ka.length=0}},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),el.prototype=Object.create(Fi.prototype),el.prototype.constructor=el,el.prototype.isLineBasicMaterial=!0,el.prototype.copy=function(e){return Fi.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};const tl=new mn,nl=new mn,il=new Sn,rl=new pi,ol=new oi;function sl(e,t,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Hn.call(this),this.type="Line",this.geometry=void 0!==e?e:new ar,this.material=void 0!==t?t:new el,this.updateMorphTargets()}sl.prototype=Object.assign(Object.create(Hn.prototype),{constructor:sl,isLine:!0,copy:function(e){return Hn.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)tl.fromBufferAttribute(t,e-1),nl.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=tl.distanceTo(nl);e.setAttribute("lineDistance",new Zi(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,n=e.lineDistances;n[0]=0;for(let e=1,i=t.length;e<i;e++)n[e]=n[e-1],n[e]+=t[e-1].distanceTo(t[e])}return this},raycast:function(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),ol.copy(n.boundingSphere),ol.applyMatrix4(i),ol.radius+=r,!1===e.ray.intersectsSphere(ol))return;il.getInverse(i),rl.copy(e.ray).applyMatrix4(il);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,a=new mn,l=new mn,c=new mn,u=new mn,h=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,r=n.attributes.position.array;if(null!==i){const n=i.array;for(let i=0,o=n.length-1;i<o;i+=h){const o=n[i],h=n[i+1];if(a.fromArray(r,3*o),l.fromArray(r,3*h),rl.distanceSqToSegment(a,l,u,c)>s)continue;u.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(u);d<e.near||d>e.far||t.push({distance:d,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else for(let n=0,o=r.length/3-1;n<o;n+=h){if(a.fromArray(r,3*n),l.fromArray(r,3*n+3),rl.distanceSqToSegment(a,l,u,c)>s)continue;u.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(u);i<e.near||i>e.far||t.push({distance:i,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){const i=n.vertices,r=i.length;for(let n=0;n<r-1;n+=h){if(rl.distanceSqToSegment(i[n],i[n+1],u,c)>s)continue;u.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(u);r<e.near||r>e.far||t.push({distance:r,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const al=new mn,ll=new mn;function cl(e,t){sl.call(this,e,t),this.type="LineSegments"}function ul(e,t){sl.call(this,e,t),this.type="LineLoop"}function hl(e){Fi.call(this),this.type="PointsMaterial",this.color=new Ri(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}cl.prototype=Object.assign(Object.create(sl.prototype),{constructor:cl,isLineSegments:!0,computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)al.fromBufferAttribute(t,e),ll.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+al.distanceTo(ll);e.setAttribute("lineDistance",new Zi(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,n=e.lineDistances;for(let e=0,i=t.length;e<i;e+=2)al.copy(t[e]),ll.copy(t[e+1]),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+al.distanceTo(ll)}return this}}),ul.prototype=Object.assign(Object.create(sl.prototype),{constructor:ul,isLineLoop:!0}),hl.prototype=Object.create(Fi.prototype),hl.prototype.constructor=hl,hl.prototype.isPointsMaterial=!0,hl.prototype.copy=function(e){return Fi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};const dl=new Sn,pl=new pi,fl=new oi,ml=new mn;function gl(e,t){Hn.call(this),this.type="Points",this.geometry=void 0!==e?e:new ar,this.material=void 0!==t?t:new hl,this.updateMorphTargets()}function yl(e,t,n,i,r,o,s){const a=pl.distanceSqToPoint(e);if(a<n){const n=new mn;pl.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;o.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,object:s})}}function vl(e,t,n,i,r,o,s,a,l){ln.call(this,e,t,n,i,r,o,s,a,l),this.format=void 0!==s?s:Te,this.minFilter=void 0!==o?o:he,this.magFilter=void 0!==r?r:he,this.generateMipmaps=!1}function bl(e,t,n,i,r,o,s,a,l,c,u,h){ln.call(this,null,o,s,a,l,c,i,r,u,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function xl(e,t,n,i,r,o,s,a,l){ln.call(this,e,t,n,i,r,o,s,a,l),this.needsUpdate=!0}function wl(e,t,n,i,r,o,s,a,l,c){if((c=void 0!==c?c:Le)!==Le&&c!==Re)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Le&&(n=ye),void 0===n&&c===Re&&(n=Ae),ln.call(this,null,i,r,o,s,a,c,n,l),this.image={width:e,height:t},this.magFilter=void 0!==s?s:le,this.minFilter=void 0!==a?a:le,this.flipY=!1,this.generateMipmaps=!1}function _l(e){ar.call(this),this.type="WireframeGeometry";const t=[],n=[0,0],i={},r=["a","b","c"];if(e&&e.isGeometry){const o=e.faces;for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0;e<3;e++){const o=t[r[e]],s=t[r[(e+1)%3]];n[0]=Math.min(o,s),n[1]=Math.max(o,s);const a=n[0]+","+n[1];void 0===i[a]&&(i[a]={index1:n[0],index2:n[1]})}}for(const n in i){const r=i[n];let o=e.vertices[r.index1];t.push(o.x,o.y,o.z),o=e.vertices[r.index2],t.push(o.x,o.y,o.z)}}else if(e&&e.isBufferGeometry){let r=new mn;if(null!==e.index){const o=e.attributes.position,s=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,t=a.length;e<t;++e){const t=a[e],r=t.start;for(let e=r,o=r+t.count;e<o;e+=3)for(let t=0;t<3;t++){const r=s.getX(e+t),o=s.getX(e+(t+1)%3);n[0]=Math.min(r,o),n[1]=Math.max(r,o);const a=n[0]+","+n[1];void 0===i[a]&&(i[a]={index1:n[0],index2:n[1]})}}for(const e in i){const n=i[e];r.fromBufferAttribute(o,n.index1),t.push(r.x,r.y,r.z),r.fromBufferAttribute(o,n.index2),t.push(r.x,r.y,r.z)}}else{const n=e.attributes.position;for(let e=0,i=n.count/3;e<i;e++)for(let o=0;o<3;o++){const i=3*e+o;r.fromBufferAttribute(n,i),t.push(r.x,r.y,r.z);const s=3*e+(o+1)%3;r.fromBufferAttribute(n,s),t.push(r.x,r.y,r.z)}}}this.setAttribute("position",new Zi(t,3))}function Sl(e,t,n){Rr.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new Ml(e,t,n)),this.mergeVertices()}function Ml(e,t,n){ar.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};const i=[],r=[],o=[],s=[],a=1e-5,l=new mn,c=new mn,u=new mn,h=new mn,d=new mn;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=t+1;for(let f=0;f<=n;f++){const i=f/n;for(let n=0;n<=t;n++){const p=n/t;e(p,i,c),r.push(c.x,c.y,c.z),p-a>=0?(e(p-a,i,u),h.subVectors(c,u)):(e(p+a,i,u),h.subVectors(u,c)),i-a>=0?(e(p,i-a,u),d.subVectors(c,u)):(e(p,i+a,u),d.subVectors(u,c)),l.crossVectors(h,d).normalize(),o.push(l.x,l.y,l.z),s.push(p,i)}}for(let f=0;f<n;f++)for(let e=0;e<t;e++){const t=f*p+e,n=f*p+e+1,r=(f+1)*p+e+1,o=(f+1)*p+e;i.push(t,n,o),i.push(n,r,o)}this.setIndex(i),this.setAttribute("position",new Zi(r,3)),this.setAttribute("normal",new Zi(o,3)),this.setAttribute("uv",new Zi(s,2))}function Al(e,t,n,i){Rr.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},this.fromBufferGeometry(new Cl(e,t,n,i)),this.mergeVertices()}function Cl(e,t,n,i){ar.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},n=n||1;const r=[],o=[];function s(e){const n=new mn,i=new mn,r=new mn;for(let o=0;o<t.length;o+=3)d(t[o+0],n),d(t[o+1],i),d(t[o+2],r),a(n,i,r,e)}function a(e,t,n,i){const r=Math.pow(2,i),o=[];for(let s=0;s<=r;s++){o[s]=[];const i=e.clone().lerp(n,s/r),a=t.clone().lerp(n,s/r),l=r-s;for(let e=0;e<=l;e++)o[s][e]=0===e&&s===r?i:i.clone().lerp(a,e/l)}for(let s=0;s<r;s++)for(let e=0;e<2*(r-s)-1;e++){const t=Math.floor(e/2);e%2===0?(h(o[s][t+1]),h(o[s+1][t]),h(o[s][t])):(h(o[s][t+1]),h(o[s+1][t+1]),h(o[s+1][t]))}}function l(e){const t=new mn;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}function c(){const e=new mn;for(let t=0;t<r.length;t+=3){e.x=r[t+0],e.y=r[t+1],e.z=r[t+2];const n=m(e)/2/Math.PI+.5,i=g(e)/Math.PI+.5;o.push(n,1-i)}p(),u()}function u(){for(let e=0;e<o.length;e+=6){const t=o[e+0],n=o[e+2],i=o[e+4],r=Math.max(t,n,i),s=Math.min(t,n,i);r>.9&&s<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),i<.2&&(o[e+4]+=1))}}function h(e){r.push(e.x,e.y,e.z)}function d(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function p(){const e=new mn,t=new mn,n=new mn,i=new mn,s=new nn,a=new nn,l=new nn;for(let c=0,u=0;c<r.length;c+=9,u+=6){e.set(r[c+0],r[c+1],r[c+2]),t.set(r[c+3],r[c+4],r[c+5]),n.set(r[c+6],r[c+7],r[c+8]),s.set(o[u+0],o[u+1]),a.set(o[u+2],o[u+3]),l.set(o[u+4],o[u+5]),i.copy(e).add(t).add(n).divideScalar(3);const h=m(i);f(s,u+0,e,h),f(a,u+2,t,h),f(l,u+4,n,h)}}function f(e,t,n,i){i<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=i/2/Math.PI+.5)}function m(e){return Math.atan2(e.z,-e.x)}function g(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}s(i=i||0),l(n),c(),this.setAttribute("position",new Zi(r,3)),this.setAttribute("normal",new Zi(r.slice(),3)),this.setAttribute("uv",new Zi(o,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}function Tl(e,t){Rr.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new El(e,t)),this.mergeVertices()}function El(e,t){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];Cl.call(this,n,i,e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Pl(e,t){Rr.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Il(e,t)),this.mergeVertices()}function Il(e,t){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];Cl.call(this,n,i,e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ll(e,t){Rr.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Rl(e,t)),this.mergeVertices()}function Rl(e,t){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];Cl.call(this,i,r,e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function kl(e,t){Rr.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Dl(e,t)),this.mergeVertices()}function Dl(e,t){const n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];Cl.call(this,r,o,e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ol(e,t,n,i,r,o){Rr.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");const s=new Nl(e,t,n,i,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}function Nl(e,t,n,i,r){ar.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r},t=t||64,n=n||1,i=i||8,r=r||!1;const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new mn,a=new mn,l=new nn;let c=new mn;const u=[],h=[],d=[],p=[];function f(){for(let e=0;e<t;e++)m(e);m(!1===r?t:0),y(),g()}function m(r){c=e.getPointAt(r/t,c);const l=o.normals[r],d=o.binormals[r];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,r=Math.sin(t),o=-Math.cos(t);a.x=o*l.x+r*d.x,a.y=o*l.y+r*d.y,a.z=o*l.z+r*d.z,a.normalize(),h.push(a.x,a.y,a.z),s.x=c.x+n*a.x,s.y=c.y+n*a.y,s.z=c.z+n*a.z,u.push(s.x,s.y,s.z)}}function g(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),o=(i+1)*e+t,s=(i+1)*(e-1)+t;p.push(n,r,s),p.push(r,o,s)}}function y(){for(let e=0;e<=t;e++)for(let n=0;n<=i;n++)l.x=e/t,l.y=n/i,d.push(l.x,l.y)}f(),this.setIndex(p),this.setAttribute("position",new Zi(u,3)),this.setAttribute("normal",new Zi(h,3)),this.setAttribute("uv",new Zi(d,2))}function Bl(e,t,n,i,r,o,s){Rr.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:o},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Fl(e,t,n,i,r,o)),this.mergeVertices()}function Fl(e,t,n,i,r,o){ar.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:o},e=e||1,t=t||.4,n=Math.floor(n)||64,i=Math.floor(i)||8,r=r||2,o=o||3;const s=[],a=[],l=[],c=[],u=new mn,h=new mn,d=new mn,p=new mn,f=new mn,m=new mn,g=new mn;for(let v=0;v<=n;++v){const s=v/n*r*Math.PI*2;y(s,r,o,e,d),y(s+.01,r,o,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=i;++e){const r=e/i*Math.PI*2,o=-t*Math.cos(r),s=t*Math.sin(r);u.x=d.x+(o*g.x+s*f.x),u.y=d.y+(o*g.y+s*f.y),u.z=d.z+(o*g.z+s*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(v/n),c.push(e/i)}}for(let v=1;v<=n;v++)for(let e=1;e<=i;e++){const t=(i+1)*(v-1)+(e-1),n=(i+1)*v+(e-1),r=(i+1)*v+e,o=(i+1)*(v-1)+e;s.push(t,n,o),s.push(n,r,o)}function y(e,t,n,i,r){const o=Math.cos(e),s=Math.sin(e),a=n/t*e,l=Math.cos(a);r.x=i*(2+l)*.5*o,r.y=i*(2+l)*s*.5,r.z=i*Math.sin(a)*.5}this.setIndex(s),this.setAttribute("position",new Zi(a,3)),this.setAttribute("normal",new Zi(l,3)),this.setAttribute("uv",new Zi(c,2))}function zl(e,t,n,i,r){Rr.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},this.fromBufferGeometry(new Ul(e,t,n,i,r)),this.mergeVertices()}function Ul(e,t,n,i,r){ar.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},e=e||1,t=t||.4,n=Math.floor(n)||8,i=Math.floor(i)||6,r=r||2*Math.PI;const o=[],s=[],a=[],l=[],c=new mn,u=new mn,h=new mn;for(let d=0;d<=n;d++)for(let o=0;o<=i;o++){const p=o/i*r,f=d/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(p),u.y=(e+t*Math.cos(f))*Math.sin(p),u.z=t*Math.sin(f),s.push(u.x,u.y,u.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(o/i),l.push(d/n)}for(let d=1;d<=n;d++)for(let e=1;e<=i;e++){const t=(i+1)*d+e-1,n=(i+1)*(d-1)+e-1,r=(i+1)*(d-1)+e,s=(i+1)*d+e;o.push(t,n,s),o.push(n,r,s)}this.setIndex(o),this.setAttribute("position",new Zi(s,3)),this.setAttribute("normal",new Zi(a,3)),this.setAttribute("uv",new Zi(l,2))}gl.prototype=Object.assign(Object.create(Hn.prototype),{constructor:gl,isPoints:!0,copy:function(e){return Hn.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),fl.copy(n.boundingSphere),fl.applyMatrix4(i),fl.radius+=r,!1===e.ray.intersectsSphere(fl))return;dl.getInverse(i),pl.copy(e.ray).applyMatrix4(dl);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){const r=n.index,o=n.attributes.position.array;if(null!==r){const n=r.array;for(let r=0,a=n.length;r<a;r++){const a=n[r];ml.fromArray(o,3*a),yl(ml,a,s,i,e,t,this)}}else for(let n=0,a=o.length/3;n<a;n++)ml.fromArray(o,3*n),yl(ml,n,s,i,e,t,this)}else{const r=n.vertices;for(let n=0,o=r.length;n<o;n++)yl(r[n],n,s,i,e,t,this)}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),vl.prototype=Object.assign(Object.create(ln.prototype),{constructor:vl,isVideoTexture:!0,update:function(){const e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),bl.prototype=Object.create(ln.prototype),bl.prototype.constructor=bl,bl.prototype.isCompressedTexture=!0,xl.prototype=Object.create(ln.prototype),xl.prototype.constructor=xl,xl.prototype.isCanvasTexture=!0,wl.prototype=Object.create(ln.prototype),wl.prototype.constructor=wl,wl.prototype.isDepthTexture=!0,_l.prototype=Object.create(ar.prototype),_l.prototype.constructor=_l,Sl.prototype=Object.create(Rr.prototype),Sl.prototype.constructor=Sl,Ml.prototype=Object.create(ar.prototype),Ml.prototype.constructor=Ml,Al.prototype=Object.create(Rr.prototype),Al.prototype.constructor=Al,Cl.prototype=Object.create(ar.prototype),Cl.prototype.constructor=Cl,Tl.prototype=Object.create(Rr.prototype),Tl.prototype.constructor=Tl,El.prototype=Object.create(Cl.prototype),El.prototype.constructor=El,Pl.prototype=Object.create(Rr.prototype),Pl.prototype.constructor=Pl,Il.prototype=Object.create(Cl.prototype),Il.prototype.constructor=Il,Ll.prototype=Object.create(Rr.prototype),Ll.prototype.constructor=Ll,Rl.prototype=Object.create(Cl.prototype),Rl.prototype.constructor=Rl,kl.prototype=Object.create(Rr.prototype),kl.prototype.constructor=kl,Dl.prototype=Object.create(Cl.prototype),Dl.prototype.constructor=Dl,Ol.prototype=Object.create(Rr.prototype),Ol.prototype.constructor=Ol,Nl.prototype=Object.create(ar.prototype),Nl.prototype.constructor=Nl,Nl.prototype.toJSON=function(){const e=ar.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},Bl.prototype=Object.create(Rr.prototype),Bl.prototype.constructor=Bl,Fl.prototype=Object.create(ar.prototype),Fl.prototype.constructor=Fl,zl.prototype=Object.create(Rr.prototype),zl.prototype.constructor=zl,Ul.prototype=Object.create(ar.prototype),Ul.prototype.constructor=Ul;const Hl={triangulate:function(e,t,n){n=n||2;let i,r,o,s,a,l,c,u=t&&t.length,h=u?t[0]*n:e.length,d=Gl(e,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=Yl(e,t,d,n)),e.length>80*n){i=o=e[0],r=s=e[1];for(let t=n;t<h;t+=n)a=e[t],l=e[t+1],a<i&&(i=a),l<r&&(r=l),a>o&&(o=a),l>s&&(s=l);c=Math.max(o-i,s-r),c=0!==c?1/c:0}return jl(d,p,n,i,r,c),p}};function Gl(e,t,n,i,r){let o,s;if(r===vc(e,t,n,i)>0)for(o=t;o<n;o+=i)s=mc(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=mc(o,e[o],e[o+1],s);return s&&ac(s,s.next)&&(gc(s),s=s.next),s}function Vl(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!ac(i,i.next)&&0!==sc(i.prev,i,i.next))i=i.next;else{if(gc(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function jl(e,t,n,i,r,o,s){if(!e)return;!s&&o&&ec(e,i,r,o);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,o?Wl(e,i,r,o):$l(e))t.push(a.i/n),t.push(e.i/n),t.push(l.i/n),gc(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?jl(e=ql(Vl(e),t,n),t,n,i,r,o,2):2===s&&Xl(e,t,n,i,r,o):jl(Vl(e),t,n,i,r,o,1);break}}function $l(e){let t=e.prev,n=e,i=e.next;if(sc(t,n,i)>=0)return!1;let r=e.next.next;for(;r!==e.prev;){if(rc(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&sc(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Wl(e,t,n,i){let r=e.prev,o=e,s=e.next;if(sc(r,o,s)>=0)return!1;let a=r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,l=r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,c=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,u=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,h=nc(a,l,t,n,i),d=nc(c,u,t,n,i),p=e.prevZ,f=e.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&rc(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&sc(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&rc(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&sc(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&rc(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&sc(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&rc(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&sc(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function ql(e,t,n){let i=e;do{let r=i.prev,o=i.next.next;!ac(r,o)&&lc(r,i,i.next,o)&&dc(r,o)&&dc(o,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(o.i/n),gc(i),gc(i.next),i=e=o),i=i.next}while(i!==e);return Vl(i)}function Xl(e,t,n,i,r,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&oc(s,e)){let a=fc(s,e);return s=Vl(s,s.next),a=Vl(a,a.next),jl(s,t,n,i,r,o),void jl(a,t,n,i,r,o)}e=e.next}s=s.next}while(s!==e)}function Yl(e,t,n,i){let r,o,s,a,l,c=[];for(r=0,o=t.length;r<o;r++)s=t[r]*i,a=r<o-1?t[r+1]*i:e.length,l=Gl(e,s,a,i,!1),l===l.next&&(l.steiner=!0),c.push(ic(l));for(c.sort(Zl),r=0;r<c.length;r++)Kl(c[r],n),n=Vl(n,n.next);return n}function Zl(e,t){return e.x-t.x}function Kl(e,t){if(t=Ql(e,t)){const n=fc(t,e);Vl(t,t.next),Vl(n,n.next)}}function Ql(e,t){let n,i=t,r=e.x,o=e.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){let e=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=r&&e>s){if(s=e,e===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===s)return n;let a,l=n,c=n.x,u=n.y,h=1/0;i=n;do{r>=i.x&&i.x>=c&&r!==i.x&&rc(o<u?r:s,o,c,u,o<u?s:r,o,i.x,i.y)&&(a=Math.abs(o-i.y)/(r-i.x),dc(i,e)&&(a<h||a===h&&(i.x>n.x||i.x===n.x&&Jl(n,i)))&&(n=i,h=a)),i=i.next}while(i!==l);return n}function Jl(e,t){return sc(e.prev,e,t.prev)<0&&sc(t.next,e,e.next)<0}function ec(e,t,n,i){let r=e;do{null===r.z&&(r.z=nc(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,tc(r)}function tc(e){let t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ,i);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1);return e}function nc(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ic(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function rc(e,t,n,i,r,o,s,a){return(r-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(i-a)-(n-s)*(t-a)>=0&&(n-s)*(o-a)-(r-s)*(i-a)>=0}function oc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!hc(e,t)&&(dc(e,t)&&dc(t,e)&&pc(e,t)&&(sc(e.prev,e,t.prev)||sc(e,t.prev,t))||ac(e,t)&&sc(e.prev,e,e.next)>0&&sc(t.prev,t,t.next)>0)}function sc(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function ac(e,t){return e.x===t.x&&e.y===t.y}function lc(e,t,n,i){const r=uc(sc(e,t,n)),o=uc(sc(e,t,i)),s=uc(sc(n,i,e)),a=uc(sc(n,i,t));return r!==o&&s!==a||!(0!==r||!cc(e,n,t))||!(0!==o||!cc(e,i,t))||!(0!==s||!cc(n,e,i))||!(0!==a||!cc(n,t,i))}function cc(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function uc(e){return e>0?1:e<0?-1:0}function hc(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&lc(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function dc(e,t){return sc(e.prev,e,e.next)<0?sc(e,t,e.next)>=0&&sc(e,e.prev,t)>=0:sc(e,t,e.prev)<0||sc(e,e.next,t)<0}function pc(e,t){let n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!==n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}function fc(e,t){let n=new yc(e.i,e.x,e.y),i=new yc(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function mc(e,t,n,i){const r=new yc(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function gc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function yc(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function vc(e,t,n,i){let r=0;for(let o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}const bc={area:function(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n},isClockWise:function(e){return bc.area(e)<0},triangulateShape:function(e,t){const n=[],i=[],r=[];xc(e),wc(n,e);let o=e.length;t.forEach(xc);for(let a=0;a<t.length;a++)i.push(o),o+=t[a].length,wc(n,t[a]);const s=Hl.triangulate(n,i);for(let a=0;a<s.length;a+=3)r.push(s.slice(a,a+3));return r}};function xc(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function wc(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}function _c(e,t){Rr.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Sc(e,t)),this.mergeVertices()}function Sc(e,t){ar.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let s=0,a=e.length;s<a;s++)o(e[s]);function o(e){const o=[],s=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:u-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Mc;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let g,y,v,b,x,w=!1;f&&(g=f.getSpacedPoints(a),w=!0,c=!1,y=f.computeFrenetFrames(a,!1),v=new mn,b=new mn,x=new mn),c||(p=0,u=0,h=0,d=0);const _=e.extractPoints(s);let S=_.shape;const M=_.holes;if(!bc.isClockWise(S)){S=S.reverse();for(let e=0,t=M.length;e<t;e++){const t=M[e];bc.isClockWise(t)&&(M[e]=t.reverse())}}const A=bc.triangulateShape(S,M),C=S;for(let t=0,n=M.length;t<n;t++){const e=M[t];S=S.concat(e)}function T(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const E=S.length,P=A.length;function I(e,t,n){let i,r,o;const s=e.x-t.x,a=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=s*s+a*a,h=s*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=t.x-a/h,f=t.y+s/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(s*c-a*l);i=p+s*m-e.x,r=f+a*m-e.y;const g=i*i+r*r;if(g<=2)return new nn(i,r);o=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(i=-a,r=s,o=Math.sqrt(u)):(i=s,r=a,o=Math.sqrt(u/2))}return new nn(i/o,r/o)}const L=[];for(let t=0,n=C.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),L[t]=I(C[t],C[i],C[r]);const R=[];let k,D=L.concat();for(let t=0,n=M.length;t<n;t++){const e=M[t];k=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),k[t]=I(e[t],e[i],e[r]);R.push(k),D=D.concat(k)}for(let t=0;t<p;t++){const e=t/p,n=u*Math.cos(e*Math.PI/2),i=h*Math.sin(e*Math.PI/2)+d;for(let t=0,r=C.length;t<r;t++){const e=T(C[t],L[t],i);z(e.x,e.y,-n)}for(let t=0,r=M.length;t<r;t++){const e=M[t];k=R[t];for(let t=0,r=e.length;t<r;t++){const r=T(e[t],k[t],i);z(r.x,r.y,-n)}}}const O=h+d;for(let t=0;t<E;t++){const e=c?T(S[t],D[t],O):S[t];w?(b.copy(y.normals[0]).multiplyScalar(e.x),v.copy(y.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(b).add(v),z(x.x,x.y,x.z)):z(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<E;e++){const n=c?T(S[e],D[e],O):S[e];w?(b.copy(y.normals[t]).multiplyScalar(n.x),v.copy(y.binormals[t]).multiplyScalar(n.y),x.copy(g[t]).add(b).add(v),z(x.x,x.y,x.z)):z(n.x,n.y,l/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=u*Math.cos(e*Math.PI/2),i=h*Math.sin(e*Math.PI/2)+d;for(let t=0,r=C.length;t<r;t++){const e=T(C[t],L[t],i);z(e.x,e.y,l+n)}for(let t=0,r=M.length;t<r;t++){const e=M[t];k=R[t];for(let t=0,r=e.length;t<r;t++){const r=T(e[t],k[t],i);w?z(r.x,r.y+g[a-1].y,g[a-1].x+n):z(r.x,r.y,l+n)}}}function N(){const e=i.length/3;if(c){let e=0,t=E*e;for(let n=0;n<P;n++){const e=A[n];U(e[2]+t,e[1]+t,e[0]+t)}e=a+2*p,t=E*e;for(let n=0;n<P;n++){const e=A[n];U(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<P;e++){const t=A[e];U(t[2],t[1],t[0])}for(let e=0;e<P;e++){const t=A[e];U(t[0]+E*a,t[1]+E*a,t[2]+E*a)}}n.addGroup(e,i.length/3-e,0)}function B(){const e=i.length/3;let t=0;F(C,t),t+=C.length;for(let n=0,i=M.length;n<i;n++){const e=M[n];F(e,t),t+=e.length}n.addGroup(e,i.length/3-e,1)}function F(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=a+2*p;e<n;e++){const n=E*e,o=E*(e+1);H(t+i+n,t+r+n,t+r+o,t+i+o)}}}function z(e,t,n){o.push(e),o.push(t),o.push(n)}function U(e,t,r){G(e),G(t),G(r);const o=i.length/3,s=m.generateTopUV(n,i,o-3,o-2,o-1);V(s[0]),V(s[1]),V(s[2])}function H(e,t,r,o){G(e),G(t),G(o),G(t),G(r),G(o);const s=i.length/3,a=m.generateSideWallUV(n,i,s-6,s-3,s-2,s-1);V(a[0]),V(a[1]),V(a[3]),V(a[1]),V(a[2]),V(a[3])}function G(e){i.push(o[3*e+0]),i.push(o[3*e+1]),i.push(o[3*e+2])}function V(e){r.push(e.x),r.push(e.y)}N(),B()}this.setAttribute("position",new Zi(i,3)),this.setAttribute("uv",new Zi(r,2)),this.computeVertexNormals()}_c.prototype=Object.create(Rr.prototype),_c.prototype.constructor=_c,_c.prototype.toJSON=function(){const e=Rr.prototype.toJSON.call(this);return Ac(this.parameters.shapes,this.parameters.options,e)},Sc.prototype=Object.create(ar.prototype),Sc.prototype.constructor=Sc,Sc.prototype.toJSON=function(){const e=ar.prototype.toJSON.call(this);return Ac(this.parameters.shapes,this.parameters.options,e)};const Mc={generateTopUV:function(e,t,n,i,r){const o=t[3*n],s=t[3*n+1],a=t[3*i],l=t[3*i+1],c=t[3*r],u=t[3*r+1];return[new nn(o,s),new nn(a,l),new nn(c,u)]},generateSideWallUV:function(e,t,n,i,r,o){const s=t[3*n],a=t[3*n+1],l=t[3*n+2],c=t[3*i],u=t[3*i+1],h=t[3*i+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*o],g=t[3*o+1],y=t[3*o+2];return Math.abs(a-u)<.01?[new nn(s,1-l),new nn(c,1-h),new nn(d,1-f),new nn(m,1-y)]:[new nn(a,1-l),new nn(u,1-h),new nn(p,1-f),new nn(g,1-y)]}};function Ac(e,t,n){if(n.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const t=e[i];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function Cc(e,t){Rr.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Tc(e,t)),this.mergeVertices()}function Tc(e,t){const n=(t=t||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Rr;const i=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Sc.call(this,i,t),this.type="TextBufferGeometry"}function Ec(e,t,n,i,r,o,s){Rr.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Pc(e,t,n,i,r,o,s)),this.mergeVertices()}function Pc(e,t,n,i,r,o,s){ar.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:s},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,o=void 0!==o?o:0,s=void 0!==s?s:Math.PI;const a=Math.min(o+s,Math.PI);let l=0;const c=[],u=new mn,h=new mn,d=[],p=[],f=[],m=[];for(let g=0;g<=n;g++){const d=[],y=g/n;let v=0;0==g&&0==o?v=.5/t:g==n&&a==Math.PI&&(v=-.5/t);for(let n=0;n<=t;n++){const a=n/t;u.x=-e*Math.cos(i+a*r)*Math.sin(o+y*s),u.y=e*Math.cos(o+y*s),u.z=e*Math.sin(i+a*r)*Math.sin(o+y*s),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+v,1-y),d.push(l++)}c.push(d)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=c[g][e+1],i=c[g][e],r=c[g+1][e],s=c[g+1][e+1];(0!==g||o>0)&&d.push(t,i,s),(g!==n-1||a<Math.PI)&&d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new Zi(p,3)),this.setAttribute("normal",new Zi(f,3)),this.setAttribute("uv",new Zi(m,2))}function Ic(e,t,n,i,r,o){Rr.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new Lc(e,t,n,i,r,o)),this.mergeVertices()}function Lc(e,t,n,i,r,o){ar.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},e=e||.5,t=t||1,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8;const s=[],a=[],l=[],c=[];let u=e;const h=(t-e)/(i=void 0!==i?Math.max(1,i):1),d=new mn,p=new nn;for(let f=0;f<=i;f++){for(let e=0;e<=n;e++){const i=r+e/n*o;d.x=u*Math.cos(i),d.y=u*Math.sin(i),a.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}u+=h}for(let f=0;f<i;f++){const e=f*(n+1);for(let t=0;t<n;t++){const i=t+e,r=i,o=i+n+1,a=i+n+2,l=i+1;s.push(r,o,l),s.push(o,a,l)}}this.setIndex(s),this.setAttribute("position",new Zi(a,3)),this.setAttribute("normal",new Zi(l,3)),this.setAttribute("uv",new Zi(c,2))}function Rc(e,t,n,i){Rr.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},this.fromBufferGeometry(new kc(e,t,n,i)),this.mergeVertices()}function kc(e,t,n,i){ar.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t)||12,n=n||0,i=i||2*Math.PI,i=tn.clamp(i,0,2*Math.PI);const r=[],o=[],s=[],a=1/t,l=new mn,c=new nn;for(let u=0;u<=t;u++){const r=n+u*a*i,h=Math.sin(r),d=Math.cos(r);for(let n=0;n<=e.length-1;n++)l.x=e[n].x*h,l.y=e[n].y,l.z=e[n].x*d,o.push(l.x,l.y,l.z),c.x=u/t,c.y=n/(e.length-1),s.push(c.x,c.y)}for(let u=0;u<t;u++)for(let t=0;t<e.length-1;t++){const n=t+u*e.length,i=n,o=n+e.length,s=n+e.length+1,a=n+1;r.push(i,o,a),r.push(o,s,a)}if(this.setIndex(r),this.setAttribute("position",new Zi(o,3)),this.setAttribute("uv",new Zi(s,2)),this.computeVertexNormals(),i===2*Math.PI){const n=this.attributes.normal.array,i=new mn,r=new mn,o=new mn,s=t*e.length*3;for(let t=0,a=0;t<e.length;t++,a+=3)i.x=n[a+0],i.y=n[a+1],i.z=n[a+2],r.x=n[s+a+0],r.y=n[s+a+1],r.z=n[s+a+2],o.addVectors(i,r).normalize(),n[a+0]=n[s+a+0]=o.x,n[a+1]=n[s+a+1]=o.y,n[a+2]=n[s+a+2]=o.z}}function Dc(e,t){Rr.call(this),this.type="ShapeGeometry","object"===typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Oc(e,t)),this.mergeVertices()}function Oc(e,t){ar.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;const n=[],i=[],r=[],o=[];let s=0,a=0;if(!1===Array.isArray(e))l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(s,a,c),s+=a,a=0;function l(e){const s=i.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===bc.isClockWise(c)&&(c=c.reverse());for(let t=0,n=u.length;t<n;t++){const e=u[t];!0===bc.isClockWise(e)&&(u[t]=e.reverse())}const h=bc.triangulateShape(c,u);for(let t=0,n=u.length;t<n;t++){const e=u[t];c=c.concat(e)}for(let t=0,n=c.length;t<n;t++){const e=c[t];i.push(e.x,e.y,0),r.push(0,0,1),o.push(e.x,e.y)}for(let t=0,i=h.length;t<i;t++){const e=h[t],i=e[0]+s,r=e[1]+s,o=e[2]+s;n.push(i,r,o),a+=3}}this.setIndex(n),this.setAttribute("position",new Zi(i,3)),this.setAttribute("normal",new Zi(r,3)),this.setAttribute("uv",new Zi(o,2))}function Nc(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function Bc(e,t){ar.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;const n=[],i=Math.cos(tn.DEG2RAD*t),r=[0,0],o={};let s,a,l;const c=["a","b","c"];let u;e.isBufferGeometry?(u=new Rr,u.fromBufferGeometry(e)):u=e.clone(),u.mergeVertices(),u.computeFaceNormals();const h=u.vertices,d=u.faces;for(let p=0,f=d.length;p<f;p++){const e=d[p];for(let t=0;t<3;t++)s=e[c[t]],a=e[c[(t+1)%3]],r[0]=Math.min(s,a),r[1]=Math.max(s,a),l=r[0]+","+r[1],void 0===o[l]?o[l]={index1:r[0],index2:r[1],face1:p,face2:void 0}:o[l].face2=p}for(l in o){const e=o[l];if(void 0===e.face2||d[e.face1].normal.dot(d[e.face2].normal)<=i){let t=h[e.index1];n.push(t.x,t.y,t.z),t=h[e.index2],n.push(t.x,t.y,t.z)}}this.setAttribute("position",new Zi(n,3))}function Fc(e,t,n,i,r,o,s,a){Rr.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new zc(e,t,n,i,r,o,s,a)),this.mergeVertices()}function zc(e,t,n,i,r,o,s,a){ar.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a};const l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,n=n||1,i=Math.floor(i)||8,r=Math.floor(r)||1,o=void 0!==o&&o,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI;const c=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function y(){const o=new mn,y=new mn;let v=0;const b=(t-e)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,v=g*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,r=t*a+s,l=Math.sin(r),f=Math.cos(r);y.x=v*l,y.y=-g*n+m,y.z=v*f,u.push(y.x,y.y,y.z),o.set(l,b,f).normalize(),h.push(o.x,o.y,o.z),d.push(t,1-g),c.push(p++)}f.push(c)}for(let e=0;e<i;e++)for(let t=0;t<r;t++){const n=f[t][e],i=f[t+1][e],r=f[t+1][e+1],o=f[t][e+1];c.push(n,i,o),c.push(i,r,o),v+=6}l.addGroup(g,v,0),g+=v}function v(n){let r,o;const f=new nn,y=new mn;let v=0;const b=!0===n?e:t,x=!0===n?1:-1;r=p;for(let e=1;e<=i;e++)u.push(0,m*x,0),h.push(0,x,0),d.push(.5,.5),p++;o=p;for(let e=0;e<=i;e++){const t=e/i*a+s,n=Math.cos(t),r=Math.sin(t);y.x=b*r,y.y=m*x,y.z=b*n,u.push(y.x,y.y,y.z),h.push(0,x,0),f.x=.5*n+.5,f.y=.5*r*x+.5,d.push(f.x,f.y),p++}for(let e=0;e<i;e++){const t=r+e,i=o+e;!0===n?c.push(i,i+1,t):c.push(i+1,i,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}y(),!1===o&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new Zi(u,3)),this.setAttribute("normal",new Zi(h,3)),this.setAttribute("uv",new Zi(d,2))}function Uc(e,t,n,i,r,o,s){Fc.call(this,0,e,t,n,i,r,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:s}}function Hc(e,t,n,i,r,o,s){zc.call(this,0,e,t,n,i,r,o,s),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:s}}function Gc(e,t,n,i){Rr.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},this.fromBufferGeometry(new Vc(e,t,n,i)),this.mergeVertices()}function Vc(e,t,n,i){ar.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},e=e||1,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;const r=[],o=[],s=[],a=[],l=new mn,c=new nn;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let u=0,h=3;u<=t;u++,h+=3){const r=n+u/t*i;l.x=e*Math.cos(r),l.y=e*Math.sin(r),o.push(l.x,l.y,l.z),s.push(0,0,1),c.x=(o[h]/e+1)/2,c.y=(o[h+1]/e+1)/2,a.push(c.x,c.y)}for(let u=1;u<=t;u++)r.push(u,u+1,0);this.setIndex(r),this.setAttribute("position",new Zi(o,3)),this.setAttribute("normal",new Zi(s,3)),this.setAttribute("uv",new Zi(a,2))}Cc.prototype=Object.create(Rr.prototype),Cc.prototype.constructor=Cc,Tc.prototype=Object.create(Sc.prototype),Tc.prototype.constructor=Tc,Ec.prototype=Object.create(Rr.prototype),Ec.prototype.constructor=Ec,Pc.prototype=Object.create(ar.prototype),Pc.prototype.constructor=Pc,Ic.prototype=Object.create(Rr.prototype),Ic.prototype.constructor=Ic,Lc.prototype=Object.create(ar.prototype),Lc.prototype.constructor=Lc,Rc.prototype=Object.create(Rr.prototype),Rc.prototype.constructor=Rc,kc.prototype=Object.create(ar.prototype),kc.prototype.constructor=kc,Dc.prototype=Object.create(Rr.prototype),Dc.prototype.constructor=Dc,Dc.prototype.toJSON=function(){const e=Rr.prototype.toJSON.call(this);return Nc(this.parameters.shapes,e)},Oc.prototype=Object.create(ar.prototype),Oc.prototype.constructor=Oc,Oc.prototype.toJSON=function(){const e=ar.prototype.toJSON.call(this);return Nc(this.parameters.shapes,e)},Bc.prototype=Object.create(ar.prototype),Bc.prototype.constructor=Bc,Fc.prototype=Object.create(Rr.prototype),Fc.prototype.constructor=Fc,zc.prototype=Object.create(ar.prototype),zc.prototype.constructor=zc,Uc.prototype=Object.create(Fc.prototype),Uc.prototype.constructor=Uc,Hc.prototype=Object.create(zc.prototype),Hc.prototype.constructor=Hc,Gc.prototype=Object.create(Rr.prototype),Gc.prototype.constructor=Gc,Vc.prototype=Object.create(ar.prototype),Vc.prototype.constructor=Vc;var jc=Object.freeze({__proto__:null,WireframeGeometry:_l,ParametricGeometry:Sl,ParametricBufferGeometry:Ml,TetrahedronGeometry:Tl,TetrahedronBufferGeometry:El,OctahedronGeometry:Pl,OctahedronBufferGeometry:Il,IcosahedronGeometry:Ll,IcosahedronBufferGeometry:Rl,DodecahedronGeometry:kl,DodecahedronBufferGeometry:Dl,PolyhedronGeometry:Al,PolyhedronBufferGeometry:Cl,TubeGeometry:Ol,TubeBufferGeometry:Nl,TorusKnotGeometry:Bl,TorusKnotBufferGeometry:Fl,TorusGeometry:zl,TorusBufferGeometry:Ul,TextGeometry:Cc,TextBufferGeometry:Tc,SphereGeometry:Ec,SphereBufferGeometry:Pc,RingGeometry:Ic,RingBufferGeometry:Lc,PlaneGeometry:eo,PlaneBufferGeometry:to,LatheGeometry:Rc,LatheBufferGeometry:kc,ShapeGeometry:Dc,ShapeBufferGeometry:Oc,ExtrudeGeometry:_c,ExtrudeBufferGeometry:Sc,EdgesGeometry:Bc,ConeGeometry:Uc,ConeBufferGeometry:Hc,CylinderGeometry:Fc,CylinderBufferGeometry:zc,CircleGeometry:Gc,CircleBufferGeometry:Vc,BoxGeometry:kr,BoxBufferGeometry:Dr});function $c(e){Fi.call(this),this.type="ShadowMaterial",this.color=new Ri(0),this.transparent=!0,this.setValues(e)}function Wc(e){Ur.call(this,e),this.type="RawShaderMaterial"}function qc(e){Fi.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ri(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ri(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qt,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function Xc(e){qc.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new nn(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(e)}function Yc(e){Fi.call(this),this.type="MeshPhongMaterial",this.color=new Ri(16777215),this.specular=new Ri(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ri(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qt,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=V,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Zc(e){Fi.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ri(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ri(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qt,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Kc(e){Fi.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qt,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Qc(e){Fi.call(this),this.type="MeshLambertMaterial",this.color=new Ri(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ri(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=V,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Jc(e){Fi.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ri(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qt,this.normalScale=new nn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function eu(e){el.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}$c.prototype=Object.create(Fi.prototype),$c.prototype.constructor=$c,$c.prototype.isShadowMaterial=!0,$c.prototype.copy=function(e){return Fi.prototype.copy.call(this,e),this.color.copy(e.color),this},Wc.prototype=Object.create(Ur.prototype),Wc.prototype.constructor=Wc,Wc.prototype.isRawShaderMaterial=!0,qc.prototype=Object.create(Fi.prototype),qc.prototype.constructor=qc,qc.prototype.isMeshStandardMaterial=!0,qc.prototype.copy=function(e){return Fi.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},Xc.prototype=Object.create(qc.prototype),Xc.prototype.constructor=Xc,Xc.prototype.isMeshPhysicalMaterial=!0,Xc.prototype.copy=function(e){return qc.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Ri).copy(e.sheen):this.sheen=null,this.transparency=e.transparency,this},Yc.prototype=Object.create(Fi.prototype),Yc.prototype.constructor=Yc,Yc.prototype.isMeshPhongMaterial=!0,Yc.prototype.copy=function(e){return Fi.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Zc.prototype=Object.create(Fi.prototype),Zc.prototype.constructor=Zc,Zc.prototype.isMeshToonMaterial=!0,Zc.prototype.copy=function(e){return Fi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Kc.prototype=Object.create(Fi.prototype),Kc.prototype.constructor=Kc,Kc.prototype.isMeshNormalMaterial=!0,Kc.prototype.copy=function(e){return Fi.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Qc.prototype=Object.create(Fi.prototype),Qc.prototype.constructor=Qc,Qc.prototype.isMeshLambertMaterial=!0,Qc.prototype.copy=function(e){return Fi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Jc.prototype=Object.create(Fi.prototype),Jc.prototype.constructor=Jc,Jc.prototype.isMeshMatcapMaterial=!0,Jc.prototype.copy=function(e){return Fi.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},eu.prototype=Object.create(el.prototype),eu.prototype.constructor=eu,eu.prototype.isLineDashedMaterial=!0,eu.prototype.copy=function(e){return el.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var tu=Object.freeze({__proto__:null,ShadowMaterial:$c,SpriteMaterial:Aa,RawShaderMaterial:Wc,ShaderMaterial:Ur,PointsMaterial:hl,MeshPhysicalMaterial:Xc,MeshStandardMaterial:qc,MeshPhongMaterial:Yc,MeshToonMaterial:Zc,MeshNormalMaterial:Kc,MeshLambertMaterial:Qc,MeshDepthMaterial:oa,MeshDistanceMaterial:sa,MeshBasicMaterial:zi,MeshMatcapMaterial:Jc,LineDashedMaterial:eu,LineBasicMaterial:el,Material:Fi});const nu={arraySlice:function(e,t,n){return nu.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(t,n){return e[t]-e[n]}const n=e.length,i=new Array(n);for(let r=0;r!==n;++r)i[r]=r;return i.sort(t),i},sortedArray:function(e,t,n){const i=e.length,r=new e.constructor(i);for(let o=0,s=0;s!==i;++o){const i=n[o]*t;for(let n=0;n!==t;++n)r[s++]=e[i+n]}return r},flattenJSON:function(e,t,n,i){let r=1,o=e[0];for(;void 0!==o&&void 0===o[i];)o=e[r++];if(void 0===o)return;let s=o[i];if(void 0!==s)if(Array.isArray(s))do{s=o[i],void 0!==s&&(t.push(o.time),n.push.apply(n,s)),o=e[r++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[i],void 0!==s&&(t.push(o.time),s.toArray(n,n.length)),o=e[r++]}while(void 0!==o);else do{s=o[i],void 0!==s&&(t.push(o.time),n.push(s)),o=e[r++]}while(void 0!==o)},subclip:function(e,t,n,i,r){r=r||30;const o=e.clone();o.name=t;const s=[];for(let l=0;l<o.tracks.length;++l){const e=o.tracks[l],t=e.getValueSize(),a=[],c=[];for(let o=0;o<e.times.length;++o){const s=e.times[o]*r;if(!(s<n||s>=i)){a.push(e.times[o]);for(let n=0;n<t;++n)c.push(e.values[o*t+n])}}0!==a.length&&(e.times=nu.convertArray(a,e.times.constructor),e.values=nu.convertArray(c,e.values.constructor),s.push(e))}o.tracks=s;let a=1/0;for(let l=0;l<o.tracks.length;++l)a>o.tracks[l].times[0]&&(a=o.tracks[l].times[0]);for(let l=0;l<o.tracks.length;++l)o.tracks[l].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=e),(void 0===i||i<=0)&&(i=30);const r=e.tracks.length,o=t/i;for(let s=0;s<r;++s){const t=n.tracks[s],i=t.ValueTypeName;if("bool"===i||"string"===i)continue;const r=e.tracks.find((function(e){return e.name===t.name&&e.ValueTypeName===i}));if(void 0===r)continue;const a=t.getValueSize(),l=t.times.length-1;let c;if(o<=t.times[0])c=nu.arraySlice(t.values,0,t.valueSize);else if(o>=t.times[l]){const e=l*a;c=nu.arraySlice(t.values,e)}else{const e=t.createInterpolant();e.evaluate(o),c=e.resultBuffer}"quaternion"===i&&new dn(c[0],c[1],c[2],c[3]).normalize().conjugate().toArray(c);const u=r.times.length;for(let e=0;e<u;++e){const t=e*a;if("quaternion"===i)dn.multiplyQuaternionsFlat(r.values,t,c,0,r.values,t);else for(let e=0;e<a;++e)r.values[t+e]-=c[e]}}return e.blendMode=Ot,e}};function iu(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function ru(e,t,n,i){iu.call(this,e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function ou(e,t,n,i){iu.call(this,e,t,n,i)}function su(e,t,n,i){iu.call(this,e,t,n,i)}function au(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=nu.convertArray(t,this.TimeBufferType),this.values=nu.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function lu(e,t,n){au.call(this,e,t,n)}function cu(e,t,n,i){au.call(this,e,t,n,i)}function uu(e,t,n,i){au.call(this,e,t,n,i)}function hu(e,t,n,i){iu.call(this,e,t,n,i)}function du(e,t,n,i){au.call(this,e,t,n,i)}function pu(e,t,n,i){au.call(this,e,t,n,i)}function fu(e,t,n,i){au.call(this,e,t,n,i)}function mu(e,t,n,i){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.blendMode=void 0!==i?i:Dt,this.uuid=tn.generateUUID(),this.duration<0&&this.resetDuration()}function gu(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return uu;case"vector":case"vector2":case"vector3":case"vector4":return fu;case"color":return cu;case"quaternion":return du;case"bool":case"boolean":return lu;case"string":return pu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function yu(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=gu(e.type);if(void 0===e.times){const t=[],n=[];nu.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(iu.prototype,{evaluate:function(e){let t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(e>=r)break e;{const s=t[1];e<s&&(n=2,r=s);for(let o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===o)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0}}for(;n<o;){const i=n+o>>>1;e<t[i]?o=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let o=0;o!==i;++o)t[o]=n[r+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(iu.prototype,{beforeStart_:iu.prototype.copySampleValue_,afterEnd_:iu.prototype.copySampleValue_}),ru.prototype=Object.assign(Object.create(iu.prototype),{constructor:ru,DefaultSettings_:{endingStart:Lt,endingEnd:Lt},intervalChanged_:function(e,t,n){let i=this.parameterPositions,r=e-2,o=e+1,s=i[r],a=i[o];if(void 0===s)switch(this.getSettings_().endingStart){case Rt:r=e,s=2*t-n;break;case kt:r=i.length-2,s=t+i[r]-i[r+1];break;default:r=e,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case Rt:o=e,a=2*n-t;break;case kt:o=1,a=n+i[1]-i[0];break;default:o=e-1,a=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-n),this._offsetPrev=r*c,this._offsetNext=o*c},interpolate_:function(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,y=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f;for(let x=0;x!==s;++x)r[x]=g*o[c+x]+y*o[l+x]+v*o[a+x]+b*o[u+x];return r}}),ou.prototype=Object.assign(Object.create(iu.prototype),{constructor:ou,interpolate_:function(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=(n-t)/(i-t),u=1-c;for(let h=0;h!==s;++h)r[h]=o[l+h]*u+o[a+h]*c;return r}}),su.prototype=Object.assign(Object.create(iu.prototype),{constructor:su,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(au,{toJSON:function(e){const t=e.constructor;let n;if(void 0!==t.toJSON)n=t.toJSON(e);else{n={name:e.name,times:nu.convertArray(e.times,Array),values:nu.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}}),Object.assign(au.prototype,{constructor:au,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Pt,InterpolantFactoryMethodDiscrete:function(e){return new su(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new ou(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new ru(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){let t;switch(e){case Et:t=this.InterpolantFactoryMethodDiscrete;break;case Pt:t=this.InterpolantFactoryMethodLinear;break;case It:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Et;case this.InterpolantFactoryMethodLinear:return Pt;case this.InterpolantFactoryMethodSmooth:return It}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this},scale:function(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this},trim:function(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==r||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const e=this.getValueSize();this.times=nu.arraySlice(n,r,o),this.values=nu.arraySlice(this.values,r*e,o*e)}return this},validate:function(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let s=0;s!==r;s++){const t=n[s];if("number"===typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,t),e=!1;break}if(null!==o&&o>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,t,o),e=!1;break}o=t}if(void 0!==i&&nu.isTypedArray(i))for(let s=0,a=i.length;s!==a;++s){const t=i[s];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,t),e=!1;break}}return e},optimize:function(){const e=nu.arraySlice(this.times),t=nu.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===It,r=e.length-1;let o=1;for(let s=1;s<r;++s){let r=!1;const a=e[s];if(a!==e[s+1]&&(1!==s||a!==a[0]))if(i)r=!0;else{const e=s*n,i=e-n,o=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[i+s]||n!==t[o+s]){r=!0;break}}}if(r){if(s!==o){e[o]=e[s];const i=s*n,r=o*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++o}}if(r>0){e[o]=e[r];for(let e=r*n,i=o*n,s=0;s!==n;++s)t[i+s]=t[e+s];++o}return o!==e.length?(this.times=nu.arraySlice(e,0,o),this.values=nu.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this},clone:function(){const e=nu.arraySlice(this.times,0),t=nu.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),lu.prototype=Object.assign(Object.create(au.prototype),{constructor:lu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Et,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),cu.prototype=Object.assign(Object.create(au.prototype),{constructor:cu,ValueTypeName:"color"}),uu.prototype=Object.assign(Object.create(au.prototype),{constructor:uu,ValueTypeName:"number"}),hu.prototype=Object.assign(Object.create(iu.prototype),{constructor:hu,interpolate_:function(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-t)/(i-t);let l=e*s;for(let c=l+s;l!==c;l+=4)dn.slerpFlat(r,0,o,l-s,o,l,a);return r}}),du.prototype=Object.assign(Object.create(au.prototype),{constructor:du,ValueTypeName:"quaternion",DefaultInterpolation:Pt,InterpolantFactoryMethodLinear:function(e){return new hu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),pu.prototype=Object.assign(Object.create(au.prototype),{constructor:pu,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Et,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),fu.prototype=Object.assign(Object.create(au.prototype),{constructor:fu,ValueTypeName:"vector"}),Object.assign(mu,{parse:function(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let r=0,o=n.length;r!==o;++r)t.push(yu(n[r]).scale(i));return new mu(e.name,e.duration,t,e.blendMode)},toJSON:function(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=n.length;r!==o;++r)t.push(au.toJSON(n[r]));return i},CreateFromMorphTargetSequence:function(e,t,n,i){const r=t.length,o=[];for(let s=0;s<r;s++){let e=[],a=[];e.push((s+r-1)%r,s,(s+1)%r),a.push(0,1,0);const l=nu.getKeyframeOrder(e);e=nu.sortedArray(e,1,l),a=nu.sortedArray(a,1,l),i||0!==e[0]||(e.push(r),a.push(a[0])),o.push(new uu(".morphTargetInfluences["+t[s].name+"]",e,a).scale(1/n))}return new mu(e,-1,o)},findByName:function(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let s=0,a=e.length;s<a;s++){const t=e[s],n=t.name.match(r);if(n&&n.length>1){const e=n[1];let r=i[e];r||(i[e]=r=[]),r.push(t)}}const o=[];for(const s in i)o.push(mu.CreateFromMorphTargetSequence(s,i[s],t,n));return o},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const o=[],s=[];nu.flattenJSON(n,o,s,i),0!==o.length&&r.push(new e(t,o,s))}},i=[],r=e.name||"default",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let i=0;i<e[n].morphTargets.length;i++)t[e[n].morphTargets[i]]=-1;for(const r in t){const t=[],o=[];for(let i=0;i!==e[n].morphTargets.length;++i){const i=e[n];t.push(i.time),o.push(i.morphTarget===r?1:0)}i.push(new uu(".morphTargetInfluence["+r+"]",t,o))}a=t.length*(o||1)}else{const r=".bones["+t[c].name+"]";n(fu,r+".position",e,"pos",i),n(du,r+".quaternion",e,"rot",i),n(fu,r+".scale",e,"scl",i)}}return 0===i.length?null:new mu(r,a,i,s)}}),Object.assign(mu.prototype,{resetDuration:function(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this},trim:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new mu(this.name,this.duration,e,this.blendMode)}});const vu={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function bu(e,t,n){const i=this;let r,o=!1,s=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===o&&void 0!==i.onStart&&i.onStart(e,s,a),o=!0},this.itemEnd=function(e){s++,void 0!==i.onProgress&&i.onProgress(e,s,a),s===a&&(o=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}const xu=new bu;function wu(e){this.manager=void 0!==e?e:xu,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(wu.prototype,{load:function(){},loadAsync:function(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});const _u={};function Su(e){wu.call(this,e)}function Mu(e){wu.call(this,e)}function Au(e){wu.call(this,e)}function Cu(e){wu.call(this,e)}function Tu(e){wu.call(this,e)}function Eu(e){wu.call(this,e)}function Pu(e){wu.call(this,e)}function Iu(){this.type="Curve",this.arcLengthDivisions=200}function Lu(e,t,n,i,r,o,s,a){Iu.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=i||1,this.aStartAngle=r||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function Ru(e,t,n,i,r,o){Lu.call(this,e,t,n,n,i,r,o),this.type="ArcCurve"}function ku(){let e=0,t=0,n=0,i=0;function r(r,o,s,a){e=r,t=s,n=-3*r+3*o-2*s-a,i=2*r-2*o+s+a}return{initCatmullRom:function(e,t,n,i,o){r(t,n,o*(n-e),o*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,o,s,a){let l=(t-e)/o-(n-e)/(o+s)+(n-t)/s,c=(n-t)/s-(i-t)/(s+a)+(i-n)/a;l*=s,c*=s,r(t,n,l,c)},calc:function(r){const o=r*r;return e+t*r+n*o+i*(o*r)}}}Su.prototype=Object.assign(Object.create(wu.prototype),{constructor:Su,load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=vu.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;if(void 0!==_u[e])return void _u[e].push({onLoad:t,onProgress:n,onError:i});const s=/^data:(.*?)(;base64)?,(.*)$/,a=e.match(s);let l;if(a){const n=a[1],o=!!a[2];let s=a[3];s=decodeURIComponent(s),o&&(s=atob(s));try{let i;const o=(this.responseType||"").toLowerCase();switch(o){case"arraybuffer":case"blob":const e=new Uint8Array(s.length);for(let n=0;n<s.length;n++)e[n]=s.charCodeAt(n);i="blob"===o?new Blob([e.buffer],{type:n}):e.buffer;break;case"document":const t=new DOMParser;i=t.parseFromString(s,n);break;case"json":i=JSON.parse(s);break;default:i=s}setTimeout((function(){t&&t(i),r.manager.itemEnd(e)}),0)}catch(c){setTimeout((function(){i&&i(c),r.manager.itemError(e),r.manager.itemEnd(e)}),0)}}else{_u[e]=[],_u[e].push({onLoad:t,onProgress:n,onError:i}),l=new XMLHttpRequest,l.open("GET",e,!0),l.addEventListener("load",(function(t){const n=this.response,i=_u[e];if(delete _u[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),vu.add(e,n);for(let e=0,t=i.length;e<t;e++){const t=i[e];t.onLoad&&t.onLoad(n)}r.manager.itemEnd(e)}else{for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}}),!1),l.addEventListener("progress",(function(t){const n=_u[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onProgress&&i.onProgress(t)}}),!1),l.addEventListener("error",(function(t){const n=_u[e];delete _u[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),l.addEventListener("abort",(function(t){const n=_u[e];delete _u[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(l.responseType=this.responseType),void 0!==this.withCredentials&&(l.withCredentials=this.withCredentials),l.overrideMimeType&&l.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)l.setRequestHeader(e,this.requestHeader[e]);l.send(null)}return r.manager.itemStart(e),l},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this}}),Mu.prototype=Object.assign(Object.create(wu.prototype),{constructor:Mu,load:function(e,t,n,i){const r=this,o=new Su(r.manager);o.setPath(r.path),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(o){i?i(o):console.error(o),r.manager.itemError(e)}}),n,i)},parse:function(e){const t=[];for(let n=0;n<e.length;n++){const i=mu.parse(e[n]);t.push(i)}return t}}),Au.prototype=Object.assign(Object.create(wu.prototype),{constructor:Au,load:function(e,t,n,i){const r=this,o=[],s=new bl;s.image=o;const a=new Su(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer");let l=0;function c(c){a.load(e[c],(function(e){const n=r.parse(e,!0);o[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(s.minFilter=he),s.format=n.format,s.needsUpdate=!0,t&&t(s))}),n,i)}if(Array.isArray(e))for(let u=0,h=e.length;u<h;++u)c(u);else a.load(e,(function(e){const n=r.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)o[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),o[t].format=n.format,o[t].width=n.width,o[t].height=n.height}}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=he),s.format=n.format,s.needsUpdate=!0,t&&t(s)}),n,i);return s}}),Cu.prototype=Object.assign(Object.create(wu.prototype),{constructor:Cu,load:function(e,t,n,i){const r=this,o=new qr,s=new Su(this.manager);return s.setResponseType("arraybuffer"),s.setPath(this.path),s.load(e,(function(e){const n=r.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:se,o.wrapT=void 0!==n.wrapT?n.wrapT:se,o.magFilter=void 0!==n.magFilter?n.magFilter:he,o.minFilter=void 0!==n.minFilter?n.minFilter:he,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=pe),1===n.mipmapCount&&(o.minFilter=he),o.needsUpdate=!0,t&&t(o,n))}),n,i),o}}),Tu.prototype=Object.assign(Object.create(wu.prototype),{constructor:Tu,load:function(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=vu.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;const s=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){s.removeEventListener("load",a,!1),s.removeEventListener("error",l,!1),vu.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){s.removeEventListener("load",a,!1),s.removeEventListener("error",l,!1),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}return s.addEventListener("load",a,!1),s.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s}}),Eu.prototype=Object.assign(Object.create(wu.prototype),{constructor:Eu,load:function(e,t,n,i){const r=new vo,o=new Tu(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(n){o.load(e[n],(function(e){r.images[n]=e,s++,6===s&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(let l=0;l<e.length;++l)a(l);return r}}),Pu.prototype=Object.assign(Object.create(wu.prototype),{constructor:Pu,load:function(e,t,n,i){const r=new ln,o=new Tu(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(n){r.image=n;const i=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);r.format=i?Te:Ee,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}),Object.assign(Iu.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){void 0===e&&(e=5);const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){const e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){const n=this.getLengths();let i,r=0,o=n.length;i=t||e*n[o-1];let s,a=0,l=o-1;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),s=n[r]-i,s<0)a=r+1;else{if(!(s>0)){l=r;break}l=r-1}if(r=l,n[r]===i)return r/(o-1);const c=n[r];return(r+(i-c)/(n[r+1]-c))/(o-1)},getTangent:function(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),s=this.getPoint(r),a=t||(o.isVector2?new nn:new mn);return a.copy(s).sub(o).normalize(),a},getTangentAt:function(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)},computeFrenetFrames:function(e,t){const n=new mn,i=[],r=[],o=[],s=new mn,a=new Sn;for(let d=0;d<=e;d++){const t=d/e;i[d]=this.getTangentAt(t,new mn),i[d].normalize()}r[0]=new mn,o[0]=new mn;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),s.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],s),o[0].crossVectors(i[0],r[0]);for(let d=1;d<=e;d++){if(r[d]=r[d-1].clone(),o[d]=o[d-1].clone(),s.crossVectors(i[d-1],i[d]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(tn.clamp(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(a.makeRotationAxis(s,e))}o[d].crossVectors(i[d],r[d])}if(!0===t){let t=Math.acos(tn.clamp(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(s.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],t*n)),o[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Lu.prototype=Object.create(Iu.prototype),Lu.prototype.constructor=Lu,Lu.prototype.isEllipseCurve=!0,Lu.prototype.getPoint=function(e,t){const n=t||new nn,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=o?0:i),!0!==this.aClockwise||o||(r===i?r=-i:r-=i);const s=this.aStartAngle+e*r;let a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,i=l-this.aY;a=n*e-i*t+this.aX,l=n*t+i*e+this.aY}return n.set(a,l)},Lu.prototype.copy=function(e){return Iu.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Lu.prototype.toJSON=function(){const e=Iu.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Lu.prototype.fromJSON=function(e){return Iu.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Ru.prototype=Object.create(Lu.prototype),Ru.prototype.constructor=Ru,Ru.prototype.isArcCurve=!0;const Du=new mn,Ou=new ku,Nu=new ku,Bu=new ku;function Fu(e,t,n,i){Iu.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=i||.5}function zu(e,t,n,i,r){const o=.5*(i-t),s=.5*(r-n),a=e*e;return(2*n-2*i+o+s)*(e*a)+(-3*n+3*i-2*o-s)*a+o*e+n}function Uu(e,t){const n=1-e;return n*n*t}function Hu(e,t){return 2*(1-e)*e*t}function Gu(e,t){return e*e*t}function Vu(e,t,n,i){return Uu(e,t)+Hu(e,n)+Gu(e,i)}function ju(e,t){const n=1-e;return n*n*n*t}function $u(e,t){const n=1-e;return 3*n*n*e*t}function Wu(e,t){return 3*(1-e)*e*e*t}function qu(e,t){return e*e*e*t}function Xu(e,t,n,i,r){return ju(e,t)+$u(e,n)+Wu(e,i)+qu(e,r)}function Yu(e,t,n,i){Iu.call(this),this.type="CubicBezierCurve",this.v0=e||new nn,this.v1=t||new nn,this.v2=n||new nn,this.v3=i||new nn}function Zu(e,t,n,i){Iu.call(this),this.type="CubicBezierCurve3",this.v0=e||new mn,this.v1=t||new mn,this.v2=n||new mn,this.v3=i||new mn}function Ku(e,t){Iu.call(this),this.type="LineCurve",this.v1=e||new nn,this.v2=t||new nn}function Qu(e,t){Iu.call(this),this.type="LineCurve3",this.v1=e||new mn,this.v2=t||new mn}function Ju(e,t,n){Iu.call(this),this.type="QuadraticBezierCurve",this.v0=e||new nn,this.v1=t||new nn,this.v2=n||new nn}function eh(e,t,n){Iu.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new mn,this.v1=t||new mn,this.v2=n||new mn}function th(e){Iu.call(this),this.type="SplineCurve",this.points=e||[]}Fu.prototype=Object.create(Iu.prototype),Fu.prototype.constructor=Fu,Fu.prototype.isCatmullRomCurve3=!0,Fu.prototype.getPoint=function(e,t){const n=t||new mn,i=this.points,r=i.length,o=(r-(this.closed?0:1))*e;let s,a,l,c,u=Math.floor(o),h=o-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/r)+1)*r:0===h&&u===r-1&&(u=r-2,h=1),this.closed||u>0?s=i[(u-1)%r]:(Du.subVectors(i[0],i[1]).add(i[0]),s=Du),a=i[u%r],l=i[(u+1)%r],this.closed||u+2<r?c=i[(u+2)%r]:(Du.subVectors(i[r-1],i[r-2]).add(i[r-1]),c=Du),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(s.distanceToSquared(a),e),n=Math.pow(a.distanceToSquared(l),e),i=Math.pow(l.distanceToSquared(c),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),Ou.initNonuniformCatmullRom(s.x,a.x,l.x,c.x,t,n,i),Nu.initNonuniformCatmullRom(s.y,a.y,l.y,c.y,t,n,i),Bu.initNonuniformCatmullRom(s.z,a.z,l.z,c.z,t,n,i)}else"catmullrom"===this.curveType&&(Ou.initCatmullRom(s.x,a.x,l.x,c.x,this.tension),Nu.initCatmullRom(s.y,a.y,l.y,c.y,this.tension),Bu.initCatmullRom(s.z,a.z,l.z,c.z,this.tension));return n.set(Ou.calc(h),Nu.calc(h),Bu.calc(h)),n},Fu.prototype.copy=function(e){Iu.prototype.copy.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Fu.prototype.toJSON=function(){const e=Iu.prototype.toJSON.call(this);e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Fu.prototype.fromJSON=function(e){Iu.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new mn).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Yu.prototype=Object.create(Iu.prototype),Yu.prototype.constructor=Yu,Yu.prototype.isCubicBezierCurve=!0,Yu.prototype.getPoint=function(e,t){const n=t||new nn,i=this.v0,r=this.v1,o=this.v2,s=this.v3;return n.set(Xu(e,i.x,r.x,o.x,s.x),Xu(e,i.y,r.y,o.y,s.y)),n},Yu.prototype.copy=function(e){return Iu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Yu.prototype.toJSON=function(){const e=Iu.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Yu.prototype.fromJSON=function(e){return Iu.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Zu.prototype=Object.create(Iu.prototype),Zu.prototype.constructor=Zu,Zu.prototype.isCubicBezierCurve3=!0,Zu.prototype.getPoint=function(e,t){const n=t||new mn,i=this.v0,r=this.v1,o=this.v2,s=this.v3;return n.set(Xu(e,i.x,r.x,o.x,s.x),Xu(e,i.y,r.y,o.y,s.y),Xu(e,i.z,r.z,o.z,s.z)),n},Zu.prototype.copy=function(e){return Iu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Zu.prototype.toJSON=function(){const e=Iu.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Zu.prototype.fromJSON=function(e){return Iu.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Ku.prototype=Object.create(Iu.prototype),Ku.prototype.constructor=Ku,Ku.prototype.isLineCurve=!0,Ku.prototype.getPoint=function(e,t){const n=t||new nn;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Ku.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Ku.prototype.getTangent=function(e,t){const n=t||new nn;return n.copy(this.v2).sub(this.v1).normalize(),n},Ku.prototype.copy=function(e){return Iu.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ku.prototype.toJSON=function(){const e=Iu.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ku.prototype.fromJSON=function(e){return Iu.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Qu.prototype=Object.create(Iu.prototype),Qu.prototype.constructor=Qu,Qu.prototype.isLineCurve3=!0,Qu.prototype.getPoint=function(e,t){const n=t||new mn;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Qu.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Qu.prototype.copy=function(e){return Iu.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Qu.prototype.toJSON=function(){const e=Iu.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Qu.prototype.fromJSON=function(e){return Iu.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ju.prototype=Object.create(Iu.prototype),Ju.prototype.constructor=Ju,Ju.prototype.isQuadraticBezierCurve=!0,Ju.prototype.getPoint=function(e,t){const n=t||new nn,i=this.v0,r=this.v1,o=this.v2;return n.set(Vu(e,i.x,r.x,o.x),Vu(e,i.y,r.y,o.y)),n},Ju.prototype.copy=function(e){return Iu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ju.prototype.toJSON=function(){const e=Iu.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ju.prototype.fromJSON=function(e){return Iu.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},eh.prototype=Object.create(Iu.prototype),eh.prototype.constructor=eh,eh.prototype.isQuadraticBezierCurve3=!0,eh.prototype.getPoint=function(e,t){const n=t||new mn,i=this.v0,r=this.v1,o=this.v2;return n.set(Vu(e,i.x,r.x,o.x),Vu(e,i.y,r.y,o.y),Vu(e,i.z,r.z,o.z)),n},eh.prototype.copy=function(e){return Iu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},eh.prototype.toJSON=function(){const e=Iu.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},eh.prototype.fromJSON=function(e){return Iu.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},th.prototype=Object.create(Iu.prototype),th.prototype.constructor=th,th.prototype.isSplineCurve=!0,th.prototype.getPoint=function(e,t){const n=t||new nn,i=this.points,r=(i.length-1)*e,o=Math.floor(r),s=r-o,a=i[0===o?o:o-1],l=i[o],c=i[o>i.length-2?i.length-1:o+1],u=i[o>i.length-3?i.length-1:o+2];return n.set(zu(s,a.x,l.x,c.x,u.x),zu(s,a.y,l.y,c.y,u.y)),n},th.prototype.copy=function(e){Iu.prototype.copy.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this},th.prototype.toJSON=function(){const e=Iu.prototype.toJSON.call(this);e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e},th.prototype.fromJSON=function(e){Iu.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new nn).fromArray(n))}return this};var nh=Object.freeze({__proto__:null,ArcCurve:Ru,CatmullRomCurve3:Fu,CubicBezierCurve:Yu,CubicBezierCurve3:Zu,EllipseCurve:Lu,LineCurve:Ku,LineCurve3:Qu,QuadraticBezierCurve:Ju,QuadraticBezierCurve3:eh,SplineCurve:th});function ih(){Iu.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function rh(e){ih.call(this),this.type="Path",this.currentPoint=new nn,e&&this.setFromPoints(e)}function oh(e){rh.call(this,e),this.uuid=tn.generateUUID(),this.type="Shape",this.holes=[]}function sh(e,t){Hn.call(this),this.type="Light",this.color=new Ri(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function ah(e,t,n){sh.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Hn.DefaultUp),this.updateMatrix(),this.groundColor=new Ri(t)}function lh(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new nn(512,512),this.map=null,this.mapPass=null,this.matrix=new Sn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Zr,this._frameExtents=new nn(1,1),this._viewportCount=1,this._viewports=[new cn(0,0,1,1)]}function ch(){lh.call(this,new Gr(50,1,.5,500))}function uh(e,t,n,i,r,o){sh.call(this,e,t),this.type="SpotLight",this.position.copy(Hn.DefaultUp),this.updateMatrix(),this.target=new Hn,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new ch}function hh(){lh.call(this,new Gr(90,1,.5,500)),this._frameExtents=new nn(4,2),this._viewportCount=6,this._viewports=[new cn(2,1,1,1),new cn(0,1,1,1),new cn(3,1,1,1),new cn(1,1,1,1),new cn(3,0,1,1),new cn(1,0,1,1)],this._cubeDirections=[new mn(1,0,0),new mn(-1,0,0),new mn(0,0,1),new mn(0,0,-1),new mn(0,1,0),new mn(0,-1,0)],this._cubeUps=[new mn(0,1,0),new mn(0,1,0),new mn(0,1,0),new mn(0,1,0),new mn(0,0,1),new mn(0,0,-1)]}function dh(e,t,n,i){sh.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==i?i:1,this.shadow=new hh}function ph(e,t,n,i,r,o){Hr.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==n?n:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function fh(){lh.call(this,new ph(-5,5,5,-5,.5,500))}function mh(e,t){sh.call(this,e,t),this.type="DirectionalLight",this.position.copy(Hn.DefaultUp),this.updateMatrix(),this.target=new Hn,this.shadow=new fh}function gh(e,t){sh.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function yh(e,t,n,i){sh.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==i?i:10}function vh(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new mn)}function bh(e,t){sh.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==e?e:new vh}function xh(e){wu.call(this,e),this.textures={}}ih.prototype=Object.assign(Object.create(Iu.prototype),{constructor:ih,add:function(e){this.curves.push(e)},closePath:function(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ku(t,e))},getPoint:function(e){const t=e*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=t){const e=n[i]-t,r=this.curves[i],o=r.getLength(),s=0===o?0:1-e/o;return r.getPointAt(s)}i++}return null},getLength:function(){const e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],s=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let e=0;e<a.length;e++){const i=a[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:function(e){Iu.prototype.copy.call(this,e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){const e=Iu.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function(e){Iu.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new nh[n.type]).fromJSON(n))}return this}}),rh.prototype=Object.assign(Object.create(ih.prototype),{constructor:rh,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){const n=new Ku(this.currentPoint.clone(),new nn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,i){const r=new Ju(this.currentPoint.clone(),new nn(e,t),new nn(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this},bezierCurveTo:function(e,t,n,i,r,o){const s=new Yu(this.currentPoint.clone(),new nn(e,t),new nn(n,i),new nn(r,o));return this.curves.push(s),this.currentPoint.set(r,o),this},splineThru:function(e){const t=new th([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,i,r,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,n,i,r,o),this},absarc:function(e,t,n,i,r,o){return this.absellipse(e,t,n,n,i,r,o),this},ellipse:function(e,t,n,i,r,o,s,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,r,o,s,a),this},absellipse:function(e,t,n,i,r,o,s,a){const l=new Lu(e,t,n,i,r,o,s,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(e){return ih.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){const e=ih.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return ih.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),oh.prototype=Object.assign(Object.create(rh.prototype),{constructor:oh,getPointsHoles:function(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){rh.prototype.copy.call(this,e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function(){const e=rh.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function(e){rh.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new rh).fromJSON(n))}return this}}),sh.prototype=Object.assign(Object.create(Hn.prototype),{constructor:sh,isLight:!0,copy:function(e){return Hn.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){const t=Hn.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),ah.prototype=Object.assign(Object.create(sh.prototype),{constructor:ah,isHemisphereLight:!0,copy:function(e){return sh.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(lh.prototype,{_projScreenMatrix:new Sn,_lightPositionWorld:new mn,_lookTarget:new mn,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){const t=this.camera,n=this.matrix,i=this._projScreenMatrix,r=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),r.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(r),t.updateMatrixWorld(),i.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),ch.prototype=Object.assign(Object.create(lh.prototype),{constructor:ch,isSpotLightShadow:!0,updateMatrices:function(e){const t=this.camera,n=2*tn.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),lh.prototype.updateMatrices.call(this,e)}}),uh.prototype=Object.assign(Object.create(sh.prototype),{constructor:uh,isSpotLight:!0,copy:function(e){return sh.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),hh.prototype=Object.assign(Object.create(lh.prototype),{constructor:hh,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);const n=this.camera,i=this.matrix,r=this._lightPositionWorld,o=this._lookTarget,s=this._projScreenMatrix;r.setFromMatrixPosition(e.matrixWorld),n.position.copy(r),o.copy(n.position),o.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(o),n.updateMatrixWorld(),i.makeTranslation(-r.x,-r.y,-r.z),s.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s)}}),dh.prototype=Object.assign(Object.create(sh.prototype),{constructor:dh,isPointLight:!0,copy:function(e){return sh.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),ph.prototype=Object.assign(Object.create(Hr.prototype),{constructor:ph,isOrthographicCamera:!0,copy:function(e,t){return Hr.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,s=i+t,a=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,o=r+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){const t=Hn.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),fh.prototype=Object.assign(Object.create(lh.prototype),{constructor:fh,isDirectionalLightShadow:!0,updateMatrices:function(e){lh.prototype.updateMatrices.call(this,e)}}),mh.prototype=Object.assign(Object.create(sh.prototype),{constructor:mh,isDirectionalLight:!0,copy:function(e){return sh.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),gh.prototype=Object.assign(Object.create(sh.prototype),{constructor:gh,isAmbientLight:!0}),yh.prototype=Object.assign(Object.create(sh.prototype),{constructor:yh,isRectAreaLight:!0,copy:function(e){return sh.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){const t=sh.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Object.assign(vh.prototype,{isSphericalHarmonics3:!0,set:function(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*i*1.092548),t.addScaledVector(o[5],i*r*1.092548),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],n*r*1.092548),t.addScaledVector(o[8],.546274*(n*n-i*i)),t},getIrradianceAt:function(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*i),t.addScaledVector(o[2],1.023328*r),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*i),t.addScaledVector(o[5],.858086*i*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],.858086*n*r),t.addScaledVector(o[8],.429043*(n*n-i*i)),t},add:function(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},addScaledSH:function(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this},scale:function(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this},equals:function(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){void 0===t&&(t=0);const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}}),Object.assign(vh,{getBasisAt:function(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}),bh.prototype=Object.assign(Object.create(sh.prototype),{constructor:bh,isLightProbe:!0,copy:function(e){return sh.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){const t=sh.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}}),xh.prototype=Object.assign(Object.create(wu.prototype),{constructor:xh,load:function(e,t,n,i){const r=this,o=new Su(r.manager);o.setPath(r.path),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(o){i?i(o):console.error(o),r.manager.itemError(e)}}),n,i)},parse:function(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const i=new tu[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=(new Ri).setHex(e.sheen)),void 0!==e.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&i.specular.setHex(e.specular),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(i.skinning=e.skinning),void 0!==e.morphTargets&&(i.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(i.morphNormals=e.morphNormals),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.vertexTangents&&(i.vertexTangents=e.vertexTangents),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const r in e.uniforms){const t=e.uniforms[r];switch(i.uniforms[r]={},t.type){case"t":i.uniforms[r].value=n(t.value);break;case"c":i.uniforms[r].value=(new Ri).setHex(t.value);break;case"v2":i.uniforms[r].value=(new nn).fromArray(t.value);break;case"v3":i.uniforms[r].value=(new mn).fromArray(t.value);break;case"v4":i.uniforms[r].value=(new cn).fromArray(t.value);break;case"m3":i.uniforms[r].value=(new rn).fromArray(t.value);case"m4":i.uniforms[r].value=(new Sn).fromArray(t.value);break;default:i.uniforms[r].value=t.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const r in e.extensions)i.extensions[r]=e.extensions[r];if(void 0!==e.shading&&(i.flatShading=1===e.shading),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new nn).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new nn).fromArray(e.clearcoatNormalScale)),i},setTextures:function(e){return this.textures=e,this}});const wh={decodeText:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(n){return t}},extractUrlBase:function(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function _h(){ar.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function Sh(e,t,n,i){"number"===typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Gi.call(this,e,t,n),this.meshPerAttribute=i||1}function Mh(e){wu.call(this,e)}_h.prototype=Object.assign(Object.create(ar.prototype),{constructor:_h,isInstancedBufferGeometry:!0,copy:function(e){return ar.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e=ar.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),Sh.prototype=Object.assign(Object.create(Gi.prototype),{constructor:Sh,isInstancedBufferAttribute:!0,copy:function(e){return Gi.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){const e=Gi.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Mh.prototype=Object.assign(Object.create(wu.prototype),{constructor:Mh,load:function(e,t,n,i){const r=this,o=new Su(r.manager);o.setPath(r.path),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(o){i?i(o):console.error(o),r.manager.itemError(e)}}),n,i)},parse:function(e){const t={},n={};function i(e,n){if(void 0!==t[n])return t[n];const i=e.interleavedBuffers[n],o=r(e,i.buffer),s=new _a(new Ah[i.type](o),i.stride);return s.uuid=i.uuid,t[n]=s,s}function r(e,t){if(void 0!==n[t])return n[t];const i=e.arrayBuffers[t],r=new Uint32Array(i).buffer;return n[t]=r,r}const o=e.isInstancedBufferGeometry?new _h:new ar,s=e.data.index;if(void 0!==s){const e=new Ah[s.type](s.array);o.setIndex(new Gi(e,1))}const a=e.data.attributes;for(const h in a){const t=a[h];let n;if(t.isInterleavedBufferAttribute)n=new Ma(i(e.data,t.data),t.itemSize,t.offset,t.normalized);else{const e=new Ah[t.type](t.array);n=new(t.isInstancedBufferAttribute?Sh:Gi)(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),o.setAttribute(h,n)}const l=e.data.morphAttributes;if(l)for(const h in l){const t=l[h],n=[];for(let r=0,o=t.length;r<o;r++){const o=t[r];let s;s=o.isInterleavedBufferAttribute?new Ma(i(e.data,o.data),o.itemSize,o.offset,o.normalized):new Gi(new Ah[o.type](o.array),o.itemSize,o.normalized),void 0!==o.name&&(s.name=o.name),n.push(s)}o.morphAttributes[h]=n}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const c=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==c)for(let h=0,d=c.length;h!==d;++h){const e=c[h];o.addGroup(e.start,e.count,e.materialIndex)}const u=e.data.boundingSphere;if(void 0!==u){const e=new mn;void 0!==u.center&&e.fromArray(u.center),o.boundingSphere=new oi(e,u.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}});const Ah={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!==typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Ch(e){wu.call(this,e)}Ch.prototype=Object.assign(Object.create(wu.prototype),{constructor:Ch,load:function(e,t,n,i){const r=this,o=""===this.path?wh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const s=new Su(r.manager);s.setPath(this.path),s.load(e,(function(n){let o=null;try{o=JSON.parse(n)}catch(a){return void 0!==i&&i(a),void console.error("THREE:ObjectLoader: Can't parse "+e+".",a.message)}const s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?r.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,i)},parse:function(e,t){const n=this.parseShape(e.shapes),i=this.parseGeometries(e.geometries,n),r=this.parseImages(e.images,(function(){void 0!==t&&t(a)})),o=this.parseTextures(e.textures,r),s=this.parseMaterials(e.materials,o),a=this.parseObject(e.object,i,s);return e.animations&&(a.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(a),a},parseShape:function(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const i=(new oh).fromJSON(e[n]);t[i.uuid]=i}return t},parseGeometries:function(e,t){const n={};let i;if(void 0!==e){const r=new Mh;for(let o=0,s=e.length;o<s;o++){let s;const a=e[o];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new jc[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new jc[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new jc[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new jc[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new jc[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new jc[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new jc[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new jc[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new jc[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new jc[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"TubeGeometry":case"TubeBufferGeometry":s=new jc[a.type]((new nh[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case"LatheGeometry":case"LatheBufferGeometry":s=new jc[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new jc[a.type](a.vertices,a.indices,a.radius,a.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":i=[];for(let n=0,r=a.shapes.length;n<r;n++){const e=t[a.shapes[n]];i.push(e)}s=new jc[a.type](i,a.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":i=[];for(let n=0,r=a.shapes.length;n<r;n++){const e=t[a.shapes[n]];i.push(e)}const e=a.options.extrudePath;void 0!==e&&(a.options.extrudePath=(new nh[e.type]).fromJSON(e)),s=new jc[a.type](i,a.options);break;case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(a);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),!0===s.isBufferGeometry&&void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}}return n},parseMaterials:function(e,t){const n={},i={};if(void 0!==e){const r=new xh;r.setTextures(t);for(let t=0,o=e.length;t<o;t++){const o=e[t];if("MultiMaterial"===o.type){const e=[];for(let t=0;t<o.materials.length;t++){const i=o.materials[t];void 0===n[i.uuid]&&(n[i.uuid]=r.parse(i)),e.push(n[i.uuid])}i[o.uuid]=e}else void 0===n[o.uuid]&&(n[o.uuid]=r.parse(o)),i[o.uuid]=n[o.uuid]}}return i},parseAnimations:function(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n],r=mu.parse(i);void 0!==i.uuid&&(r.uuid=i.uuid),t.push(r)}return t},parseImages:function(e,t){const n=this,i={};let r;function o(e){return n.manager.itemStart(e),r.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}if(void 0!==e&&e.length>0){const s=new bu(t);r=new Tu(s),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const r=e[t],s=r.url;if(Array.isArray(s)){i[r.uuid]=[];for(let e=0,t=s.length;e<t;e++){const t=s[e],a=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t;i[r.uuid].push(o(a))}}else{const e=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r.url)?r.url:n.resourcePath+r.url;i[r.uuid]=o(e)}}}return i},parseTextures:function(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const i={};if(void 0!==e)for(let r=0,o=e.length;r<o;r++){const o=e[r];let s;void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image),s=Array.isArray(t[o.image])?new vo(t[o.image]):new ln(t[o.image]),s.needsUpdate=!0,s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.mapping&&(s.mapping=n(o.mapping,Th)),void 0!==o.offset&&s.offset.fromArray(o.offset),void 0!==o.repeat&&s.repeat.fromArray(o.repeat),void 0!==o.center&&s.center.fromArray(o.center),void 0!==o.rotation&&(s.rotation=o.rotation),void 0!==o.wrap&&(s.wrapS=n(o.wrap[0],Eh),s.wrapT=n(o.wrap[1],Eh)),void 0!==o.format&&(s.format=o.format),void 0!==o.type&&(s.type=o.type),void 0!==o.encoding&&(s.encoding=o.encoding),void 0!==o.minFilter&&(s.minFilter=n(o.minFilter,Ph)),void 0!==o.magFilter&&(s.magFilter=n(o.magFilter,Ph)),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),void 0!==o.flipY&&(s.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(s.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(s.unpackAlignment=o.unpackAlignment),i[o.uuid]=s}return i},parseObject:function(e,t,n){let i,r,o;function s(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function a(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),t.push(n[r])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":i=new Gn,void 0!==e.background&&Number.isInteger(e.background)&&(i.background=new Ri(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new wa(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new xa(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new Gr(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new ph(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new gh(e.color,e.intensity);break;case"DirectionalLight":i=new mh(e.color,e.intensity);break;case"PointLight":i=new dh(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new yh(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new uh(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new ah(e.color,e.groundColor,e.intensity);break;case"LightProbe":i=(new bh).fromJSON(e);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":r=s(e.geometry),o=a(e.material),i=new Ar(r,o);break;case"InstancedMesh":r=s(e.geometry),o=a(e.material);const t=e.count,n=e.instanceMatrix;i=new Ja(r,o,t),i.instanceMatrix=new Gi(new Float32Array(n.array),16);break;case"LOD":i=new Va;break;case"Line":i=new sl(s(e.geometry),a(e.material),e.mode);break;case"LineLoop":i=new ul(s(e.geometry),a(e.material));break;case"LineSegments":i=new cl(s(e.geometry),a(e.material));break;case"PointCloud":case"Points":i=new gl(s(e.geometry),a(e.material));break;case"Sprite":i=new za(a(e.material));break;case"Group":i=new fa;break;default:i=new Hn}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(i.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children){const r=e.children;for(let e=0;e<r.length;e++)i.add(this.parseObject(r[e],t,n))}if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=i.getObjectByProperty("uuid",n.object);void 0!==r&&i.addLevel(r,n.distance)}}return i}});const Th={UVMapping:Q,CubeReflectionMapping:J,CubeRefractionMapping:ee,EquirectangularReflectionMapping:te,EquirectangularRefractionMapping:ne,CubeUVReflectionMapping:ie,CubeUVRefractionMapping:re},Eh={RepeatWrapping:oe,ClampToEdgeWrapping:se,MirroredRepeatWrapping:ae},Ph={NearestFilter:le,NearestMipmapNearestFilter:ce,NearestMipmapLinearFilter:ue,LinearFilter:he,LinearMipmapNearestFilter:de,LinearMipmapLinearFilter:pe};function Ih(e){"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),wu.call(this,e),this.options={premultiplyAlpha:"none"}}function Lh(){this.type="ShapePath",this.color=new Ri,this.subPaths=[],this.currentPath=null}function Rh(e){this.type="Font",this.data=e}function kh(e,t,n){const i=Array.from?Array.from(e):String(e).split(""),r=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,s=[];let a=0,l=0;for(let c=0;c<i.length;c++){const e=i[c];if("\n"===e)a=0,l-=o;else{const t=Dh(e,r,a,l,n);a+=t.offsetX,s.push(t.path)}}return s}function Dh(e,t,n,i,r){const o=r.glyphs[e]||r.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+r.familyName+".");const s=new Lh;let a,l,c,u,h,d,p,f;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let r=0,o=e.length;r<o;)switch(e[r++]){case"m":a=e[r++]*t+n,l=e[r++]*t+i,s.moveTo(a,l);break;case"l":a=e[r++]*t+n,l=e[r++]*t+i,s.lineTo(a,l);break;case"q":c=e[r++]*t+n,u=e[r++]*t+i,h=e[r++]*t+n,d=e[r++]*t+i,s.quadraticCurveTo(h,d,c,u);break;case"b":c=e[r++]*t+n,u=e[r++]*t+i,h=e[r++]*t+n,d=e[r++]*t+i,p=e[r++]*t+n,f=e[r++]*t+i,s.bezierCurveTo(h,d,p,f,c,u)}}return{offsetX:o.ha*t,path:s}}function Oh(e){wu.call(this,e)}let Nh;Ih.prototype=Object.assign(Object.create(wu.prototype),{constructor:Ih,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=vu.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;fetch(e).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,r.options)})).then((function(n){vu.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}),Object.assign(Lh.prototype,{moveTo:function(e,t){return this.currentPath=new rh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this},bezierCurveTo:function(e,t,n,i,r,o){return this.currentPath.bezierCurveTo(e,t,n,i,r,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],r=new oh;r.curves=i.curves,t.push(r)}return t}function i(e,t){const n=t.length;let i=!1;for(let r=n-1,o=0;o<n;r=o++){let n=t[r],s=t[o],a=s.x-n.x,l=s.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[o],a=-a,s=t[r],l=-l),e.y<n.y||e.y>s.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-a*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(s.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=s.x)return!0}}return i}const r=bc.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);let s,a,l,c=[];if(1===o.length)return a=o[0],l=new oh,l.curves=a.curves,c.push(l),c;let u=!r(o[0].getPoints());u=e?!u:u;const h=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let y=0,v=o.length;y<v;y++)a=o[y],p=a.getPoints(),s=r(p),s=e?!s:s,s?(!u&&d[g]&&g++,d[g]={s:new oh,p:p},d[g].s.curves=a.curves,u&&g++,m[g]=[]):m[g].push({h:a,p:p[0]});if(!d[0])return n(o);if(d.length>1){let e=!1;const t=[];for(let n=0,i=d.length;n<i;n++)h[n]=[];for(let n=0,r=d.length;n<r;n++){const r=m[n];for(let o=0;o<r.length;o++){const s=r[o];let a=!0;for(let r=0;r<d.length;r++)i(s.p,d[r].p)&&(n!==r&&t.push({froms:n,tos:r,hole:o}),a?(a=!1,h[r].push(s)):e=!0);a&&h[n].push(s)}}t.length>0&&(e||(m=h))}for(let y=0,v=d.length;y<v;y++){l=d[y].s,c.push(l),f=m[y];for(let e=0,t=f.length;e<t;e++)l.holes.push(f[e].h)}return c}}),Object.assign(Rh.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);const n=[],i=kh(e,t,this.data);for(let r=0,o=i.length;r<o;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}}),Oh.prototype=Object.assign(Object.create(wu.prototype),{constructor:Oh,load:function(e,t,n,i){const r=this,o=new Su(this.manager);o.setPath(this.path),o.load(e,(function(e){let n;try{n=JSON.parse(e)}catch(o){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}const i=r.parse(n);t&&t(i)}),n,i)},parse:function(e){return new Rh(e)}});const Bh={getContext:function(){return void 0===Nh&&(Nh=new(window.AudioContext||window.webkitAudioContext)),Nh},setContext:function(e){Nh=e}};function Fh(e){wu.call(this,e)}function zh(e,t,n){bh.call(this,void 0,n);const i=(new Ri).set(e),r=(new Ri).set(t),o=new mn(i.r,i.g,i.b),s=new mn(r.r,r.g,r.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(s).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(s).multiplyScalar(l)}function Uh(e,t){bh.call(this,void 0,t);const n=(new Ri).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}Fh.prototype=Object.assign(Object.create(wu.prototype),{constructor:Fh,load:function(e,t,n,i){const r=this,o=new Su(r.manager);o.setResponseType("arraybuffer"),o.setPath(r.path),o.load(e,(function(n){try{const e=n.slice(0);Bh.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(o){i?i(o):console.error(o),r.manager.itemError(e)}}),n,i)}}),zh.prototype=Object.assign(Object.create(bh.prototype),{constructor:zh,isHemisphereLightProbe:!0,copy:function(e){return bh.prototype.copy.call(this,e),this},toJSON:function(e){return bh.prototype.toJSON.call(this,e)}}),Uh.prototype=Object.assign(Object.create(bh.prototype),{constructor:Uh,isAmbientLightProbe:!0,copy:function(e){return bh.prototype.copy.call(this,e),this},toJSON:function(e){return bh.prototype.toJSON.call(this,e)}});const Hh=new Sn,Gh=new Sn;function Vh(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Gr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Gr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function jh(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(Vh.prototype,{update:function(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const n=e.projectionMatrix.clone(),i=t.eyeSep/2,r=i*t.near/t.focus,o=t.near*Math.tan(tn.DEG2RAD*t.fov*.5)/t.zoom;let s,a;Gh.elements[12]=-i,Hh.elements[12]=i,s=-o*t.aspect+r,a=o*t.aspect+r,n.elements[0]=2*t.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(n),s=-o*t.aspect-r,a=o*t.aspect-r,n.elements[0]=2*t.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Gh),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Hh)}}),Object.assign(jh.prototype,{start:function(){this.startTime=("undefined"===typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=("undefined"===typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});const $h=new mn,Wh=new dn,qh=new mn,Xh=new mn;function Yh(){Hn.call(this),this.type="AudioListener",this.context=Bh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new jh}function Zh(e){Hn.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._progress=0,this.filters=[]}Yh.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Yh,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){Hn.prototype.updateMatrixWorld.call(this,e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose($h,Wh,qh),Xh.set(0,0,-1).applyQuaternion(Wh),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime($h.x,e),t.positionY.linearRampToValueAtTime($h.y,e),t.positionZ.linearRampToValueAtTime($h.z,e),t.forwardX.linearRampToValueAtTime(Xh.x,e),t.forwardY.linearRampToValueAtTime(Xh.y,e),t.forwardZ.linearRampToValueAtTime(Xh.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition($h.x,$h.y,$h.z),t.setOrientation(Xh.x,Xh.y,Xh.z,n.x,n.y,n.z)}}),Zh.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Zh,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(void 0===e&&(e=0),!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});const Kh=new mn,Qh=new dn,Jh=new mn,ed=new mn;function td(e){Zh.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function nd(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function id(e,t,n){let i,r,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}td.prototype=Object.assign(Object.create(Zh.prototype),{constructor:td,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(e){if(Hn.prototype.updateMatrixWorld.call(this,e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Kh,Qh,Jh),ed.set(0,0,1).applyQuaternion(Qh);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Kh.x,e),t.positionY.linearRampToValueAtTime(Kh.y,e),t.positionZ.linearRampToValueAtTime(Kh.z,e),t.orientationX.linearRampToValueAtTime(ed.x,e),t.orientationY.linearRampToValueAtTime(ed.y,e),t.orientationZ.linearRampToValueAtTime(ed.z,e)}else t.setPosition(Kh.x,Kh.y,Kh.z),t.setOrientation(ed.x,ed.y,ed.z)}}),Object.assign(nd.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(id.prototype,{accumulate:function(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==i;++e)n[r+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=o},accumulateAdditive:function(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e},apply:function(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let a=t,l=t+t;a!==l;++a)if(n[a]!==n[a+t]){s.setValue(n,i);break}},saveOriginalState:function(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,o=i;r!==o;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[4*this._addIndex+3]=1},_setAdditiveIdentityOther:function(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]},_select:function(e,t,n,i,r){if(i>=.5)for(let o=0;o!==r;++o)e[t+o]=e[n+o]},_slerp:function(e,t,n,i){dn.slerpFlat(e,t,e,t,e,n,i)},_slerpAdditive:function(e,t,n,i,r){const o=this._workIndex*r;dn.multiplyQuaternionsFlat(e,o,e,t,e,n),dn.slerpFlat(e,t,e,t,e,o,i)},_lerp:function(e,t,n,i,r){const o=1-i;for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]*o+e[n+s]*i}},_lerpAdditive:function(e,t,n,i,r){for(let o=0;o!==r;++o){const r=t+o;e[r]=e[r]+e[n+o]*i}}});const rd="\\[\\]\\.:\\/",od=new RegExp("["+rd+"]","g"),sd="[^"+rd+"]",ad="[^"+rd.replace("\\.","")+"]",ld=/((?:WC+[\/:])*)/.source.replace("WC",sd),cd=/(WCOD+)?/.source.replace("WCOD",ad),ud=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",sd),hd=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",sd),dd=new RegExp("^"+ld+cd+ud+hd+"$"),pd=["material","materials","bones"];function fd(e,t,n){const i=n||md.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function md(e,t,n){this.path=t,this.parsedPath=n||md.parseTrackName(t),this.node=md.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function gd(){this.uuid=tn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}function yd(e,t,n,i){this._mixer=e,this._clip=t,this._localRoot=n||null,this.blendMode=i||t.blendMode;const r=t.tracks,o=r.length,s=new Array(o),a={endingStart:Lt,endingEnd:Lt};for(let l=0;l!==o;++l){const e=r[l].createInterpolant(null);s[l]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ct,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function vd(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function bd(e){"string"===typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function xd(e,t,n){_a.call(this,e,t),this.meshPerAttribute=n||1}function wd(e,t,n,i){this.ray=new pi(e,t),this.near=n||0,this.far=i||1/0,this.camera=null,this.layers=new Tn,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function _d(e,t){return e.distance-t.distance}function Sd(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i){const i=e.children;for(let e=0,r=i.length;e<r;e++)Sd(i[e],t,n,!0)}}function Md(e,t,n){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0,this}function Ad(e,t,n){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==n?n:0,this}Object.assign(fd.prototype,{getValue:function(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)},bind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(md,{Composite:fd,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new md.Composite(e,t,n):new md(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(od,"")},parseTrackName:function(e){const t=dd.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==pd.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const o=n(r.children);if(o)return o}return null},i=n(e.children);if(i)return i}return null}}),Object.assign(md.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]},function(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){let e=this.node,t=this.parsedPath,n=t.objectName,i=t.propertyName,r=t.propertyIndex;if(e||(e=md.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const o=e[i];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(md.prototype,{_getValue_unbound:md.prototype.getValue,_setValue_unbound:md.prototype.setValue}),Object.assign(gd.prototype,{isAnimationObjectGroup:!0,add:function(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,o=r.length;let s,a=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=t[h];if(void 0===d){d=a++,t[h]=d,e.push(u);for(let e=0,t=o;e!==t;++e)r[e].push(new md(u,n[e],i[e]))}else if(d<l){s=e[d];const a=--l,c=e[a];t[c.uuid]=d,e[d]=c,t[h]=a,e[a]=u;for(let e=0,t=o;e!==t;++e){const t=r[e],o=t[a];let s=t[d];t[d]=o,void 0===s&&(s=new md(u,n[e],i[e])),t[a]=s}}else e[d]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,l=t[a];if(void 0!==l&&l>=r){const o=r++,c=e[o];t[c.uuid]=l,e[l]=c,t[a]=o,e[o]=s;for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[o],r=t[l];t[l]=i,t[o]=r}}}this.nCachedObjects_=r},uncache:function(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,o=e.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<r){const s=--r,a=e[s],c=--o,u=e[c];t[a.uuid]=l,e[l]=a,t[u.uuid]=s,e[s]=u,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[s],r=t[c];t[l]=i,t[s]=r,t.pop()}}else{const r=--o,s=e[r];t[s.uuid]=l,e[l]=s,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e];t[l]=t[r],t.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){let n=this._bindingsIndicesByPath,i=n[e],r=this._bindings;if(void 0!==i)return r[i];const o=this._paths,s=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);i=r.length,n[e]=i,o.push(e),s.push(t),r.push(u);for(let h=c,d=a.length;h!==d;++h){const n=a[h];u[h]=new md(n,e,t)}return u},unsubscribe_:function(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const i=this._paths,r=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=n,o[n]=a,o.pop(),r[n]=r[s],r.pop(),i[n]=i[s],i.pop()}}}),Object.assign(yd.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,r=i/n,o=n/i;e.warp(1,r,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){let e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){const i=this._mixer,r=i.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=i._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,l=s.sampleValues;return a[0]=r,a[1]=r+n,l[0]=e/o,l[1]=t/o,this},stopWarping:function(){let e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;if(i<0||0===n)return;this._startTime=null,t=n*i}t*=this._updateTimeScale(e);const o=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Ot)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulateAdditive(s);else for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulate(i,s)}},_updateWeight:function(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t},_updateTime:function(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const o=n===Tt;if(0===e)return-1===r?i:o&&1===(1&r)?t-i:i;if(n===At){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);const s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(o&&1===(1&r))return t-i}return i},_setEndings:function(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=Rt,i.endingEnd=Rt):(i.endingStart=e?this.zeroSlopeAtStart?Rt:Lt:kt,i.endingEnd=t?this.zeroSlopeAtEnd?Rt:Lt:kt)},_scheduleFading:function(e,t,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=r,a[0]=t,s[1]=r+e,a[1]=n,this}}),vd.prototype=Object.assign(Object.create(Jt.prototype),{constructor:vd,_bindAction:function(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,o=e._propertyBindings,s=e._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let u=0;u!==r;++u){const e=i[u],r=e.name;let l=c[r];if(void 0!==l)o[u]=l;else{if(l=o[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,a,r));continue}const i=t&&t._propertyBindings[u].binding.parsedPath;l=new id(md.create(n,r,i),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,a,r),o[u]=l}s[u].resultBuffer=l.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){const i=this._actions,r=this._actionsByClip;let o=r[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e},_removeInactiveAction:function(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,s=o[r],a=s.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[r],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const e=t[n];0===--e.referenceCount&&this._removeInactiveBinding(e)}},_lendAction:function(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackAction:function(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_addInactiveBinding:function(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[t];void 0===o&&(o={},i[t]=o),o[n]=e,e._cacheIndex=r.length,r.push(e)},_removeInactiveBinding:function(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,s=o[i],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete s[r],0===Object.keys(s).length&&delete o[i]},_lendBinding:function(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackBinding:function(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_lendControlInterpolant:function(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new ou(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,n){const i=t||this._root,r=i.uuid;let o="string"===typeof e?mu.findByName(i,e):e;const s=null!==o?o.uuid:e;let a=this._actionsByClip[s],l=null;if(void 0===n&&(n=null!==o?o.blendMode:Dt),void 0!==a){const e=a.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;l=a.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const c=new yd(this,o,t,n);return this._bindAction(c,l),this._addInactiveAction(c,s,r),c},existingAction:function(e,t){const n=t||this._root,i=n.uuid,r="string"===typeof e?mu.findByName(n,e):e,o=r?r.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[i]||null},stopAllAction:function(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this},update:function(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let l=0;l!==n;++l)t[l]._update(i,e,r,o);const s=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)s[l].apply(o);return this},setTime:function(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const r=i._cacheIndex,o=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,o._cacheIndex=r,t[r]=o,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}},uncacheRoot:function(e){const t=e.uuid,n=this._actionsByClip;for(const r in n){const e=n[r].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const r in i){const e=i[r];e.restoreOriginalState(),this._removeInactiveBinding(e)}},uncacheAction:function(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),bd.prototype.clone=function(){return new bd(void 0===this.value.clone?this.value:this.value.clone())},xd.prototype=Object.assign(Object.create(_a.prototype),{constructor:xd,isInstancedInterleavedBuffer:!0,copy:function(e){return _a.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){const t=_a.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){const t=_a.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.assign(wd.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){const i=n||[];return Sd(e,this,i,t),i.sort(_d),i},intersectObjects:function(e,t,n){const i=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(let r=0,o=e.length;r<o;r++)Sd(e[r],this,i,t);return i.sort(_d),i}}),Object.assign(Md.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(tn.clamp(t/this.radius,-1,1))),this}}),Object.assign(Ad.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}});const Cd=new nn;function Td(e,t){this.min=void 0!==e?e:new nn(1/0,1/0),this.max=void 0!==t?t:new nn(-1/0,-1/0)}Object.assign(Td.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){const n=Cd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new nn),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new nn),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new nn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new nn),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return Cd.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});const Ed=new mn,Pd=new mn;function Id(e,t){this.start=void 0!==e?e:new mn,this.end=void 0!==t?t:new mn}function Ld(e){Hn.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Object.assign(Id.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new mn),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new mn),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new mn),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){Ed.subVectors(e,this.start),Pd.subVectors(this.end,this.start);const n=Pd.dot(Pd);let i=Pd.dot(Ed)/n;return t&&(i=tn.clamp(i,0,1)),i},closestPointToPoint:function(e,t,n){const i=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new mn),this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Ld.prototype=Object.create(Hn.prototype),Ld.prototype.constructor=Ld,Ld.prototype.isImmediateRenderObject=!0;const Rd=new mn;function kd(e,t){Hn.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new ar,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,s=1,a=32;o<a;o++,s++){const e=o/a*Math.PI*2,t=s/a*Math.PI*2;i.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}n.setAttribute("position",new Zi(i,3));const r=new el({fog:!1,toneMapped:!1});this.cone=new cl(n,r),this.add(this.cone),this.update()}kd.prototype=Object.create(Hn.prototype),kd.prototype.constructor=kd,kd.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},kd.prototype.update=function(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Rd.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Rd),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};const Dd=new mn,Od=new Sn,Nd=new Sn;function Bd(e){const t=[];e&&e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,Bd(e.children[n]));return t}function Fd(e){const t=Bd(e),n=new ar,i=[],r=[],o=new Ri(0,0,1),s=new Ri(0,1,0);for(let l=0;l<t.length;l++){const e=t[l];e.parent&&e.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(s.r,s.g,s.b))}n.setAttribute("position",new Zi(i,3)),n.setAttribute("color",new Zi(r,3));const a=new el({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});cl.call(this,n,a),this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function zd(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n;const i=new Pc(t,4,2),r=new zi({wireframe:!0,fog:!1,toneMapped:!1});Ar.call(this,i,r),this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}Fd.prototype=Object.create(cl.prototype),Fd.prototype.constructor=Fd,Fd.prototype.isSkeletonHelper=!0,Fd.prototype.updateMatrixWorld=function(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");Nd.getInverse(this.root.matrixWorld);for(let r=0,o=0;r<t.length;r++){const e=t[r];e.parent&&e.parent.isBone&&(Od.multiplyMatrices(Nd,e.matrixWorld),Dd.setFromMatrixPosition(Od),i.setXYZ(o,Dd.x,Dd.y,Dd.z),Od.multiplyMatrices(Nd,e.parent.matrixWorld),Dd.setFromMatrixPosition(Od),i.setXYZ(o+1,Dd.x,Dd.y,Dd.z),o+=2)}n.getAttribute("position").needsUpdate=!0,Hn.prototype.updateMatrixWorld.call(this,e)},zd.prototype=Object.create(Ar.prototype),zd.prototype.constructor=zd,zd.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},zd.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};const Ud=new mn,Hd=new Ri,Gd=new Ri;function Vd(e,t,n){Hn.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new Il(t);i.rotateY(.5*Math.PI),this.material=new zi({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),o=new Float32Array(3*r.count);i.setAttribute("color",new Gi(o,3)),this.add(new Ar(i,this.material)),this.update()}function jd(e,t,n,i){e=e||10,t=t||10,n=new Ri(void 0!==n?n:4473924),i=new Ri(void 0!==i?i:8947848);const r=t/2,o=e/t,s=e/2,a=[],l=[];for(let h=0,d=0,p=-s;h<=t;h++,p+=o){a.push(-s,0,p,s,0,p),a.push(p,0,-s,p,0,s);const e=h===r?n:i;e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3}const c=new ar;c.setAttribute("position",new Zi(a,3)),c.setAttribute("color",new Zi(l,3));const u=new el({vertexColors:!0,toneMapped:!1});cl.call(this,c,u),this.type="GridHelper"}function $d(e,t,n,i,r,o){e=e||10,t=t||16,n=n||8,i=i||64,r=new Ri(void 0!==r?r:4473924),o=new Ri(void 0!==o?o:8947848);const s=[],a=[];for(let u=0;u<=t;u++){const n=u/t*(2*Math.PI),i=Math.sin(n)*e,l=Math.cos(n)*e;s.push(0,0,0),s.push(i,0,l);const c=1&u?r:o;a.push(c.r,c.g,c.b),a.push(c.r,c.g,c.b)}for(let u=0;u<=n;u++){const t=1&u?r:o,l=e-e/n*u;for(let e=0;e<i;e++){let n=e/i*(2*Math.PI),r=Math.sin(n)*l,o=Math.cos(n)*l;s.push(r,0,o),a.push(t.r,t.g,t.b),n=(e+1)/i*(2*Math.PI),r=Math.sin(n)*l,o=Math.cos(n)*l,s.push(r,0,o),a.push(t.r,t.g,t.b)}}const l=new ar;l.setAttribute("position",new Zi(s,3)),l.setAttribute("color",new Zi(a,3));const c=new el({vertexColors:!0,toneMapped:!1});cl.call(this,l,c),this.type="PolarGridHelper"}Vd.prototype=Object.create(Hn.prototype),Vd.prototype.constructor=Vd,Vd.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Vd.prototype.update=function(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Hd.copy(this.light.color),Gd.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const i=e<n/2?Hd:Gd;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(Ud.setFromMatrixPosition(this.light.matrixWorld).negate())},jd.prototype=Object.assign(Object.create(cl.prototype),{constructor:jd,copy:function(e){return cl.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),$d.prototype=Object.create(cl.prototype),$d.prototype.constructor=$d;const Wd=new mn,qd=new mn,Xd=new mn;function Yd(e,t,n){Hn.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let i=new ar;i.setAttribute("position",new Zi([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new el({fog:!1,toneMapped:!1});this.lightPlane=new sl(i,r),this.add(this.lightPlane),i=new ar,i.setAttribute("position",new Zi([0,0,0,0,0,1],3)),this.targetLine=new sl(i,r),this.add(this.targetLine),this.update()}Yd.prototype=Object.create(Hn.prototype),Yd.prototype.constructor=Yd,Yd.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Yd.prototype.update=function(){Wd.setFromMatrixPosition(this.light.matrixWorld),qd.setFromMatrixPosition(this.light.target.matrixWorld),Xd.subVectors(qd,Wd),this.lightPlane.lookAt(qd),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(qd),this.targetLine.scale.z=Xd.length()};const Zd=new mn,Kd=new Hr;function Qd(e){const t=new ar,n=new el({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],o={},s=new Ri(16755200),a=new Ri(16711680),l=new Ri(43775),c=new Ri(16777215),u=new Ri(3355443);function h(e,t,n){d(e,n),d(t,n)}function d(e,t){i.push(0,0,0),r.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(i.length/3-1)}h("n1","n2",s),h("n2","n4",s),h("n4","n3",s),h("n3","n1",s),h("f1","f2",s),h("f2","f4",s),h("f4","f3",s),h("f3","f1",s),h("n1","f1",s),h("n2","f2",s),h("n3","f3",s),h("n4","f4",s),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),t.setAttribute("position",new Zi(i,3)),t.setAttribute("color",new Zi(r,3)),cl.call(this,t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Jd(e,t,n,i,r,o,s){Zd.set(r,o,s).unproject(i);const a=t[e];if(void 0!==a){const e=n.getAttribute("position");for(let t=0,n=a.length;t<n;t++)e.setXYZ(a[t],Zd.x,Zd.y,Zd.z)}}Qd.prototype=Object.create(cl.prototype),Qd.prototype.constructor=Qd,Qd.prototype.update=function(){const e=this.geometry,t=this.pointMap,n=1,i=1;Kd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Jd("c",t,e,Kd,0,0,-1),Jd("t",t,e,Kd,0,0,1),Jd("n1",t,e,Kd,-n,-i,-1),Jd("n2",t,e,Kd,n,-i,-1),Jd("n3",t,e,Kd,-n,i,-1),Jd("n4",t,e,Kd,n,i,-1),Jd("f1",t,e,Kd,-n,-i,1),Jd("f2",t,e,Kd,n,-i,1),Jd("f3",t,e,Kd,-n,i,1),Jd("f4",t,e,Kd,n,i,1),Jd("u1",t,e,Kd,.7*n,1.1*i,-1),Jd("u2",t,e,Kd,.7*-n,1.1*i,-1),Jd("u3",t,e,Kd,0,2*i,-1),Jd("cf1",t,e,Kd,-n,0,1),Jd("cf2",t,e,Kd,n,0,1),Jd("cf3",t,e,Kd,0,-i,1),Jd("cf4",t,e,Kd,0,i,1),Jd("cn1",t,e,Kd,-n,0,-1),Jd("cn2",t,e,Kd,n,0,-1),Jd("cn3",t,e,Kd,0,-i,-1),Jd("cn4",t,e,Kd,0,i,-1),e.getAttribute("position").needsUpdate=!0};const ep=new ni;function tp(e,t){this.object=e,void 0===t&&(t=16776960);const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new ar;r.setIndex(new Gi(n,1)),r.setAttribute("position",new Gi(i,3)),cl.call(this,r,new el({color:t,toneMapped:!1})),this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}function np(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new ar;r.setIndex(new Gi(n,1)),r.setAttribute("position",new Zi(i,3)),cl.call(this,r,new el({color:t,toneMapped:!1})),this.type="Box3Helper",this.geometry.computeBoundingSphere()}function ip(e,t,n){this.plane=e,this.size=void 0===t?1:t;const i=void 0!==n?n:16776960,r=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],o=new ar;o.setAttribute("position",new Zi(r,3)),o.computeBoundingSphere(),sl.call(this,o,new el({color:i,toneMapped:!1})),this.type="PlaneHelper";const s=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],a=new ar;a.setAttribute("position",new Zi(s,3)),a.computeBoundingSphere(),this.add(new Ar(a,new zi({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}tp.prototype=Object.create(cl.prototype),tp.prototype.constructor=tp,tp.prototype.update=function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&ep.setFromObject(this.object),ep.isEmpty())return;const t=ep.min,n=ep.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()},tp.prototype.setFromObject=function(e){return this.object=e,this.update(),this},tp.prototype.copy=function(e){return cl.prototype.copy.call(this,e),this.object=e.object,this},tp.prototype.clone=function(){return(new this.constructor).copy(this)},np.prototype=Object.create(cl.prototype),np.prototype.constructor=np,np.prototype.updateMatrixWorld=function(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Hn.prototype.updateMatrixWorld.call(this,e))},ip.prototype=Object.create(sl.prototype),ip.prototype.constructor=ip,ip.prototype.updateMatrixWorld=function(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?u:c,this.lookAt(this.plane.normal),Hn.prototype.updateMatrixWorld.call(this,e)};const rp=new mn;let op,sp;function ap(e,t,n,i,r,o){Hn.call(this),this.type="ArrowHelper",void 0===e&&(e=new mn(0,0,1)),void 0===t&&(t=new mn(0,0,0)),void 0===n&&(n=1),void 0===i&&(i=16776960),void 0===r&&(r=.2*n),void 0===o&&(o=.2*r),void 0===op&&(op=new ar,op.setAttribute("position",new Zi([0,0,0,0,1,0],3)),sp=new zc(0,.5,1,5,1),sp.translate(0,-.5,0)),this.position.copy(t),this.line=new sl(op,new el({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ar(sp,new zi({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,o)}function lp(e){const t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new ar;i.setAttribute("position",new Zi(t,3)),i.setAttribute("color",new Zi(n,3));const r=new el({vertexColors:!0,toneMapped:!1});cl.call(this,i,r),this.type="AxesHelper"}ap.prototype=Object.create(Hn.prototype),ap.prototype.constructor=ap,ap.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{rp.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(rp,t)}},ap.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},ap.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},ap.prototype.copy=function(e){return Hn.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},ap.prototype.clone=function(){return(new this.constructor).copy(this)},lp.prototype=Object.create(cl.prototype),lp.prototype.constructor=lp;const cp=4,up=8,hp=[.125,.215,.35,.446,.526,.582],dp=up-cp+1+hp.length;new ph,mp();const pp=(1+Math.sqrt(5))/2,fp=1/pp;function mp(){const e=[],t=[],n=[];let i=up;for(let r=0;r<dp;r++){const o=Math.pow(2,i);t.push(o);let s=1/o;r>up-cp?s=hp[r-up+cp-1]:0==r&&(s=0),n.push(s);const a=1/(o-1),l=-a/2,c=1+a/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*h),y=new Float32Array(f*d*h),v=new Float32Array(m*d*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];g.set(i,p*d*e),y.set(u,f*d*e);const r=[e,e,e,e,e,e];v.set(r,m*d*e)}const b=new ar;b.setAttribute("position",new Gi(g,p)),b.setAttribute("uv",new Gi(y,f)),b.setAttribute("faceIndex",new Gi(v,m)),e.push(b),i>cp&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function gp(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Fu.call(this,e),this.type="catmullrom"}function yp(e){if("undefined"===typeof window)return;const t=new RegExp("".concat(e,"=([^&#=]*)")).exec(window.location.search);return t?decodeURIComponent(t[1]):void 0}function vp(e){return!!e&&("string"!==typeof e||/^1|true|t|yes|y$/i.test(e))}function bp(e,t){return void 0!==e?e:t}function xp(e,t){const n=Object.assign({},e);for(const i in t)void 0===e[i]&&(n[i]=t[i]);return n}function wp(e,t){for(const n in t){const i=t[n];void 0!==i&&(e[n]=i)}return e}function _p(e,t){t=bp(t,[]);for(let n=0;n<e.length;n++)Array.isArray(e[n])?_p(e[n],t):t.push(e[n]);return t}function Sp(){const e=window.location.protocol;return null===e.match(/http(s)?:/gi)?"http:":e}function Mp(){if("undefined"===typeof window)return!1;const e=window.navigator.userAgent;return/Opera|OPR/.test(e)?"Opera":/Chrome/i.test(e)?"Chrome":/Firefox/i.test(e)?"Firefox":/Mobile(\/.*)? Safari/i.test(e)?"Mobile Safari":/MSIE/i.test(e)?"Internet Explorer":!!/Safari/i.test(e)&&"Safari"}function Ap(e){const t=window.location,n=t.pathname,i=n.substring(0,n.lastIndexOf("/")+1);return t.origin+i+e}function Cp(e){window.open(e,"_blank")||(window.location.href=e)}function Tp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"download";if(!e)return;const n="Safari"===Mp(),i=/CriOS\/[\d]+/.test(window.navigator.userAgent),r=document.createElement("a");function o(e){Cp(i?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"))}if("undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else if((n||i)&&FileReader)if(e instanceof Blob){var s=new FileReader;s.onloadend=function(){o(s.result)},s.readAsDataURL(e)}else o(e);else{let n=!1;e instanceof Blob&&(e=URL.createObjectURL(e),n=!0),"download"in r?(r.style.display="hidden",document.body.appendChild(r),r.href=e,r.download=t,r.target="_blank",r.click(),document.body.removeChild(r)):Cp(e),n&&window.URL.revokeObjectURL(e)}}function Ep(e,t,n){let i,r,o,s=null,a=0;function l(){a=!1===n.leading?0:Date.now(),s=null,o=e.apply(i,r),s||(i=r=null)}return n||(n={}),function(){var c=Date.now();a||!1!==n.leading||(a=c);var u=t-(c-a);return i=this,r=arguments,u<=0||u>t?(s&&(clearTimeout(s),s=null),a=c,o=e.apply(i,r),s||(i=r=null)):s||!1===n.trailing||(s=setTimeout(l,u)),o}}function Pp(e,t){return e<t?-1:e>t?1:0}function Ip(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Pp,i=0,r=e.length-1;for(;i<=r;){const o=i+r>>1,s=n(t,e[o]);if(s>0)i=o+1;else{if(!(s<0))return o;r=o-1}}return-i-1}function Lp(e,t){let n=e.length-1;if(e[n]<t)return-1;let i=0;for(;i<=n;){const r=i+n>>1;e[r]>=t?n=r-1:i=r+1}return n+1}function Rp(e,t){if(e[0]>t)return-1;let n=0,i=e.length-1;for(;n<=i;){const r=n+i>>1;e[r]>t?i=r-1:n=r+1}return n-1}function kp(e,t,n){const i=Lp(e,t),r=Rp(e,n);return-1===i||-1===r||i>r?0:r-i+1}function Dp(e){return e.sort().filter((function(e,t,n){return 0===t||e!==n[t-1]}))}function Op(e){const t=28672;if(e.length>t){const n=[];for(let i=0;i<e.length;i+=t)n.push(String.fromCharCode.apply(null,e.subarray(i,i+t)));return n.join("")}return String.fromCharCode.apply(null,e)}function Np(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10485760,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"\n",i="",r=[];for(let o=0;o<e.length;o+=t){const s=Op(e.subarray(o,o+t)),a=s.lastIndexOf(n);if(-1===a)i+=s;else{const e=i+s.substr(0,a);r=r.concat(e.split(n)),i=a===s.length-n.length?"":s.substr(a+n.length)}}return""!==i&&r.push(i),r}function Bp(e,t){switch(e){case"int8":return new Int8Array(t);case"int16":return new Int16Array(t);case"int32":return new Int32Array(t);case"uint8":return new Uint8Array(t);case"uint16":return new Uint16Array(t);case"uint32":return new Uint32Array(t);case"float32":return new Float32Array(t);default:throw new Error("arrayType unknown: "+e)}}function Fp(e,t){return new(t>65535?Uint32Array:Uint16Array)(e)}function zp(e){return Array.isArray(e)?e:[e]}function Up(e){return e.buffer&&e.buffer instanceof ArrayBuffer?e.buffer:e}function Hp(e,t){return e instanceof t?e:new t(e)}function Gp(e,t){return void 0===e?e=new t:Array.isArray(e)&&(e=(new t).fromArray(e)),e}function Vp(e){return Gp(e,nn)}function jp(e){return Gp(e,mn)}function $p(e){return Gp(e,Sn)}function Wp(e){return Gp(e,dn)}function qp(e){return Hp(e,Float32Array)}function Xp(e){let t=0,n=0;const i=[];return{has:function(e){return-1!==i.indexOf(e)},get:function(e){return i[e]},push:function(r){i[t]=r,t=(e+t+1)%e,++n},get count(){return n},get data(){return i.slice(0,Math.min(n,e))},clear:function(){n=0,t=0,i.length=0}}}function Yp(){const e={};return{has:function(t){return void 0!==e[JSON.stringify(t)]},add:function(t,n){e[JSON.stringify(t)]=n},del:function(t){delete e[JSON.stringify(t)]},get values(){return Object.keys(e).map((t=>e[t]))}}}function Zp(e){return bp(e,"").toString().toLowerCase()}new mn(1,1,1),new mn(-1,1,1),new mn(1,1,-1),new mn(-1,1,-1),new mn(0,pp,fp),new mn(0,pp,-fp),new mn(fp,0,pp),new mn(-fp,0,pp),new mn(pp,fp,0),new mn(-pp,fp,0),Iu.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Iu.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(ih.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=new Rr;for(let n=0,i=e.length;n<i;n++){const i=e[n];t.vertices.push(new mn(i.x,i.y,i.z||0))}return t}}),Object.assign(rh.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),gp.prototype=Object.create(Fu.prototype),Object.assign(gp.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),jd.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Fd.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(wu.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),wh.extractUrlBase(e)}}),wu.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Ch.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(Td.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(ni.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(oi.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Zr.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Id.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(tn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),tn.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),tn.ceilPowerOfTwo(e)}}),Object.assign(rn.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Sn.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new mn).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,i,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,r,o)}}),yi.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},dn.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(pi.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Ei.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Ei,{barycoordFromPoint:function(e,t,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ei.getBarycoord(e,t,n,i,r)},normal:function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ei.getNormal(e,t,n,i)}}),Object.assign(oh.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new _c(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Dc(this,e)}}),Object.assign(nn.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(mn.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(cn.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Rr.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(Hn.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(Hn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Ar.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Ar.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Nt},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Va.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(qa.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),ja.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Iu.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Gr.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(sh.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Gi.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Qt},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Qt)}}}),Object.assign(Gi.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Qt:Kt),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ar.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Gi(arguments[1],arguments[2])))},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(ar.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(_h.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}}),Object.defineProperties(wd.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(_a.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Qt},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(_a.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Qt:Kt),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Sc.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(bd.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Fi.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ri}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===d}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Yc.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Ur.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(va.prototype,{clearTarget:function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(va.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Ft:Bt}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(ca.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(un.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Zh.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new Fh).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),nd.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},$r.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},sn.crossOrigin=void 0,sn.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new Pu;r.setCrossOrigin(this.crossOrigin);const o=r.load(e,n,void 0,i);return t&&(o.mapping=t),o},sn.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new Eu;r.setCrossOrigin(this.crossOrigin);const o=r.load(e,n,void 0,i);return t&&(o.mapping=t),o},sn.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},sn.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:t}}));class Kp{constructor(e){this.name=e,this._dict={}}add(e,t){this._dict[Zp(e)]=t}get(e){return this._dict[Zp(e)]}get names(){return Object.keys(this._dict)}}function Qp(e){return.01745*e}function Jp(e){return 57.29578*e}const ef="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),tf=new Array(36);function nf(){let e,t=0;for(let n=0;n<36;n++)8===n||13===n||18===n||23===n?tf[n]="-":14===n?tf[n]="4":(t<=2&&(t=33554432+16777216*Math.random()|0),e=15&t,t>>=4,tf[n]=ef[19===n?3&e|8:e]);return tf.join("")}function rf(e){return 16843009*((e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135)>>24}function of(e,t,n){return(e-t)/(n-t)}function sf(e,t,n){return Math.max(t,Math.min(n,e))}function af(e){return sf(e,0,100)}function lf(e){return sf(e,0,1)}function cf(e,t,n){return e+(t-e)*n}function uf(e,t,n,i,r,o){const s=(n-e)*o,a=(i-t)*o,l=r*r;return(2*t-2*n+s+a)*(r*l)+(-3*t+3*n-2*s-a)*l+s*r+t}function hf(e,t,n){return(n=lf(of(n,e,t)))*n*(3-2*n)}function df(e,t,n){if(e>t)return e;const i=e/t;return((2*n-t)*i+(2*t-3*n))*i*i+n}var pf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{};function ff(e){var t={exports:{}};return e(t,t.exports),t.exports}var mf=ff((function(e,t){(function(){var n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,v,b,x,w,_,S,M,A,C,T,E,P,I,L,R,k,D,O,N,B,F,z,U,H,G,V,j,$,W,q,X,Y,Z,K,Q,J,ee,te,ne,ie,re,oe,se,ae,le,ce,ue,he,de,pe,fe,me,ge,ye,ve,be,xe,we,_e,Se,Me,Ae,Ce,Te,Ee=[].slice;Se=function(){var e,t,n,i,r;for(e={},i=0,t=(r="Boolean Number String Function Array Date RegExp Undefined Null".split(" ")).length;i<t;i++)n=r[i],e["[object "+n+"]"]=n.toLowerCase();return function(t){var n;return n=Object.prototype.toString.call(t),e[n]||"object"}}(),X=function(e,t,n){return null==t&&(t=0),null==n&&(n=1),e<t&&(e=t),e>n&&(e=n),e},Me=function(e){return e.length>=3?Array.prototype.slice.call(e):e[0]},_=function(e){var t,n;for(e._clipped=!1,e._unclipped=e.slice(0),t=n=0;n<3;t=++n)t<3?((e[t]<0||e[t]>255)&&(e._clipped=!0),e[t]<0&&(e[t]=0),e[t]>255&&(e[t]=255)):3===t&&(e[t]<0&&(e[t]=0),e[t]>1&&(e[t]=1));return e._clipped||delete e._unclipped,e},o=Math.PI,ve=Math.round,M=Math.cos,P=Math.floor,ne=Math.pow,Y=Math.log,xe=Math.sin,we=Math.sqrt,m=Math.atan2,Q=Math.max,f=Math.abs,l=2*o,s=o/3,i=o/180,a=180/o,w=function(){return arguments[0]instanceof n?arguments[0]:function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,arguments,(function(){}))},w.default=w,p=[],null!==e&&null!=e.exports&&(e.exports=w),(null!==t?t:this).chroma=w,w.version="1.4.1",d={},u=[],h=!1,n=function(){function e(){var e,t,n,i,r,o,s,a,l;for(o=this,t=[],a=0,i=arguments.length;a<i;a++)null!=(e=arguments[a])&&t.push(e);if(t.length>1&&(s=t[t.length-1]),null!=d[s])o._rgb=_(d[s](Me(t.slice(0,-1))));else{for(h||(u=u.sort((function(e,t){return t.p-e.p})),h=!0),l=0,r=u.length;l<r&&!(s=(n=u[l]).test.apply(n,t));l++);s&&(o._rgb=_(d[s].apply(d,t)))}null==o._rgb&&console.warn("unknown format: "+t),null==o._rgb&&(o._rgb=[0,0,0]),3===o._rgb.length&&o._rgb.push(1)}return e.prototype.toString=function(){return this.hex()},e}(),w._input=d,w.brewer=b={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var e,t;for(e in t=[],b)t.push(b[e.toLowerCase()]=b[e])}(),Ae={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},w.colors=Ae,V=function(){var e,t,n,i,o,s,a;return i=(t=Me(arguments))[0],e=t[1],n=t[2],s=(i+16)/116,o=isNaN(e)?s:s+e/500,a=isNaN(n)?s:s-n/200,s=r.Yn*j(s),o=r.Xn*j(o),a=r.Zn*j(a),[Te(3.2404542*o-1.5371385*s-.4985314*a),Te(-.969266*o+1.8760108*s+.041556*a),n=Te(.0556434*o-.2040259*s+1.0572252*a),t.length>3?t[3]:1]},Te=function(e){return 255*(e<=.00304?12.92*e:1.055*ne(e,1/2.4)-.055)},j=function(e){return e>r.t1?e*e*e:r.t2*(e-r.t0)},r={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},ue=function(){var e,t,n,i,r,o,s;return n=(i=Me(arguments))[0],t=i[1],e=i[2],o=(r=me(n,t,e))[0],[116*(s=r[1])-16,500*(o-s),200*(s-r[2])]},ge=function(e){return(e/=255)<=.04045?e/12.92:ne((e+.055)/1.055,2.4)},Ce=function(e){return e>r.t3?ne(e,1/3):e/r.t2+r.t0},me=function(){var e,t,n,i;return n=(i=Me(arguments))[0],t=i[1],e=i[2],n=ge(n),t=ge(t),e=ge(e),[Ce((.4124564*n+.3575761*t+.1804375*e)/r.Xn),Ce((.2126729*n+.7151522*t+.072175*e)/r.Yn),Ce((.0193339*n+.119192*t+.9503041*e)/r.Zn)]},w.lab=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Ee.call(arguments).concat(["lab"]),(function(){}))},d.lab=V,n.prototype.lab=function(){return ue(this._rgb)},g=function(e){var t,n,i,r,o,s,a,l,c,u,h;return 2===(e=function(){var t,n,i;for(i=[],n=0,t=e.length;n<t;n++)r=e[n],i.push(w(r));return i}()).length?(c=function(){var t,n,i;for(i=[],n=0,t=e.length;n<t;n++)r=e[n],i.push(r.lab());return i}(),o=c[0],s=c[1],t=function(e){var t,n;return n=function(){var n,i;for(i=[],t=n=0;n<=2;t=++n)i.push(o[t]+e*(s[t]-o[t]));return i}(),w.lab.apply(w,n)}):3===e.length?(u=function(){var t,n,i;for(i=[],n=0,t=e.length;n<t;n++)r=e[n],i.push(r.lab());return i}(),o=u[0],s=u[1],a=u[2],t=function(e){var t,n;return n=function(){var n,i;for(i=[],t=n=0;n<=2;t=++n)i.push((1-e)*(1-e)*o[t]+2*(1-e)*e*s[t]+e*e*a[t]);return i}(),w.lab.apply(w,n)}):4===e.length?(h=function(){var t,n,i;for(i=[],n=0,t=e.length;n<t;n++)r=e[n],i.push(r.lab());return i}(),o=h[0],s=h[1],a=h[2],l=h[3],t=function(e){var t,n;return n=function(){var n,i;for(i=[],t=n=0;n<=2;t=++n)i.push((1-e)*(1-e)*(1-e)*o[t]+3*(1-e)*(1-e)*e*s[t]+3*(1-e)*e*e*a[t]+e*e*e*l[t]);return i}(),w.lab.apply(w,n)}):5===e.length&&(n=g(e.slice(0,3)),i=g(e.slice(2,5)),t=function(e){return e<.5?n(2*e):i(2*(e-.5))}),t},w.bezier=function(e){var t;return(t=g(e)).scale=function(){return w.scale(t)},t},w.cubehelix=function(e,t,n,i,r){var o,s,a;return null==e&&(e=300),null==t&&(t=-1.5),null==n&&(n=1),null==i&&(i=1),null==r&&(r=[0,1]),o=0,"array"===Se(r)?s=r[1]-r[0]:(s=0,r=[r,r]),(a=function(a){var c,u,h,d,p;return c=l*((e+120)/360+t*a),d=ne(r[0]+s*a,i),u=(0!==o?n[0]+a*o:n)*d*(1-d)/2,h=M(c),p=xe(c),w(_([255*(d+u*(-.14861*h+1.78277*p)),255*(d+u*(-.29227*h-.90649*p)),255*(d+u*(1.97294*h)),1]))}).start=function(t){return null==t?e:(e=t,a)},a.rotations=function(e){return null==e?t:(t=e,a)},a.gamma=function(e){return null==e?i:(i=e,a)},a.hue=function(e){return null==e?n:("array"===Se(n=e)?0===(o=n[1]-n[0])&&(n=n[1]):o=0,a)},a.lightness=function(e){return null==e?r:("array"===Se(e)?(r=e,s=e[1]-e[0]):(r=[e,e],s=0),a)},a.scale=function(){return w.scale(a)},a.hue(n),a},w.random=function(){var e,t,i;for(t="0123456789abcdef",e="#",i=0;i<6;++i)e+=t.charAt(P(16*Math.random()));return new n(e)},p=[],N=function(e,t,n,i){var r,o,s,a;for(null==n&&(n=.5),null==i&&(i="rgb"),"object"!==Se(e)&&(e=w(e)),"object"!==Se(t)&&(t=w(t)),s=0,o=p.length;s<o;s++)if(i===(r=p[s])[0]){a=r[1](e,t,n,i);break}if(null==a)throw"color mode "+i+" is not supported";return a.alpha(e.alpha()+n*(t.alpha()-e.alpha()))},w.interpolate=N,n.prototype.interpolate=function(e,t,n){return N(this,e,t,n)},w.mix=N,n.prototype.mix=n.prototype.interpolate,d.rgb=function(){var e,t,n,i;for(e in n=[],t=Me(arguments))i=t[e],n.push(i);return n},w.rgb=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Ee.call(arguments).concat(["rgb"]),(function(){}))},n.prototype.rgb=function(e){return null==e&&(e=!0),e?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},n.prototype.rgba=function(e){return null==e&&(e=!0),e?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},u.push({p:3,test:function(e){var t;return t=Me(arguments),"array"===Se(t)&&3===t.length||4===t.length&&"number"===Se(t[3])&&t[3]>=0&&t[3]<=1?"rgb":void 0}}),d.lrgb=d.rgb,z=function(e,t,i,r){var o,s;return o=e._rgb,s=t._rgb,new n(we(ne(o[0],2)*(1-i)+ne(s[0],2)*i),we(ne(o[1],2)*(1-i)+ne(s[1],2)*i),we(ne(o[2],2)*(1-i)+ne(s[2],2)*i),r)},c=function(e){var t,i,r,o,s;for(t=1/e.length,s=[0,0,0,0],r=0,i=e.length;r<i;r++)o=e[r]._rgb,s[0]+=ne(o[0],2)*t,s[1]+=ne(o[1],2)*t,s[2]+=ne(o[2],2)*t,s[3]+=o[3]*t;return s[0]=we(s[0]),s[1]=we(s[1]),s[2]=we(s[2]),s[3]>1&&(s[3]=1),new n(_(s))},p.push(["lrgb",z]),w.average=function(e,t){var n,i,r,s,a,l,u,h,d,p,f,g,y;if(null==t&&(t="rgb"),d=e.length,e=e.map((function(e){return w(e)})),u=e.splice(0,1)[0],"lrgb"===t)return c(e);for(h in s=[],a=0,l=0,g=u.get(t))g[h]=g[h]||0,s.push(isNaN(g[h])?0:1),"h"!==t.charAt(h)||isNaN(g[h])||(n=g[h]/180*o,a+=M(n),l+=xe(n));for(i=u.alpha(),f=0,p=e.length;f<p;f++)for(h in y=(r=e[f]).get(t),i+=r.alpha(),g)isNaN(y[h])||(s[h]+=1,"h"===t.charAt(h)?(n=y[h]/180*o,a+=M(n),l+=xe(n)):g[h]+=y[h]);for(h in g)if("h"===t.charAt(h)){for(n=m(l/s[h],a/s[h])/o*180;n<0;)n+=360;for(;n>=360;)n-=360;g[h]=n}else g[h]=g[h]/s[h];return w(g,t).alpha(i/d)},L=function(e){var t,n;if(e.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return 4!==e.length&&7!==e.length||(e=e.substr(1)),3===e.length&&(e=(e=e.split(""))[0]+e[0]+e[1]+e[1]+e[2]+e[2]),[(n=parseInt(e,16))>>16,n>>8&255,255&n,1];if(e.match(/^#?([A-Fa-f0-9]{8})$/))return 9===e.length&&(e=e.substr(1)),[(n=parseInt(e,16))>>24&255,n>>16&255,n>>8&255,ve((255&n)/255*100)/100];if(null!=d.css&&(t=d.css(e)))return t;throw"unknown color: "+e},se=function(e,t){var n,i,r,o,s,a;return null==t&&(t="auto"),s=e[0],r=e[1],i=e[2],n=e[3],"auto"===t&&(t=n<1?"rgba":"rgb"),s=Math.round(s),r=Math.round(r),i=Math.round(i),a=(a="000000"+(s<<16|r<<8|i).toString(16)).substr(a.length-6),o=(o="0"+ve(255*n).toString(16)).substr(o.length-2),"#"+function(){switch(t.toLowerCase()){case"rgba":return a+o;case"argb":return o+a;default:return a}}()},d.hex=function(e){return L(e)},w.hex=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Ee.call(arguments).concat(["hex"]),(function(){}))},n.prototype.hex=function(e){return null==e&&(e="auto"),se(this._rgb,e)},u.push({p:4,test:function(e){if(1===arguments.length&&"string"===Se(e))return"hex"}}),D=function(){var e,t,n,i,r,o,s,a,l,c,u,h,d,p;if(r=(e=Me(arguments))[0],u=e[1],s=e[2],0===u)l=i=t=255*s;else{for(n=[0,0,0],h=2*s-(d=s<.5?s*(1+u):s+u-s*u),(p=[0,0,0])[0]=(r/=360)+1/3,p[1]=r,p[2]=r-1/3,o=a=0;a<=2;o=++a)p[o]<0&&(p[o]+=1),p[o]>1&&(p[o]-=1),6*p[o]<1?n[o]=h+6*(d-h)*p[o]:2*p[o]<1?n[o]=d:3*p[o]<2?n[o]=h+(d-h)*(2/3-p[o])*6:n[o]=h;l=(c=[ve(255*n[0]),ve(255*n[1]),ve(255*n[2])])[0],i=c[1],t=c[2]}return e.length>3?[l,i,t,e[3]]:[l,i,t]},le=function(e,t,n){var i,r,o,s,a;return void 0!==e&&e.length>=3&&(e=(s=e)[0],t=s[1],n=s[2]),e/=255,t/=255,n/=255,o=Math.min(e,t,n),r=((Q=Math.max(e,t,n))+o)/2,Q===o?(a=0,i=Number.NaN):a=r<.5?(Q-o)/(Q+o):(Q-o)/(2-Q-o),e===Q?i=(t-n)/(Q-o):t===Q?i=2+(n-e)/(Q-o):n===Q&&(i=4+(e-t)/(Q-o)),(i*=60)<0&&(i+=360),[i,a,r]},w.hsl=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Ee.call(arguments).concat(["hsl"]),(function(){}))},d.hsl=D,n.prototype.hsl=function(){return le(this._rgb)},O=function(){var e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y;if(r=(e=Me(arguments))[0],m=e[1],y=e[2],y*=255,0===m)l=i=t=y;else switch(360===r&&(r=0),r>360&&(r-=360),r<0&&(r+=360),s=y*(1-m),a=y*(1-m*(n=(r/=60)-(o=P(r)))),g=y*(1-m*(1-n)),o){case 0:l=(c=[y,g,s])[0],i=c[1],t=c[2];break;case 1:l=(u=[a,y,s])[0],i=u[1],t=u[2];break;case 2:l=(h=[s,y,g])[0],i=h[1],t=h[2];break;case 3:l=(d=[s,a,y])[0],i=d[1],t=d[2];break;case 4:l=(p=[g,s,y])[0],i=p[1],t=p[2];break;case 5:l=(f=[y,s,a])[0],i=f[1],t=f[2]}return[l,i,t,e.length>3?e[3]:1]},ce=function(){var e,t,n,i,r,o,s,a,l;return o=(s=Me(arguments))[0],n=s[1],e=s[2],r=Math.min(o,n,e),t=(Q=Math.max(o,n,e))-r,l=Q/255,0===Q?(i=Number.NaN,a=0):(a=t/Q,o===Q&&(i=(n-e)/t),n===Q&&(i=2+(e-o)/t),e===Q&&(i=4+(o-n)/t),(i*=60)<0&&(i+=360)),[i,a,l]},w.hsv=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Ee.call(arguments).concat(["hsv"]),(function(){}))},d.hsv=O,n.prototype.hsv=function(){return ce(this._rgb)},ee=function(e){return"number"===Se(e)&&e>=0&&e<=16777215?[e>>16,e>>8&255,255&e,1]:(console.warn("unknown num color: "+e),[0,0,0,1])},pe=function(){var e;return((e=Me(arguments))[0]<<16)+(e[1]<<8)+e[2]},w.num=function(e){return new n(e,"num")},n.prototype.num=function(e){return null==e&&(e="rgb"),pe(this._rgb,e)},d.num=ee,u.push({p:1,test:function(e){if(1===arguments.length&&"number"===Se(e)&&e>=0&&e<=16777215)return"num"}}),I=function(){var e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,v,b;if(a=(n=Me(arguments))[0],r=n[1],t=n[2],s=s/100*255,e=255*(r/=100),0===r)h=s=i=t;else switch(360===a&&(a=0),a>360&&(a-=360),a<0&&(a+=360),u=(c=t*(1-r))+e*(1-(o=(a/=60)-(l=P(a)))),v=c+e*o,b=c+e,l){case 0:h=(d=[b,v,c])[0],s=d[1],i=d[2];break;case 1:h=(p=[u,b,c])[0],s=p[1],i=p[2];break;case 2:h=(f=[c,b,v])[0],s=f[1],i=f[2];break;case 3:h=(m=[c,u,b])[0],s=m[1],i=m[2];break;case 4:h=(g=[v,c,b])[0],s=g[1],i=g[2];break;case 5:h=(y=[b,c,u])[0],s=y[1],i=y[2]}return[h,s,i,n.length>3?n[3]:1]},oe=function(){var e,t,n,i,r,o,s,a,l;return a=(l=Me(arguments))[0],r=l[1],t=l[2],s=Math.min(a,r,t),n=100*(i=(Q=Math.max(a,r,t))-s)/255,e=s/(255-i)*100,0===i?o=Number.NaN:(a===Q&&(o=(r-t)/i),r===Q&&(o=2+(t-a)/i),t===Q&&(o=4+(a-r)/i),(o*=60)<0&&(o+=360)),[o,n,e]},w.hcg=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Ee.call(arguments).concat(["hcg"]),(function(){}))},d.hcg=I,n.prototype.hcg=function(){return oe(this._rgb)},A=function(e){var t,n,i,r,o,s,a,l;if(e=e.toLowerCase(),null!=w.colors&&w.colors[e])return L(w.colors[e]);if(o=e.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(a=o.slice(1,4),r=s=0;s<=2;r=++s)a[r]=+a[r];a[3]=1}else if(o=e.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(a=o.slice(1,5),r=l=0;l<=3;r=++l)a[r]=+a[r];else if(o=e.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(a=o.slice(1,4),r=t=0;t<=2;r=++t)a[r]=ve(2.55*a[r]);a[3]=1}else if(o=e.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(a=o.slice(1,5),r=n=0;n<=2;r=++n)a[r]=ve(2.55*a[r]);a[3]=+a[3]}else(o=e.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?((i=o.slice(1,4))[1]*=.01,i[2]*=.01,(a=D(i))[3]=1):(o=e.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&((i=o.slice(1,4))[1]*=.01,i[2]*=.01,(a=D(i))[3]=+o[4]);return a},re=function(e){var t;return"rgb"===(t=e[3]<1?"rgba":"rgb")?t+"("+e.slice(0,3).map(ve).join(",")+")":"rgba"===t?t+"("+e.slice(0,3).map(ve).join(",")+","+e[3]+")":void 0},ye=function(e){return ve(100*e)/100},k=function(e,t){var n;return n=t<1?"hsla":"hsl",e[0]=ye(e[0]||0),e[1]=ye(100*e[1])+"%",e[2]=ye(100*e[2])+"%","hsla"===n&&(e[3]=t),n+"("+e.join(",")+")"},d.css=function(e){return A(e)},w.css=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Ee.call(arguments).concat(["css"]),(function(){}))},n.prototype.css=function(e){return null==e&&(e="rgb"),"rgb"===e.slice(0,3)?re(this._rgb):"hsl"===e.slice(0,3)?k(this.hsl(),this.alpha()):void 0},d.named=function(e){return L(Ae[e])},u.push({p:5,test:function(e){if(1===arguments.length&&null!=Ae[e])return"named"}}),n.prototype.name=function(e){var t,n;for(n in arguments.length&&(Ae[e]&&(this._rgb=L(Ae[e])),this._rgb[3]=1),t=this.hex("rgb"),Ae)if(t===Ae[n])return n;return t},$=function(){var e,t,n,r;return n=(r=Me(arguments))[0],e=r[1],t=r[2],[n,M(t*=i)*e,xe(t)*e]},W=function(){var e,t,n,i,r,o,s,a,l;return s=(n=Me(arguments))[0],r=n[1],o=n[2],e=(a=$(s,r,o))[0],t=a[1],i=a[2],[(l=V(e,t,i))[0],l[1],i=l[2],n.length>3?n[3]:1]},G=function(){var e,t,n,i,r,o;return r=(o=Me(arguments))[0],e=o[1],t=o[2],n=we(e*e+t*t),i=(m(t,e)*a+360)%360,0===ve(1e4*n)&&(i=Number.NaN),[r,n,i]},he=function(){var e,t,n,i,r,o,s;return r=(o=Me(arguments))[0],n=o[1],t=o[2],i=(s=ue(r,n,t))[0],e=s[1],t=s[2],G(i,e,t)},w.lch=function(){var e;return e=Me(arguments),new n(e,"lch")},w.hcl=function(){var e;return e=Me(arguments),new n(e,"hcl")},d.lch=W,d.hcl=function(){var e,t,n,i;return t=(i=Me(arguments))[0],e=i[1],n=i[2],W([n,e,t])},n.prototype.lch=function(){return he(this._rgb)},n.prototype.hcl=function(){return he(this._rgb).reverse()},ie=function(e){var t,n,i,r,o,s;return null==e&&(e="rgb"),o=(s=Me(arguments))[0],i=s[1],t=s[2],i/=255,t/=255,[(1-(o/=255)-(r=1-Math.max(o,Math.max(i,t))))*(n=r<1?1/(1-r):0),(1-i-r)*n,(1-t-r)*n,r]},S=function(){var e,t,n,i,r,o;return n=(t=Me(arguments))[0],r=t[1],o=t[2],i=t[3],e=t.length>4?t[4]:1,1===i?[0,0,0,e]:[n>=1?0:255*(1-n)*(1-i),r>=1?0:255*(1-r)*(1-i),o>=1?0:255*(1-o)*(1-i),e]},d.cmyk=function(){return S(Me(arguments))},w.cmyk=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Ee.call(arguments).concat(["cmyk"]),(function(){}))},n.prototype.cmyk=function(){return ie(this._rgb)},d.gl=function(){var e,t,n,i,r;for(i=function(){var e,n;for(t in n=[],e=Me(arguments))r=e[t],n.push(r);return n}.apply(this,arguments),e=n=0;n<=2;e=++n)i[e]*=255;return i},w.gl=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Ee.call(arguments).concat(["gl"]),(function(){}))},n.prototype.gl=function(){var e;return[(e=this._rgb)[0]/255,e[1]/255,e[2]/255,e[3]]},de=function(e,t,n){var i;return e=(i=Me(arguments))[0],t=i[1],n=i[2],.2126*(e=Z(e))+.7152*(t=Z(t))+.0722*(n=Z(n))},Z=function(e){return(e/=255)<=.03928?e/12.92:ne((e+.055)/1.055,2.4)},H=function(e,t,i,r){var o,s;return o=e._rgb,s=t._rgb,new n(o[0]+i*(s[0]-o[0]),o[1]+i*(s[1]-o[1]),o[2]+i*(s[2]-o[2]),r)},p.push(["rgb",H]),n.prototype.luminance=function(e,t){var n,i,r,o,s;return null==t&&(t="rgb"),arguments.length?(o=this._rgb,0===e?o=[0,0,0,this._rgb[3]]:1===e?o=[255,255,255,this[3]]:(n=de(this._rgb),i=1e-7,r=20,s=function(n,o){var a,l;return a=(l=n.interpolate(o,.5,t)).luminance(),Math.abs(e-a)<i||!r--?l:a>e?s(n,l):s(l,o)},o=n>e?s(w("black"),this).rgba():s(this,w("white")).rgba()),w(o).alpha(this.alpha())):de(this._rgb)},_e=function(e){var t,n,i,r;return(r=e/100)<66?(i=255,n=-155.25485562709179-.44596950469579133*(n=r-2)+104.49216199393888*Y(n),t=r<20?0:.8274096064007395*(t=r-10)-254.76935184120902+115.67994401066147*Y(t)):(i=351.97690566805693+.114206453784165*(i=r-55)-40.25366309332127*Y(i),n=325.4494125711974+.07943456536662342*(n=r-50)-28.0852963507957*Y(n),t=255),[i,n,t]},fe=function(){var e,t,n,i,r,o,s,a;for(r=(o=Me(arguments))[0],e=o[2],i=1e3,n=4e4,t=.4;n-i>t;)(s=_e(a=.5*(n+i)))[2]/s[0]>=e/r?n=a:i=a;return ve(a)},w.temperature=w.kelvin=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Ee.call(arguments).concat(["temperature"]),(function(){}))},d.temperature=d.kelvin=d.K=_e,n.prototype.temperature=function(){return fe(this._rgb)},n.prototype.kelvin=n.prototype.temperature,w.contrast=function(e,t){var i,r,o,s;return"string"!==(o=Se(e))&&"number"!==o||(e=new n(e)),"string"!==(s=Se(t))&&"number"!==s||(t=new n(t)),(i=e.luminance())>(r=t.luminance())?(i+.05)/(r+.05):(r+.05)/(i+.05)},w.distance=function(e,t,i){var r,o,s,a,l,c,u;for(o in null==i&&(i="lab"),"string"!==(l=Se(e))&&"number"!==l||(e=new n(e)),"string"!==(c=Se(t))&&"number"!==c||(t=new n(t)),s=e.get(i),a=t.get(i),u=0,s)u+=(r=(s[o]||0)-(a[o]||0))*r;return Math.sqrt(u)},w.deltaE=function(e,t,i,r){var s,a,l,c,u,h,d,p,g,y,v,b,x,w,_,S,A,C,T,E,P,I,L,R;for(null==i&&(i=1),null==r&&(r=1),"string"!==(_=Se(e))&&"number"!==_||(e=new n(e)),"string"!==(S=Se(t))&&"number"!==S||(t=new n(t)),s=(A=e.lab())[0],l=A[1],u=A[2],a=(C=t.lab())[0],c=C[1],h=C[2],d=we(l*l+u*u),p=we(c*c+h*h),E=s<16?.511:.040975*s/(1+.01765*s),T=.0638*d/(1+.0131*d)+.638,w=d<1e-6?0:180*m(u,l)/o;w<0;)w+=360;for(;w>=360;)w-=360;return P=w>=164&&w<=345?.56+f(.2*M(o*(w+168)/180)):.36+f(.4*M(o*(w+35)/180)),x=we((g=d*d*d*d)/(g+1900)),we((I=(s-a)/(i*E))*I+(L=(b=d-p)/(r*T))*L+((y=l-c)*y+(v=u-h)*v-b*b)/((R=T*(x*P+1-x))*R))},n.prototype.get=function(e){var t,n,i,r,o,s;return i=this,r=(o=e.split("."))[0],t=o[1],s=i[r](),t?(n=r.indexOf(t))>-1?s[n]:console.warn("unknown channel "+t+" in mode "+r):s},n.prototype.set=function(e,t){var n,i,r,o,s,a;if(r=this,o=(s=e.split("."))[0],n=s[1])if(a=r[o](),(i=o.indexOf(n))>-1)if("string"===Se(t))switch(t.charAt(0)){case"+":case"-":a[i]+=+t;break;case"*":a[i]*=+t.substr(1);break;case"/":a[i]/=+t.substr(1);break;default:a[i]=+t}else a[i]=t;else console.warn("unknown channel "+n+" in mode "+o);else a=t;return w(a,o).alpha(r.alpha())},n.prototype.clipped=function(){return this._rgb._clipped||!1},n.prototype.alpha=function(e){return arguments.length?w.rgb([this._rgb[0],this._rgb[1],this._rgb[2],e]):this._rgb[3]},n.prototype.darken=function(e){var t,n;return null==e&&(e=1),(t=(n=this).lab())[0]-=r.Kn*e,w.lab(t).alpha(n.alpha())},n.prototype.brighten=function(e){return null==e&&(e=1),this.darken(-e)},n.prototype.darker=n.prototype.darken,n.prototype.brighter=n.prototype.brighten,n.prototype.saturate=function(e){var t,n;return null==e&&(e=1),(t=(n=this).lch())[1]+=e*r.Kn,t[1]<0&&(t[1]=0),w.lch(t).alpha(n.alpha())},n.prototype.desaturate=function(e){return null==e&&(e=1),this.saturate(-e)},n.prototype.premultiply=function(){var e,t;return t=this.rgb(),e=this.alpha(),w(t[0]*e,t[1]*e,t[2]*e,e)},J=function(e,t){return e*t/255},C=function(e,t){return e>t?t:e},q=function(e,t){return e>t?e:t},be=function(e,t){return 255*(1-(1-e/255)*(1-t/255))},te=function(e,t){return t<128?2*e*t/255:255*(1-2*(1-e/255)*(1-t/255))},x=function(e,t){return 255*(1-(1-t/255)/(e/255))},T=function(e,t){return 255===e||(e=t/255*255/(1-e/255))>255?255:e},(y=function(e,t,n){if(!y[n])throw"unknown blend mode "+n;return y[n](e,t)}).normal=(v=function(e){return function(t,n){var i,r;return i=w(n).rgb(),r=w(t).rgb(),w(e(i,r),"rgb")}})((E=function(e){return function(t,n){var i,r,o;for(o=[],i=r=0;r<=3;i=++r)o[i]=e(t[i],n[i]);return o}})((function(e,t){return e}))),y.multiply=v(E(J)),y.screen=v(E(be)),y.overlay=v(E(te)),y.darken=v(E(C)),y.lighten=v(E(q)),y.dodge=v(E(T)),y.burn=v(E(x)),w.blend=y,w.analyze=function(e){var t,n,i,r;for(i={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0},n=0,t=e.length;n<t;n++)null==(r=e[n])||isNaN(r)||(i.values.push(r),i.sum+=r,r<i.min&&(i.min=r),r>i.max&&(i.max=r),i.count+=1);return i.domain=[i.min,i.max],i.limits=function(e,t){return w.limits(i,e,t)},i},w.scale=function(e,t){var n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,v,b,x,_,S;return u="rgb",h=w("#ccc"),m=0,s=[0,1],f=[],p=[0,0],n=!1,r=[],d=!1,c=0,l=1,o=!1,i={},g=!0,a=1,_=function(e){var t,n,i,o,s,a;if(null==e&&(e=["#fff","#000"]),null!=e&&"string"===Se(e)&&null!=w.brewer&&(e=w.brewer[e]||w.brewer[e.toLowerCase()]||e),"array"===Se(e)){for(1===e.length&&(e=[e[0],e[0]]),t=i=0,o=(e=e.slice(0)).length-1;0<=o?i<=o:i>=o;t=0<=o?++i:--i)n=e[t],"string"===Se(n)&&(e[t]=w(n));for(f.length=0,t=a=0,s=e.length-1;0<=s?a<=s:a>=s;t=0<=s?++a:--a)f.push(t/(e.length-1))}return x(),r=e},v=function(e){var t,i;if(null!=n){for(i=n.length-1,t=0;t<i&&e>=n[t];)t++;return t-1}return 0},S=function(e){return e},b=function(e,t){var o,s,d,m,y,b,x;if(null==t&&(t=!1),isNaN(e)||null===e)return h;if(x=t?e:n&&n.length>2?v(e)/(n.length-2):l!==c?(e-c)/(l-c):1,t||(x=S(x)),1!==a&&(x=ne(x,a)),x=p[0]+x*(1-p[0]-p[1]),x=Math.min(1,Math.max(0,x)),d=Math.floor(1e4*x),g&&i[d])o=i[d];else{if("array"===Se(r))for(s=m=0,b=f.length-1;0<=b?m<=b:m>=b;s=0<=b?++m:--m){if(x<=(y=f[s])){o=r[s];break}if(x>=y&&s===f.length-1){o=r[s];break}if(x>y&&x<f[s+1]){x=(x-y)/(f[s+1]-y),o=w.interpolate(r[s],r[s+1],x,u);break}}else"function"===Se(r)&&(o=r(x));g&&(i[d]=o)}return o},x=function(){return i={}},_(e),(y=function(e){var t;return t=w(b(e)),d&&t[d]?t[d]():t}).classes=function(e){var t;return null!=e?("array"===Se(e)?(n=e,s=[e[0],e[e.length-1]]):(t=w.analyze(s),n=0===e?[t.min,t.max]:w.limits(t,"e",e)),y):n},y.domain=function(e){var t,n,i,o,a,u,h;if(!arguments.length)return s;if(c=e[0],l=e[e.length-1],f=[],i=r.length,e.length===i&&c!==l)for(a=0,o=e.length;a<o;a++)n=e[a],f.push((n-c)/(l-c));else for(t=h=0,u=i-1;0<=u?h<=u:h>=u;t=0<=u?++h:--h)f.push(t/(i-1));return s=[c,l],y},y.mode=function(e){return arguments.length?(u=e,x(),y):u},y.range=function(e,t){return _(e,t),y},y.out=function(e){return d=e,y},y.spread=function(e){return arguments.length?(m=e,y):m},y.correctLightness=function(e){return null==e&&(e=!0),o=e,x(),S=o?function(e){var t,n,i,r,o,s,a,l,c;for(t=b(0,!0).lab()[0],n=b(1,!0).lab()[0],a=t>n,i=b(e,!0).lab()[0],r=i-(o=t+(n-t)*e),l=0,c=1,s=20;Math.abs(r)>.01&&s-- >0;)a&&(r*=-1),r<0?(l=e,e+=.5*(c-e)):(c=e,e+=.5*(l-e)),i=b(e,!0).lab()[0],r=i-o;return e}:function(e){return e},y},y.padding=function(e){return null!=e?("number"===Se(e)&&(e=[e,e]),p=e,y):p},y.colors=function(t,i){var o,a,l,c,u,h,d,p;if(arguments.length<2&&(i="hex"),u=[],0===arguments.length)u=r.slice(0);else if(1===t)u=[y(.5)];else if(t>1)a=s[0],o=s[1]-a,u=function(){h=[];for(var e=0;0<=t?e<t:e>t;0<=t?e++:e--)h.push(e);return h}.apply(this).map((function(e){return y(a+e/(t-1)*o)}));else{if(e=[],d=[],n&&n.length>2)for(l=p=1,c=n.length;1<=c?p<c:p>c;l=1<=c?++p:--p)d.push(.5*(n[l-1]+n[l]));else d=s;u=d.map((function(e){return y(e)}))}return w[i]&&(u=u.map((function(e){return e[i]()}))),u},y.cache=function(e){return null!=e?(g=e,y):g},y.gamma=function(e){return null!=e?(a=e,y):a},y.nodata=function(e){return null!=e?(h=w(e),y):h},y},null==w.scales&&(w.scales={}),w.scales.cool=function(){return w.scale([w.hsl(180,1,.9),w.hsl(250,.7,.4)])},w.scales.hot=function(){return w.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},w.analyze=function(e,t,n){var i,r,o,s,a,l;if(a={min:Number.MAX_VALUE,max:-1*Number.MAX_VALUE,sum:0,values:[],count:0},null==n&&(n=function(){return!0}),i=function(e){null==e||isNaN(e)||(a.values.push(e),a.sum+=e,e<a.min&&(a.min=e),e>a.max&&(a.max=e),a.count+=1)},l=function(e,r){if(n(e,r))return null!=t&&"function"===Se(t)?i(t(e)):null!=t&&"string"===Se(t)||"number"===Se(t)?i(e[t]):i(e)},"array"===Se(e))for(s=0,o=e.length;s<o;s++)l(e[s]);else for(r in e)l(e[r],r);return a.domain=[a.min,a.max],a.limits=function(e,t){return w.limits(a,e,t)},a},w.limits=function(e,t,n){var i,r,o,s,a,l,c,u,h,d,p,m,g,y,v,b,x,_,S,M,A,C,T,E,I,L,R,k,D,O,N,B,F,z,U,H,G,V,j,$,W,q,X,Z,K,J,ee,te,ie,re,oe,se,ae,le,ce;if(null==t&&(t="equal"),null==n&&(n=7),"array"===Se(e)&&(e=w.analyze(e)),I=e.min,Q=e.max,le=e.values.sort((function(e,t){return e-t})),1===n)return[I,Q];if(T=[],"c"===t.substr(0,1)&&(T.push(I),T.push(Q)),"e"===t.substr(0,1)){for(T.push(I),M=N=1,U=n-1;1<=U?N<=U:N>=U;M=1<=U?++N:--N)T.push(I+M/n*(Q-I));T.push(Q)}else if("l"===t.substr(0,1)){if(I<=0)throw"Logarithmic scales are only possible for values > 0";for(L=Math.LOG10E*Y(I),E=Math.LOG10E*Y(Q),T.push(I),M=ce=1,H=n-1;1<=H?ce<=H:ce>=H;M=1<=H?++ce:--ce)T.push(ne(10,L+M/n*(E-L)));T.push(Q)}else if("q"===t.substr(0,1)){for(T.push(I),M=i=1,q=n-1;1<=q?i<=q:i>=q;M=1<=q?++i:--i)B=(le.length-1)*M/n,(F=P(B))===B?T.push(le[F]):(z=B-F,T.push(le[F]*(1-z)+le[F+1]*z));T.push(Q)}else if("k"===t.substr(0,1)){for(k=le.length,y=new Array(k),_=new Array(n),re=!0,D=0,b=null,(b=[]).push(I),M=r=1,X=n-1;1<=X?r<=X:r>=X;M=1<=X?++r:--r)b.push(I+M/n*(Q-I));for(b.push(Q);re;){for(A=o=0,Z=n-1;0<=Z?o<=Z:o>=Z;A=0<=Z?++o:--o)_[A]=0;for(M=s=0,K=k-1;0<=K?s<=K:s>=K;M=0<=K?++s:--s){for(ae=le[M],R=Number.MAX_VALUE,A=a=0,J=n-1;0<=J?a<=J:a>=J;A=0<=J?++a:--a)(S=f(b[A]-ae))<R&&(R=S,v=A);_[v]++,y[M]=v}for(O=new Array(n),A=l=0,ee=n-1;0<=ee?l<=ee:l>=ee;A=0<=ee?++l:--l)O[A]=null;for(M=c=0,te=k-1;0<=te?c<=te:c>=te;M=0<=te?++c:--c)null===O[x=y[M]]?O[x]=le[M]:O[x]+=le[M];for(A=u=0,ie=n-1;0<=ie?u<=ie:u>=ie;A=0<=ie?++u:--u)O[A]*=1/_[A];for(re=!1,A=h=0,G=n-1;0<=G?h<=G:h>=G;A=0<=G?++h:--h)if(O[A]!==b[M]){re=!0;break}b=O,++D>200&&(re=!1)}for(C={},A=d=0,V=n-1;0<=V?d<=V:d>=V;A=0<=V?++d:--d)C[A]=[];for(M=p=0,j=k-1;0<=j?p<=j:p>=j;M=0<=j?++p:--p)C[x=y[M]].push(le[M]);for(oe=[],A=m=0,$=n-1;0<=$?m<=$:m>=$;A=0<=$?++m:--m)oe.push(C[A][0]),oe.push(C[A][C[A].length-1]);for(oe=oe.sort((function(e,t){return e-t})),T.push(oe[0]),M=g=1,W=oe.length-1;g<=W;M=g+=2)se=oe[M],isNaN(se)||-1!==T.indexOf(se)||T.push(se)}return T},R=function(e,t,n){var i,r,o,a;return e=(i=Me(arguments))[0],t=i[1],n=i[2],isNaN(e)&&(e=0),(e/=360)<1/3?o=1-((r=(1-t)/3)+(a=(1+t*M(l*e)/M(s-l*e))/3)):e<2/3?r=1-((a=(1-t)/3)+(o=(1+t*M(l*(e-=1/3))/M(s-l*e))/3)):a=1-((o=(1-t)/3)+(r=(1+t*M(l*(e-=2/3))/M(s-l*e))/3)),[255*(a=X(n*a*3)),255*(o=X(n*o*3)),255*(r=X(n*r*3)),i.length>3?i[3]:1]},ae=function(){var e,t,n,i,r,o,s;return r=(o=Me(arguments))[0],t=o[1],e=o[2],l=2*Math.PI,r/=255,t/=255,e/=255,0===(s=1-Math.min(r,t,e)/(i=(r+t+e)/3))?n=0:(n=(r-t+(r-e))/2,n/=Math.sqrt((r-t)*(r-t)+(r-e)*(t-e)),n=Math.acos(n),e>t&&(n=l-n),n/=l),[360*n,s,i]},w.hsi=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i}(n,Ee.call(arguments).concat(["hsi"]),(function(){}))},d.hsi=R,n.prototype.hsi=function(){return ae(this._rgb)},B=function(e,t,n,i){var r,o,s,a,l,c,u,h,d,p,f;return"hsl"===i?(p=e.hsl(),f=t.hsl()):"hsv"===i?(p=e.hsv(),f=t.hsv()):"hcg"===i?(p=e.hcg(),f=t.hcg()):"hsi"===i?(p=e.hsi(),f=t.hsi()):"lch"!==i&&"hcl"!==i||(i="hcl",p=e.hcl(),f=t.hcl()),"h"===i.substr(0,1)&&(o=p[0],h=p[1],l=p[2],s=f[0],d=f[1],c=f[2]),isNaN(o)||isNaN(s)?isNaN(o)?isNaN(s)?r=Number.NaN:(r=s,1!==l&&0!==l||"hsv"===i||(u=d)):(r=o,1!==c&&0!==c||"hsv"===i||(u=h)):r=o+n*(s>o&&s-o>180?s-(o+360):s<o&&o-s>180?s+360-o:s-o),null==u&&(u=h+n*(d-h)),a=l+n*(c-l),w[i](r,u,a)},U=function(e,t,n,i){var r,o;return r=e.num(),o=t.num(),w.num(r+(o-r)*n,"num")},(p=p.concat(function(){var e,t,n,i;for(i=[],t=0,e=(n=["hsv","hsl","hsi","hcl","lch","hcg"]).length;t<e;t++)K=n[t],i.push([K,B]);return i}())).push(["num",U]),F=function(e,t,i,r){var o,s;return o=e.lab(),s=t.lab(),new n(o[0]+i*(s[0]-o[0]),o[1]+i*(s[1]-o[1]),o[2]+i*(s[2]-o[2]),r)},p.push(["lab",F])}).call(pf)})),gf="sRGB";function yf(e){gf=e}const vf={scale:"uniform",mode:"hcl",domain:[0,1],value:16777215,reverse:!1},bf=new Ri;function xf(e,t,n){const i=n.value,r=function(e,t){let n=i.bind(this,e,t)();return"linear"==gf?(bf.set(n),bf.convertSRGBToLinear(),bf.getHex()):n};return n.value=r,n}class wf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.parameters=xp(e,vf),"string"===typeof this.parameters.value&&(this.parameters.value=bf.set(this.parameters.value).getHex()),this.parameters.structure&&(this.atomProxy=this.parameters.structure.getAtomProxy())}getScale(){const e=xp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},this.parameters);return"rainbow"===e.scale?e.scale=["red","orange","yellow","green","blue"]:"rwb"===e.scale&&(e.scale=["red","white","blue"]),e.reverse&&(e.domain=e.domain.slice().reverse()),mf.scale(e.scale).mode(e.mode).domain(e.domain).out("num")}colorToArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t[n]=(e>>16&255)/255,t[n+1]=(e>>8&255)/255,t[n+2]=(255&e)/255,t}atomColorToArray(e,t,n){return this.colorToArray(this.atomColor?this.atomColor(e):0,t,n)}bondColor(e,t){return this.atomProxy&&this.atomColor?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):0}bondColorToArray(e,t,n,i){return this.colorToArray(this.bondColor(e,t),n,i)}bondColorByAtoms(e,t,n){return this.atomProxy&&this.atomColor?(this.atomProxy.index=n?e:t,this.atomColor(this.atomProxy)):0}bondColorToArrayByAtoms(e,t,n,i,r){return this.colorToArray(this.bondColorByAtoms(e,e,n),i,r)}volumeColorToArray(e,t,n){return this.colorToArray(this.volumeColor?this.volumeColor(e):0,t,n)}positionColorToArray(e,t,n){return this.colorToArray(this.positionColor?this.positionColor(e):0,t,n)}}var _f,Sf=ff((function(e){!function(t){function n(e,t,n,i,r){this._listener=t,this._isOnce=n,this.context=i,this._signal=e,this._priority=r||0}function i(e,t){if("function"!==typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function r(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){r.prototype.dispatch.apply(e,arguments)}}n.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},r.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,i,r){var o,s=this._indexOfListener(e,i);if(-1!==s){if((o=this._bindings[s]).isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else o=new n(this,e,t,i,r),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,i=this._bindings.length;i--;)if((n=this._bindings[i])._listener===e&&n.context===t)return i;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return i(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return i(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){i(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=n),i){t=this._bindings.slice(),this._shouldPropagate=!0;do{i--}while(t[i]&&this._shouldPropagate&&!1!==t[i].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var o=r;o.Signal=r,e.exports?e.exports=o:t.signals=o}(pf)}));!function(e){e[e.PROTEIN=1]="PROTEIN",e[e.NUCLEIC=2]="NUCLEIC",e[e.RNA=3]="RNA",e[e.DNA=4]="DNA",e[e.POLYMER=5]="POLYMER",e[e.WATER=6]="WATER",e[e.HELIX=7]="HELIX",e[e.SHEET=8]="SHEET",e[e.TURN=9]="TURN",e[e.BACKBONE=10]="BACKBONE",e[e.SIDECHAIN=11]="SIDECHAIN",e[e.ALL=12]="ALL",e[e.HETERO=13]="HETERO",e[e.ION=14]="ION",e[e.SACCHARIDE=15]="SACCHARIDE",e[e.SUGAR=15]="SUGAR",e[e.BONDED=16]="BONDED",e[e.RING=17]="RING",e[e.AROMATICRING=18]="AROMATICRING",e[e.METAL=19]="METAL",e[e.POLARH=20]="POLARH",e[e.NONE=21]="NONE"}(_f||(_f={}));const Mf=["*","","ALL"],Af=["NONE"],Cf=[_f.BACKBONE,_f.SIDECHAIN,_f.BONDED,_f.RING,_f.AROMATICRING,_f.METAL,_f.POLARH],Tf=[_f.POLYMER,_f.WATER],Ef=["ALA","GLY","SER"],Pf=["CYS","SER","THR"],If=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],Lf=["PHE","TRP","TYR","HIS"],Rf=["ASN","GLN"],kf=["ASP","GLU"],Df=["ARG","HIS","LYS"],Of=["ARG","ASP","GLU","HIS","LYS"],Nf=["ASN","ARG","ASP","CYS","GLY","GLN","GLU","HIS","LYS","SER","THR","TYR"],Bf=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],Ff=["HIS","PHE","PRO","TRP","TYR"],zf=["ALA","GLY","ILE","LEU","VAL"];function Uf(e){let t={operator:void 0,rules:[]};if(!e)return t;let n,i,r=t;const o=[];"("===(e=e.replace(/\(/g," ( ").replace(/\)/g," ) ").trim()).charAt(0)&&")"===e.substr(-1)&&(e=e.slice(1,-1).trim());const s=e.split(/\s+/),a=e=>{n={operator:e,rules:[]},void 0===r?(r=n,t=n):(r.rules.push(n),o.push(r),r=n)},l=function(e){i=r,r=o.pop(),void 0===r&&(a(e),c(i))},c=function(e){r.rules.push(e)};let u=!1;for(let h=0;h<s.length;++h){const e=s[h],t=e.toUpperCase();if("("===e){u=!1,a();continue}if(")"===e){l(),r.negate&&l();continue}if(u>0)if("NOT"===t)u=1;else if(1===u)u=2;else{if(2!==u)throw new Error("something went wrong with 'not'");u=!1,l()}if("AND"===t){if("OR"===r.operator){const e=r.rules.pop();a("AND"),c(e)}else r.operator="AND";continue}if("OR"===t){"AND"===r.operator?l("OR"):r.operator="OR";continue}if("NOT"===e.toUpperCase()){u=1,a(),r.negate=!0;continue}if(+t!==+t){const e=_f[t];if(void 0!==e){c({keyword:e});continue}}if("HYDROGEN"===t){c({operator:"OR",rules:[{element:"H"},{element:"D"}]});continue}if("SMALL"===t){c({resname:Ef});continue}if("NUCLEOPHILIC"===t){c({resname:Pf});continue}if("HYDROPHOBIC"===t){c({resname:If});continue}if("AROMATIC"===t){c({resname:Lf});continue}if("AMIDE"===t){c({resname:Rf});continue}if("ACIDIC"===t){c({resname:kf});continue}if("BASIC"===t){c({resname:Df});continue}if("CHARGED"===t){c({resname:Of});continue}if("POLAR"===t){c({resname:Nf});continue}if("NONPOLAR"===t){c({resname:Bf});continue}if("CYCLIC"===t){c({resname:Ff});continue}if("ALIPHATIC"===t){c({resname:zf});continue}if("SIDECHAINATTACHED"===t){c({operator:"OR",rules:[{keyword:_f.SIDECHAIN},{operator:"AND",negate:!1,rules:[{keyword:_f.PROTEIN},{operator:"OR",negate:!1,rules:[{atomname:"CA"},{atomname:"BB"}]}]},{operator:"AND",negate:!1,rules:[{resname:"PRO"},{atomname:"N"}]},{operator:"AND",negate:!1,rules:[{keyword:_f.NUCLEIC},{operator:"OR",negate:!0,rules:[{atomname:"P"},{atomname:"OP1"},{atomname:"OP2"},{atomname:"O3'"},{atomname:"O3*"},{atomname:"HO3'"},{atomname:"O5'"},{atomname:"O5*"},{atomname:"HO5'"},{atomname:"C5'"},{atomname:"C5*"},{atomname:"H5'"},{atomname:"H5''"}]}]}]});continue}if("APOLARH"===t){c({operator:"AND",negate:!1,rules:[{element:"H"},{negate:!0,operator:void 0,rules:[{keyword:_f.POLARH}]}]});continue}if("LIGAND"===t){c({operator:"AND",rules:[{operator:"OR",rules:[{operator:"AND",rules:[{keyword:_f.HETERO},{negate:!0,operator:void 0,rules:[{keyword:_f.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{keyword:_f.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{operator:"OR",rules:[{keyword:_f.WATER},{keyword:_f.ION}]}]}]});continue}if(-1!==Mf.indexOf(t)){c({keyword:_f.ALL});continue}if("@"===e.charAt(0)){const t=e.substr(1).split(",").map((e=>parseInt(e)));t.sort((function(e,t){return e-t})),c({atomindex:t});continue}if("#"===e.charAt(0)){console.error("# for element selection deprecated, use _"),c({element:t.substr(1)});continue}if("_"===e.charAt(0)){c({element:t.substr(1)});continue}if("["===e[0]&&"]"===e[e.length-1]){const n=t.substr(1,e.length-2).split(","),i=n.length>1?n:n[0];c({resname:i});continue}if(e.length>=1&&e.length<=4&&"^"!==e[0]&&":"!==e[0]&&"."!==e[0]&&"%"!==e[0]&&"/"!==e[0]&&isNaN(parseInt(e))){c({resname:t});continue}const n={operator:"AND",rules:[]},i=e.split("/");if(i.length>1&&i[1]){if(isNaN(parseInt(i[1])))throw new Error("model must be an integer");n.rules.push({model:parseInt(i[1])})}const o=i[0].split("%");o.length>1&&n.rules.push({altloc:o[1]});const d=o[0].split(".");if(d.length>1&&d[1]){if(d[1].length>4)throw new Error("atomname must be one to four characters");n.rules.push({atomname:d[1].substring(0,4).toUpperCase()})}const p=d[0].split(":");p.length>1&&p[1]&&n.rules.push({chainname:p[1]});const f=p[0].split("^");if(f.length>1&&n.rules.push({inscode:f[1]}),f[0]){let e,t;"-"===f[0][0]&&(f[0]=f[0].substr(1),e=!0),f[0].includes("--")&&(f[0]=f[0].replace("--","-"),t=!0);let i=f[0].split("-");if(1===i.length){let t=parseInt(i[0]);if(isNaN(t))throw new Error("resi must be an integer");e&&(t*=-1),n.rules.push({resno:t})}else{if(2!==i.length)throw new Error("resi range must contain one '-'");{const r=i.map((e=>parseInt(e)));e&&(r[0]*=-1),t&&(r[1]*=-1),n.rules.push({resno:[r[0],r[1]]})}}}if(1===n.rules.length)c(n.rules[0]);else{if(!(n.rules.length>1))throw new Error("empty selection chunk");c(n)}}return void 0===t.operator&&1===t.rules.length&&t.rules[0].hasOwnProperty("operator")&&(t=t.rules[0]),t}function Hf(e,t){if(void 0===t.atomname&&void 0===t.element&&void 0===t.altloc&&void 0===t.atomindex&&void 0===t.keyword&&void 0===t.inscode&&void 0===t.resname&&void 0===t.sstruc&&void 0===t.resno&&void 0===t.chainname&&void 0===t.model)return-1;if(void 0!==t.keyword){if(t.keyword===_f.BACKBONE&&!e.isBackbone())return!1;if(t.keyword===_f.SIDECHAIN&&!e.isSidechain())return!1;if(t.keyword===_f.BONDED&&!e.isBonded())return!1;if(t.keyword===_f.RING&&!e.isRing())return!1;if(t.keyword===_f.AROMATICRING&&!e.isAromatic())return!1;if(t.keyword===_f.HETERO&&!e.isHetero())return!1;if(t.keyword===_f.PROTEIN&&!e.isProtein())return!1;if(t.keyword===_f.NUCLEIC&&!e.isNucleic())return!1;if(t.keyword===_f.RNA&&!e.isRna())return!1;if(t.keyword===_f.DNA&&!e.isDna())return!1;if(t.keyword===_f.POLYMER&&!e.isPolymer())return!1;if(t.keyword===_f.WATER&&!e.isWater())return!1;if(t.keyword===_f.HELIX&&!e.isHelix())return!1;if(t.keyword===_f.SHEET&&!e.isSheet())return!1;if(t.keyword===_f.TURN&&!e.isTurn())return!1;if(t.keyword===_f.ION&&!e.isIon())return!1;if(t.keyword===_f.SACCHARIDE&&!e.isSaccharide())return!1;if(t.keyword===_f.METAL&&!e.isMetal())return!1;if(t.keyword===_f.POLARH&&!e.isPolarHydrogen())return!1}if(void 0!==t.atomname&&t.atomname!==e.atomname)return!1;if(void 0!==t.element&&t.element!==e.element)return!1;if(void 0!==t.altloc&&t.altloc!==e.altloc)return!1;if(void 0!==t.atomindex&&Ip(t.atomindex,e.index)<0)return!1;if(void 0!==t.resname)if(Array.isArray(t.resname)){if(!t.resname.includes(e.resname))return!1}else if(t.resname!==e.resname)return!1;if(void 0!==t.sstruc&&t.sstruc!==e.sstruc)return!1;if(void 0!==t.resno)if(Array.isArray(t.resno)&&2===t.resno.length){if(t.resno[0]>e.resno||t.resno[1]<e.resno)return!1}else if(t.resno!==e.resno)return!1;return(void 0===t.inscode||t.inscode===e.inscode)&&(void 0===t.chainname||t.chainname===e.chainname)&&(void 0===t.model||t.model===e.modelIndex)}function Gf(e,t){if(void 0===t.resname&&void 0===t.resno&&void 0===t.inscode&&void 0===t.sstruc&&void 0===t.model&&void 0===t.chainname&&void 0===t.atomindex&&(void 0===t.keyword||Cf.includes(t.keyword)))return-1;if(void 0!==t.keyword){if(t.keyword===_f.HETERO&&!e.isHetero())return!1;if(t.keyword===_f.PROTEIN&&!e.isProtein())return!1;if(t.keyword===_f.NUCLEIC&&!e.isNucleic())return!1;if(t.keyword===_f.RNA&&!e.isRna())return!1;if(t.keyword===_f.DNA&&!e.isDna())return!1;if(t.keyword===_f.POLYMER&&!e.isPolymer())return!1;if(t.keyword===_f.WATER&&!e.isWater())return!1;if(t.keyword===_f.HELIX&&!e.isHelix())return!1;if(t.keyword===_f.SHEET&&!e.isSheet())return!1;if(t.keyword===_f.TURN&&!e.isTurn())return!1;if(t.keyword===_f.ION&&!e.isIon())return!1;if(t.keyword===_f.SACCHARIDE&&!e.isSaccharide())return!1}if(void 0!==t.atomindex&&0===kp(t.atomindex,e.atomOffset,e.atomEnd))return!1;if(void 0!==t.resname)if(Array.isArray(t.resname)){if(!t.resname.includes(e.resname))return!1}else if(t.resname!==e.resname)return!1;if(void 0!==t.sstruc&&t.sstruc!==e.sstruc)return!1;if(void 0!==t.resno)if(Array.isArray(t.resno)&&2===t.resno.length){if(t.resno[0]>e.resno||t.resno[1]<e.resno)return!1}else if(t.resno!==e.resno)return!1;return(void 0===t.inscode||t.inscode===e.inscode)&&(void 0===t.chainname||t.chainname===e.chainname)&&(void 0===t.model||t.model===e.modelIndex)}function Vf(e,t){if(void 0===t.chainname&&void 0===t.model&&void 0===t.atomindex&&(void 0===t.keyword||!Tf.includes(t.keyword)||!e.entity))return-1;if(void 0!==t.keyword){if(t.keyword===_f.POLYMER&&!e.entity.isPolymer())return!1;if(t.keyword===_f.WATER&&!e.entity.isWater())return!1}return(void 0===t.atomindex||0!==kp(t.atomindex,e.atomOffset,e.atomEnd))&&(void 0===t.chainname||t.chainname===e.chainname)&&(void 0===t.model||t.model===e.modelIndex)}function jf(e,t){return void 0===t.model&&void 0===t.atomindex?-1:(void 0===t.atomindex||0!==kp(t.atomindex,e.atomOffset,e.atomEnd))&&(void 0===t.model||t.model===e.index)}function $f(e,t){if(null===e)return!1;if(e.error)return!1;if(!e.rules||0===e.rules.length)return!1;const n=e.rules.length,i=!e.negate,r=!!e.negate,o=[];for(let s=0;s<n;++s){const n=e.rules[s];n.hasOwnProperty("operator")&&(o[s]=$f(n,t))}return function(s){const a="AND"===e.operator;let l=!1;for(let c=0;c<n;++c){const n=e.rules[c];let u;if(n.hasOwnProperty("operator")){const e=o[c];if(u=!1!==e?e(s):-1,-1===u){l=!0;continue}if(!0===u){if(a)continue;return i}if(a)return r}else{if(n.keyword===_f.ALL){if(a)continue;return i}if(n.keyword===_f.NONE){if(a)continue;return r}if(u=t(s,n),-1!==u){if(!0===u){if(a)continue;return i}if(a)return r}else l=!0}}return l?-1:a?i:r}}function Wf(e,t){if(e.error)return e;if(!e.rules||0===e.rules.length)return e;const n=e.rules.length,i={operator:e.operator,rules:[]};e.hasOwnProperty("negate")&&(i.negate=e.negate);for(let r=0;r<n;++r){const n=e.rules[r];if(n.hasOwnProperty("operator")){const e=Wf(n,t);null!==e&&i.rules.push(e)}else t(n)||i.rules.push(n)}return i.rules.length>0?e:null}function qf(e){let t=e;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(t=Wf(e,(function(e){return void 0!==e.keyword&&!Cf.includes(e.keyword)||void 0!==e.model||void 0!==e.chainname||void 0!==e.resname||void 0!==e.resno||void 0!==e.sstruc}))),$f(t,Hf)}function Xf(e){let t=e;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(t=Wf(e,(function(e){return!(void 0===e.keyword||!Cf.includes(e.keyword))||void 0!==e.model||void 0!==e.chainname||void 0!==e.atomname||void 0!==e.element||void 0!==e.altloc}))),$f(t,Gf)}function Yf(e){let t=e;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(t=Wf(e,(function(e){return void 0!==e.keyword&&!Tf.includes(e.keyword)||void 0!==e.resname||void 0!==e.resno||void 0!==e.atomname||void 0!==e.element||void 0!==e.altloc||void 0!==e.sstruc||void 0!==e.inscode}))),$f(t,Vf)}function Zf(e){let t=e;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(t=Wf(e,(function(e){return void 0!==e.keyword||void 0!==e.chainname||void 0!==e.resname||void 0!==e.resno||void 0!==e.atomname||void 0!==e.element||void 0!==e.altloc||void 0!==e.sstruc||void 0!==e.inscode}))),$f(t,jf)}class Kf{constructor(e){this.signals={stringChanged:new Sf.Signal},this.setString(e)}get type(){return"selection"}setString(e,t){if(void 0===e&&(e=this.string||""),e===this.string)return;try{this.selection=Uf(e)}catch(i){this.selection={error:i.message}}const n=this.selection;this.string=e,this.test=qf(n),this.residueTest=Xf(n),this.chainTest=Yf(n),this.modelTest=Zf(n),this.atomOnlyTest=qf(n,!0),this.residueOnlyTest=Xf(n,!0),this.chainOnlyTest=Yf(n,!0),this.modelOnlyTest=Zf(n,!0),t||this.signals.stringChanged.dispatch(this.string)}isAllSelection(){return Mf.includes(this.string.toUpperCase())}isNoneSelection(){return Af.includes(this.string.toUpperCase())}}class Qf extends wf{constructor(e){super(e),this.colormakerList=[],this.selectionList=[],(e.dataList||[]).forEach((e=>{const[t,n,i={}]=e;Sm.hasScheme(t)?Object.assign(i,{scheme:t,structure:this.parameters.structure}):Object.assign(i,{scheme:"uniform",value:new Ri(t).getHex()}),this.colormakerList.push(Sm.getScheme(i)),this.selectionList.push(new Kf(n))}))}atomColor(e){for(let t=0,n=this.selectionList.length;t<n;++t){const n=this.selectionList[t].test;if(n&&n(e))return this.colormakerList[t].atomColor(e)}return 16777215}}const Jf={"":"",OrRd:"[S] Orange-Red",PuBu:"[S] Purple-Blue",BuPu:"[S] Blue-Purple",Oranges:"[S] Oranges",BuGn:"[S] Blue-Green",YlOrBr:"[S] Yellow-Orange-Brown",YlGn:"[S] Yellow-Green",Reds:"[S] Reds",RdPu:"[S] Red-Purple",Greens:"[S] Greens",YlGnBu:"[S] Yellow-Green-Blue",Purples:"[S] Purples",GnBu:"[S] Green-Blue",Greys:"[S] Greys",YlOrRd:"[S] Yellow-Orange-Red",PuRd:"[S] Purple-Red",Blues:"[S] Blues",PuBuGn:"[S] Purple-Blue-Green",Viridis:"[D] Viridis",Spectral:"[D] Spectral",RdYlGn:"[D] Red-Yellow-Green",RdBu:"[D] Red-Blue",PiYG:"[D] Pink-Yellowgreen",PRGn:"[D] Purplered-Green",RdYlBu:"[D] Red-Yellow-Blue",BrBG:"[D] Brown-Bluegreen",RdGy:"[D] Red-Grey",PuOr:"[D] Purple-Orange",Set1:"[Q] Set1",Set2:"[Q] Set2",Set3:"[Q] Set3",Dark2:"[Q] Dark2",Paired:"[Q] Paired",Pastel1:"[Q] Pastel1",Pastel2:"[Q] Pastel2",Accent:"[Q] Accent",rainbow:"[?] Rainbow",rwb:"[?] Red-White-Blue"},em={"":"",rgb:"Red Green Blue",hsv:"Hue Saturation Value",hsl:"Hue Saturation Lightness",hsi:"Hue Saturation Intensity",lab:"CIE L*a*b*",hcl:"Hue Chroma Lightness"};class tm{constructor(){this.schemes={},this.userSchemes={}}getScheme(e){const t=((e||{}).scheme||"").toLowerCase();let n;return n=t in this.schemes?this.schemes[t]:t in this.userSchemes?this.userSchemes[t]:wf,new n(e)}getSchemes(){const e={};return Object.keys(this.schemes).forEach((function(t){e[t]=t})),Object.keys(this.userSchemes).forEach((function(t){e[t]=t.split("|")[1]})),e}getScales(){return Jf}getModes(){return em}add(e,t){e=e.toLowerCase(),this.schemes[e]=t}addScheme(e,t){return nm(e)||(e=this._createScheme(e)),this._addUserScheme(e,t)}_addUserScheme(e,t){t=t||"";const n="".concat(nf(),"|").concat(t).toLowerCase();return this.userSchemes[n]=e,n}removeScheme(e){e=e.toLowerCase(),delete this.userSchemes[e]}_createScheme(e){class t extends wf{constructor(t){super(t),e.call(this,t)}}return t}addSelectionScheme(e,t){class n extends Qf{constructor(t){super(Object.assign({dataList:e},t))}}return this._addUserScheme(n,t)}hasScheme(e){return(e=e.toLowerCase())in this.schemes||e in this.userSchemes}}function nm(e){return e instanceof wf}class im extends Kp{constructor(){super("parser")}__hasObjName(e,t){const n=this.get(e);return n&&n.prototype.__objName===t}isTrajectory(e){return this.__hasObjName(e,"frames")}isStructure(e){return this.__hasObjName(e,"structure")}isVolume(e){return this.__hasObjName(e,"volume")}isSurface(e){return this.__hasObjName(e,"surface")}isBinary(e){const t=this.get(e);return t&&t.prototype.isBinary}isXml(e){const t=this.get(e);return t&&t.prototype.isXml}isJson(e){const t=this.get(e);return t&&t.prototype.isJson}getTrajectoryExtensions(){return this.names.filter((e=>this.isTrajectory(e)))}getStructureExtensions(){return this.names.filter((e=>this.isStructure(e)))}getVolumeExtensions(){return this.names.filter((e=>this.isVolume(e)))}getSurfaceExtensions(){return this.names.filter((e=>this.isSurface(e)))}}function rm(e){const t=e;return e.forEach((function(e){e.__deps&&Array.prototype.push.apply(t,rm(e.__deps))})),t}function om(e){return Dp(rm(e)).map((function(e){return e.toString()})).join("\n\n\n")}function sm(e){const t=e.data.__name,n=e.data.__postId;if(void 0===t)console.error("message __name undefined");else if(void 0===self.func)console.error("worker func undefined",t);else{const t=function(e,t){e=e||{},void 0!==n&&(e.__postId=n);try{self.postMessage(e,t)}catch(i){console.error("self.postMessage:",i),self.postMessage(e)}};self.func(e,t)}}function am(e,t){let n="'use strict';\n\n"+om(t);return n+="\n\n\nself.func = "+e.toString()+";",n+="\n\n\nself.onmessage = "+sm.toString()+";",new Blob([n],{type:"application/javascript"})}class lm{constructor(){this.activeWorkerCount=0,this._funcDict={},this._depsDict={},this._blobDict={}}add(e,t,n){this._funcDict[e]=t,this._depsDict[e]=n}get(e){return this._blobDict[e]||(this._blobDict[e]=am(this._funcDict[e],this._depsDict[e])),this._blobDict[e]}}const cm=Mp();let um=!1;try{const e=Object.defineProperty({},"passive",{get:function(){um=!0}});window.addEventListener("test",(e=>{}),e)}catch(CD){}const hm="undefined"!==typeof window&&"undefined"!==typeof window.orientation;let dm=!1;function pm(e){dm=e}let fm=!1;function mm(e){fm=e}const gm={log:Function.prototype.bind.call(console.log,console),info:Function.prototype.bind.call(console.info,console),warn:Function.prototype.bind.call(console.warn,console),error:Function.prototype.bind.call(console.error,console),time:Function.prototype.bind.call(console.time,console),timeEnd:Function.prototype.bind.call(console.timeEnd,console)};let ym={color:"green",labelColor:8421504,labelAttachment:"bottom-center",labelSize:.7,labelZOffset:.5,labelYOffset:.1,labelBorder:!0,labelBorderColor:13882323,labelBorderWidth:.25,lineOpacity:.8,linewidth:5,opacity:.6,labelUnit:"angstrom",arcVisible:!0,planeVisible:!1};function vm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(ym,e)}function bm(t){e.Debug=t}e.Debug=vp(yp("debug"));const xm='<div style="display:flex;align-items:center;justify-content:center;height:100%;"><p style="padding:15px;text-align:center;">Your browser/graphics card does not seem to support <a target="_blank" href="https://en.wikipedia.org/wiki/WebGL">WebGL</a>.<br/><br/>Find out how to get it <a target="_blank" href="http://get.webgl.org/">here</a>.</p></div>',wm=["ngl","js"],_m=new lm,Sm=new tm,Mm=new Kp("datasource"),Am=new Kp("representatation"),Cm=new im,Tm=new Kp("shader"),Em=new Kp("decompressor"),Pm=new Kp("component"),Im=new Kp("buffer"),Lm=new Kp("picker");function Rm(t){e.ListingDatasource=t}function km(t){e.TrajectoryDatasource=t}e.ListingDatasource=void 0,e.TrajectoryDatasource=void 0;class Dm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.chunkSize=10485760,this.newline="\n",this.__pointer=0,this.__partialLine="",this.compressed=bp(t.compressed,!1),this.binary=bp(t.binary,!1),this.json=bp(t.json,!1),this.xml=bp(t.xml,!1),this.src=e}isBinary(){return this.binary||this.compressed}read(){return this._read().then((e=>{const t=this.compressed?Em.get(this.compressed):void 0;return this.compressed&&t?this.data=t(e):((this.binary||this.compressed)&&e instanceof ArrayBuffer&&(e=new Uint8Array(e)),this.data=e),this.data}))}_chunk(e,t){return t=Math.min(this.data.length,t),0===e&&this.data.length===t?this.data:this.isBinary()?this.data.subarray(e,t):this.data.substring(e,t)}chunk(e){const t=e+this.chunkSize;return this._chunk(e,t)}peekLines(e){const t=this.data,n=t.length,i=this.isBinary()?this.newline.charCodeAt(0):this.newline;let r,o=0;for(r=0;r<n&&(t[r]===i&&++o,o!==e);++r);const s=this._chunk(0,r+1);return this.chunkToLines(s,"",r>n).lines}chunkCount(){return Math.floor(this.data.length/this.chunkSize)+1}asText(){return this.isBinary()?Op(this.data):this.data}chunkToLines(e,t,n){const i=this.newline;if(!this.isBinary()&&e.length===this.data.length)return{lines:e.split(i),partialLine:""};let r=[];const o=this.isBinary()?Op(e):e,s=o.lastIndexOf(i);if(-1===s)t+=o;else{const e=t+o.substr(0,s);r=r.concat(e.split(i)),t=s===o.length-i.length?"":o.substr(s+i.length)}return n&&""!==t&&r.push(t),{lines:r,partialLine:t}}nextChunk(){const e=this.__pointer;if(!(e>this.data.length))return this.__pointer+=this.chunkSize,this.chunk(e)}nextChunkOfLines(){const e=this.nextChunk();if(void 0===e)return;const t=this.__pointer>this.data.length,n=this.chunkToLines(e,this.__partialLine,t);return this.__partialLine=n.partialLine,n.lines}eachChunk(e){const t=this.chunkSize,n=this.data.length,i=this.chunkCount();for(let r=0;r<n;r+=t)e(this.chunk(r),Math.round(r/t),i)}eachChunkOfLines(e){this.eachChunk(((t,n,i)=>{const r=n===i+1,o=this.chunkToLines(t,this.__partialLine,r);this.__partialLine=o.partialLine,e(o.lines,n,i)}))}dispose(){delete this.src}}class Om extends Dm{_read(){return new Promise(((e,t)=>{const n=this.src,i=new FileReader;i.onload=t=>{t.target&&e(t.target.result)},i.onerror=e=>t(e),this.binary||this.compressed?i.readAsArrayBuffer(n):i.readAsText(n)}))}}class Nm extends Dm{_read(){return new Promise(((e,t)=>{const n=this.src,i=new XMLHttpRequest;i.open("GET",n,!0),i.addEventListener("load",(()=>{if(200===i.status||304===i.status||0===i.status)try{e(i.response)}catch(CD){t(CD)}else t(i.statusText)}),!1),i.addEventListener("error",(e=>t("network error")),!1),this.isBinary()?i.responseType="arraybuffer":this.json?i.responseType="json":this.xml?i.responseType="document":i.responseType="text",i.send()}))}}class Bm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.parameters=xp(t,{ext:"",compressed:!1,binary:Cm.isBinary(t.ext||""),name:"",dir:"",path:"",protocol:""});const n={compressed:this.parameters.compressed,binary:this.parameters.binary,json:Cm.isJson(this.parameters.ext),xml:Cm.isXml(this.parameters.ext)};"undefined"!==typeof File&&e instanceof File||"undefined"!==typeof Blob&&e instanceof Blob?this.streamer=new Om(e,n):this.streamer=new Nm(e,n)}}class Fm extends Bm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this.parserParams={voxelSize:t.voxelSize,firstModelOnly:t.firstModelOnly,asTrajectory:t.asTrajectory,cAlphaOnly:t.cAlphaOnly,delimiter:t.delimiter,comment:t.comment,columnNames:t.columnNames,inferBonds:t.inferBonds,name:this.parameters.name,path:this.parameters.path}}load(){return new(Cm.get(this.parameters.ext))(this.streamer,this.parserParams).parse()}}class zm{constructor(e,t,n){this.name=t,this.path=n,this.signals={elementAdded:new Sf.Signal,elementRemoved:new Sf.Signal,nameChanged:new Sf.Signal},this.type="Script",this.dir=n.substring(0,n.lastIndexOf("/")+1);try{this.fn=new Function("stage","__name","__path","__dir",e)}catch(CD){gm.error("Script compilation failed",CD),this.fn=function(){}}}run(e){return new Promise(((t,n)=>{try{this.fn.apply(null,[e,this.name,this.path,this.dir]),t()}catch(CD){gm.error("Script.fn",CD),n(CD)}}))}}class Um extends Bm{load(){return this.streamer.read().then((()=>new zm(this.streamer.asText(),this.parameters.name,this.parameters.path)))}}function Hm(e){const t=Em.names;let n,i,r="";n=e instanceof File?e.name:e instanceof Blob?"":e;const o=n.lastIndexOf("?"),s=-1!==o?n.substring(o):"";n=n.substring(0,-1===o?n.length:o);const a=n.replace(/^.*[\\/]/,"");let l=a.substring(0,a.lastIndexOf("."));const c=a.split(".");let u=c.length>1?(c.pop()||"").toLowerCase():"";const h=n.match(/^(.+):\/\/(.+)$/);h&&(r=h[1].toLowerCase(),n=h[2]||"");const d=n.substring(0,n.lastIndexOf("/")+1);if(t.includes(u)){i=u;const e=n.length-u.length-1;u=(n.substr(0,e).split(".").pop()||"").toLowerCase();const t=l.length-u.length-1;l=l.substr(0,t)}else i=!1;return{path:n,name:a,ext:u,base:l,dir:d,compressed:i,protocol:r,query:s,src:e}}function Gm(e){let t=Hm(e);const n=Mm.get(t.protocol);return n&&(t=Hm(n.getUrl(t.src)),!t.ext&&n.getExt&&(t.ext=n.getExt(e))),t}function Vm(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Object.assign(Gm(e),t);let i;return Cm.names.includes(n.ext)?i=new Fm(n.src,n):wm.includes(n.ext)&&(i=new Um(n.src,n)),i?i.load():Promise.reject(new Error("autoLoad: ext '".concat(n.ext,"' unknown")))}var jm=ff((function(e,t){!function(){var e={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function n(e){return r(s(e),arguments)}function i(e,t){return n.apply(null,[e].concat(t||[]))}function r(t,i){var r,o,s,a,l,c,u,h,d,p=1,f=t.length,m="";for(o=0;o<f;o++)if("string"===typeof t[o])m+=t[o];else if("object"===typeof t[o]){if((a=t[o]).keys)for(r=i[p],s=0;s<a.keys.length;s++){if(void 0==r)throw new Error(n('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[s],a.keys[s-1]));r=r[a.keys[s]]}else r=a.param_no?i[a.param_no]:i[p++];if(e.not_type.test(a.type)&&e.not_primitive.test(a.type)&&r instanceof Function&&(r=r()),e.numeric_arg.test(a.type)&&"number"!==typeof r&&isNaN(r))throw new TypeError(n("[sprintf] expecting number but found %T",r));switch(e.number.test(a.type)&&(h=r>=0),a.type){case"b":r=parseInt(r,10).toString(2);break;case"c":r=String.fromCharCode(parseInt(r,10));break;case"d":case"i":r=parseInt(r,10);break;case"j":r=JSON.stringify(r,null,a.width?parseInt(a.width):0);break;case"e":r=a.precision?parseFloat(r).toExponential(a.precision):parseFloat(r).toExponential();break;case"f":r=a.precision?parseFloat(r).toFixed(a.precision):parseFloat(r);break;case"g":r=a.precision?String(Number(r.toPrecision(a.precision))):parseFloat(r);break;case"o":r=(parseInt(r,10)>>>0).toString(8);break;case"s":r=String(r),r=a.precision?r.substring(0,a.precision):r;break;case"t":r=String(!!r),r=a.precision?r.substring(0,a.precision):r;break;case"T":r=Object.prototype.toString.call(r).slice(8,-1).toLowerCase(),r=a.precision?r.substring(0,a.precision):r;break;case"u":r=parseInt(r,10)>>>0;break;case"v":r=r.valueOf(),r=a.precision?r.substring(0,a.precision):r;break;case"x":r=(parseInt(r,10)>>>0).toString(16);break;case"X":r=(parseInt(r,10)>>>0).toString(16).toUpperCase()}e.json.test(a.type)?m+=r:(!e.number.test(a.type)||h&&!a.sign?d="":(d=h?"+":"-",r=r.toString().replace(e.sign,"")),c=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",u=a.width-(d+r).length,l=a.width&&u>0?c.repeat(u):"",m+=a.align?d+r+l:"0"===c?d+l+r:l+d+r)}return m}var o=Object.create(null);function s(t){if(o[t])return o[t];for(var n,i=t,r=[],s=0;i;){if(null!==(n=e.text.exec(i)))r.push(n[0]);else if(null!==(n=e.modulo.exec(i)))r.push("%");else{if(null===(n=e.placeholder.exec(i)))throw new SyntaxError("[sprintf] unexpected placeholder");if(n[2]){s|=1;var a=[],l=n[2],c=[];if(null===(c=e.key.exec(l)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(a.push(c[1]);""!==(l=l.substring(c[0].length));)if(null!==(c=e.key_access.exec(l)))a.push(c[1]);else{if(null===(c=e.index_access.exec(l)))throw new SyntaxError("[sprintf] failed to parse named argument key");a.push(c[1])}n[2]=a}else s|=2;if(3===s)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r.push({placeholder:n[0],param_no:n[1],keys:n[2],sign:n[3],pad_char:n[4],align:n[5],width:n[6],precision:n[7],type:n[8]})}i=i.substring(n[0].length)}return o[t]=r}t.sprintf=n,t.vsprintf=i,"undefined"!==typeof window&&(window.sprintf=n,window.vsprintf=i)}()}));class $m{getBlob(){return new Blob([this.getData()],{type:this.mimeType})}download(e,t){e=bp(e,this.defaultName),t=bp(t,this.defaultExt),Tp(this.getBlob(),"".concat(e,".").concat(t))}}const Wm="ATOM  %5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s%1s%1s",qm="HETATM%5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s%1s%1s";class Xm extends $m{constructor(e,t){super(),this.mimeType="text/plain",this.defaultName="structure",this.defaultExt="pdb";const n=Object.assign({},t);this.renumberSerial=bp(n.renumberSerial,!0),this.remarks=zp(bp(n.remarks,[])),this.structure=e,this._records=[]}_writeRecords(){this._records.length=0,this._writeTitle(),this._writeRemarks(),this._writeAtoms()}_writeTitle(){this._records.push(jm.sprintf("TITLE %-74s",this.structure.name))}_writeRemarks(){this.remarks.forEach((e=>{this._records.push(jm.sprintf("REMARK %-73s",e))})),this.structure.trajectory&&(this._records.push(jm.sprintf("REMARK %-73s","Trajectory '"+this.structure.trajectory.name+"'")),this._records.push(jm.sprintf("REMARK %-73s","Frame ".concat(this.structure.trajectory.frame))))}_writeAtoms(){let e=1,t=1,n=" ",i=" ";const r=this.structure.modelStore.count>1;this.structure.eachModel((o=>{r&&this._records.push(jm.sprintf("MODEL     %4d%-66s",t++,"")),o.eachAtom((t=>{const r=t.hetero?qm:Wm,o=this.renumberSerial?e:t.serial;let s=t.atomname;(1===s.length||s.length<4&&1===t.element.length&&s[0]===t.element)&&(s=" "+s),t.formalCharge?(n=Math.abs(t.formalCharge).toPrecision(1),i=t.formalCharge>0?"+":"-"):(n=" ",i=" "),this._records.push(jm.sprintf(r,o,s,t.resname,bp(t.chainname," "),t.resno,t.x,t.y,t.z,bp(t.occupancy,1),bp(t.bfactor,0),"",bp(t.element,""),n,i)),e+=1}),this.structure.getSelection()),r&&this._records.push(jm.sprintf("%-80s","ENDMDL"))})),this._records.push(jm.sprintf("%-80s","END"))}getString(){return console.warn("PdbWriter.getString() is deprecated, use .getData instead"),this.getData()}getData(){return this._writeRecords(),this._records.join("\n")}}const Ym="%3i%3i  0  0  0  0  0  0  0  0999 V2000",Zm="%10.4f%10.4f%10.4f %-3s 0%3i  0  0  0",Km="%3i%3i%3i  0  0  0";class Qm extends $m{constructor(e){super(),this.mimeType="text/plain",this.defaultName="structure",this.defaultExt="sdf",this.structure=e,this._records=[]}get idString(){return this.structure.id}get titleString(){return"  "+this.structure.title}get countsString(){return jm.sprintf(Ym,this.structure.atomCount,this.structure.bondCount)}get chargeLines(){const e=[];this.structure.eachAtom((t=>{null!=t.formalCharge&&0!==t.formalCharge&&e.push([t.index,t.formalCharge])}));const t=[];for(let n=0;n<e.length;n+=8){const i=Math.min(8,e.length-n);let r=jm.sprintf("M  CHG%3i",i);for(let t=n;t<n+i;t++)r+=jm.sprintf(" %3i %3i",e[t][0]+1,e[t][1]);t.push(r)}return t}formatAtom(e){let t=0;null!=e.formalCharge&&0!==e.formalCharge&&(t=4-e.formalCharge);const n=jm.sprintf(Zm,e.x,e.y,e.z,e.element,t);if(48!==n.length)throw new Error("Incompatible atom for sdf format");return n}formatBond(e){return jm.sprintf(Km,e.atomIndex1+1,e.atomIndex2+1,e.bondOrder)}_writeRecords(){this._records.length=0,this._writeHeader(),this._writeCTab(),this._writeFooter()}_writeHeader(){this._records.push(this.idString,this.titleString,"")}_writeCTab(){this._records.push(this.countsString),this.structure.eachAtom((e=>{this._records.push(this.formatAtom(e))})),this.structure.eachBond((e=>{this._records.push(this.formatBond(e))})),this.chargeLines.forEach((e=>{this._records.push(e)})),this._records.push("M  END")}_writeFooter(){this._records.push("$$$$")}getData(){return this._writeRecords(),this._records.join("\n")}}const Jm=8192,eg=[];class tg{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;let n=!1;void 0===e&&(e=Jm),"number"===typeof e?e=new ArrayBuffer(e):n=!0;const i=t.offset?t.offset>>>0:0;let r=e.byteLength-i,o=i;e instanceof ArrayBuffer||(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+i),e=e.buffer),this._lastWrittenByte=n?r:0,this.buffer=e,this.length=r,this.byteLength=r,this.byteOffset=o,this._data=new DataView(this.buffer,o,r)}available(e){return void 0===e&&(e=1),this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e){return void 0===e&&(e=1),this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(void 0===e)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e){if(void 0===e&&(e=1),!this.available(e)){const t=2*(this.offset+e),n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){void 0===e&&(e=1);for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=this.readByte();return t}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;eg.length=e;for(var t=0;t<e;t++)eg[t]=this.readChar();return eg.join("")}writeBoolean(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(var t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(var t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}class ng extends $m{constructor(e){super(),this.mimeType="application/vnd.ms-pki.stl",this.defaultName="surface",this.defaultExt="stl",this.surface=e}getData(){const e=this.surface.index.length/3,t=new tg(2*e+3*e*4*4+80+4);t.skip(80),t.writeUint32(e);const n=new mn,i=new mn,r=new mn,o=new mn;for(let s=0;s<e;s++){const e=[this.surface.index[3*s],this.surface.index[3*s+1],this.surface.index[3*s+2]];i.fromArray(this.surface.normal,3*e[0]),r.fromArray(this.surface.normal,3*e[1]),o.fromArray(this.surface.normal,3*e[2]),n.addVectors(i,r).add(o).normalize(),t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z);for(let i=0;i<3;i++)n.fromArray(this.surface.position,3*e[i]),t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z);t.writeUint16(0)}return new DataView(t.buffer)}}class ig{constructor(){this.count=0,this.signals={countChanged:new Sf.Signal}}clear(){this.change(-this.count)}change(e){this.count+=e,this.signals.countChanged.dispatch(e,this.count),this.count<0&&gm.warn("Counter.count below zero",this.count)}increment(){this.change(1)}decrement(){this.change(-1)}listen(e){this.change(e.count),e.signals.countChanged.add(this.change,this)}unlisten(e){const t=e.signals.countChanged;t.has(this.change,this)&&t.remove(this.change,this)}onZeroOnce(e,t){if(0===this.count)e.call(t);else{const n=()=>{0===this.count&&(this.signals.countChanged.remove(n,this),e.call(t))};this.signals.countChanged.add(n,this)}}dispose(){this.clear(),this.signals.countChanged.dispose()}}Tm.add("shader/BasicLine.vert","void main(){\n#include begin_vertex\n#include project_vertex\n}"),Tm.add("shader/BasicLine.frag","uniform vec3 uColor;\n#include common\n#include fog_pars_fragment\nvoid main(){\ngl_FragColor = vec4( uColor, 1.0 );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include encodings_fragment\n#include fog_fragment\n}"),Tm.add("shader/Quad.vert","varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"),Tm.add("shader/Quad.frag","varying vec2 vUv;\nuniform sampler2D tForeground;\nuniform float scale;\nvoid main() {\nvec4 foreground = texture2D( tForeground, vUv );\ngl_FragColor = foreground * scale;\n}");class rg{constructor(){this.signals={updated:new Sf.Signal},this.maxDuration=-1/0,this.minDuration=1/0,this.avgDuration=14,this.lastDuration=1/0,this.prevFpsTime=0,this.lastFps=1/0,this.lastFrames=1,this.frames=0,this.count=0,this.begin()}update(){this.startTime=this.end(),this.currentTime=this.startTime,this.signals.updated.dispatch()}begin(){this.startTime=window.performance.now(),this.lastFrames=this.frames}end(){const e=window.performance.now();return this.count+=1,this.frames+=1,this.lastDuration=e-this.startTime,this.minDuration=Math.min(this.minDuration,this.lastDuration),this.maxDuration=Math.max(this.maxDuration,this.lastDuration),this.avgDuration-=this.avgDuration/30,this.avgDuration+=this.lastDuration/30,e>this.prevFpsTime+1e3&&(this.lastFps=this.frames,this.prevFpsTime=e,this.frames=0),e}}function og(e){if(void 0===e)return"";const t=[];for(const n in e){const i=e[n];i&&t.push("#define ".concat(n," ").concat(i))}return t.join("\n")+"\n"}Tm.add("shader/chunk/fog_fragment.glsl","#ifdef USE_FOG\nfloat depth = length( vViewPosition );\n#ifdef FOG_EXP2\nfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif"),Tm.add("shader/chunk/interior_fragment.glsl","if( gl_FrontFacing == false ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}"),Tm.add("shader/chunk/matrix_scale.glsl","float matrixScale( in mat4 m ){\nvec4 r = m[ 0 ];\nreturn sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );\n}"),Tm.add("shader/chunk/nearclip_vertex.glsl","#ifdef NEAR_CLIP\nif( vViewPosition.z < clipNear - 5.0 )\ngl_Position.z = 2.0 * gl_Position.w;\n#endif"),Tm.add("shader/chunk/nearclip_fragment.glsl","#ifdef NEAR_CLIP\nif( vViewPosition.z < clipNear )\ndiscard;\n#endif"),Tm.add("shader/chunk/opaque_back_fragment.glsl","#ifdef OPAQUE_BACK\n#ifdef FLIP_SIDED\nif( gl_FrontFacing == true ){\ngl_FragColor.a = 1.0;\n}\n#else\nif( gl_FrontFacing == false ){\ngl_FragColor.a = 1.0;\n}\n#endif\n#endif"),Tm.add("shader/chunk/radiusclip_vertex.glsl","#ifdef RADIUS_CLIP\nif( distance( vViewPosition, vClipCenter ) > clipRadius + 5.0 )\ngl_Position.z = 2.0 * gl_Position.w;\n#endif"),Tm.add("shader/chunk/radiusclip_fragment.glsl","#ifdef RADIUS_CLIP\nif( distance( vViewPosition, vClipCenter ) > clipRadius )\ndiscard;\n#endif"),Tm.add("shader/chunk/unpack_color.glsl","vec3 unpackColor(float f) {\nvec3 color;\ncolor.r = floor(f / 256.0 / 256.0);\ncolor.g = floor((f - color.r * 256.0 * 256.0) / 256.0);\ncolor.b = floor(f - color.r * 256.0 * 256.0 - color.g * 256.0);\nreturn color / 255.0;\n}");const sg=/^(?!\/\/)\s*#include\s+(\S+)/gim,ag={};function lg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e+"|";for(const i in t)n+=i+":"+t[i];if(!ag[n]){const i=og(t);let r=Tm.get("shader/".concat(e));if(!r)throw new Error("empty shader, '".concat(e,"'"));r=r.replace(sg,(function(e,t){const n="shader/chunk/".concat(t,".glsl"),i=Tm.get(n)||no[t];if(!i)throw new Error("empty chunk, '".concat(t,"'"));return i})),ag[n]=i+r}return ag[n]}if("undefined"!==typeof WebGLRenderingContext){const t=WebGLRenderingContext.prototype,n=t.getShaderParameter;t.getShaderParameter=function(){return!e.Debug||n.apply(this,arguments)};const i=t.getShaderInfoLog;t.getShaderInfoLog=function(){return e.Debug?i.apply(this,arguments):""};const r=t.getProgramParameter;t.getProgramParameter=function(n,i){return!e.Debug&&i===t.LINK_STATUS||r.apply(this,arguments)};const o=t.getProgramInfoLog;t.getProgramInfoLog=function(){return e.Debug?o.apply(this,arguments):""}}const cg=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];cg.forEach((e=>{e.forEach((e=>{e[0]*=.0625,e[1]*=.0625}))}));class ug{constructor(e,t,n,i){this.canvas=document.createElement("canvas"),this._viewer=n,this._factor=bp(i.factor,2),this._antialias=bp(i.antialias,!1),this._onProgress=i.onProgress,this._onFinish=i.onFinish,this._antialias&&(this._factor*=2),this._n=this._factor*this._factor,this._width=this._viewer.width,this._height=this._viewer.height,this._antialias?(this.canvas.width=this._width*this._factor/2,this.canvas.height=this._height*this._factor/2):(this.canvas.width=this._width*this._factor,this.canvas.height=this._height*this._factor),this._ctx=this.canvas.getContext("2d"),this._viewerSampleLevel=n.sampleLevel,this._viewer.setSampling(-1)}_renderTile(e){const t=this._viewer,n=this._width,i=this._height,r=this._factor,o=e%r*n,s=Math.floor(e/r)*i;if(t.camera.setViewOffset(n*r,i*r,o,s,n,i),t.render(),this._antialias){const e=Math.round((o+n)/2)-Math.round(o/2),r=Math.round((s+i)/2)-Math.round(s/2);this._ctx.drawImage(t.renderer.domElement,Math.round(o/2),Math.round(s/2),e,r)}else this._ctx.drawImage(t.renderer.domElement,Math.floor(o),Math.floor(s),Math.ceil(n),Math.ceil(i));"function"===typeof this._onProgress&&this._onProgress(e+1,this._n,!1)}_finalize(){this._viewer.setSampling(this._viewerSampleLevel),this._viewer.camera.view=null,"function"===typeof this._onFinish&&this._onFinish(this._n+1,this._n,!1)}render(){for(let e=0;e<=this._n;++e)e===this._n?this._finalize():this._renderTile(e)}renderAsync(){let e=0;const t=this._n,n=()=>{e===t?this._finalize():this._renderTile(e),e+=1};for(let i=0;i<=t;++i)setTimeout(n,0)}}const hg=2*Math.PI,dg=180/Math.PI;function pg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4?arguments[4]:void 0;const o=r?r.length:e.length/n;let s=0,a=0;if(r)for(let l=0;l<o;++l){const o=(e[r[l]*n+i]+t)%t/t*hg-Math.PI;s+=Math.cos(o),a+=Math.sin(o)}else for(let l=i;l<o;l+=n){const n=(e[l]+t)%t/t*hg-Math.PI;s+=Math.cos(n),a+=Math.sin(n)}return s/=o,a/=o,(Math.atan2(a,s)+Math.PI)/hg*t}function fg(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const r=e.length,o=n||new Float32Array(r);for(let s=0;s<r;s+=3)o[i+s+0]=(e[s+0]+t[s+0])/2,o[i+s+1]=(e[s+1]+t[s+1])/2,o[i+s+2]=(e[s+2]+t[s+2])/2;return o}function mg(e,t){const n=e.length,i=new Float32Array(n);for(let r=0;r<n;r+=3)i[r+0]=t[r+0]-e[r+0],i[r+1]=t[r+1]-e[r+1],i[r+2]=t[r+2]-e[r+2];return i}function gg(e,t,n){const i=n||new Float32Array(e);for(let r=0;r<e;++r)i[r]=t;return i}function yg(e,t,n,i,r){const o=r||new Float32Array(3*e);for(let s=0;s<e;++s){const e=3*s;o[e+0]=t,o[e+1]=n,o[e+2]=i}return o}function vg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mn;const n=e.length;for(let i=0;i<n;i+=3)t.x+=e[i],t.y+=e[i+1],t.z+=e[i+2];return t.divideScalar(n/3),t}function bg(e){const t=new Float32Array(e);for(let n=0;n<e;++n)t[n]=n;return t}function xg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=(arguments.length>3?arguments[3]:void 0)||new Float32Array(e*t);for(let r=0;r<e;++r){const e=n+r*t;for(let n=0;n<t;++n)i[e+n]=r}return i}function wg(e,t){const n=e.length,i=new Float32Array(n*t);for(let r=0;r<n;++r){const n=r*t,o=e[r];for(let e=0;e<t;++e)i[n+e]=o}return i}function _g(e,t){const n=e.length/3,i=new Float32Array(n*t*3);for(let r=0;r<n;++r){const n=3*r,o=r*t*3,s=e[n+0],a=e[n+1],l=e[n+2];for(let e=0;e<t;++e){const t=o+3*e;i[t+0]=s,i[t+1]=a,i[t+2]=l}}return i}function Sg(e,t){const n=e.length,i=new Float32Array(n);for(let r=0;r<n;r++)i[r]=Math.min(e[r],t[r]);return i}function Mg(e,t,n,i,r){for(let o=0;o<r;++o)t[i+o]=e[n+o]}function Ag(e,t,n,i){Mg(e,e,t,n,i)}function Cg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;t=t||function(e,t){return e>t?1:e<t?-1:0},i=(i||e.length)-1;const r=[];let o,s,a,l=-1,c=n,u=i;function h(t,n){const i=e[t];e[t]=e[n],e[n]=i}for(;;)if(u-c<=25){for(let n=c+1;n<=u;++n){for(o=e[n],s=n-1;s>=c&&t(e[s],o)>0;)e[s+1]=e[s],--s;e[s+1]=o}if(-1===l)break;u=r[l--],c=r[l--]}else{for(s=c+1,a=u,h(c+u>>1,s),t(e[c],e[u])>0&&h(c,u),t(e[s],e[u])>0&&h(s,u),t(e[c],e[s])>0&&h(c,s),o=e[s];;){do{s++}while(t(e[s],o)<0);do{a--}while(t(e[a],o)>0);if(a<s)break;h(s,a)}e[c+1]=e[a],e[a]=o,u-s+1>=a-c?(r[++l]=s,r[++l]=u,u=a-1):(r[++l]=c,r[++l]=a-1,c=s)}return e}function Tg(e){let t=-1/0;for(let n=0,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}function Eg(e){let t=1/0;for(let n=0,i=e.length;n<i;++n)e[n]<t&&(t=e[n]);return t}function Pg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=e.length;let r=0;for(let o=n;o<i;o+=t)r+=e[o];return r}function Ig(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Pg(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)/(e.length/t)}function Lg(e){const t=e.length;let n=0;for(let i=0;i<t;++i){const t=e[i];n+=t*t}return Math.sqrt(n/t)}function Rg(e,t,n,i,r){const o=e.height,s=e.width,a=e.getContext("2d").getImageData(0,0,s,o).data;let l,c,u,h;for(u=!1,c=0;c<o;c++){for(l=0;l<s;l++)if(h=4*(c*s+l),a[h]!==t||a[h+1]!==n||a[h+2]!==i||a[h+3]!==r){u=!0;break}if(u)break}const d=c;for(u=!1,l=0;l<s;l++){for(c=0;c<o;c++)if(h=4*(c*s+l),a[h]!==t||a[h+1]!==n||a[h+2]!==i||a[h+3]!==r){u=!0;break}if(u)break}const p=l;for(u=!1,c=o-1;c>=0;c--){for(l=s-1;l>=0;l--)if(h=4*(c*s+l),a[h]!==t||a[h+1]!==n||a[h+2]!==i||a[h+3]!==r){u=!0;break}if(u)break}const f=c;for(u=!1,l=s-1;l>=0;l--){for(c=o-1;c>=0;c--)if(h=4*(c*s+l),a[h]!==t||a[h+1]!==n||a[h+2]!==i||a[h+3]!==r){u=!0;break}if(u)break}const m=l,g=document.createElement("canvas");return g.width=m-p,g.height=f-d,g.getContext("2d").drawImage(e,p,d,g.width,g.height,0,0,g.width,g.height),g}const kg={trim:!1,factor:1,antialias:!1,transparent:!1,onProgress:void 0};function Dg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{trim:n,factor:i,antialias:r,transparent:o}=xp(t,kg),s=e.renderer,a=e.camera,l=s.getClearAlpha(),c=s.getClearColor();function u(){let t=i;r&&(t*=2),arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(t=1/t),e.scene.traverse((function(e){const n=e.material;n&&n.linewidth&&(n.linewidth*=t),n&&n.uniforms&&n.uniforms.size&&void 0===n.uniforms.size.__seen&&(n.uniforms.size.value*=t,n.uniforms.size.__seen=!0),n&&n.uniforms&&n.uniforms.linewidth&&void 0===n.uniforms.linewidth.__seen&&(n.uniforms.linewidth.value*=t,n.uniforms.linewidth.__seen=!0)})),e.scene.traverse((function(e){const t=e.material;t&&t.uniforms&&t.uniforms.size&&delete t.uniforms.size.__seen,t&&t.uniforms&&t.uniforms.linewidth&&delete t.uniforms.linewidth.__seen}))}function h(e){if(n){const t=c;return Rg(e,o?0:255*t.r,o?0:255*t.g,o?0:255*t.b,o?0:255)}return e}function d(e,n,i){"function"===typeof t.onProgress&&t.onProgress(e,n,i)}return new Promise((function(t,n){const c=new ug(s,a,e,{factor:i,antialias:r,onProgress:d,onFinish:p});function p(i,r){h(c.canvas).toBlob((function(i){s.setClearAlpha(l),u(!0),e.requestRender(),d(r,r,!0),i?t(i):n("error creating image")}),"image/png")}s.setClearAlpha(o?0:1),u(),c.renderAsync()}))}const Og=new mn,Ng=new Sn,Bg=new Sn;function Fg(e,t){e.traverseVisible((function(e){if(!(e instanceof gl)||!e.userData.buffer.parameters.sortParticles)return;const n=e.geometry.attributes,i=n.position.count;if(0===i)return;let r,o,s,a,l,c,u,h;Ng.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),Bg.multiplyMatrices(t.projectionMatrix,Ng),e.userData.sortData?(r=e.userData.sortData,s=r.__zArray,o=r.__sortArray,a=r.__cmpFn):(s=new Float32Array(i),o=new Uint32Array(i),a=function(e,t){const n=s[e],i=s[t];return n>i?1:n<i?-1:0},r={__zArray:s,__sortArray:o,__cmpFn:a},e.userData.sortData=r);for(let t=0;t<i;++t)Og.fromArray(n.position.array,3*t),Og.applyMatrix4(Bg),s[t]=-Og.z,o[t]=t;Cg(o,a);for(let t in n){const e=n[t],s=e.array,a=e.itemSize;r[t]||(r[t]=new Float32Array(a*i)),h=r[t],r[t]=s;for(let t=0;t<i;++t){l=o[t];for(let e=0;e<a;++e)c=l*a+e,u=t*a+e,h[u]=s[c]}n[t].array=h,n[t].needsUpdate=!0}}))}const zg=new nn,Ug=new Sn,Hg=new Sn;function Gg(e,t,n,i,r){let o=new nn;n.getSize(o);const s=o.height,a=n.getPixelRatio(),l="OrthographicCamera"===t.type;zg.set(o.width,o.height),Ug.getInverse(t.projectionMatrix),Hg.copy(t.projectionMatrix).transpose(),e.traverse((function(e){const t=e.material;if(!t)return;const n=t.uniforms;if(n){if(t.clipNear){const e=(50-t.clipNear)/50,o=i-r*e;n.clipNear.value=o}n.canvasHeight&&(n.canvasHeight.value=s),n.resolution&&n.resolution.value.copy(zg),n.pixelRatio&&(n.pixelRatio.value=a),n.projectionMatrixInverse&&n.projectionMatrixInverse.value.copy(Ug),n.projectionMatrixTranspose&&n.projectionMatrixTranspose.value.copy(Hg),n.ortho&&(n.ortho.value=l)}}))}function Vg(e,t){Ug.getInverse(t.projectionMatrix),Hg.copy(t.projectionMatrix).transpose(),e.traverse((function(e){const t=e.material;if(!t)return;const n=t.uniforms;n&&(n.projectionMatrixInverse&&n.projectionMatrixInverse.value.copy(Ug),n.projectionMatrixTranspose&&n.projectionMatrixTranspose.value.copy(Hg))}))}function jg(e,t,n,i){const r=e.createProgram();if(r)return t.forEach((t=>e.attachShader(r,t))),n&&n.forEach(((t,n)=>{e.bindAttribLocation(r,i?i[n]:n,t)})),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)?r:(console.log("error linking program: ".concat(e.getProgramInfoLog(r))),e.deleteProgram(r),null);console.log("error creating WebGL program")}function $g(e,t,n){const i=e.createShader(n);if(i)return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(console.log("error compiling shader ".concat(i,": ").concat(e.getShaderInfoLog(i))),e.deleteShader(i),null);console.log("error creating WebGL shader ".concat(n))}function Wg(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function qg(e,t){const n=e.getExtension(t);return n||console.log("extension '".concat(t,"' not available")),n}const Xg="\nattribute vec4 a_position;\n\nvoid main() {\n  gl_Position = a_position;\n}",Yg="\nprecision mediump float;\nuniform vec4 u_color;\nuniform sampler2D u_texture;\n\nvoid main() {\n  gl_FragColor = texture2D(u_texture, vec2(0.5, 0.5)) * u_color;\n}",Zg=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function Kg(e){const t=document.createElement("canvas");t.width=16,t.height=16,t.style.width="16px",t.style.height="16px";const n=t.getContext("webgl")||t.getContext("experimental-webgl");if(!n)return console.log("error creating webgl context for ".concat(e)),!1;if(!(n instanceof WebGLRenderingContext))return console.log("Got unexpected type for WebGL rendering context"),!1;qg(n,"OES_texture_float"),qg(n,"OES_texture_half_float"),qg(n,"WEBGL_color_buffer_float");const i=$g(n,Xg,n.VERTEX_SHADER),r=$g(n,Yg,n.FRAGMENT_SHADER);if(!i||!r)return!1;const o=jg(n,[i,r]);if(!o)return console.log("error creating WebGL program"),!1;n.useProgram(o);const s=n.getAttribLocation(o,"a_position"),a=n.getUniformLocation(o,"u_color");if(!a)return console.log("error getting 'u_color' uniform location"),!1;const l=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,l),n.bufferData(n.ARRAY_BUFFER,Zg,n.STATIC_DRAW),n.enableVertexAttribArray(s),n.vertexAttribPointer(s,2,n.FLOAT,!1,0,0);const c=n.createTexture(),u=new Uint8Array([255,255,255,255]);n.bindTexture(n.TEXTURE_2D,c),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,u);const h=n.createTexture();n.bindTexture(n.TEXTURE_2D,h),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,e,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);const d=n.createFramebuffer();if(n.bindFramebuffer(n.FRAMEBUFFER,d),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,h,0),n.checkFramebufferStatus(n.FRAMEBUFFER)!==n.FRAMEBUFFER_COMPLETE)return console.log("error creating framebuffer for ".concat(e)),!1;n.bindTexture(n.TEXTURE_2D,c),n.uniform4fv(a,[0,10,20,1]),n.drawArrays(n.TRIANGLES,0,6),n.bindTexture(n.TEXTURE_2D,h),n.bindFramebuffer(n.FRAMEBUFFER,null),n.clearColor(1,0,0,1),n.clear(n.COLOR_BUFFER_BIT),n.uniform4fv(a,[0,.1,.05,1]),n.drawArrays(n.TRIANGLES,0,6);const p=new Uint8Array(4);if(n.readPixels(0,0,1,1,n.RGBA,n.UNSIGNED_BYTE,p),0!==p[0]||p[1]<248||p[2]<248||p[3]<254)return console.log("not able to actually render to ".concat(e," texture")),!1;if(e===n.FLOAT){n.bindFramebuffer(n.FRAMEBUFFER,d);const e=new Float32Array(4);n.readPixels(0,0,1,1,n.RGBA,n.FLOAT,e);const t=n.getError();if(t)return console.log("error reading pixels as float: '".concat(Wg(n,t),"'")),!1}return!0}const Qg=new Float32Array(100),Jg=new Uint8Array(100),ey=[12,7,13,17,11,6,8,18,16,2,14,22,10,1,3,9,19,23,21,15,5,0,4,24,20],ty=new Sn;function ny(e,t,n,i,r){const o=r.uniforms,s=[];if(o&&(o.objectId&&(o.objectId.value=dm?this.id:this.id/255,s.push("objectId")),(o.modelViewMatrixInverse||o.modelViewMatrixInverseTranspose||o.modelViewProjectionMatrix||o.modelViewProjectionMatrixInverse)&&this.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,this.matrixWorld),o.modelViewMatrixInverse&&(o.modelViewMatrixInverse.value.getInverse(this.modelViewMatrix),s.push("modelViewMatrixInverse")),o.modelViewMatrixInverseTranspose&&(o.modelViewMatrixInverse?o.modelViewMatrixInverseTranspose.value.copy(o.modelViewMatrixInverse.value).transpose():o.modelViewMatrixInverseTranspose.value.getInverse(this.modelViewMatrix).transpose(),s.push("modelViewMatrixInverseTranspose")),o.modelViewProjectionMatrix&&(o.modelViewProjectionMatrix.value.multiplyMatrices(n.projectionMatrix,this.modelViewMatrix),s.push("modelViewProjectionMatrix")),o.modelViewProjectionMatrixInverse&&(o.modelViewProjectionMatrix?(ty.copy(o.modelViewProjectionMatrix.value),o.modelViewProjectionMatrixInverse.value.getInverse(ty)):(ty.multiplyMatrices(n.projectionMatrix,this.modelViewMatrix),o.modelViewProjectionMatrixInverse.value.getInverse(ty)),s.push("modelViewProjectionMatrixInverse")),s.length)){const t=e.properties.get(r);if(t.program){const n=e.getContext(),i=t.program;n.useProgram(i.program);const r=i.getUniforms();s.forEach((function(e){r.setValue(n,e,o[e].value)}))}}}class iy{constructor(e){if(this.boundingBox=new ni,this.boundingBoxSize=new mn,this.boundingBoxLength=0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this.distVector=new mn,this.signals={ticked:new Sf.Signal,rendered:new Sf.Signal},"string"===typeof e){const t=document.getElementById(e);this.container=null===t?document.createElement("div"):t}else e instanceof HTMLElement?this.container=e:this.container=document.createElement("div");if(this.container===document.body)this.width=window.innerWidth||1,this.height=window.innerHeight||1;else{const e=this.container.getBoundingClientRect();this.width=e.width||1,this.height=e.height||1,this.container.style.overflow="hidden"}this.wrapper=document.createElement("div"),this.wrapper.style.position="relative",this.container.appendChild(this.wrapper),this._initParams(),this._initStats(),this._initCamera(),this._initScene(),!1!==this._initRenderer()?(this._initHelper(),this.setBackground(),this.setFog(),this.animate=this.animate.bind(this)):gm.error("Viewer: could not initialize renderer")}_initParams(){this.parameters={fogColor:new Ri(0),fogNear:50,fogFar:100,backgroundColor:new Ri(0),cameraType:"perspective",cameraFov:40,cameraEyeSep:.3,cameraZ:-80,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",lightColor:new Ri(14540253),lightIntensity:1,ambientColor:new Ri(14540253),ambientIntensity:.2,sampleLevel:0,rendererEncoding:Bt}}_initCamera(){const e=new mn(0,0,0),{width:t,height:n}=this;this.perspectiveCamera=new Gr(this.parameters.cameraFov,t/n),this.perspectiveCamera.position.z=this.parameters.cameraZ,this.perspectiveCamera.lookAt(e),this.orthographicCamera=new ph(t/-2,t/2,n/2,n/-2),this.orthographicCamera.position.z=this.parameters.cameraZ,this.orthographicCamera.lookAt(e),this.stereoCamera=new Vh,this.stereoCamera.aspect=.5,this.stereoCamera.eyeSep=this.parameters.cameraEyeSep;const i=this.parameters.cameraType;if("orthographic"===i)this.camera=this.orthographicCamera;else{if("perspective"!==i&&"stereo"!==i)throw new Error("Unknown cameraType '".concat(i,"'"));this.camera=this.perspectiveCamera}this.camera.updateProjectionMatrix()}_initStats(){this.stats=new rg}_initScene(){this.scene||(this.scene=new Gn,this.scene.name="scene"),this.rotationGroup=new fa,this.rotationGroup.name="rotationGroup",this.scene.add(this.rotationGroup),this.translationGroup=new fa,this.translationGroup.name="translationGroup",this.rotationGroup.add(this.translationGroup),this.modelGroup=new fa,this.modelGroup.name="modelGroup",this.translationGroup.add(this.modelGroup),this.pickingGroup=new fa,this.pickingGroup.name="pickingGroup",this.translationGroup.add(this.pickingGroup),this.backgroundGroup=new fa,this.backgroundGroup.name="backgroundGroup",this.translationGroup.add(this.backgroundGroup),this.helperGroup=new fa,this.helperGroup.name="helperGroup",this.translationGroup.add(this.helperGroup),this.scene.fog=new wa(this.parameters.fogColor.getHex()),this.spotLight=new uh(this.parameters.lightColor.getHex(),this.parameters.lightIntensity),this.scene.add(this.spotLight),this.ambientLight=new gh(this.parameters.ambientColor.getHex(),this.parameters.ambientIntensity),this.scene.add(this.ambientLight)}_initRenderer(){const t=window.devicePixelRatio,{width:n,height:i}=this;try{this.renderer=new va({preserveDrawingBuffer:!0,alpha:!0,antialias:!0})}catch(CD){return this.wrapper.innerHTML=xm,!1}this.renderer.setPixelRatio(t),this.renderer.setSize(n,i),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,this.renderer.outputEncoding=this.parameters.rendererEncoding;const r=this.renderer.getContext();this.renderer.capabilities.isWebGL2?(mm(!0),pm(this.renderer.extensions.get("EXT_color_buffer_float")),this.supportsHalfFloat=!0):(mm(this.renderer.extensions.get("EXT_frag_depth")),this.renderer.extensions.get("OES_element_index_uint"),pm(this.renderer.extensions.get("OES_texture_float")&&this.renderer.extensions.get("WEBGL_color_buffer_float")||this.renderer.extensions.get("OES_texture_float")&&Kg(r.FLOAT)),this.renderer.extensions.get("OES_texture_float"),this.supportsHalfFloat=this.renderer.extensions.get("OES_texture_half_float")&&Kg(36193)),this.wrapper.appendChild(this.renderer.domElement);const o=n*t,s=i*t;e.Debug&&console.log(JSON.stringify({Browser:cm,OES_texture_float:!!this.renderer.extensions.get("OES_texture_float"),OES_texture_half_float:!!this.renderer.extensions.get("OES_texture_half_float"),WEBGL_color_buffer_float:!!this.renderer.extensions.get("WEBGL_color_buffer_float"),"testTextureSupport Float":Kg(r.FLOAT),"testTextureSupport HalfFloat":Kg(36193),"this.supportsHalfFloat":this.supportsHalfFloat,SupportsReadPixelsFloat:dm},null,2)),this.pickingTarget=new un(o,s,{minFilter:le,magFilter:le,stencilBuffer:!1,format:Ee,type:dm?xe:fe}),this.pickingTarget.texture.generateMipmaps=!1,this.pickingTarget.texture.encoding=this.parameters.rendererEncoding,this.renderer.setRenderTarget(this.pickingTarget),this.renderer.clear(),this.renderer.setRenderTarget(null),this.sampleTarget=new un(o,s,{minFilter:he,magFilter:he,format:Ee}),this.sampleTarget.texture.encoding=this.parameters.rendererEncoding,this.holdTarget=new un(o,s,{minFilter:le,magFilter:le,format:Ee,type:fe}),this.holdTarget.texture.encoding=this.parameters.rendererEncoding,this.compositeUniforms={tForeground:new bd(this.sampleTarget.texture),scale:new bd(1)},this.compositeMaterial=new Ur({uniforms:this.compositeUniforms,vertexShader:lg("Quad.vert"),fragmentShader:lg("Quad.frag"),premultipliedAlpha:!0,transparent:!0,blending:m,depthTest:!1,depthWrite:!1}),this.compositeCamera=new ph(-1,1,1,-1,0,1),this.compositeScene=new Gn,this.compositeScene.name="compositeScene",this.compositeScene.add(new Ar(new eo(2,2),this.compositeMaterial))}_initHelper(){const e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),t=new Float32Array(24),n=new ar;n.setIndex(new Gi(e,1)),n.setAttribute("position",new Gi(t,3));const i=new Ur({uniforms:{uColor:{value:new Ri("skyblue")}},vertexShader:lg("BasicLine.vert"),fragmentShader:lg("BasicLine.frag")});this.boundingBoxMesh=new cl(n,i),this.helperGroup.add(this.boundingBoxMesh)}updateHelper(){const e=this.boundingBoxMesh.geometry.attributes.position,t=e.array,{min:n,max:i}=this.boundingBox;t[0]=i.x,t[1]=i.y,t[2]=i.z,t[3]=n.x,t[4]=i.y,t[5]=i.z,t[6]=n.x,t[7]=n.y,t[8]=i.z,t[9]=i.x,t[10]=n.y,t[11]=i.z,t[12]=i.x,t[13]=i.y,t[14]=n.z,t[15]=n.x,t[16]=i.y,t[17]=n.z,t[18]=n.x,t[19]=n.y,t[20]=n.z,t[21]=i.x,t[22]=n.y,t[23]=n.z,e.needsUpdate=!0,this.boundingBox.isEmpty()||this.boundingBoxMesh.geometry.computeBoundingSphere()}get cameraDistance(){return Math.abs(this.camera.position.z)}set cameraDistance(e){this.camera.position.z=-e}add(t,n){n?n.forEach((e=>this.addBuffer(t,e))):this.addBuffer(t),t.group.name="meshGroup",t.wireframeGroup.name="wireframeGroup",t.parameters.background?(this.backgroundGroup.add(t.group),this.backgroundGroup.add(t.wireframeGroup)):(this.modelGroup.add(t.group),this.modelGroup.add(t.wireframeGroup)),t.pickable&&this.pickingGroup.add(t.pickingGroup),e.Debug&&this.updateHelper()}addBuffer(e,t){function n(i){i instanceof fa?i.children.forEach(n):(i.userData.buffer=e,i.userData.instance=t,i.onBeforeRender=ny)}const i=e.getMesh();t&&i.applyMatrix4(t.matrix),n(i),e.group.add(i);const r=e.getWireframeMesh();if(t&&(r.matrix.copy(i.matrix),r.position.copy(i.position),r.quaternion.copy(i.quaternion),r.scale.copy(i.scale)),n(r),e.wireframeGroup.add(r),e.pickable){const r=e.getPickingMesh();t&&(r.matrix.copy(i.matrix),r.position.copy(i.position),r.quaternion.copy(i.quaternion),r.scale.copy(i.scale)),n(r),e.pickingGroup.add(r)}t?this._updateBoundingBox(e.geometry,e.matrix,t.matrix):this._updateBoundingBox(e.geometry,e.matrix)}remove(t){this.translationGroup.children.forEach((function(e){e.remove(t.group),e.remove(t.wireframeGroup)})),t.pickable&&this.pickingGroup.remove(t.pickingGroup),this.updateBoundingBox(),e.Debug&&this.updateHelper()}_updateBoundingBox(e,t,n){const i=this.boundingBox;function r(e,t,n){null==e.boundingBox&&e.computeBoundingBox();const r=e.boundingBox.clone();t&&r.applyMatrix4(t),n&&r.applyMatrix4(n),r.min.equals(r.max)&&r.expandByScalar(5),i.union(r)}function o(e){if(void 0!==e.geometry){let t,n;e.userData.buffer&&(t=e.userData.buffer.matrix),e.userData.instance&&(n=e.userData.instance.matrix),r(e.geometry,t,n)}}e?r(e,t,n):(i.makeEmpty(),this.modelGroup.traverse(o),this.backgroundGroup.traverse(o)),i.getSize(this.boundingBoxSize),this.boundingBoxLength=this.boundingBoxSize.length()}updateBoundingBox(){this._updateBoundingBox(),e.Debug&&this.updateHelper()}getPickingPixels(){const{width:e,height:t}=this,n=e*t*4,i=dm?new Float32Array(n):new Uint8Array(n);return this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,0,0,e,t,i),i}getImage(e){return new Promise((t=>{if(e){const{width:e,height:n}=this,i=e*n*4;let r=this.getPickingPixels();if(dm){const e=new Uint8Array(i);for(let t=0;t<i;++t)e[t]=Math.round(255*r[t]);r=e}const o=document.createElement("canvas");o.width=e,o.height=n;const s=o.getContext("2d"),a=s.getImageData(0,0,e,n);a.data.set(r),s.putImageData(a,0,0),o.toBlob(t,"image/png")}else this.renderer.domElement.toBlob(t,"image/png")}))}makeImage(){return Dg(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}setLight(e,t,n,i){const r=this.parameters;void 0!==e&&r.lightColor.set(e),void 0!==t&&(r.lightIntensity=t),void 0!==n&&r.ambientColor.set(n),void 0!==i&&(r.ambientIntensity=i),this.requestRender()}setFog(e,t,n){const i=this.parameters;void 0!==e&&i.fogColor.set(e),void 0!==t&&(i.fogNear=t),void 0!==n&&(i.fogFar=n),this.requestRender()}setBackground(e){const t=this.parameters;e&&t.backgroundColor.set(e),this.setFog(t.backgroundColor),this.renderer.setClearColor(t.backgroundColor,0),this.renderer.domElement.style.backgroundColor=t.backgroundColor.getStyle(),this.requestRender()}setSampling(e){void 0!==e&&(this.parameters.sampleLevel=e,this.sampleLevel=e),this.requestRender()}setOutputEncoding(e){this.parameters.rendererEncoding=e,this.renderer.outputEncoding=e,this.pickingTarget.texture.encoding=e,this.sampleTarget.texture.encoding=e,this.holdTarget.texture.encoding=e}setColorWorkflow(e){if("linear"!=e&&"sRGB"!=e)throw new Error("setColorWorkflow: invalid color workflow ".concat(e));yf("linear"==e?"linear":"sRGB"),this.setOutputEncoding("linear"==e?Ft:Bt),this.requestRender()}setCamera(e,t,n){const i=this.parameters;if(e&&(i.cameraType=e),t&&(i.cameraFov=t),n&&(i.cameraEyeSep=n),"orthographic"===i.cameraType)this.camera!==this.orthographicCamera&&(this.camera=this.orthographicCamera,this.camera.position.copy(this.perspectiveCamera.position),this.camera.up.copy(this.perspectiveCamera.up),this.updateZoom());else{if("perspective"!==i.cameraType&&"stereo"!==i.cameraType)throw new Error("Unknown cameraType '".concat(i.cameraType,"'"));this.camera!==this.perspectiveCamera&&(this.camera=this.perspectiveCamera,this.camera.position.copy(this.orthographicCamera.position),this.camera.up.copy(this.orthographicCamera.up))}this.perspectiveCamera.fov=i.cameraFov,this.stereoCamera.eyeSep=i.cameraEyeSep,this.camera.updateProjectionMatrix(),this.requestRender()}setClip(e,t,n,i,r){const o=this.parameters;void 0!==e&&(o.clipNear=e),void 0!==t&&(o.clipFar=t),void 0!==n&&(o.clipDist=n),void 0!==i&&(o.clipMode=i),void 0!==r&&(o.clipScale=r),this.requestRender()}setSize(e,t){this.width=e||1,this.height=t||1,this.perspectiveCamera.aspect=this.width/this.height,this.orthographicCamera.left=-this.width/2,this.orthographicCamera.right=this.width/2,this.orthographicCamera.top=this.height/2,this.orthographicCamera.bottom=-this.height/2,this.camera.updateProjectionMatrix();const n=window.devicePixelRatio;this.renderer.setPixelRatio(n),this.renderer.setSize(e,t);const i=this.width*n,r=this.height*n;this.pickingTarget.setSize(i,r),this.sampleTarget.setSize(i,r),this.holdTarget.setSize(i,r),this.requestRender()}handleResize(){if(this.container===document.body)this.setSize(window.innerWidth,window.innerHeight);else{const e=this.container.getBoundingClientRect();this.setSize(e.width,e.height)}}updateInfo(e){const{memory:t,render:n}=this.info;if(e)t.programs=0,t.geometries=0,t.textures=0,n.calls=0,n.vertices=0,n.points=0;else{const e=this.renderer.info,i=e.memory,r=e.render;t.geometries=i.geometries,t.textures=i.textures,n.calls+=r.calls,n.faces+=r.triangles,n.points+=r.points}}animate(){if(this.signals.ticked.dispatch(this.stats),window.performance.now()-this.stats.startTime>500&&!this.isStill&&this.sampleLevel<3&&-1!==this.sampleLevel){const t=this.sampleLevel;this.sampleLevel=3,this.renderPending=!0,this.render(),this.isStill=!0,this.sampleLevel=t,e.Debug&&gm.log("rendered still frame")}this.frameRequest=window.requestAnimationFrame(this.animate)}pick(e,t){if("stereo"===this.parameters.cameraType)return{pid:0,instance:void 0,picker:void 0};e*=window.devicePixelRatio,t*=window.devicePixelRatio,e=Math.max(e-2,0),t=Math.max(t-2,0);let n,i,r=0;const o=dm?Qg:Jg;this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,e,t,5,5,o);for(let s=0;s<ey.length;s++){const e=4*ey[s],t=Math.round(o[e+3]),a=this.pickingGroup.getObjectById(t);a&&(n=a.userData.instance,i=a.userData.buffer.picking,r=dm?Math.round(255*o[e])<<16&16711680|Math.round(255*o[e+1])<<8&65280|255&Math.round(255*o[e+2]):o[e]<<16|o[e+1]<<8|o[e+2])}return{pid:r,instance:n,picker:i}}requestRender(){this.renderPending||(window.performance.now()-this.stats.startTime>22&&(this.stats.begin(),this.isStill=!1),this.renderPending=!0,window.requestAnimationFrame((()=>{this.render(),this.stats.update()})))}updateZoom(){const e=Qp(this.perspectiveCamera.fov),t=2*Math.tan(e/2)*this.cameraDistance;this.orthographicCamera.zoom=this.height/t}absoluteToRelative(e){return 50*(1-e/this.bRadius)}relativeToAbsolute(e){return this.bRadius*(1-e/50)}__updateClipping(){const e=this.parameters;this.bRadius=Math.max(10,.5*this.boundingBoxLength),isFinite(this.bRadius)||(this.bRadius=50),this.camera.getWorldPosition(this.distVector),this.cDist=this.distVector.length(),this.cDist||(this.cameraDistance=Math.abs(e.cameraZ),this.cDist=Math.abs(e.cameraZ));const t=this.scene.fog;if(t.color.set(e.fogColor),"camera"===e.clipMode)this.camera.near=e.clipNear,this.camera.far=e.clipFar,t.near=e.fogNear,t.far=e.fogFar;else if("absolute"===e.clipScale)this.camera.near=this.cDist-e.clipNear,this.camera.far=this.cDist+e.clipFar,t.near=this.cDist-e.fogNear,t.far=this.cDist+e.fogFar;else{const n=(50-e.clipNear)/50,i=-(50-e.clipFar)/50;this.camera.near=this.cDist-this.bRadius*n,this.camera.far=this.cDist+this.bRadius*i;const r=(50-e.fogNear)/50,o=-(50-e.fogFar)/50;t.near=this.cDist-this.bRadius*r,t.far=this.cDist+this.bRadius*o}"camera"!==e.clipMode&&("PerspectiveCamera"===this.camera.type?(this.camera.near=Math.max(.1,e.clipDist,this.camera.near),this.camera.far=Math.max(1,this.camera.far),t.near=Math.max(.1,t.near),t.far=Math.max(1,t.far)):"OrthographicCamera"===this.camera.type&&e.clipDist>0&&(this.camera.near=Math.max(e.clipDist,this.camera.near)))}__updateCamera(){const e=this.camera;e.updateMatrix(),e.updateMatrixWorld(!0),e.updateProjectionMatrix(),Gg(this.scene,e,this.renderer,this.cDist,this.bRadius),Fg(this.scene,e)}__setVisibility(e,t,n,i){this.modelGroup.visible=e,this.pickingGroup.visible=t,this.backgroundGroup.visible=n,this.helperGroup.visible=i}__updateLights(){this.spotLight.color.set(this.parameters.lightColor),this.spotLight.intensity=this.parameters.lightIntensity,this.distVector.copy(this.camera.position).setLength(100*this.boundingBoxLength),this.spotLight.position.copy(this.camera.position).add(this.distVector),this.ambientLight.color.set(this.parameters.ambientColor),this.ambientLight.intensity=this.parameters.ambientIntensity}__renderPickingGroup(e){this.renderer.setRenderTarget(this.pickingTarget||null),this.renderer.clear(),this.__setVisibility(!1,!0,!1,!1),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()}__renderModelGroup(t,n){this.renderer.setRenderTarget(n||null),this.renderer.clear(),this.__setVisibility(!1,!1,!0,!1),this.renderer.render(this.scene,t),this.renderer.clear(!1,!0,!0),this.updateInfo(),this.__setVisibility(!0,!1,!1,e.Debug),this.renderer.render(this.scene,t),this.renderer.setRenderTarget(null),this.updateInfo()}__renderSuperSample(e,t){const n=cg[Math.max(0,Math.min(this.sampleLevel,5))],i=1/n.length,r=1/32;this.compositeUniforms.tForeground.value=this.sampleTarget.texture;let o=this.sampleTarget.width;const s=this.sampleTarget.height;"stereo"===this.parameters.cameraType&&(o/=2);for(let a=0;a<n.length;++a){const t=n[a];e.setViewOffset(o,s,t[0],t[1],o,s),e.updateProjectionMatrix(),Vg(this.scene,e);let l=i;l+=r*((a+.5)/n.length-.5),this.compositeUniforms.scale.value=l,this.__renderModelGroup(e,this.sampleTarget),this.renderer.setRenderTarget(this.holdTarget),0===a&&this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}this.compositeUniforms.scale.value=1,this.compositeUniforms.tForeground.value=this.holdTarget.texture,e.clearViewOffset(),this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}__renderStereo(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.stereoCamera;t.update(this.perspectiveCamera);const n=this.renderer;let i=new nn;n.getSize(i),n.setScissorTest(!0),n.setScissor(0,0,i.width/2,i.height),n.setViewport(0,0,i.width/2,i.height),Vg(this.scene,t.cameraL),this.__render(e,t.cameraL),n.setScissor(i.width/2,0,i.width/2,i.height),n.setViewport(i.width/2,0,i.width/2,i.height),Vg(this.scene,t.cameraR),this.__render(e,t.cameraR),n.setScissorTest(!1),n.setViewport(0,0,i.width,i.height)}__render(){let e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.lastRenderedPicking||this.__renderPickingGroup(e):this.sampleLevel>0&&"stereo"!==this.parameters.cameraType?this.__renderSuperSample(e,t):this.__renderModelGroup(e,t)}render(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(this.rendering)gm.warn("'tried to call 'render' from within 'render'");else{this.rendering=!0;try{this.__updateClipping(),this.__updateCamera(),this.__updateLights(),this.updateInfo(!0),"stereo"===this.parameters.cameraType?this.__renderStereo(e,t):this.__render(e,this.camera,t),this.lastRenderedPicking=e}finally{this.rendering=!1,this.renderPending=!1}this.signals.rendered.dispatch()}}clear(){gm.log("scene cleared"),this.scene.remove(this.rotationGroup),this._initScene(),this.renderer.clear()}dispose(){this.renderer.dispose(),window.cancelAnimationFrame(this.frameRequest)}}const ry=1,oy=2,sy=3;function ay(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;return Math.sqrt(t*t+n*n)}function ly(e){if("object"===typeof e){if("buttons"in e)return e.buttons;if("which"in e){const t=e.which;if(2===t)return 4;if(3===t)return 2;if(t>0)return 1<<t-1}else if("button"in e){const t=e.button;if(1===t)return 4;if(2===t)return 2;if(t>=0)return 1<<t}}return 0}class cy{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.domElement=e,this.signals={moved:new Sf.Signal,scrolled:new Sf.Signal,dragged:new Sf.Signal,dropped:new Sf.Signal,clicked:new Sf.Signal,hovered:new Sf.Signal,doubleClicked:new Sf.Signal},this.position=new nn,this.prevPosition=new nn,this.down=new nn,this.canvasPosition=new nn,this.prevClickCP=new nn,this.moving=!1,this.hovering=!0,this.scrolled=!1,this.lastMoved=1/0,this.which=0,this.buttons=0,this.pressed=!1,this.altKey=!1,this.ctrlKey=!1,this.metaKey=!1,this.shiftKey=!1,this.domElement.style.touchAction="none",this.hoverTimeout=bp(t.hoverTimeout,50),this.handleScroll=bp(t.handleScroll,!0),this.doubleClickSpeed=bp(t.doubleClickSpeed,500),this._listen=this._listen.bind(this),this._onMousewheel=this._onMousewheel.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMousedown=this._onMousedown.bind(this),this._onMouseup=this._onMouseup.bind(this),this._onContextmenu=this._onContextmenu.bind(this),this._onTouchstart=this._onTouchstart.bind(this),this._onTouchend=this._onTouchend.bind(this),this._onTouchmove=this._onTouchmove.bind(this),this._listen();const n={passive:!1};document.addEventListener("mousewheel",this._onMousewheel,n),document.addEventListener("wheel",this._onMousewheel,n),document.addEventListener("MozMousePixelScroll",this._onMousewheel,n),document.addEventListener("mousemove",this._onMousemove,n),document.addEventListener("mousedown",this._onMousedown,n),document.addEventListener("mouseup",this._onMouseup,n),document.addEventListener("contextmenu",this._onContextmenu,n),document.addEventListener("touchstart",this._onTouchstart,n),document.addEventListener("touchend",this._onTouchend,n),document.addEventListener("touchmove",this._onTouchmove,n)}get key(){let e=0;return this.altKey&&(e+=1),this.ctrlKey&&(e+=2),this.metaKey&&(e+=4),this.shiftKey&&(e+=8),e}setParameters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.hoverTimeout=bp(e.hoverTimeout,this.hoverTimeout)}_listen(){const e=window.performance.now(),t=this.canvasPosition;this.doubleClickPending&&e-this.lastClicked>this.doubleClickSpeed&&(this.doubleClickPending=!1),e-this.lastMoved>this.hoverTimeout&&(this.moving=!1),(this.scrolled||!this.moving&&!this.hovering)&&(this.scrolled=!1,-1!==this.hoverTimeout&&this.overElement&&(this.hovering=!0,this.signals.hovered.dispatch(t.x,t.y))),this.frameRequest=window.requestAnimationFrame(this._listen)}_onMousewheel(e){if(e.target!==this.domElement||!this.handleScroll)return;e.preventDefault(),this._setKeys(e);let t=0;"deltaY"in e&&"deltaMode"in e&&void 0!==e.deltaY&&void 0!==e.deltaMode?t=e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?.025*-e.deltaY:e.deltaMode===WheelEvent.DOM_DELTA_LINE?-e.deltaY*(2.5/3):2.5*-e.deltaY:"deltaY"in e&&!("detail"in e)?t=.025*-e.deltaY:void 0!==e.wheelDelta?t=.025*-e.wheelDelta:void 0!==e.wheelDeltaY?t=.025*-e.wheelDeltaY:void 0!==e.detail&&(t=-e.detail/3),this.signals.scrolled.dispatch(t),setTimeout((()=>{this.scrolled=!0}),this.hoverTimeout)}_onMousemove(e){e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,this._setKeys(e),this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.clientX,e.clientY),this._setCanvasPosition(e);const t=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,n),this.pressed&&this.signals.dragged.dispatch(t,n)}_onMousedown(e){e.target===this.domElement&&(e.preventDefault(),this._setKeys(e),this.moving=!1,this.hovering=!1,this.down.set(e.clientX,e.clientY),this.position.set(e.clientX,e.clientY),this.which=e.which,this.buttons=ly(e),this.pressed=!0,this._setCanvasPosition(e))}_onMouseup(e){e.target===this.domElement&&e.preventDefault(),this._setKeys(e);const t=this.canvasPosition;this._distance()<4&&(this.lastClicked=window.performance.now(),this.doubleClickPending&&this.prevClickCP.distanceTo(t)<4&&(this.signals.doubleClicked.dispatch(t.x,t.y),this.doubleClickPending=!1),this.signals.clicked.dispatch(t.x,t.y),this.doubleClickPending=!0,this.prevClickCP.copy(t)),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onContextmenu(e){e.target===this.domElement&&e.preventDefault()}_onTouchstart(e){if(e.target===this.domElement)switch(e.preventDefault(),this.pressed=!0,e.touches.length){case 1:this.moving=!1,this.hovering=!1,this.down.set(e.touches[0].pageX,e.touches[0].pageY),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);break;case 2:this.down.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.lastTouchDistance=ay(e)}}_onTouchend(e){e.target===this.domElement&&e.preventDefault(),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onTouchmove(e){switch(e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,e.touches.length){case 1:{this._setKeys(e),this.which=ry,this.buttons=1,this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);const t=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,n),this.pressed&&this.signals.dragged.dispatch(t,n);break}case 2:{const t=ay(e),n=t-this.lastTouchDistance;if(this.lastTouchDistance=t,this.prevPosition.copy(this.position),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),Math.abs(n)>2&&this.handleScroll&&this.position.distanceTo(this.prevPosition)<2)this.which=0,this.buttons=0,this.signals.scrolled.dispatch(n/2);else{this.which=sy,this.buttons=2;const e=this.prevPosition.x-this.position.x,t=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(e,t),this.pressed&&this.signals.dragged.dispatch(e,t)}}}}_distance(){return this.position.distanceTo(this.down)}_setCanvasPosition(e){const t=this.domElement.getBoundingClientRect();let n,i;"clientX"in e&&"clientY"in e?(n=e.clientX-t.left,i=e.clientY-t.top):(n=e.offsetX,i=e.offsetY),this.canvasPosition.set(n,t.height-i)}_setKeys(e){this.altKey=e.altKey,this.ctrlKey=e.ctrlKey,this.metaKey=e.metaKey,this.shiftKey=e.shiftKey}dispose(){document.removeEventListener("mousewheel",this._onMousewheel),document.removeEventListener("wheel",this._onMousewheel),document.removeEventListener("MozMousePixelScroll",this._onMousewheel),document.removeEventListener("mousemove",this._onMousemove),document.removeEventListener("mousedown",this._onMousedown),document.removeEventListener("mouseup",this._onMouseup),document.removeEventListener("contextmenu",this._onContextmenu),document.removeEventListener("touchstart",this._onTouchstart),document.removeEventListener("touchend",this._onTouchend),document.removeEventListener("touchmove",this._onTouchmove),window.cancelAnimationFrame(this.frameRequest)}}const uy=new Sn,hy=new Sn,dy=new Sn,py=new Sn,fy=new Sn,my=new mn,gy=new dn,yy=new dn,vy=new Sn,by=new mn,xy=new mn;class wy{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.stage=e,this.rotateSpeed=bp(t.rotateSpeed,2),this.zoomSpeed=bp(t.zoomSpeed,1.2),this.panSpeed=bp(t.panSpeed,1),this.viewer=e.viewer,this.mouse=e.mouseObserver,this.controls=e.viewerControls}get component(){return this.stage.transformComponent}get atom(){return this.stage.transformAtom}_setPanVector(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=this.controls.getCanvasScaleFactor(n);by.set(e,t,0),by.multiplyScalar(this.panSpeed*i)}_getRotateXY(e,t){return[this.rotateSpeed*-e*.01,this.rotateSpeed*t*.01]}_getCameraRotation(e){return e.extractRotation(this.viewer.camera.matrixWorld),e.multiply(hy.makeRotationY(Math.PI)),e}_transformPanVector(){this.component&&(vy.extractRotation(this.component.transform),vy.premultiply(this.viewer.rotationGroup.matrix),vy.getInverse(vy),vy.multiply(this._getCameraRotation(py)),by.applyMatrix4(vy))}zoom(e){this.controls.zoom(this.zoomSpeed*e*.02)}pan(e,t){this._setPanVector(e,t),vy.getInverse(this.viewer.rotationGroup.matrix),vy.multiply(this._getCameraRotation(py)),by.applyMatrix4(vy),this.controls.translate(by)}panComponent(e,t){this.component&&(this._setPanVector(e,t),this._transformPanVector(),this.component.position.add(by),this.component.updateMatrix())}panAtom(e,t){this.atom&&this.component&&(this.atom.positionToVector3(xy),xy.add(this.viewer.translationGroup.position),xy.applyMatrix4(this.viewer.rotationGroup.matrix),this._setPanVector(e,t,xy.z),this._transformPanVector(),this.atom.positionAdd(by),this.component.updateRepresentations({position:!0}))}rotate(e,t){const[n,i]=this._getRotateXY(e,t);this._getCameraRotation(py),my.set(1,0,0),my.applyMatrix4(py),gy.setFromAxisAngle(my,i),my.set(0,1,0),my.applyMatrix4(py),yy.setFromAxisAngle(my,n),gy.multiply(yy),py.makeRotationFromQuaternion(gy),this.controls.applyMatrix(py)}zRotate(e,t){const n=this.rotateSpeed*((-e+t)/-2)*.01;dy.makeRotationZ(n),this.controls.applyMatrix(dy)}rotateComponent(e,t){if(!this.component)return;const[n,i]=this._getRotateXY(e,t);this._getCameraRotation(fy),py.extractRotation(this.component.transform),py.premultiply(this.viewer.rotationGroup.matrix),py.getInverse(py),py.premultiply(fy),my.set(1,0,0),my.applyMatrix4(py),uy.makeRotationAxis(my,i),my.set(0,1,0),my.applyMatrix4(py),hy.makeRotationAxis(my,n),uy.multiply(hy),gy.setFromRotationMatrix(uy),this.component.quaternion.premultiply(gy),this.component.quaternion.normalize(),this.component.updateMatrix()}}const _y=new mn;function Sy(e,t,n){return e.distanceTo(t)<e.distanceTo(n)}class My{constructor(e,t){this.stage=t,this.pid=e.pid,this.picker=e.picker,this.instance=e.instance,this.stage=t,this.controls=t.viewerControls,this.mouse=t.mouseObserver}get type(){return this.picker.type}get altKey(){return this.mouse.altKey}get ctrlKey(){return this.mouse.ctrlKey}get metaKey(){return this.mouse.metaKey}get shiftKey(){return this.mouse.shiftKey}get canvasPosition(){return this.mouse.canvasPosition}get component(){return this.stage.getComponentsByObject(this.picker.data).list[0]}get object(){return this.picker.getObject(this.pid)}get position(){return this.picker.getPosition(this.pid,this.instance,this.component)}get closestBondAtom(){if("bond"!==this.type||!this.bond)return;const e=this.bond,t=this.controls,n=this.canvasPosition,i=e.atom1.positionToVector3(),r=e.atom2.positionToVector3();return i.applyMatrix4(this.component.matrix),r.applyMatrix4(this.component.matrix),Sy(n,t.getPositionOnCanvas(i),t.getPositionOnCanvas(r))?e.atom1:e.atom2}get closeAtom(){const e=this.canvasPosition,t=this.closestBondAtom;if(!t)return;const n=t.positionToVector3().applyMatrix4(this.component.matrix),i=this.controls.getPositionOnCanvas(n);t.positionToVector3(_y),this.instance&&_y.applyMatrix4(this.instance.matrix),_y.applyMatrix4(this.component.matrix);const r=this.controls.viewer;_y.add(r.translationGroup.position),_y.applyMatrix4(r.rotationGroup.matrix);const o=this.controls.getCanvasScaleFactor(_y.z),s=this.component.getMaxRepresentationRadius(t.index);return e.distanceTo(i)<=s/o?t:void 0}get arrow(){return this._objectIfType("arrow")}get atom(){return this._objectIfType("atom")}get axes(){return this._objectIfType("axes")}get bond(){return this._objectIfType("bond")}get box(){return this._objectIfType("box")}get cone(){return this._objectIfType("cone")}get clash(){return this._objectIfType("clash")}get contact(){return this._objectIfType("contact")}get cylinder(){return this._objectIfType("cylinder")}get distance(){return this._objectIfType("distance")}get ellipsoid(){return this._objectIfType("ellipsoid")}get octahedron(){return this._objectIfType("octahedron")}get point(){return this._objectIfType("point")}get mesh(){return this._objectIfType("mesh")}get slice(){return this._objectIfType("slice")}get sphere(){return this._objectIfType("sphere")}get tetrahedron(){return this._objectIfType("tetrahedron")}get torus(){return this._objectIfType("torus")}get surface(){return this._objectIfType("surface")}get unitcell(){return this._objectIfType("unitcell")}get unknown(){return this._objectIfType("unknown")}get volume(){return this._objectIfType("volume")}get wideline(){return this._objectIfType("wideline")}_objectIfType(e){return this.type===e?this.object:void 0}getLabel(){const e=this.atom||this.closeAtom;let t="nothing";return this.arrow?t=this.arrow.name:e?t="atom: ".concat(e.qualifiedName()," (").concat(e.structure.name,")"):this.axes?t="axes":this.bond?t="bond: ".concat(this.bond.atom1.qualifiedName()," - ").concat(this.bond.atom2.qualifiedName()," (").concat(this.bond.structure.name,")"):this.box?t=this.box.name:this.cone?t=this.cone.name:this.clash?t="clash: ".concat(this.clash.clash.sele1," - ").concat(this.clash.clash.sele2):this.contact?t="".concat(this.contact.type,": ").concat(this.contact.atom1.qualifiedName()," - ").concat(this.contact.atom2.qualifiedName()," (").concat(this.contact.atom1.structure.name,")"):this.cylinder?t=this.cylinder.name:this.distance?t="distance: ".concat(this.distance.atom1.qualifiedName()," - ").concat(this.distance.atom2.qualifiedName()," (").concat(this.distance.structure.name,")"):this.ellipsoid?t=this.ellipsoid.name:this.octahedron?t=this.octahedron.name:this.point?t=this.point.name:this.mesh?t="mesh: ".concat(this.mesh.name||this.mesh.serial," (").concat(this.mesh.shape.name,")"):this.slice?t="slice: ".concat(this.slice.value.toPrecision(3)," (").concat(this.slice.volume.name,")"):this.sphere?t=this.sphere.name:this.surface?t="surface: ".concat(this.surface.surface.name):this.tetrahedron?t=this.tetrahedron.name:this.torus?t=this.torus.name:this.unitcell?t="unitcell: ".concat(this.unitcell.unitcell.spacegroup," (").concat(this.unitcell.structure.name,")"):this.unknown?t="unknown":this.volume?t="volume: ".concat(this.volume.value.toPrecision(3)," (").concat(this.volume.volume.name,")"):this.wideline&&(t=this.wideline.name),t}}class Ay{constructor(e){this.stage=e,this.viewer=e.viewer}pick(e,t){const n=this.viewer.pick(e,t);if(n.picker&&"ignore"!==n.picker.type&&void 0!==n.pid){const e=n.picker.array;if(!(e&&n.pid>=e.length))return new My(n,this.stage);console.error("pid >= picker.array.length")}}}const Cy=new dn,Ty=new mn,Ey=new mn,Py=new mn,Iy=new mn,Ly=new Sn,Ry=new mn,ky=new Sn;class Dy{constructor(e){this.stage=e,this.signals={changed:new Sf.Signal},this.viewer=e.viewer}get position(){return this.viewer.translationGroup.position}get rotation(){return this.viewer.rotationGroup.quaternion}changed(){this.viewer.requestRender(),this.signals.changed.dispatch()}getPositionOnCanvas(e,t){const n=Vp(t),i=this.viewer;return Py.copy(e).add(i.translationGroup.position).applyMatrix4(i.rotationGroup.matrix).project(i.camera),n.set((Py.x+1)*i.width/2,(Py.y+1)*i.height/2)}getCanvasScaleFactor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this.viewer.camera;if(t instanceof ph)return 1/t.zoom;{e=Math.abs(e),e+=this.getCameraDistance();const n=Qp(t.fov);return 2*e*Math.tan(n/2)/this.viewer.height}}getOrientation(e){const t=$p(e);t.copy(this.viewer.rotationGroup.matrix);const n=this.getCameraDistance();return t.scale(Iy.set(n,n,n)),t.setPosition(this.viewer.translationGroup.position),t}orient(e){$p(e).decompose(Ty,Cy,Ey);const t=this.viewer;t.rotationGroup.setRotationFromQuaternion(Cy),t.translationGroup.position.copy(Ty),t.cameraDistance=Ey.z,t.updateZoom(),this.changed()}translate(e){this.viewer.translationGroup.position.add(jp(e)),this.changed()}center(e){this.viewer.translationGroup.position.copy(jp(e)).negate(),this.changed()}zoom(e){this.distance(this.getCameraDistance()*(1-e))}getCameraDistance(){return this.viewer.cameraDistance}distance(e){this.viewer.cameraDistance=Math.max(Math.abs(e),.2),this.viewer.updateZoom(),this.changed()}spin(e,t){Ly.getInverse(this.viewer.rotationGroup.matrix),Ry.copy(jp(e)).applyMatrix4(Ly),this.viewer.rotationGroup.rotateOnAxis(Ry,t),this.changed()}rotate(e){this.viewer.rotationGroup.setRotationFromQuaternion(Wp(e)),this.changed()}align(e){ky.getInverse($p(e)),this.viewer.rotationGroup.setRotationFromMatrix(ky),this.changed()}applyMatrix(e){this.viewer.rotationGroup.applyMatrix4($p(e)),this.changed()}}class Oy{constructor(e,t){this.pausedTime=-1,this.elapsedDuration=0,this.pausedDuration=0,this.ignoreGlobalToggle=!1,this._paused=!1,this._resolveList=[],this.duration=bp(e,1e3),this.controls=t,this.startTime=window.performance.now();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];this._init(...i)}get done(){return 1===this.alpha}get paused(){return this._paused}tick(e){if(!this._paused)return this.elapsedDuration=e.currentTime-this.startTime-this.pausedDuration,0===this.duration?this.alpha=1:this.alpha=hf(0,1,this.elapsedDuration/this.duration),this._tick(e),this.done&&this._resolveList.forEach((e=>e())),this.done}pause(e){e&&(this._hold=!0),-1===this.pausedTime&&(this.pausedTime=window.performance.now()),this._paused=!0}resume(e){!e&&this._hold||(this.pausedDuration+=window.performance.now()-this.pausedTime,this._paused=!1,this._hold=!1,this.pausedTime=-1)}toggle(){this._paused?this.resume():this.pause()}then(e){let t;return t=this.done?Promise.resolve():new Promise((e=>this._resolveList.push(e))),t.then(e)}}class Ny extends Oy{constructor(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];super(bp(e,1/0),t,...i)}_init(e,t){Array.isArray(e)?this.axis=(new mn).fromArray(e):this.axis=bp(e,new mn(0,1,0)),this.angle=bp(t,.01)}_tick(e){this.axis&&this.angle&&this.controls.spin(this.axis,this.angle*e.lastDuration/16)}}class By extends Oy{constructor(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];super(bp(e,1/0),t,...i),this.angleSum=0,this.direction=1}_init(e,t,n){Array.isArray(e)?this.axis=(new mn).fromArray(e):this.axis=bp(e,new mn(0,1,0)),this.angleStep=bp(t,.01),this.angleEnd=bp(n,.2)}_tick(e){if(!this.axis||!this.angleStep||!this.angleEnd)return;const t=hf(0,1,Math.abs(this.angleSum)/this.angleEnd),n=this.angleStep*this.direction*(1.1-t);this.controls.spin(this.axis,n*e.lastDuration/16),this.angleSum+=this.angleStep,this.angleSum>=this.angleEnd&&(this.direction*=-1,this.angleSum=-this.angleEnd)}}class Fy extends Oy{_init(e,t){this.moveFrom=jp(bp(e,new mn)),this.moveTo=jp(bp(t,new mn))}_tick(){this.controls.position.lerpVectors(this.moveFrom,this.moveTo,this.alpha).negate(),this.controls.changed()}}class zy extends Oy{_init(e,t){this.zoomFrom=e,this.zoomTo=t}_tick(){this.controls.distance(cf(this.zoomFrom,this.zoomTo,this.alpha))}}class Uy extends Oy{constructor(){super(...arguments),this._currentRotation=new dn}_init(e,t){this.rotateFrom=Wp(e),this.rotateTo=Wp(t),this._currentRotation=new dn}_tick(){this._currentRotation.copy(this.rotateFrom).slerp(this.rotateTo,this.alpha),this.controls.rotate(this._currentRotation)}}class Hy extends Oy{_init(e,t,n){this.valueFrom=e,this.valueTo=t,this.callback=n}_tick(){this.callback(cf(this.valueFrom,this.valueTo,this.alpha))}}class Gy extends Oy{_init(e){this.callback=e}_tick(){1===this.alpha&&this.callback()}}class Vy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._resolveList=[],this._list=e}get done(){return this._list.every((e=>e.done))}then(e){let t;return t=this.done?Promise.resolve():new Promise((e=>{this._resolveList.push(e),this._list.forEach((e=>{e.then((()=>{this._resolveList.forEach((e=>{e()})),this._resolveList.length=0}))}))})),t.then(e)}}class jy{constructor(e){this.stage=e,this.animationList=[],this.finishedList=[],this.viewer=e.viewer,this.controls=e.viewerControls}get paused(){return this.animationList.every((e=>e.paused))}add(e){return 0===e.duration?e.tick(this.viewer.stats):this.animationList.push(e),e}remove(e){const t=this.animationList,n=t.indexOf(e);n>-1&&t.splice(n,1)}run(e){const t=this.finishedList,n=this.animationList,i=n.length;for(let o=0;o<i;++o){const i=n[o];i.tick(e)&&t.push(i)}const r=t.length;if(r){for(let e=0;e<r;++e)this.remove(t[e]);t.length=0}}spin(e,t,n){return this.add(new Ny(n,this.controls,e,t))}rock(e,t,n,i){return this.add(new By(i,this.controls,e,t,n))}rotate(e,t){const n=this.viewer.rotationGroup.quaternion.clone();return this.add(new Uy(t,this.controls,n,e))}move(e,t){const n=this.controls.position.clone().negate();return this.add(new Fy(t,this.controls,n,e))}zoom(e,t){const n=this.viewer.camera.position.z;return this.add(new zy(t,this.controls,n,e))}zoomMove(e,t,n){return new Vy([this.move(e,n),this.zoom(t,n)])}orient(e,t){const n=new mn,i=new dn,r=new mn;return $p(e).decompose(n,i,r),new Vy([this.move(n.negate(),t),this.rotate(i,t),this.zoom(-r.x,t)])}value(e,t,n,i){return this.add(new Hy(i,this.controls,e,t,n))}timeout(e,t){return this.add(new Gy(t,this.controls,e))}spinComponent(e,t,n,i){return this.add(new Ny(i,e.controls,t,n))}rockComponent(e,t,n,i,r){return this.add(new By(r,e.controls,t,n,i))}moveComponent(e,t,n){const i=e.controls.position.clone().negate();return this.add(new Fy(n,e.controls,i,t))}pause(){this.animationList.forEach((e=>e.pause()))}resume(){this.animationList.forEach((e=>e.resume()))}toggle(){this.paused?this.resume():this.pause()}clear(){this.animationList.length=0}dispose(){this.clear()}}class $y{constructor(e,t){if(this.fn=e,this.queue=[],this.pending=!1,this.next=this.next.bind(this),t){for(let e=0,n=t.length;e<n;++e)this.queue.push(t[e]);this.next()}}run(e){this.fn(e,this.next)}next(){const e=this.queue.shift();void 0!==e?(this.pending=!0,setTimeout((()=>this.run(e)))):this.pending=!1}push(e){this.queue.push(e),this.pending||this.next()}kill(){this.queue.length=0}length(){return this.queue.length}}class Wy{constructor(e,t,n){this.type="",this.parameters={lazy:{type:"boolean"},clipNear:{type:"range",step:1,max:100,min:0,buffer:!0},clipRadius:{type:"number",precision:1,max:1e3,min:0,buffer:!0},clipCenter:{type:"vector3",precision:1,buffer:!0},flatShaded:{type:"boolean",buffer:!0},opacity:{type:"range",step:.01,max:1,min:0,buffer:!0},depthWrite:{type:"boolean",buffer:!0},side:{type:"select",buffer:!0,options:{front:"front",back:"back",double:"double"}},wireframe:{type:"boolean",buffer:!0},colorData:{type:"hidden",update:"color"},colorScheme:{type:"select",update:"color",options:{}},colorScale:{type:"select",update:"color",options:Sm.getScales()},colorReverse:{type:"boolean",update:"color"},colorValue:{type:"color",update:"color"},colorDomain:{type:"hidden",update:"color"},colorMode:{type:"select",update:"color",options:Sm.getModes()},roughness:{type:"range",step:.01,max:1,min:0,buffer:!0},metalness:{type:"range",step:.01,max:1,min:0,buffer:!0},diffuse:{type:"color",buffer:!0},diffuseInterior:{type:"boolean",buffer:!0},useInteriorColor:{type:"boolean",buffer:!0},interiorColor:{type:"color",buffer:!0},interiorDarkening:{type:"range",step:.01,max:1,min:0,buffer:!0},matrix:{type:"hidden",buffer:!0},disablePicking:{type:"boolean",rebuild:!0}},this.viewer=t,this.tasks=new ig,this.queue=new $y(this.make.bind(this)),this.bufferList=[],this.parameters.colorScheme&&(this.parameters.colorScheme.options=Sm.getSchemes()),this.toBePrepared=!1}init(e){const t=e||{};this.clipNear=bp(t.clipNear,0),this.clipRadius=bp(t.clipRadius,0),this.clipCenter=bp(t.clipCenter,new mn),this.flatShaded=bp(t.flatShaded,!1),this.side=bp(t.side,"double"),this.opacity=bp(t.opacity,1),this.depthWrite=bp(t.depthWrite,!0),this.wireframe=bp(t.wireframe,!1),this.setColor(t.color,t),this.colorData=bp(t.colorData,void 0),this.colorScheme=bp(t.colorScheme,"uniform"),this.colorScale=bp(t.colorScale,""),this.colorReverse=bp(t.colorReverse,!1),this.colorValue=bp(t.colorValue,9474192),this.colorDomain=bp(t.colorDomain,void 0),this.colorMode=bp(t.colorMode,"hcl"),this.visible=bp(t.visible,!0),this.quality=bp(t.quality,void 0),this.roughness=bp(t.roughness,.4),this.metalness=bp(t.metalness,0),this.diffuse=bp(t.diffuse,16777215),this.diffuseInterior=bp(t.diffuseInterior,!1),this.useInteriorColor=bp(t.useInteriorColor,!1),this.interiorColor=bp(t.interiorColor,2236962),this.interiorDarkening=bp(t.interiorDarkening,0),this.lazy=bp(t.lazy,!1),this.lazyProps={build:!1,bufferParams:{},what:{}},this.matrix=bp(t.matrix,new Sn),this.disablePicking=bp(t.disablePicking,!1);const n=this.parameters;!0===n.sphereDetail&&(n.sphereDetail={type:"integer",max:3,min:0,rebuild:"impostor"}),!0===n.radialSegments&&(n.radialSegments={type:"integer",max:25,min:5,rebuild:"impostor"}),!0===n.openEnded&&(n.openEnded={type:"boolean",rebuild:"impostor",buffer:!0}),!0===n.disableImpostor&&(n.disableImpostor={type:"boolean",rebuild:!0}),"low"===t.quality?(n.sphereDetail&&(this.sphereDetail=0),n.radialSegments&&(this.radialSegments=5)):"medium"===t.quality?(n.sphereDetail&&(this.sphereDetail=1),n.radialSegments&&(this.radialSegments=10)):"high"===t.quality?(n.sphereDetail&&(this.sphereDetail=2),n.radialSegments&&(this.radialSegments=20)):(n.sphereDetail&&(this.sphereDetail=bp(t.sphereDetail,1)),n.radialSegments&&(this.radialSegments=bp(t.radialSegments,10))),n.openEnded&&(this.openEnded=bp(t.openEnded,!0)),n.disableImpostor&&(this.disableImpostor=bp(t.disableImpostor,!1))}getColorParams(e){return Object.assign({data:this.colorData,scheme:this.colorScheme,scale:this.colorScale,reverse:this.colorReverse,value:this.colorValue,domain:this.colorDomain,mode:this.colorMode,colorSpace:this.colorSpace},e)}getBufferParams(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({clipNear:this.clipNear,clipRadius:this.clipRadius,clipCenter:this.clipCenter,flatShaded:this.flatShaded,opacity:this.opacity,depthWrite:this.depthWrite,side:this.side,wireframe:this.wireframe,roughness:this.roughness,metalness:this.metalness,diffuse:this.diffuse,diffuseInterior:this.diffuseInterior,useInteriorColor:this.useInteriorColor,interiorColor:this.interiorColor,interiorDarkening:this.interiorDarkening,matrix:this.matrix,disablePicking:this.disablePicking},e)}setColor(e,t){const n=Object.keys(Sm.getSchemes());if("string"===typeof e&&n.includes(e.toLowerCase()))t?t.colorScheme=e:this.setParameters({colorScheme:e});else if(void 0!==e){let n=new Ri(e).getHex();t?(t.colorScheme="uniform",t.colorValue=n):this.setParameters({colorScheme:"uniform",colorValue:n})}return this}prepare(e){}create(){}update(e){this.build()}build(e){if(!this.lazy||this.visible&&this.opacity){if(!this.toBePrepared)return this.tasks.increment(),void this.make();this.queue.length()>0?(this.tasks.change(1-this.queue.length()),this.queue.kill()):this.tasks.increment(),this.queue.push(e||!1)}else this.lazyProps.build=!0}make(t,n){e.Debug&&gm.time("Representation.make "+this.type);const i=()=>{t?(this.update(t),this.viewer.requestRender(),this.tasks.decrement(),n&&n()):(this.clear(),this.create(),this.manualAttach||this.disposed||(e.Debug&&gm.time("Representation.attach "+this.type),this.attach((()=>{e.Debug&&gm.timeEnd("Representation.attach "+this.type),this.tasks.decrement(),n&&n()})))),e.Debug&&gm.timeEnd("Representation.make "+this.type)};this.toBePrepared?this.prepare(i):i()}attach(e){this.setVisibility(this.visible),e()}setVisibility(e,t){if(this.visible=e,this.visible&&this.opacity){const e=this.lazyProps,t=e.bufferParams,n=e.what;if(e.build)return e.build=!1,this.build(),this;(Object.keys(t).length||Object.keys(n).length)&&(e.bufferParams={},e.what={},this.updateParameters(t,n))}return this.bufferList.forEach((function(t){t.setVisibility(e)})),t||this.viewer.requestRender(),this}setParameters(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=e||{},r=this.parameters,o={};this.opacity||void 0===i.opacity||(this.lazyProps.build?(this.lazyProps.build=!1,n=!0):(Object.assign(o,this.lazyProps.bufferParams),Object.assign(t,this.lazyProps.what),this.lazyProps.bufferParams={},this.lazyProps.what={})),this.setColor(i.color,i);for(let s in i)void 0!==i[s]&&void 0!=r[s]&&(r[s].int&&(i[s]=parseInt(i[s])),r[s].float&&(i[s]=parseFloat(i[s])),i[s]!==this[s]||i[s].equals&&!i[s].equals(this[s]))&&(this[s]&&this[s].copy&&i[s].copy?this[s].copy(i[s]):this[s]&&this[s].set?this[s].set(i[s]):this[s]=i[s],r[s].buffer&&(!0===r[s].buffer?o[s]=i[s]:o[r[s].buffer]=i[s]),r[s].update&&(t[r[s].update]=!0),!r[s].rebuild||"impostor"===r[s].rebuild&&fm&&!this.disableImpostor||(n=!0));return n?this.build():this.updateParameters(o,t),this}updateParameters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(this.lazy&&(!this.visible||!this.opacity)&&!1===e.hasOwnProperty("opacity"))return Object.assign(this.lazyProps.bufferParams,e),void Object.assign(this.lazyProps.what,t);this.bufferList.forEach((function(t){t.setParameters(e)})),Object.keys(t).length&&this.update(t),this.viewer.requestRender()}getParameters(){const e={lazy:this.lazy,visible:this.visible,quality:this.quality};return Object.keys(this.parameters).forEach((t=>{null!==this.parameters[t]&&(e[t]=this[t])})),e}clear(){this.bufferList.forEach((e=>{this.viewer.remove(e),e.dispose()})),this.bufferList.length=0,this.viewer.requestRender()}dispose(){this.disposed=!0,this.queue.kill(),this.tasks.dispose(),this.clear()}}class qy{constructor(t){this.pending=0,this.postCount=0,this.onmessageDict={},this.onerrorDict={},this.name=t,this.blobUrl=window.URL.createObjectURL(_m.get(t)),this.worker=new Worker(this.blobUrl),_m.activeWorkerCount+=1,this.worker.onmessage=n=>{this.pending-=1;const i=n.data.__postId;e.Debug&&gm.timeEnd("Worker.postMessage "+t+" #"+i);const r=this.onmessageDict[i];r&&r.call(this.worker,n),delete this.onmessageDict[i],delete this.onerrorDict[i]},this.worker.onerror=e=>{if(this.pending-=1,e.data){const n=e.data.__postId,i=this.onerrorDict[n];i?i.call(this.worker,e):gm.error("Worker.onerror",n,t,e),delete this.onmessageDict[n],delete this.onerrorDict[n]}else gm.error("Worker.onerror",t,e)}}post(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.onmessageDict[this.postCount]=i,this.onerrorDict[this.postCount]=r,t.__name=this.name,t.__postId=this.postCount,t.__debug=e.Debug,e.Debug&&gm.time("Worker.postMessage ".concat(this.name," #").concat(this.postCount));try{this.worker.postMessage(t,n)}catch(o){gm.error("worker.post:",o),this.worker.postMessage(t)}return this.pending+=1,this.postCount+=1,this}terminate(){this.worker?(this.worker.terminate(),window.URL.revokeObjectURL(this.blobUrl),_m.activeWorkerCount-=1):gm.log("no worker to terminate")}}class Xy{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;this.pool=[],this.count=0,this.maxCount=Math.min(8,t),this.name=e}post(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;const r=this.getNextWorker();return r?r.post(e,t,n,i):console.error("unable to get worker from pool"),this}terminate(){this.pool.forEach((function(e){e.terminate()}))}getNextWorker(){let e,t=1/0;for(let n=0;n<this.maxCount;++n){if(n>=this.count){e=new qy(this.name),this.pool.push(e),this.count+=1;break}const i=this.pool[n];if(0===i.pending){e=i;break}i.pending<t&&(t=i.pending,e=i)}return e}}function Yy(e){const t=e.length,n=t/3;let i=0,r=0,o=0;for(let s=0;s<t;s+=3)i+=e[s+0],r+=e[s+1],o+=e[s+2];return new mn(i/n,r/n,o/n)}function Zy(e,t,n){return n?e.sub(n).projectOnVector(t).add(n):e.projectOnVector(t),e}function Ky(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],u=e[a+2];l<t&&(t=l),c<n&&(n=c),u<i&&(i=u),l>r&&(r=l),c>o&&(o=c),u>s&&(s=u)}return[tv([t,n,i]),tv([r,o,s])]}function Qy(e,t){for(let n=0,i=t.length;n<i;n+=3){const i=t[n],r=t[n+1],o=t[n+2];t[n]=e[0]*i+e[4]*r+e[8]*o+e[12],t[n+1]=e[1]*i+e[5]*r+e[9]*o+e[13],t[n+2]=e[2]*i+e[6]*r+e[10]*o+e[14]}}function Jy(e,t){for(let n=0,i=t.length;n<i;n+=3){const i=t[n],r=t[n+1],o=t[n+2];t[n]=e[0]*i+e[3]*r+e[6]*o,t[n+1]=e[1]*i+e[4]*r+e[7]*o,t[n+2]=e[2]*i+e[5]*r+e[8]*o}}function ev(e){for(let t=0,n=e.length;t<n;t+=3){const n=e[t],i=e[t+1],r=e[t+2],o=n*n+i*i+r*r;if(o>0){const s=1/Math.sqrt(o);e[t]=n*s,e[t+1]=i*s,e[t+2]=r*s}}}function tv(e){return new Float32Array(e||3)}function nv(e,t,n){const i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2];e[0]=r*l-o*a,e[1]=o*s-i*l,e[2]=i*a-r*s}function iv(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function rv(e,t,n){e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2]}function ov(e,t,n){e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2]}function sv(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e[0]=t[n],e[1]=t[n+1],e[2]=t[n+2]}function av(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t[n]=e[0],t[n+1]=e[1],t[n+2]=e[2]}function lv(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function cv(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}function uv(e,t,n){hv(e,t,1/n)}function hv(e,t,n){e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}function dv(e,t){const n=lv(t);0==n?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):hv(e,t,1/Math.sqrt(n))}function pv(e,t,n){e[0]=t[0]-n,e[1]=t[1]-n,e[2]=t[2]-n}function fv(e,t,n){e[0]=t[0]+n,e[1]=t[1]+n,e[2]=t[2]+n}function mv(e,t){e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2])}function gv(e,t){e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2])}function yv(e,t){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2]}function vv(e,t){const n=e[0],i=e[1],r=e[2],o=t[0],s=t[1],a=t[2],l=i*a-r*s,c=r*o-n*a,u=n*s-i*o,h=Math.sqrt(l*l+c*c+u*u),d=n*o+i*s+r*a;return Math.atan2(h,d)}function bv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9;const n=Math.floor(t/2),i=e.position1.length/3,r=n*i*3,o=1/t,s=mg(e.position1,e.position2),a=new Float32Array(r),l=new Float32Array(r),c=new mn;for(let p=0;p<i;++p){const t=3*p;c.set(s[t],s[t+1],s[t+2]);const i=e.position1[t],r=e.position1[t+1],u=e.position1[t+2];for(let e=0;e<n;++e){const s=n*t+3*e,h=o*(2*e+1),d=o*(2*e+2);a[s]=i+c.x*h,a[s+1]=r+c.y*h,a[s+2]=u+c.z*h,l[s]=i+c.x*d,l[s+1]=r+c.y*d,l[s+2]=u+c.z*d}}const u=fg(a,l),h=_g(e.color,n),d={position:u,position1:a,position2:l,color:h,color2:h};return e.radius&&(d.radius=wg(e.radius,n)),e.picking&&e.picking.array&&(e.picking.array=wg(e.picking.array,n),d.picking=e.picking),e.primitiveId&&(d.primitiveId=wg(e.primitiveId,n)),d}function xv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;const n=mg(e.position1,e.position2),i=[],r=[],o=[],s=e.radius?[]:void 0,a=e.picking?[]:void 0,l=e.primitiveId?[]:void 0,c=new mn,u=e.position1.length/3;let h=0;for(let y=0;y<u;++y){const u=3*y;c.set(n[u],n[u+1],n[u+2]);const d=c.length()/t,p=Math.floor(d/2),f=1/d,m=e.position1[u],g=e.position1[u+1],v=e.position1[u+2];for(let t=0;t<p;++t){const n=3*h+3*t,d=f*(2*t+1),p=f*(2*t+2);i[n]=m+c.x*d,i[n+1]=g+c.y*d,i[n+2]=v+c.z*d,r[n]=m+c.x*p,r[n+1]=g+c.y*p,r[n+2]=v+c.z*p,e.color&&(o[n]=e.color[u],o[n+1]=e.color[u+1],o[n+2]=e.color[u+2]),s&&(s[h+t]=e.radius[y]),a&&(e.picking.array?a[h+t]=e.picking.array[y]:a[h+t]=y),l&&(l[h+t]=e.primitiveId[y])}h+=p}const d=new Float32Array(i),p=new Float32Array(r),f=fg(d,p),m=new Float32Array(o),g={position:f,position1:d,position2:p,color:m,color2:m};return s&&(g.radius=new Float32Array(s)),a&&e.picking&&(e.picking.array=new Float32Array(a),g.picking=e.picking),l&&(g.primitiveId=new Float32Array(l)),g}function wv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;const n=mg(e.position1,e.position2),i=[],r=[],o=[],s=e.radius?[]:void 0,a=e.picking?[]:void 0,l=e.primitiveId?[]:void 0,c=new mn,u=e.position1.length/3;let h=t,d=!0,p=0,f=0,m=0;for(let w=0;w<u;++w){const u=3*w,g=e.position1[u],y=e.position1[u+1],v=e.position1[u+2];c.set(n[u],n[u+1],n[u+2]);const b=c.length();d&&(i[f]=g,i[f+1]=y,i[f+2]=v);let x=h;const _=1/b;for(;x<b;){const e=d?r:i;e[f]=g+c.x*x*_,e[f+1]=y+c.y*x*_,e[f+2]=v+c.z*x*_,d&&(p++,f=3*p),d=!d,h=t,x+=t}d&&(r[f]=e.position2[u],r[f+1]=e.position2[u+1],r[f+2]=e.position2[u+2],p++,f=3*p),h=x-b;for(let t=m;t<p;t++){if(e.color){const n=3*t;o[n]=e.color[u],o[n+1]=e.color[u+1],o[n+2]=e.color[u+2]}s&&(s[t]=e.radius[w]),a&&(e.picking.array?a[t]=e.picking.array[w]:a[t]=w),l&&(l[t]=e.primitiveId[w])}m=p}if(!d&&u>0){const t=3*p;r[t]=e.position2[3*u-3],r[t+1]=e.position2[3*u-2],r[t+1]=e.position2[3*u-1]}const g=new Float32Array(i),y=new Float32Array(r),v=fg(g,y),b=new Float32Array(o),x={position:v,position1:g,position2:y,color:b,color2:b};return s&&(x.radius=new Float32Array(s)),a&&e.picking&&(e.picking.array=new Float32Array(a),x.picking=e.picking),l&&(x.primitiveId=new Float32Array(l)),x}function _v(e,t){void 0!==e.toArray?e=e.toArray():void 0!==e.x?e=[e.x,e.y,e.z]:void 0!==e.r&&(e=[e.r,e.g,e.b]),t.push.apply(t,e)}Xy.prototype.constructor=Xy,Ky.__deps=[tv],uv.__deps=[hv],dv.__deps=[hv,lv];const Sv=new mn;class Mv{static get Picker(){return Lm.get(this.type)}static get Buffer(){return Im.get(this.type)}static getShapeKey(e){return this.type+e[0].toUpperCase()+e.substr(1)}static expandBoundingBox(e,t){}static valueToShape(e,t,n){const i=e._primitiveData[this.getShapeKey(t)];switch(this.fields[t]){case"v3":case"c":_v(n,i);break;default:i.push(n)}}static objectToShape(e,t){Object.keys(this.fields).forEach((n=>{this.valueToShape(e,n,t[n])})),this.valueToShape(e,"name",t.name),this.expandBoundingBox(e.boundingBox,t)}static valueFromShape(e,t,n){const i=e._primitiveData[this.getShapeKey(n)];switch(this.fields[n]){case"v3":return(new mn).fromArray(i,3*t);case"c":return(new Ri).fromArray(i,3*t);default:return i[t]}}static objectFromShape(e,t){let n=this.valueFromShape(e,t,"name");void 0===n&&(n="".concat(this.type,": ").concat(t," (").concat(e.name,")"));const i={shape:e,name:n};return Object.keys(this.fields).forEach((n=>{i[n]=this.valueFromShape(e,t,n)})),i}static arrayFromShape(e,t){const n=e._primitiveData[this.getShapeKey(t)];return"s"===this.fields[t]?n:new Float32Array(n)}static dataFromShape(e){const t={};return this.Picker&&(t.picking=new this.Picker(e)),Object.keys(this.fields).forEach((n=>{t[n]=this.arrayFromShape(e,n)})),t}static bufferFromShape(e,t){return new this.Buffer(this.dataFromShape(e),t)}}Mv.type="",Mv.fields={};class Av extends Mv{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Sv.fromArray(t.position))}}Av.type="sphere",Av.fields={position:"v3",color:"c",radius:"f"};class Cv extends Mv{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Sv.fromArray(t.position))}}Cv.type="box",Cv.fields={position:"v3",color:"c",size:"f",heightAxis:"v3",depthAxis:"v3"};class Tv extends Cv{}Tv.type="octahedron";class Ev extends Cv{}Ev.type="tetrahedron";class Pv extends Mv{static positionFromShape(e,t){const n=this.valueFromShape(e,t,"position1"),i=this.valueFromShape(e,t,"position2");return n.add(i).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(Sv.fromArray(t.position1)),e.expandByPoint(Sv.fromArray(t.position2))}static bufferFromShape(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.dataFromShape(e);return"cylinder"===this.type&&t.dashedCylinder&&(n=xv(n)),new this.Buffer(n,t)}}Pv.type="cylinder",Pv.fields={position1:"v3",position2:"v3",color:"c",radius:"f"};class Iv extends Pv{}Iv.type="arrow";class Lv extends Pv{}Lv.type="cone";class Rv extends Av{}Rv.type="ellipsoid",Rv.fields={position:"v3",color:"c",radius:"f",majorAxis:"v3",minorAxis:"v3"};class kv extends Rv{}kv.type="torus";class Dv extends Mv{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Sv.fromArray(t.position))}}Dv.type="text",Dv.fields={position:"v3",color:"c",size:"f",text:"s"};class Ov extends Mv{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Sv.fromArray(t.position))}}Ov.type="point",Ov.fields={position:"v3",color:"c"};class Nv extends Mv{static positionFromShape(e,t){const n=this.valueFromShape(e,t,"position1"),i=this.valueFromShape(e,t,"position2");return n.add(i).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(Sv.fromArray(t.position1)),e.expandByPoint(Sv.fromArray(t.position2))}}function Bv(e){const{x:t,y:n,z:i}=e,r=new ni,o=t.length,{min:s,max:a}=r;for(let l=0;l<o;l++)s.x=Math.min(t[l],s.x),s.y=Math.min(n[l],s.y),s.z=Math.min(i[l],s.z),a.x=Math.max(t[l],a.x),a.y=Math.max(n[l],a.y),a.z=Math.max(i[l],a.z);return r}Nv.type="wideline",Nv.fields={position1:"v3",position2:"v3",color:"c"};class Fv{constructor(e,t){this.exp=3;const n=t||Bv(e);this.minX=n.min.x,this.minY=n.min.y,this.minZ=n.min.z,this.boundX=1+(n.max.x-this.minX>>this.exp),this.boundY=1+(n.max.y-this.minY>>this.exp),this.boundZ=1+(n.max.z-this.minZ>>this.exp);const i=this.boundX*this.boundY*this.boundZ,r=void 0!==e.count?e.count:e.x.length,o=e.x,s=e.y,a=e.z;let l=0;const c=new Uint32Array(i),u=new Int32Array(r);for(let m=0;m<r;++m){const e=o[m]-this.minX>>this.exp,t=s[m]-this.minY>>this.exp,n=a[m]-this.minZ>>this.exp,i=(e*this.boundY+t)*this.boundZ+n;1===(c[i]+=1)&&(l+=1),u[m]=i}const h=new Uint16Array(l);for(let m=0,g=0;m<i;++m){const e=c[m];e>0&&(c[m]=g+1,h[g]=e,g+=1)}const d=new Uint32Array(l);for(let m=1;m<l;++m)d[m]+=d[m-1]+h[m-1];const p=new Uint16Array(l),f=new Int32Array(r);for(let m=0;m<r;++m){const e=c[u[m]];if(e>0){const t=e-1;f[d[t]+p[t]]=m,p[t]+=1}}this.grid=c,this.bucketCount=h,this.bucketOffset=d,this.bucketArray=f,this.xArray=o,this.yArray=s,this.zArray=a}within(e,t,n,i){const r=[];return this.eachWithin(e,t,n,i,(e=>r.push(e))),r}eachWithin(e,t,n,i,r){const o=i*i,s=Math.max(0,e-i-this.minX>>this.exp),a=Math.max(0,t-i-this.minY>>this.exp),l=Math.max(0,n-i-this.minZ>>this.exp),c=Math.min(this.boundX,1+(e+i-this.minX>>this.exp)),u=Math.min(this.boundY,1+(t+i-this.minY>>this.exp)),h=Math.min(this.boundZ,1+(n+i-this.minZ>>this.exp));for(let d=s;d<c;++d)for(let i=a;i<u;++i)for(let s=l;s<h;++s){const a=(d*this.boundY+i)*this.boundZ+s,l=this.grid[a];if(l>0){const i=l-1,s=this.bucketOffset[i],a=s+this.bucketCount[i];for(let l=s;l<a;++l){const i=this.bucketArray[l],s=this.xArray[i]-e,a=this.yArray[i]-t,c=this.zArray[i]-n,u=s*s+a*a+c*c;u<=o&&r(i,u)}}}}}class zv{constructor(){this._fields=this._defaultFields,this._init(0)}get _defaultFields(){return[]}_init(e){this.length=e,this.count=0;for(let t=0,n=this._fields.length;t<n;++t){const[e,n,i]=this._fields[t];this._initField(e,n,i)}}_initField(e,t,n){this[e]=Bp(n,this.length*t)}addField(e,t,n){this._fields.push([e,t,n]),this._initField(e,t,n)}resize(e){this.length=Math.round(e||0),this.count=Math.min(this.count,this.length);for(let t=0,n=this._fields.length;t<n;++t){const e=this._fields[t][0],n=this._fields[t][1],i=this.length*n,r=new this[e].constructor(i);this[e].length>i?r.set(this[e].subarray(0,i)):r.set(this[e]),this[e]=r}}growIfFull(){if(this.count>=this.length){const e=Math.round(1.5*this.length);this.resize(Math.max(256,e))}}copyFrom(e,t,n,i){for(let r=0,o=this._fields.length;r<o;++r){const o=this._fields[r][0],s=this._fields[r][1],a=this[o],l=e[o];for(let e=0;e<i;++e){const i=s*(t+e),r=s*(n+e);for(let e=0;e<s;++e)a[i+e]=l[r+e]}}}copyWithin(e,t,n){for(let i=0,r=this._fields.length;i<r;++i){const r=this._fields[i][0],o=this._fields[i][1],s=this[r];for(let i=0;i<n;++i){const n=o*(e+i),r=o*(t+i);for(let e=0;e<o;++e)s[n+e]=s[r+e]}}}sort(e){gm.time("Store.sort");const t=this,n=new this.constructor(1);function i(e,i){e!==i&&(n.copyFrom(t,0,e,1),t.copyWithin(e,i,1),t.copyFrom(n,i,0,1))}function r(t,n){if(t<n){let o=Math.floor((t+n)/2),s=t,a=n;do{for(;e(s,o)<0;)s+=1;for(;e(a,o)>0;)a-=1;s<=a&&(s===o?o=a:a===o&&(o=s),i(s,a),s+=1,a-=1)}while(s<=a);r(t,a),r(s,n)}}r(0,this.count-1),gm.timeEnd("Store.sort")}clear(){this.count=0}dispose(){for(let e=0,t=this._fields.length;e<t;++e)delete this[this._fields[e][0]]}}class Uv extends zv{get _defaultFields(){return[["index1",1,"int32"],["index2",1,"int32"],["type",1,"int8"]]}addContact(e,t,n){this.growIfFull();const i=this.count;e<t?(this.index1[i]=e,this.index2[i]=t):(this.index2[i]=e,this.index1[i]=t),n&&(this.type[i]=n),this.count+=1}}function Hv(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24}class Gv{constructor(e,t){this.length=e,this._words=new Uint32Array(e+32>>>5),!0===t&&this.setAll()}get(e){return 0!==(this._words[e>>>5]&1<<e)}set(e){this._words[e>>>5]|=1<<e}clear(e){this._words[e>>>5]&=~(1<<e)}flip(e){this._words[e>>>5]^=1<<e}_assignRange(e,t,n){if(t<e)return;const i=this._words,r=!0===n?4294967295:0,o=e>>>5,s=t>>>5;for(let c=o+1;c<s;++c)i[c]=r;const a=o<<5,l=s<<5;if(!0===n)if(t-e<32)for(let c=e,u=t+1;c<u;++c)i[c>>>5]|=1<<c;else{for(let t=e,n=a+32;t<n;++t)i[t>>>5]|=1<<t;for(let e=l,n=t+1;e<n;++e)i[e>>>5]|=1<<e}else if(t-e<32)for(let c=e,u=t+1;c<u;++c)i[c>>>5]&=~(1<<c);else{for(let t=e,n=a+32;t<n;++t)i[t>>>5]&=~(1<<t);for(let e=l,n=t+1;e<n;++e)i[e>>>5]&=~(1<<e)}return this}setRange(e,t){return this._assignRange(e,t,!0)}clearRange(e,t){return this._assignRange(e,t,!1)}setBits(){const e=this._words,t=arguments.length;for(let n=0;n<t;++n){const t=n<0||arguments.length<=n?void 0:arguments[n];e[t>>>5]|=1<<t}return this}clearBits(){const e=this._words,t=arguments.length;for(let n=0;n<t;++n){const t=n<0||arguments.length<=n?void 0:arguments[n];e[t>>>5]&=~(1<<t)}return this}setAll(){return this._assignRange(0,this.length-1,!0)}clearAll(){return this._assignRange(0,this.length-1,!1)}flipAll(){const e=this._words.length,t=this._words,n=32-this.length%32;for(let i=0;i<e-1;++i)t[i]=~t[i];return t[e-1]=~(t[e-1]<<n)>>>n,this}_isRangeValue(e,t,n){if(t<e)return;const i=this._words,r=!0===n?4294967295:0,o=e>>>5,s=t>>>5;for(let a=o+1;a<s;++a)if(i[a]!==r)return!1;if(t-e<32){for(let a=e,l=t+1;a<l;++a)if(!!(i[a>>>5]&1<<a)!==n)return!1}else{const r=s<<5;for(let t=e,s=32+(o<<5);t<s;++t)if(!!(i[t>>>5]&1<<t)!==n)return!1;for(let e=r,o=t+1;e<o;++e)if(!!(i[e>>>5]&1<<e)!==n)return!1}return!0}isRangeSet(e,t){return this._isRangeValue(e,t,!0)}isRangeClear(e,t){return this._isRangeValue(e,t,!1)}isAllSet(){return this._isRangeValue(0,this.length-1,!0)}isAllClear(){return this._isRangeValue(0,this.length-1,!1)}isSet(){const e=this._words,t=arguments.length;for(let n=0;n<t;++n){const t=n<0||arguments.length<=n?void 0:arguments[n];if(0===(e[t>>>5]&1<<t))return!1}return!0}isClear(){const e=this._words,t=arguments.length;for(let n=0;n<t;++n){const t=n<0||arguments.length<=n?void 0:arguments[n];if(0!==(e[t>>>5]&1<<t))return!1}return!0}isEqualTo(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let r=0;r<i;++r)if(t[r]!==n[r])return!1;return!0}getSize(){const e=this._words.length,t=this._words;let n=0;for(let i=0;i<e;++i)n+=Hv(t[i]);return n}difference(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let r=0;r<i;++r)t[r]=t[r]&~n[r];for(let r=t.length;r<i;++r)t[r]=0;return this}union(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let r=0;r<i;++r)t[r]|=n[r];for(let r=t.length;r<i;++r)t[r]=0;return this}intersection(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let r=0;r<i;++r)t[r]&=n[r];for(let r=t.length;r<i;++r)t[r]=0;return this}intersects(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let r=0;r<i;++r)if(0!==(t[r]&n[r]))return!0;return!1}getIntersectionSize(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);let r=0;for(let o=0;o<i;++o)r+=Hv(t[o]&n[o]);return r}makeIntersection(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length),r=new Uint32Array(i),o=Object.create(Gv.prototype);o._words=r,o.length=Math.min(this.length,e.length);for(let s=0;s<i;++s)r[s]=t[s]&n[s];return o}forEach(e){const t=this._words.length,n=this._words;let i=0;for(let r=0;r<t;++r){let t=n[r];for(;0!==t;){const n=t&-t;e((r<<5)+Hv(n-1),i),t^=n,++i}}}toArray(){const e=this._words,t=new Array(this.getSize()),n=this._words.length;let i=0;for(let r=0;r<n;++r){let n=e[r];for(;0!==n;){const e=n&-n;t[i++]=(r<<5)+Hv(e-1),n^=e}}return t}toString(){return"{"+this.toArray().join(",")+"}"}toSeleString(){const e=this.toArray().join(",");return e?"@"+e:"NONE"}clone(){const e=Object.create(Gv.prototype);return e.length=this.length,e._words=new Uint32Array(this._words),e}}function Vv(e){const{edgeCount:t,nodeCount:n,nodeArray1:i,nodeArray2:r}=e,o=new Uint8Array(n),s=new Int32Array(n);for(let c=0;c<t;++c)o[i[c]]+=1,o[r[c]]+=1;for(let c=1;c<n;++c)s[c]+=s[c-1]+o[c-1];const a=2*t,l=new Int32Array(a);for(let c=0;c<a;++c)l[c]=-1;for(let c=0;c<t;++c){const e=i[c],t=r[c];let n=s[e];for(;-1!==l[n]&&n<a;)n+=1;l[n]=c;let o=s[t];for(;-1!==l[o]&&o<a;)o+=1;l[o]=c}return{countArray:o,offsetArray:s,indexArray:l}}function jv(){return{types:[],groups:[],centers:{x:[],y:[],z:[]},atomSets:[]}}function $v(){return{type:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,group:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x:0,y:0,z:0,atomSet:[]}}function Wv(e,t){e.x+=t.x,e.y+=t.y,e.z+=t.z,e.atomSet.push(t.index)}function qv(e,t){const n=t.atomSet.length;if(n>0){const{types:i,groups:r,centers:o,atomSets:s}=e;i.push(t.type),r.push(t.group),o.x.push(t.x/n),o.y.push(t.y/n),o.z.push(t.z/n),s.push(t.atomSet)}}const Xv=0,Yv=1,Zv=2,Kv=3,Qv=4,Jv=0,eb=1,tb=2,nb=3,ib=4,rb=5,ob=6,sb=0,ab=1,lb=2,cb=3,ub=4,hb=5,db=6,pb=["D-BETA-PEPTIDE, C-GAMMA LINKING","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-PEPTIDE COOH CARBOXY TERMINUS","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE LINKING","PEPTIDE LINKING","PEPTIDE-LIKE"],fb=["RNA OH 3 PRIME TERMINUS","RNA OH 5 PRIME TERMINUS","RNA LINKING"],mb=["DNA OH 3 PRIME TERMINUS","DNA OH 5 PRIME TERMINUS","DNA LINKING","L-DNA LINKING","L-RNA LINKING"],gb=["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","SACCHARIDE"],yb=["NON-POLYMER"].concat(["OTHER"],gb),vb=["h","g","i"],bb=["e","b"],xb=["s","t","l",""],wb={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109,DS:110,RG:111,CN:112,NH:113,FL:114,MC:115,LV:116,TS:117,OG:118},_b=0,Sb={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:2,114:2,115:2,116:2,117:2,118:2},Mb=2,Ab={1:.31,2:.28,3:1.28,4:.96,5:.84,6:.76,7:.71,8:.66,9:.57,10:.58,11:1.66,12:1.41,13:1.21,14:1.11,15:1.07,16:1.05,17:1.02,18:1.06,19:2.03,20:1.76,21:1.7,22:1.6,23:1.53,24:1.39,25:1.39,26:1.32,27:1.26,28:1.24,29:1.32,30:1.22,31:1.22,32:1.2,33:1.19,34:1.2,35:1.2,36:1.16,37:2.2,38:1.95,39:1.9,40:1.75,41:1.64,42:1.54,43:1.47,44:1.46,45:1.42,46:1.39,47:1.45,48:1.44,49:1.42,50:1.39,51:1.39,52:1.38,53:1.39,54:1.4,55:2.44,56:2.15,57:2.07,58:2.04,59:2.03,60:2.01,61:1.99,62:1.98,63:1.98,64:1.96,65:1.94,66:1.92,67:1.92,68:1.89,69:1.9,70:1.87,71:1.87,72:1.75,73:1.7,74:1.62,75:1.51,76:1.44,77:1.41,78:1.36,79:1.36,80:1.32,81:1.45,82:1.46,83:1.48,84:1.4,85:1.5,86:1.5,87:2.6,88:2.21,89:2.15,90:2.06,91:2,92:1.96,93:1.9,94:1.87,95:1.8,96:1.69,97:1.6,98:1.6,99:1.6,100:1.6,101:1.6,102:1.6,103:1.6,104:1.6,105:1.6,106:1.6,107:1.6,108:1.6,109:1.6,110:1.6,111:1.6,112:1.6,113:1.6,114:1.6,115:1.6,116:1.6,117:1.6,118:1.6},Cb=1.6,Tb={1:[1],2:[0],3:[1],4:[2],5:[3],6:[4],7:[3],8:[2],9:[1],10:[0],11:[1],12:[2],13:[6],14:[6],15:[3,5,7],16:[2,4,6],17:[1],18:[0],19:[1],20:[2],31:[3],32:[4],33:[3,5],34:[2,4,6],35:[1],36:[0],37:[1],38:[2],49:[3],50:[4],51:[3,5],52:[2],53:[1,2,5],54:[0,2],55:[1],56:[2],81:[3],82:[4],83:[3],84:[2],85:[1],86:[0],87:[1],88:[2]},Eb=-1,Pb={1:1,2:2,3:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:1,12:2,13:3,14:4,15:5,16:6,17:7,18:8,19:1,20:2,21:3,22:4,23:5,24:6,25:7,26:8,27:9,28:10,29:11,30:2,31:3,32:4,33:5,34:6,35:7,36:8,37:1,38:2,39:3,40:4,41:5,42:6,43:7,44:8,45:9,46:10,47:11,48:2,49:3,50:4,51:5,52:6,53:7,54:8,55:1,56:2,57:3,58:4,59:3,60:4,61:5,62:6,63:7,64:8,65:9,66:10,67:11,68:12,69:13,70:14,71:15,72:4,73:5,74:6,75:7,76:8,77:9,78:10,79:11,80:2,81:3,82:4,83:5,84:6,85:7,86:8,87:1,88:2,89:3,90:4,91:3,92:4,93:5,94:6,95:7,96:8,97:9,98:10,99:11,100:12,101:13,102:14,103:15,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:3,114:4,115:5,116:6,117:7,118:8},Ib=2,Lb={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53]},Rb=[0,0,0],kb={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O"},Db=Object.keys(kb),Ob=["A","C","T","G","U","I"],Nb=["DA","DC","DT","DG","DU","DI"],Bb=["A","G","I","DA","DG","DI"],Fb=Ob.concat(Nb),zb=["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP3","TIP4","SPC"],Ub=["118","119","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","543","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MLT","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NCO","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","OHX"],Hb=["045","0AT","0BD","0MK","0NZ","0TS","0V4","0XY","0YT","10M","147","149","14T","15L","16G","18T","18Y","1AR","1BW","1GL","1GN","1JB","1LL","1NA","1S3","26M","26Q","26R","26V","26W","26Y","27C","289","291","293","2DG","2F8","2FG","2FL","2FP","2GL","2M4","2M5","32O","34V","3CM","3DO","3DY","3FM","3LR","3MF","3MG","3SA","3ZW","46D","46M","46Z","48Z","4CQ","4GC","4NN","50A","5DI","5GF","5MM","5RP","5SA","5SP","64K","6PG","6SA","7JZ","7SA","A1Q","A2G","AAB","AAL","AAO","ABC","ABD","ABE","ABF","ABL","ACG","ACI","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AHR","AIG","ALL","ALX","AMU","AOG","AOS","ARA","ARB","ARE","ARI","ASG","ASO","AXP","AXR","B0D","B16","B2G","B4G","B6D","B8D","B9D","BBK","BCD","BDG","BDP","BDR","BEM","BFP","BGC","BGL","BGP","BGS","BHG","BMA","BMX","BNG","BNX","BOG","BRI","BXF","BXP","BXX","BXY","C3X","C4X","C5X","CAP","CBI","CBK","CBS","CDR","CEG","CGF","CHO","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D6G","DAF","DAG","DDA","DDB","DDL","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGS","DIG","DLF","DLG","DMU","DNO","DOM","DP5","DQQ","DQR","DR2","DR3","DR4","DRI","DSR","DT6","DVC","E4P","E5G","EAG","EBG","EBQ","EGA","EJT","EPG","ERE","ERI","F1P","F1X","F6P","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FIX","FMO","FRU","FSI","FU4","FUB","FUC","FUD","FUL","FXP","G16","G1P","G2F","G3I","G4D","G4S","G6D","G6P","G6S","GAC","GAD","GAL","GC1","GC4","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GCX","GE1","GFG","GFP","GIV","GL0","GL2","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GMH","GN1","GNX","GP1","GP4","GPH","GPM","GQ1","GQ2","GQ4","GS1","GS4","GSA","GSD","GTE","GTH","GTK","GTR","GTZ","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUP","GUZ","GYP","GYV","H2P","HDL","HMS","HS2","HSD","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","IAB","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IMK","IN1","IPT","ISL","KBG","KD2","KDA","KDM","KDO","KFN","KO1","KO2","KTU","L6S","LAG","LAI","LAK","LAO","LAT","LB2","LBT","LCN","LDY","LGC","LGU","LM2","LMT","LMU","LOG","LOX","LPK","LSM","LTM","LVZ","LXB","LXZ","M1F","M3M","M6P","M8C","MA1","MA2","MA3","MAB","MAG","MAL","MAN","MAT","MAV","MAW","MBG","MCU","MDA","MDM","MDP","MFA","MFB","MFU","MG5","MGA","MGL","MLB","MMA","MMN","MN0","MRP","MTT","MUG","MVP","MXY","N1L","N9S","NAA","NAG","NBG","NDG","NED","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGL","NGS","NGY","NHF","NM6","NM9","NTF","NTO","NTP","NXD","NYT","OPG","OPM","ORP","OX2","P3M","P53","P6P","PA5","PNA","PNG","PNW","PRP","PSJ","PSV","PTQ","QDK","QPS","QV4","R1P","R1X","R2B","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RIB","RIP","RNS","RNT","ROB","ROR","RPA","RST","RUB","RUU","RZM","S6P","S7P","SA0","SCR","SDD","SF6","SF9","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHG","SI3","SIO","SOE","SOL","SSG","SUC","SUP","SUS","T6P","T6T","TAG","TCB","TDG","TGK","TGY","TH1","TIA","TM5","TM6","TM9","TMR","TMX","TOA","TOC","TRE","TYV","UCD","UDC","VG1","X0X","X1X","X2F","X4S","X5S","X6X","XBP","XDN","XDP","XIF","XIM","XLF","XLS","XMM","XUL","XXR","XYP","XYS","YO5","Z3Q","Z6J","Z9M","ZDC","ZDM"],Gb=["CA","C","N","O","O1","O2","OC1","OC2","OX1","OXT","OT1","OT2","H","H1","H2","H3","HA","HN","BB"],Vb=["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"],jb={};jb[ab]={trace:"CA",direction1:"C",direction2:["O","OC1","O1","OX1","OXT","OT1","OT2"],backboneStart:"N",backboneEnd:"C"},jb[lb]={trace:["C4'","C4*"],direction1:["C1'","C1*"],direction2:["C3'","C3*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},jb[cb]={trace:["C3'","C3*"],direction1:["C2'","C2*"],direction2:["O4'","O4*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},jb[ub]={trace:["CA","BB"],backboneStart:["CA","BB"],backboneEnd:["CA","BB"]},jb[hb]={trace:["C4'","C4*","P"],backboneStart:["C4'","C4*","P"],backboneEnd:["C4'","C4*","P"]},jb[db]={trace:["C3'","C3*","C2'","P"],backboneStart:["C3'","C3*","C2'","P"],backboneEnd:["C3'","C3*","C2'","P"]},jb[sb]={};const $b={HD:"H",HS:"H",A:"C",NA:"N",NS:"N",OA:"O",OS:"O",SA:"S",G0:"C",G1:"C",G2:"C",G3:"C",CG0:"C",CG1:"C",CG2:"C",CG3:"C",W:"O"};function Wb(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}const qb=new Map([[2,Qp(180)],[3,Qp(120)],[4,Qp(109.4721)],[6,Qp(90)]]);function Xb(e,t){let n=[];const i=new mn,r=new mn;return i.subVectors(t,e),e.eachBondedAtom((t=>{1!==t.number&&(r.subVectors(t,e),n.push(i.angleTo(r)))})),n}function Yb(e,t){const n=e.clone(),i=new mn;i.subVectors(t,e);const r=[new mn,new mn];let o=0;if(e.eachBondedAtom((t=>{o>1||1!==t.number&&(n.index=t.index,r[o++].subVectors(t,e))})),1===o&&n.eachBondedAtom((t=>{o>1||1!==t.number&&t.index!==e.index&&r[o++].subVectors(t,e)})),2!==o)return;const s=r[0].cross(r[1]);return Math.abs(Math.PI/2-s.angleTo(i))}function Zb(e){const t=e.structure.getBondProxy(),n=e.number,i=8===n||7===n;if(i&&4===e.bondCount)return!1;let r=!1;return e.eachBond((n=>{if(n.bondOrder>1)r=!0;else if(i){const i=n.getOtherAtom(e);i.eachBond((e=>{if(e.bondOrder>1){const t=i.number;if((15===t||16===t)&&8===e.getOtherAtom(i).number)return;r=!0}}),t)}})),r}function Kb(e){let t=0;return e.eachBond((e=>t+=e.bondOrder)),t}function Qb(e,t){const n=e.bondToElementCount(1);let i=e.formalCharge||0;const r="always"===t.assignCharge||"auto"===t.assignCharge&&0===i,o="always"===t.assignH||"auto"===t.assignH&&0===n,s=e.bondCount,a=Kb(e),l=Zb(e),c=a-s>0;let u=0,h=8;switch(e.number){case 1:r&&(0===s?(i=1,h=0):1===s&&(i=0,h=1));break;case 6:r&&(i=0),o&&(u=Math.max(0,4-a-Math.abs(i))),h=Wb(s+u+Math.max(0,-i));break;case 7:if(r)if(o)if(l&&a<4)i=s-n===1&&a-n===2?1:0;else{let t=!1;e.eachBondedAtom((e=>{(16===e.number||e.isMetal())&&(t=!0)})),i=t?0:1}else i=a-3;o&&(u=Math.max(0,3-a+i)),h=Wb(l&&!c?s+u-i:s+u+1-i);break;case 8:r&&(o||(i=a-2),1===a&&e.eachBondedAtom((t=>{t.eachBond((n=>{const r=n.getOtherAtom(t);r.index!==e.index&&8===r.number&&2===n.bondOrder&&(i=-1)}))}))),o&&(u=Math.max(0,2-a+i)),h=Wb(l&&!c?s+u-i+1:s+u-i+2);break;case 16:r&&(o||(i=a<=3&&!e.bondToElementCount(8)?a-2:0)),o&&a<2&&(u=Math.max(0,2-a+i)),a<=3&&(h=Wb(s+u-i+2));break;case 9:case 17:case 35:case 53:case 85:r&&(i=a-1);break;case 3:case 11:case 19:case 37:case 55:case 87:r&&(i=1-a);break;case 4:case 12:case 20:case 38:case 56:case 88:r&&(i=2-a);break;default:console.warn("Requested charge, protonation for an unhandled element",e.element)}return[i,u,u+n,h]}function Jb(e,t){const n=e.structure,i=n.atomCount,r=new Int8Array(i),o=new Int8Array(i),s=new Int8Array(i),a=new Int8Array(i);return n.eachAtom((e=>{const n=e.index,[i,l,c,u]=Qb(e,t);r[n]=i,o[n]=l,s[n]=c,a[n]=u})),{charge:r,implicitH:o,totalH:s,idealGeometry:a}}function ex(e){return{structure:e,"@spatialLookup":void 0,"@valenceModel":void 0}}function tx(e){if(e["@valenceModel"])return e["@valenceModel"];const t=Jb(e,{assignCharge:"auto",assignH:"auto"});return e["@valenceModel"]=t,t}function nx(e){return 16===e.number&&3===e.bondToElementCount(8)}function ix(e){return 16===e.number&&4===e.bondToElementCount(8)}function rx(e){return 15===e.number&&e.bondToElementCount(8)===e.bondCount}function ox(e){let t=0;return 6===e.number&&2===e.bondToElementCount(8)&&1===e.bondToElementCount(6)&&e.eachBondedAtom((e=>{8===e.number&&e.bondCount-e.bondToElementCount(1)===1&&++t})),2===t}function sx(e){let t=0;return 6===e.number&&3===e.bondCount&&3===e.bondToElementCount(7)&&e.eachBondedAtom((e=>{e.bondCount-e.bondToElementCount(1)===1&&++t})),2===t}function ax(e){let t=0;return 6===e.number&&3===e.bondCount&&2===e.bondToElementCount(7)&&1===e.bondToElementCount(6)&&e.eachBondedAtom((e=>{e.bondCount-e.bondToElementCount(1)===1&&++t})),2===t}const lx=["ARG","HIS","LYS"],cx=["GLU","ASP"];function ux(e,t){const{charge:n}=tx(e.data),i={};e.eachResidue((e=>{if(lx.includes(e.resname)){const n=$v(1);e.eachAtom((e=>{7===e.number&&e.isSidechain()&&Wv(n,e)})),qv(t,n)}else Db.includes(e.resname)||e.isNucleic()||(e.eachAtom((e=>{let n=!1;const r=$v(1);sx(e)?(r.group=8,n=!0):ax(e)&&(r.group=9,n=!0),n&&(e.eachBondedAtom((e=>{7===e.number&&(i[e.index]=!0,Wv(r,e))})),qv(t,r))})),e.eachAtom((e=>{const r=$v(1);n[e.index]>0&&(i[e.index]||(Wv(r,e),qv(t,r)))})))}))}function hx(e,t){const{charge:n}=tx(e.data),i={};e.eachResidue((e=>{if(cx.includes(e.resname)){const n=$v(2);e.eachAtom((e=>{8===e.number&&e.isSidechain()&&Wv(n,e)})),qv(t,n)}else if(Fb.includes(e.resname)){const n=$v(2);e.eachAtom((e=>{rx(e)&&(n.group=6,e.eachBondedAtom((e=>{8===e.number&&Wv(n,e)})),qv(t,n))}))}else Db.includes(e.resname)||Fb.includes(e.resname)||(e.eachAtom((e=>{let n=!1;const r=$v(2);nx(e)?(r.group=4,n=!0):rx(e)?(r.group=6,n=!0):ix(e)?(r.group=5,n=!0):ox(e)&&(r.group=10,n=!0),n&&(e.eachBondedAtom((e=>{8===e.number&&(i[e.index]=!0,Wv(r,e))})),qv(t,r))})),e.eachAtom((e=>{const r=$v(2);n[e.index]<0&&(i[e.index]||(Wv(r,e),qv(t,r)))})))}))}function dx(e,t){const n=e.getAtomProxy();e.eachResidue((e=>{const i=e.getAromaticRings();if(i){const r=e.atomOffset;i.forEach((e=>{const i=$v(3);e.forEach((e=>{n.index=e+r,Wv(i,n)})),qv(t,i)}))}}))}function px(e,t){return 2===e&&1===t||1===e&&2===t}function fx(e,t){return 3===e&&3===t}function mx(e,t){return 3===e&&1===t||1===e&&3===t}function gx(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=bp(n.maxIonicDist,Qx.maxIonicDist),r=bp(n.maxPiStackingDist,Qx.maxPiStackingDist),o=bp(n.maxPiStackingOffset,Qx.maxPiStackingOffset),s=bp(n.maxPiStackingAngle,Qx.maxPiStackingAngle),a=bp(n.maxCationPiDist,Qx.maxCationPiDist),l=bp(n.maxCationPiOffset,Qx.maxCationPiOffset),c=bp(n.masterModelIndex,Qx.masterModelIndex),u=Math.max(i+2,r,a),h=r*r,d=a*a,{features:p,spatialHash:f,contactStore:m,featureSet:g}=t,{types:y,centers:v,atomSets:b}=p,{x:x,y:w,z:_}=v,S=y.length,M=e.atomStore.x,A=e.atomStore.y,C=e.atomStore.z,T=e.getAtomProxy(),E=e.getAtomProxy(),P=function(e,t,n){const i=e.length,r=t.length;for(let o=0;o<i;++o){T.index=e[o];for(let e=0;e<r;++e)if(E.index=t[e],T.distanceTo(E)<=n)return!0}return!1},I=new mn,L=new mn,R=new mn,k=new mn,D=new mn,O=new mn,N=new mn,B=function(e,t){I.set(M[e[0]],A[e[0]],C[e[0]]),L.set(M[e[1]],A[e[1]],C[e[1]]),R.set(M[e[2]],A[e[2]],C[e[2]]),k.subVectors(I,L),D.subVectors(I,R),t.crossVectors(k,D)},F=function(e,t,n){return I.set(x[e],w[e],_[e]),L.set(x[t],w[t],_[t]),I.sub(L).projectOnPlane(n).add(L).distanceTo(L)},z=function(e,t,n){g.setBits(e,t),m.addContact(e,t,n)};for(let U=0;U<S;++U)f.eachWithin(x[U],w[U],_[U],u,((e,t)=>{if(e<=U)return;if(T.index=b[U][0],E.index=b[e][0],ew(T,E,c))return;const n=y[U],r=y[e];if(px(n,r))P(b[U],b[e],i)&&z(U,e,1);else if(fx(n,r)){if(t<=h){B(b[U],O),B(b[e],N);const t=Jp(O.angleTo(N));Math.min(F(U,e,N),F(e,U,O))<=o&&(t<=s||t>=180-s||t<=s+90&&t>=90-s)&&z(U,e,3)}}else if(mx(n,r)&&t<=d){const[t,i]=3===n?[U,e]:[e,U];B(b[t],O),F(i,t,O)<=l&&z(t,i,2)}}))}function yx(e,t){const{totalH:n}=tx(e.data);e.eachAtom((e=>{const i=$v(4),r=e.number;(wx(e)||n[e.index]>0&&(7===r||8===r||16===r))&&(Wv(i,e),qv(t,i))}))}function vx(e,t){const{totalH:n}=tx(e.data);e.eachAtom((e=>{if(6===e.number&&n[e.index]>0&&(e.bondToElementCount(7)>0||e.bondToElementCount(8)>0||bx(e))){const n=$v(9);Wv(n,e),qv(t,n)}}))}function bx(e){if(!e.isAromatic())return!1;const t=e.residueType.getRings();if(!t)return!1;let n=!1;return t.rings.forEach((t=>{n||t.some((t=>e.index-e.residueAtomOffset===t))&&(n=t.some((t=>{const n=e.residueType.atomTypeIdList[t],i=e.atomMap.get(n).number;return 7===i||8===i})))})),n}function xx(e,t){const{charge:n,implicitH:i,idealGeometry:r}=tx(e.data);e.eachAtom((e=>{const o=$v(5),s=e.number;if(8===s)Wv(o,e),qv(t,o);else if(7===s){if(wx(e))Wv(o,e),qv(t,o);else if(n[e.index]<1){const n=e.bondCount+i[e.index],s=r[e.index];(4===s&&n<4||3===s&&n<3||2===s&&n<2)&&(Wv(o,e),qv(t,o))}}else 16===s&&("CYS"!==e.resname&&"MET"!==e.resname&&-1!==e.formalCharge||(Wv(o,e),qv(t,o)))}))}function wx(e){return"HIS"===e.resname&&7==e.number&&e.isRing()}function _x(e,t){return e.isBackbone()&&t.isBackbone()}function Sx(e,t){return e.isWater()&&t.isWater()}function Mx(e,t){return 5===e&&4===t||4===e&&5===t}function Ax(e,t){return 9===e&&5===t||5===e&&9===t}function Cx(e,t){return Sx(e,t)?9:_x(e,t)?10:4}function Tx(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=bp(n.maxHbondDist,Qx.maxHbondDist),r=bp(n.maxHbondSulfurDist,Qx.maxHbondSulfurDist),o=Qp(bp(n.maxHbondAccAngle,Qx.maxHbondAccAngle)),s=Qp(bp(n.maxHbondDonAngle,Qx.maxHbondDonAngle)),a=Qp(bp(n.maxHbondAccPlaneAngle,Qx.maxHbondAccPlaneAngle)),l=Qp(bp(n.maxHbondDonPlaneAngle,Qx.maxHbondDonPlaneAngle)),c=bp(n.masterModelIndex,Qx.masterModelIndex),u=Math.max(i,r),h=i*i,{features:d,spatialHash:p,contactStore:f,featureSet:m}=t,{types:g,centers:y,atomSets:v}=d,{x:b,y:x,z:w}=y,_=g.length,{idealGeometry:S}=tx(e.data),M=e.getAtomProxy(),A=e.getAtomProxy();for(let C=0;C<_;++C)p.eachWithin(b[C],x[C],w[C],u,((e,t)=>{if(e<=C)return;const n=g[C],i=g[e],r=Ax(n,i);if(!r&&!Mx(n,i))return;const[u,d]=5===i?[C,e]:[e,C];if(M.index=v[u][0],A.index=v[d][0],A.index===M.index)return;if(ew(M,A,c))return;if(16!==M.number&&16!==A.number&&t>h)return;if(M.connectedTo(A))return;const p=Xb(M,A),y=qb.get(S[M.index])||Qp(120);if(p.some((e=>Math.abs(y-e)>s)))return;if(3===S[M.index]){const e=Yb(M,A);if(void 0!==e&&e>l)return}const b=Xb(A,M),x=qb.get(S[A.index])||Qp(120);if(b.some((e=>x-e>o)))return;if(3===S[A.index]){const e=Yb(A,M);if(void 0!==e&&e>a)return}m.setBits(u,d);const w=r?8:Cx(M,A);f.addContact(u,d,w)}))}const Ex=[3,11,19,37,55,12,20,38,56,13,31,49,81,21,50,82,83,51,80];function Px(e,t){e.eachAtom((e=>{let n=!1,i=!1;const r=Db.includes(e.resname),o=Fb.includes(e.resname);if(r||o?r?8===e.number?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(e.resname)&&e.isSidechain()||e.isBackbone())&&(n=!0,i=!0):16===e.number&&"CYS"===e.resname?(n=!0,i=!0):7===e.number&&"HIS"===e.resname&&e.isSidechain()&&(n=!0):o&&(8===e.number&&e.isBackbone()?(n=!0,i=!0):["N3","N4","N7"].includes(e.atomname)?n=!0:["O2","O4","O6"].includes(e.atomname)&&(n=!0,i=!0)):e.isHalogen()||8===e.number||16===e.number?(n=!0,i=!0):7===e.number&&(n=!0),n){const n=$v(11);Wv(n,e),qv(t,n)}if(i){const n=$v(10);Wv(n,e),qv(t,n)}}))}function Ix(e,t){e.eachAtom((e=>{if(e.isTransitionMetal()||30===e.number||48===e.number){const n=$v(12);Wv(n,e),qv(t,n)}else if(Ex.includes(e.number)){const n=$v(13);Wv(n,e),qv(t,n)}}))}function Lx(e,t){return 12===e?11===t||12===t:13===e?10===t:void 0}function Rx(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=bp(n.maxMetalDist,Qx.maxMetalDist),r=bp(n.masterModelIndex,Qx.masterModelIndex),{features:o,spatialHash:s,contactStore:a,featureSet:l}=t,{types:c,centers:u,atomSets:h}=o,{x:d,y:p,z:f}=u,m=c.length,g=e.getAtomProxy(),y=e.getAtomProxy();for(let v=0;v<m;++v)s.eachWithin(d[v],p[v],f[v],i,((e,t)=>{if(e<=v)return;if(g.index=h[v][0],y.index=h[e][0],ew(g,y,r))return;const n=g.isMetal(),i=y.isMetal();if(!n&&!i)return;const[o,s]=n?[c[v],c[e]]:[c[e],c[v]];Lx(o,s)&&(l.setBits(v,e),a.addContact(v,e,7))}))}function kx(e,t){e.eachAtom((e=>{const n=$v(8);let i=!1;6===e.number?(i=!0,e.eachBondedAtom((e=>{const t=e.number;6!==t&&1!==t&&(i=!1)}))):9===e.number&&(i=!0),i&&(Wv(n,e),qv(t,n))}))}function Dx(e,t){return 8===e&&8===t}function Ox(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=bp(n.maxHydrophobicDist,Qx.maxHydrophobicDist),r=bp(n.masterModelIndex,Qx.masterModelIndex),{features:o,spatialHash:s,contactStore:a,featureSet:l}=t,{types:c,centers:u,atomSets:h}=o,{x:d,y:p,z:f}=u,m=c.length,g=e.getAtomProxy(),y=e.getAtomProxy();for(let v=0;v<m;++v)s.eachWithin(d[v],p[v],f[v],i,((e,t)=>{e<=v||(g.index=h[v][0],y.index=h[e][0],ew(g,y,r)||9===g.number&&9===y.number||g.connectedTo(y)||Dx(c[v],c[e])&&(l.setBits(v,e),a.addContact(v,e,6)))}))}const Nx=[17,35,53,85];function Bx(e,t){e.eachAtom((e=>{if(Nx.includes(e.number)&&1===e.bondToElementCount(6)){const n=$v(6);Wv(n,e),qv(t,n)}}))}const Fx=[7,8,16],zx=[6,7,15,16];function Ux(e,t){e.eachAtom((e=>{if(Fx.includes(e.number)){let n=!1;if(e.eachBondedAtom((e=>{zx.includes(e.number)&&(n=!0)})),n){const n=$v(7);Wv(n,e),qv(t,n)}}}))}function Hx(e,t){return 7===e&&6===t||6===e&&7===t}const Gx=Qp(180),Vx=Qp(120);function jx(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=bp(n.maxHalogenBondDist,Qx.maxHalogenBondDist),r=Qp(bp(n.maxHalogenBondAngle,Qx.maxHalogenBondAngle)),o=bp(n.masterModelIndex,Qx.masterModelIndex),{features:s,spatialHash:a,contactStore:l,featureSet:c}=t,{types:u,centers:h,atomSets:d}=s,{x:p,y:f,z:m}=h,g=u.length,y=e.getAtomProxy(),v=e.getAtomProxy();for(let b=0;b<g;++b)a.eachWithin(p[b],f[b],m[b],i,((e,t)=>{if(e<=b)return;if(y.index=d[b][0],v.index=d[e][0],ew(y,v,o))return;if(!Hx(u[b],u[e]))return;const[n,i]=6===u[b]?[y,v]:[v,y],s=Xb(n,i);if(1!==s.length)return;if(Gx-s[0]>r)return;const a=Xb(i,n);0!==a.length&&(a.some((e=>Vx-e>r))||(c.setBits(b,e),l.addContact(b,e,5)))}))}function $x(e,t,n){return!Jx(e,t,n)&&(e.modelIndex!==t.modelIndex||e.altloc&&t.altloc&&e.altloc!==t.altloc)}function Wx(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e.Debug&&gm.time("refineLineOfSight");const r=bp(i.lineOfSightDistFactor,Qx.lineOfSightDistFactor),o=bp(i.masterModelIndex,Qx.masterModelIndex),s=t.spatialHash,{contactSet:a,contactStore:l,features:c}=n,{index1:u,index2:h}=l,{centers:d,atomSets:p}=c,{x:f,y:m,z:g}=d,y=t.getAtomProxy(),v=t.getAtomProxy(),b=t.getAtomProxy(),x=new mn,w=new mn,_=3*r,S=r*r;a.forEach((t=>{x.set(f[u[t]],m[u[t]],g[u[t]]),w.set(f[h[t]],m[h[t]],g[h[t]]);const n=(x.x+w.x)/2,i=(x.y+w.y)/2,r=(x.z+w.z)/2,l=p[u[t]],c=p[h[t]];y.index=l[0],v.index=c[0],s.eachWithin(n,i,r,_,((n,i)=>{b.index=n,1!==b.number&&b.vdw*b.vdw*S>i&&!$x(y,b,o)&&!$x(v,b,o)&&!l.includes(n)&&!c.includes(n)&&x.distanceToSquared(b)>1&&w.distanceToSquared(b)>1&&(a.clear(t),e.Debug&&gm.log("removing",y.qualifiedName(),v.qualifiedName(),"because",b.qualifiedName()))}))})),e.Debug&&gm.timeEnd("refineLineOfSight")}function qx(e,t){const{contactSet:n,contactStore:i,features:r}=t,{type:o,index1:s,index2:a}=i,{atomSets:l}=r,c=e.getAtomProxy(),u=e.getAtomProxy(),h={},d=function(e,t,i){const[r,o]=h[i]||[1/0,-1];e<r?(-1!==o&&n.clear(o),h[i]=[e,t]):n.clear(t)};n.forEach((e=>{if(6!==o[e])return;c.index=l[s[e]][0],u.index=l[a[e]][0];const t=c.distanceTo(u);d(t,e,"".concat(c.index,"|").concat(u.residueIndex)),d(t,e,"".concat(u.index,"|").concat(c.residueIndex))}))}function Xx(e){return 4===e||9===e||10===e}function Yx(e,t){const{contactSet:n,contactStore:i,features:r}=t,{type:o,index1:s,index2:a}=i,{atomSets:l}=r,c={},u=function(e,t){c[e]||(c[e]=[]),c[e].push(t)};n.forEach((e=>{1===o[e]&&(l[s[e]].forEach((t=>u(t,e))),l[a[e]].forEach((t=>u(t,e))))})),n.forEach((e=>{if(!Xx(o[e]))return;const t=c[l[s[e]][0]],i=c[l[a[e]][0]];if(!t||!i)return;const r=t.length;for(let o=0;o<r;++o)if(i.includes(t[o]))return void n.clear(e)}))}function Zx(e,t){const{contactSet:n,contactStore:i,features:r}=t,{type:o,index1:s,index2:a}=i,{atomSets:l}=r,c={},u=function(e,t){c[e]||(c[e]=[]),c[e].push(t)};n.forEach((e=>{3===o[e]&&(l[s[e]].forEach((t=>u(t,e))),l[a[e]].forEach((t=>u(t,e))))})),n.forEach((e=>{if(6!==o[e]&&2!==o[e])return;const t=c[l[s[e]][0]],i=c[l[a[e]][0]];if(!t||!i)return;const r=t.length;for(let o=0;o<r;++o)if(i.includes(t[o]))return void n.clear(e)}))}function Kx(e,t){const{contactSet:n,contactStore:i,features:r}=t,{type:o,index1:s,index2:a}=i,{atomSets:l}=r,c={},u=function(e,t){c[e]||(c[e]=[]),c[e].push(t)};n.forEach((e=>{1===o[e]&&(l[s[e]].forEach((t=>u(t,e))),l[a[e]].forEach((t=>u(t,e))))})),n.forEach((e=>{if(7!==o[e])return;const t=c[l[s[e]][0]],i=c[l[a[e]][0]];if(!t||!i)return;const r=t.length;for(let o=0;o<r;++o)if(i.includes(t[o]))return void n.clear(t[o])}))}const Qx={maxHydrophobicDist:4,maxHbondDist:3.5,maxHbondSulfurDist:4.1,maxHbondAccAngle:45,maxHbondDonAngle:45,maxHbondAccPlaneAngle:90,maxHbondDonPlaneAngle:30,maxPiStackingDist:5.5,maxPiStackingOffset:2,maxPiStackingAngle:30,maxCationPiDist:6,maxCationPiOffset:2,maxIonicDist:5,maxHalogenBondDist:4,maxHalogenBondAngle:30,maxMetalDist:3,refineSaltBridges:!0,masterModelIndex:-1,lineOfSightDistFactor:1};function Jx(e,t,n){return e.modelIndex===n&&t.modelIndex!==n||t.modelIndex===n&&e.modelIndex!==n}function ew(e,t,n){return!Jx(e,t,n)&&(e.modelIndex!==t.modelIndex||e.residueIndex===t.residueIndex||e.altloc&&t.altloc&&e.altloc!==t.altloc)}function tw(e){const{types:t,centers:n}=e;return{features:e,spatialHash:new Fv(n),contactStore:new Uv,featureSet:new Gv(t.length,!1)}}function nw(e){const{index1:t,index2:n,count:i}=e.contactStore,r=Vv({nodeArray1:t,nodeArray2:n,edgeCount:i,nodeCount:e.featureSet.length}),o=new Gv(e.contactStore.count,!0);return Object.assign({adjacencyList:r,contactSet:o},e)}function iw(t){const n=jv();return e.Debug&&gm.time("calculateFeatures"),ux(t,n),hx(t,n),dx(t,n),xx(t,n),yx(t,n),vx(t,n),Px(t,n),Ix(t,n),kx(t,n),Ux(t,n),Bx(t,n),e.Debug&&gm.timeEnd("calculateFeatures"),n}function rw(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qx;const i=tw(iw(t));e.Debug&&gm.time("calculateContacts"),gx(t,i,n),Tx(t,i,n),Rx(t,i,n),Ox(t,i,n),jx(t,i,n);const r=nw(i);return Wx(t,r,n),qx(t,r),n.refineSaltBridges&&Yx(t,r),Zx(t,r),Kx(t,r),e.Debug&&gm.timeEnd("calculateContacts"),r}function ow(e){switch(e){case 4:case 9:case 10:return"hydrogen bond";case 6:return"hydrophobic contact";case 5:return"halogen bond";case 1:return"ionic interaction";case 7:return"metal coordination";case 2:return"cation-pi interaction";case 3:return"pi-pi stacking";case 8:return"weak hydrogen bond";default:return"unknown contact"}}const sw={hydrogenBond:!0,hydrophobic:!0,halogenBond:!0,ionicInteraction:!0,metalCoordination:!0,cationPi:!0,piStacking:!0,weakHydrogenBond:!0,waterHydrogenBond:!0,backboneHydrogenBond:!0,radius:1,filterSele:""},aw=new Ri;function lw(e){switch(e){case 4:case 9:case 10:return aw.setHex(2851770).toArray();case 6:return aw.setHex(8421504).toArray();case 5:return aw.setHex(4259775).toArray();case 1:return aw.setHex(15779860).toArray();case 7:return aw.setHex(9191577).toArray();case 2:return aw.setHex(16744448).toArray();case 3:return aw.setHex(9220966).toArray();case 8:return aw.setHex(12967404).toArray();default:return aw.setHex(13421772).toArray()}}function cw(e,t,n){const i=xp(n,sw),r=[];i.hydrogenBond&&r.push(4),i.hydrophobic&&r.push(6),i.halogenBond&&r.push(5),i.ionicInteraction&&r.push(1),i.metalCoordination&&r.push(7),i.cationPi&&r.push(2),i.piStacking&&r.push(3),i.weakHydrogenBond&&r.push(8),i.waterHydrogenBond&&r.push(9),i.backboneHydrogenBond&&r.push(10);const{features:o,contactSet:s,contactStore:a}=e,{centers:l,atomSets:c}=o,{x:u,y:h,z:d}=l,{index1:p,index2:f,type:m}=a,g=[],y=[],v=[],b=[],x=[];let w;return i.filterSele&&(w=Array.isArray(i.filterSele)?i.filterSele.map((e=>t.getAtomSet(new Kf(e)))):t.getAtomSet(new Kf(i.filterSele))),s.forEach((e=>{const t=m[e];if(!r.includes(t))return;if(w){const t=c[p[e]][0],n=c[f[e]][0];if(Array.isArray(w)){if(!(w[0].isSet(t)&&w[1].isSet(n)||w[1].isSet(t)&&w[0].isSet(n)))return}else if(!w.isSet(t)&&!w.isSet(n))return}const n=p[e],o=f[e];g.push(u[n],h[n],d[n]),y.push(u[o],h[o],d[o]),v.push(...lw(t)),b.push(i.radius),x.push(e)})),{position1:new Float32Array(g),position2:new Float32Array(y),color:new Float32Array(v),color2:new Float32Array(v),radius:new Float32Array(b),picking:new vw(x,e,t)}}function uw(e,t){const n=fg(e.position1,e.position2),i=[],r=mg(e.position1,e.position2),o=r.length/3;for(let s=0;s<o;s++){const e=3*s,n=Math.sqrt(Math.pow(r[e],2)+Math.pow(r[e+1],2)+Math.pow(r[e+2],2));switch(t.unit){case"angstrom":i[s]=n.toFixed(2)+" "+String.fromCharCode(8491);break;case"nm":i[s]=(n/10).toFixed(2)+" nm";break;default:i[s]=n.toFixed(2)}}return{position:n,size:gg(n.length/3,t.size),color:e.color,text:i}}class hw{constructor(e){this.array=e}get type(){return""}get data(){return{}}getIndex(e){return this.array?this.array[e]:e}getObject(e){return{}}_applyTransformations(e,t,n){return t&&e.applyMatrix4(t.matrix),n&&e.applyMatrix4(n.matrix),e}_getPosition(e){return new mn}getPosition(e,t,n){return this._applyTransformations(this._getPosition(e),t,n)}}class dw extends hw{constructor(e){super(),this.shape=e}get primitive(){}get data(){return this.shape}get type(){return this.primitive.type}getObject(e){return this.primitive.objectFromShape(this.shape,this.getIndex(e))}_getPosition(e){return this.primitive.positionFromShape(this.shape,this.getIndex(e))}}class pw extends dw{get primitive(){return Pv}}class fw extends dw{get primitive(){return Iv}}class mw extends hw{constructor(e,t){super(e),this.structure=t}get type(){return"atom"}get data(){return this.structure}getObject(e){return this.structure.getAtomProxy(this.getIndex(e))}_getPosition(e){return(new mn).copy(this.getObject(e))}}class gw extends hw{constructor(e){super(),this.axes=e}get type(){return"axes"}get data(){return this.axes}getObject(){return{axes:this.axes}}_getPosition(){return this.axes.center.clone()}}class yw extends hw{constructor(e,t,n){super(e),this.structure=t,this.bondStore=n||t.bondStore}get type(){return"bond"}get data(){return this.structure}getObject(e){const t=this.structure.getBondProxy(this.getIndex(e));return t.bondStore=this.bondStore,t}_getPosition(e){const t=this.getObject(e);return(new mn).copy(t.atom1).add(t.atom2).multiplyScalar(.5)}}class vw extends hw{constructor(e,t,n){super(e),this.contacts=t,this.structure=n}get type(){return"contact"}get data(){return this.contacts}getObject(e){const t=this.getIndex(e),{features:n,contactStore:i}=this.contacts,{centers:r,atomSets:o}=n,{x:s,y:a,z:l}=r,{index1:c,index2:u,type:h}=i,d=c[t],p=u[t];return{center1:new mn(s[d],a[d],l[d]),center2:new mn(s[p],a[p],l[p]),atom1:this.structure.getAtomProxy(o[d][0]),atom2:this.structure.getAtomProxy(o[p][0]),type:ow(h[t])}}_getPosition(e){const{center1:t,center2:n}=this.getObject(e);return(new mn).addVectors(t,n).multiplyScalar(.5)}}class bw extends dw{get primitive(){return Lv}}class xw extends hw{constructor(e,t,n){super(e),this.validation=t,this.structure=n}get type(){return"clash"}get data(){return this.validation}getObject(e){const t=this.validation,n=this.getIndex(e);return{validation:t,index:n,clash:t.clashArray[n]}}_getAtomProxyFromSele(e){const t=new Kf(e),n=this.structure.getAtomIndices(t)[0];return this.structure.getAtomProxy(n)}_getPosition(e){const t=this.getObject(e).clash,n=this._getAtomProxyFromSele(t.sele1),i=this._getAtomProxyFromSele(t.sele2);return(new mn).copy(n).add(i).multiplyScalar(.5)}}class ww extends yw{get type(){return"distance"}}class _w extends dw{get primitive(){return Rv}}class Sw extends dw{get primitive(){return Tv}}class Mw extends dw{get primitive(){return Cv}}class Aw extends hw{get type(){return"ignore"}}class Cw extends dw{constructor(e,t){super(e),this.mesh=t}get type(){return"mesh"}getObject(){const e=this.mesh;return{shape:this.shape,name:e.name,serial:e.serial}}_getPosition(){return this.__position||(this.__position=Yy(this.mesh.position)),this.__position}}class Tw extends dw{get primitive(){return Av}}class Ew extends hw{constructor(e,t){super(e),this.surface=t}get type(){return"surface"}get data(){return this.surface}getObject(e){return{surface:this.surface,index:this.getIndex(e)}}_getPosition(){return this.surface.center.clone()}}class Pw extends dw{get primitive(){return Ev}}class Iw extends dw{get primitive(){return kv}}class Lw extends hw{constructor(e,t){super(),this.unitcell=e,this.structure=t}get type(){return"unitcell"}get data(){return this.unitcell}getObject(){return{unitcell:this.unitcell,structure:this.structure}}_getPosition(){return this.unitcell.getCenter(this.structure)}}class Rw extends hw{constructor(e,t){super(e),this.volume=t}get type(){return"volume"}get data(){return this.volume}getObject(e){const t=this.volume,n=this.getIndex(e);return{volume:t,index:n,value:t.data[n]}}_getPosition(e){const t=this.volume.position,n=this.getIndex(e);return new mn(t[3*n],t[3*n+1],t[3*n+2])}}class kw extends Rw{get type(){return"slice"}}class Dw extends dw{get primitive(){return Ov}}class Ow extends dw{get primitive(){return Nv}}function Nw(){return new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0])}function Bw(){return new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1])}function Fw(e,t,n,i,r){var o,s,a,l,c,u,h,d=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]],p=0,f=!1,m=!1,g=!1,y=!1,v=-1,b=t*n*i,x=t,w=t*n,_=new Int32Array(12),S=[],M=[],A=[],C=[],T=Nw(),E=Bw();function P(e,t,n){return e+(t-e)*n}function I(e,r,o){return w*(o=(o+h)%i)+x*(r=(r+u)%n)+(e=(e+c)%t)}function L(e,t,n,i,l,c,u){var h=3*e;if(s[h]<0){var d=(p-c)/(u-c),m=o,g=3*a;if(S[g]=n+d,S[g+1]=i,S[g+2]=l,!f){var y=3*e;M[g]=v*P(m[y],m[y+3],d),M[g+1]=v*P(m[y+1],m[y+4],d),M[g+2]=v*P(m[y+2],m[y+5],d)}r&&(C[a]=r[e+Math.round(d)]),s[h]=a,_[t]=a,a+=1}else _[t]=s[h]}function R(e,t,n,i,l,c,u){var h=3*e+1;if(s[h]<0){var d=(p-c)/(u-c),m=o,g=3*a;if(S[g]=n,S[g+1]=i+d,S[g+2]=l,!f){var y=3*e,b=y+3*x;M[g]=v*P(m[y],m[b],d),M[g+1]=v*P(m[y+1],m[b+1],d),M[g+2]=v*P(m[y+2],m[b+2],d)}r&&(C[a]=r[e+Math.round(d)*x]),s[h]=a,_[t]=a,a+=1}else _[t]=s[h]}function k(e,t,n,i,l,c,u){var h=3*e+2;if(s[h]<0){var d=(p-c)/(u-c),m=o,g=3*a;if(S[g]=n,S[g+1]=i,S[g+2]=l+d,!f){var y=3*e,b=y+3*w;M[g]=v*P(m[y],m[b],d),M[g+1]=v*P(m[y+1],m[b+1],d),M[g+2]=v*P(m[y+2],m[b+2],d)}r&&(C[a]=r[e+Math.round(d)*w]),s[h]=a,_[t]=a,a+=1}else _[t]=s[h]}function D(t){var n=3*t;0===o[n]&&(o[n]=e[(t-1+b)%b]-e[(t+1)%b],o[n+1]=e[(t-x+b)%b]-e[(t+x)%b],o[n+2]=e[(t-w+b)%b]-e[(t+w)%b])}function O(t,n,i,r,o){var s,a,c,u,h,v,b;g?(r=I(t,n,i),s=I(t+1,n,i),a=I(t,n+1,i),c=I(t,n,i+1),u=I(t+1,n+1,i),h=I(t+1,n,i+1),v=I(t,n+1,i+1),b=I(t+1,n+1,i+1)):(s=r+1,u=(a=r+x)+1,h=(c=r+w)+1,b=(v=a+w)+1);var S=0,M=e[r],C=e[s],P=e[a],O=e[u],N=e[c],B=e[h],F=e[v],z=e[b];M<p&&(S|=1),C<p&&(S|=2),P<p&&(S|=8),O<p&&(S|=4),N<p&&(S|=16),B<p&&(S|=32),F<p&&(S|=128),z<p&&(S|=64);var U=T[S];if(0===U)return 0;var H=t+1,G=n+1,V=i+1;1&U&&(f||(D(r),D(s)),L(r,0,t,n,i,M,C)),2&U&&(f||(D(s),D(u)),R(s,1,H,n,i,C,O)),4&U&&(f||(D(a),D(u)),L(a,2,t,G,i,P,O)),8&U&&(f||(D(r),D(a)),R(r,3,t,n,i,M,P)),16&U&&(f||(D(c),D(h)),L(c,4,t,n,V,N,B)),32&U&&(f||(D(h),D(b)),R(h,5,H,n,V,B,z)),64&U&&(f||(D(v),D(b)),L(v,6,t,G,V,F,z)),128&U&&(f||(D(c),D(v)),R(c,7,t,n,V,N,F)),256&U&&(f||(D(r),D(c)),k(r,8,t,n,i,M,N)),512&U&&(f||(D(s),D(h)),k(s,9,H,n,i,C,B)),1024&U&&(f||(D(u),D(b)),k(u,10,H,G,i,O,z)),2048&U&&(f||(D(a),D(v)),k(a,11,t,G,i,P,F));for(var j,$,W,q=S<<4,X=0;-1!==E[q+X];)j=E[q+X],$=E[q+X+1],W=E[q+X+2],m?(d[j][$]&o&&(A[l++]=_[j],A[l++]=_[$]),d[$][W]&o&&(A[l++]=_[$],A[l++]=_[W]),d[j][W]&o&&(A[l++]=_[j],A[l++]=_[W])):(A[l++]=_[y?j:$],A[l++]=_[y?$:j],A[l++]=_[W]),X+=3}function N(r,o,a,l,c,u){let h,d,m,y,v,b,_,S,M,A,C,T,E;if(r=void 0!==r?r:0,o=void 0!==o?o:0,a=void 0!==a?a:0,l=void 0!==l?l:t-1,c=void 0!==c?c:n-1,u=void 0!==u?u:i-1,g||(f?(r=Math.max(0,r),o=Math.max(0,o),a=Math.max(0,a),l=Math.min(t-1,l),c=Math.min(n-1,c),u=Math.min(i-1,u)):(r=Math.max(1,r),o=Math.max(1,o),a=Math.max(1,a),l=Math.min(t-2,l),c=Math.min(n-2,c),u=Math.min(i-2,u))),g)for(S=r-2,M=o-2,A=a-2,C=l+2,T=c+2,E=u+2,v=A;v<E;++v)for(y=M;y<T;++y)for(m=S;m<C;++m)d=3*I(m,y,v),s[d]=-1,s[d+1]=-1,s[d+2]=-1;else for(S=Math.max(0,r-2),M=Math.max(0,o-2),A=Math.max(0,a-2),C=Math.min(t,l+2),T=Math.min(n,c+2),E=Math.min(i,u+2),v=A;v<E;++v)for(_=w*v,y=M;y<T;++y)for(b=_+x*y,m=S;m<C;++m)h=3*(b+m),s[h]=-1,s[h+1]=-1,s[h+2]=-1;if(!g){var P,L=r,R=o,k=a,D=l,N=c,B=u;for(P=!1,v=a;v<u;++v){for(y=o;y<c;++y){for(m=r;m<l;++m)if(h=t*n*v+t*y+m,e[h]>=p){k=v,P=!0;break}if(P)break}if(P)break}for(P=!1,y=o;y<c;++y){for(v=k;v<u;++v){for(m=r;m<l;++m)if(h=t*n*v+t*y+m,e[h]>=p){R=y,P=!0;break}if(P)break}if(P)break}for(P=!1,m=r;m<l;++m){for(y=R;y<c;++y){for(v=k;v<u;++v)if(h=t*n*v+t*y+m,e[h]>=p){L=m,P=!0;break}if(P)break}if(P)break}for(P=!1,v=u;v>=a;--v){for(y=c;y>=o;--y){for(m=l;m>=r;--m)if(h=t*n*v+t*y+m,e[h]>=p){B=v,P=!0;break}if(P)break}if(P)break}for(P=!1,y=c;y>=o;--y){for(v=B;v>=a;--v){for(m=l;m>=r;--m)if(h=t*n*v+t*y+m,e[h]>=p){N=y,P=!0;break}if(P)break}if(P)break}for(P=!1,m=l;m>=r;--m){for(y=N;y>=o;--y){for(v=B;v>=a;--v)if(h=t*n*v+t*y+m,e[h]>=p){D=m,P=!0;break}if(P)break}if(P)break}f?(r=Math.max(0,L-1),o=Math.max(0,R-1),a=Math.max(0,k-1),l=Math.min(t-1,D+1),c=Math.min(n-1,N+1),u=Math.min(i-1,B+1)):(r=Math.max(1,L-1),o=Math.max(1,R-1),a=Math.max(1,k-1),l=Math.min(t-2,D+1),c=Math.min(n-2,N+1),u=Math.min(i-2,B+1))}var F=15;for(v=a;v<u;++v,F&=-5)for(_=w*v,F|=2,y=o;y<c;++y,F&=-3)for(b=_+x*y,F|=1,m=r;m<l;++m,F&=-2)h=b+m,O(m,y,v,h,F)}this.triangulate=function(e,d,x,w,_){y=(p=e)<0,m=w,g=_,(f=d||m)||(v=p>0?-1:1,o||(o=new Float32Array(3*b)));var T=3*b;if(s&&s.length===T||(s=new Int32Array(T)),a=0,l=0,void 0!==x){var E=x[0].map(Math.round),P=x[1].map(Math.round);c=t*Math.ceil(Math.abs(E[0])/t),u=n*Math.ceil(Math.abs(E[1])/n),h=i*Math.ceil(Math.abs(E[2])/i),N(E[0],E[1],E[2],P[0],P[1],P[2])}else c=u=h=0,N();return S.length=3*a,f||(M.length=3*a),A.length=l,r&&(C.length=a),{position:new Float32Array(S),normal:f?void 0:new Float32Array(M),index:Fp(A,S.length/3),atomindex:r?new Int32Array(C):void 0,contour:m}}}Lm.add("arrow",fw),Lm.add("box",Mw),Lm.add("cone",bw),Lm.add("cylinder",pw),Lm.add("ellipsoid",_w),Lm.add("octahedron",Sw),Lm.add("sphere",Tw),Lm.add("tetrahedron",Pw),Lm.add("torus",Iw),Lm.add("point",Dw),Lm.add("wideline",Ow),Object.assign(Fw,{__deps:[Nw,Bw,Fp]});class zw{constructor(e,t){this.cols=e,this.rows=t,this.size=this.cols*this.rows,this.data=new Float32Array(this.size)}copyTo(e){e.data.set(this.data)}}function Uw(e,t){let n=0,i=0;const r=t.rows,o=t.cols;let s=0,a=0,l=0;const c=t.data,u=e.data;for(;n<r;a+=1,s+=o,n++)for(l=a,i=0;i<o;l+=r,i++)u[l]=c[s+i]}function Hw(e,t,n){let i=0,r=0,o=0,s=0,a=0,l=0,c=0,u=0;const h=t.cols,d=t.rows,p=n.cols,f=t.data,m=n.data,g=e.data;let y=0;for(;i<d;s+=h,i++)for(c=0,r=0;r<p;u++,c++,r++){for(l=c,a=s,y=0,o=0;o<h;a++,l+=p,o++)y+=f[a]*m[l];g[u]=y}}function Gw(e,t,n){let i=0,r=0,o=0,s=0,a=0,l=0,c=0;const u=t.cols,h=t.rows,d=n.rows,p=t.data,f=n.data,m=e.data;let g=0;for(;i<h;s+=u,i++)for(l=0,r=0;r<d;c++,r++){for(a=s,g=0,o=0;o<u;a++,l++,o++)g+=p[a]*f[l];m[c]=g}}function Vw(e,t){const n=e.data,i=t.data,r=n[4],o=n[8],s=n[5],a=n[7],l=n[0],c=l*r,u=l*s,h=n[3],d=n[1],p=h*d,f=n[2],m=h*f,g=n[6],y=g*d,v=g*f,b=1/(c*o-u*a-p*o+m*a+y*s-v*r);i[0]=(r*o-s*a)*b,i[1]=-(d*o-f*a)*b,i[2]=-(-d*s+f*r)*b,i[3]=-(h*o-s*g)*b,i[4]=(l*o-v)*b,i[5]=-(u-m)*b,i[6]=-(-h*a+r*g)*b,i[7]=-(l*a-y)*b,i[8]=(c-p)*b}function jw(e){const t=e.data;return t[0]*t[4]*t[8]-t[0]*t[5]*t[7]-t[3]*t[1]*t[8]+t[3]*t[2]*t[7]+t[6]*t[1]*t[5]-t[6]*t[2]*t[4]}function $w(e,t,n){const i=e.data,r=t.data,o=n.data,s=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],d=r[6],p=r[7],f=r[8],m=o[0],g=o[1],y=o[2],v=o[3],b=o[4],x=o[5],w=o[6],_=o[7],S=o[8];i[0]=s*m+a*v+l*w,i[1]=s*g+a*b+l*_,i[2]=s*y+a*x+l*S,i[3]=c*m+u*v+h*w,i[4]=c*g+u*b+h*_,i[5]=c*y+u*x+h*S,i[6]=d*m+p*v+f*w,i[7]=d*g+p*b+f*_,i[8]=d*y+p*x+f*S}function Ww(e){const t=e.rows,n=e.cols,i=e.data,r=new Array(n);for(let o=0;o<n;++o)r[o]=0;for(let o=0,s=0;o<t;++o)for(let e=0;e<n;++e,++s)r[e]+=i[s];for(let o=0;o<n;++o)r[o]/=t;return r}function qw(e,t){const n=e.rows,i=e.cols,r=e.data;for(let o=0,s=0;o<n;++o)for(let e=0;e<i;++e,++s)r[s]-=t[e]}function Xw(e,t,n,i){i=e[t],e[t]=e[n],e[n]=i}function Yw(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}const Zw=1.192092896e-7,Kw=1e-37;function Qw(e,t,n,i,r,o,s,a){const l=2*Zw,c=Kw;let u=0,h=0,d=0,p=0;const f=Math.max(o,30);let m=0,g=0,y=0,v=0,b=0,x=0,w=0,_=0,S=0,M=0,A=0,C=0,T=0,E=0,P=0,I=0,L=0,R=4660,k=0,D=0,O=0;const N=new Float64Array(s<<3);for(;u<s;u++){for(d=0,A=0;d<o;d++)_=e[u*t+d],A+=_*_;if(N[u]=A,i){for(d=0;d<s;d++)i[u*r+d]=0;i[u*r+u]=1}}for(;p<f;p++){for(b=0,u=0;u<s-1;u++)for(h=u+1;h<s;h++){for(m=u*t|0,g=h*t|0,P=N[u],I=0,L=N[h],d=2,I+=e[m]*e[g],I+=e[m+1]*e[g+1];d<o;d++)I+=e[m+d]*e[g+d];if(!(Math.abs(I)<=l*Math.sqrt(P*L))){for(I*=2,C=P-L,T=Yw(I,C),C<0?(E=.5*(T-C),w=Math.sqrt(E/T),x=I/(T*w*2)):(x=Math.sqrt((T+C)/(2*T)),w=I/(T*x*2)),P=0,L=0,d=2,S=x*e[m]+w*e[g],M=-w*e[m]+x*e[g],e[m]=S,e[g]=M,P+=S*S,L+=M*M,S=x*e[m+1]+w*e[g+1],M=-w*e[m+1]+x*e[g+1],e[m+1]=S,e[g+1]=M,P+=S*S,L+=M*M;d<o;d++)S=x*e[m+d]+w*e[g+d],M=-w*e[m+d]+x*e[g+d],e[m+d]=S,e[g+d]=M,P+=S*S,L+=M*M;if(N[u]=P,N[h]=L,b=1,i)for(y=u*r|0,v=h*r|0,d=2,S=x*i[y]+w*i[v],M=-w*i[y]+x*i[v],i[y]=S,i[v]=M,S=x*i[y+1]+w*i[v+1],M=-w*i[y+1]+x*i[v+1],i[y+1]=S,i[v+1]=M;d<s;d++)S=x*i[y+d]+w*i[v+d],M=-w*i[y+d]+x*i[v+d],i[y+d]=S,i[v+d]=M}}if(0===b)break}for(u=0;u<s;u++){for(d=0,A=0;d<o;d++)_=e[u*t+d],A+=_*_;N[u]=Math.sqrt(A)}for(u=0;u<s-1;u++){for(h=u,d=u+1;d<s;d++)N[h]<N[d]&&(h=d);if(u!==h&&(Xw(N,u,h,A),i)){for(d=0;d<o;d++)Xw(e,u*t+d,h*t+d,_);for(d=0;d<s;d++)Xw(i,u*r+d,h*r+d,_)}}for(u=0;u<s;u++)n[u]=N[u];if(i)for(u=0;u<a;u++){for(A=u<s?N[u]:0;A<=c;){for(D=1/o,d=0;d<o;d++)R=214013*R+2531011,k=0!==(256&R>>16)?D:-D,e[u*t+d]=k;for(p=0;p<2;p++)for(h=0;h<u;h++){for(A=0,d=0;d<o;d++)A+=e[u*t+d]*e[h*t+d];for(O=0,d=0;d<o;d++)_=e[u*t+d]-A*e[h*t+d],e[u*t+d]=_,O+=Math.abs(_);for(O=O?1/O:0,d=0;d<o;d++)e[u*t+d]*=O}for(A=0,d=0;d<o;d++)_=e[u*t+d],A+=_*_;A=Math.sqrt(A)}for(w=1/A,d=0;d<o;d++)e[u*t+d]*=w}}function Jw(e,t,n,i){let r=0,o=0;const s=e.rows,a=e.cols;let l=s,c=a;l<c&&(r=1,o=l,l=c,c=o);const u=new zw(l,l),h=new zw(1,c),d=new zw(c,c);if(0===r)Uw(u,e);else{for(o=0;o<a*s;o++)u.data[o]=e.data[o];for(;o<c*l;o++)u.data[o]=0}if(Qw(u.data,l,h.data,d.data,c,l,c,l),t){for(o=0;o<c;o++)t.data[o]=h.data[o];for(;o<a;o++)t.data[o]=0}0===r?(n&&Uw(n,u),i&&Uw(i,d)):(n&&Uw(n,d),i&&Uw(i,u))}function e_(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function t_(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g){e[0]=t,e[4]=n,e[8]=i,e[12]=r,e[1]=o,e[5]=s,e[9]=a,e[13]=l,e[2]=c,e[6]=u,e[10]=h,e[14]=d,e[3]=p,e[7]=f,e[11]=m,e[15]=g}function n_(e,t,n){const i=t[0],r=t[4],o=t[8],s=t[12],a=t[1],l=t[5],c=t[9],u=t[13],h=t[2],d=t[6],p=t[10],f=t[14],m=t[3],g=t[7],y=t[11],v=t[15],b=n[0],x=n[4],w=n[8],_=n[12],S=n[1],M=n[5],A=n[9],C=n[13],T=n[2],E=n[6],P=n[10],I=n[14],L=n[3],R=n[7],k=n[11],D=n[15];e[0]=i*b+r*S+o*T+s*L,e[4]=i*x+r*M+o*E+s*R,e[8]=i*w+r*A+o*P+s*k,e[12]=i*_+r*C+o*I+s*D,e[1]=a*b+l*S+c*T+u*L,e[5]=a*x+l*M+c*E+u*R,e[9]=a*w+l*A+c*P+u*k,e[13]=a*_+l*C+c*I+u*D,e[2]=h*b+d*S+p*T+f*L,e[6]=h*x+d*M+p*E+f*R,e[10]=h*w+d*A+p*P+f*k,e[14]=h*_+d*C+p*I+f*D,e[3]=m*b+g*S+y*T+v*L,e[7]=m*x+g*M+y*E+v*R,e[11]=m*w+g*A+y*P+v*k,e[15]=m*_+g*C+y*I+v*D}function i_(e,t,n,i){t_(e,t,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1)}function r_(e,t,n,i){t_(e,1,0,0,t,0,1,0,n,0,0,1,i,0,0,0,1)}function o_(e,t){const n=Math.cos(t),i=Math.sin(t);t_(e,n,0,i,0,0,1,0,0,-i,0,n,0,0,0,0,1)}function s_(){return new Float32Array([1,0,0,0,1,0,0,0,1])}function a_(e,t){const n=tv([t[0],t[1],t[2]]),i=tv([t[4],t[5],t[6]]),r=tv([t[8],t[9],t[10]]),o=tv();nv(o,i,r),e[0]=o[0],e[1]=o[1],e[2]=o[2],nv(o,r,n),e[3]=o[0],e[4]=o[1],e[5]=o[2],nv(o,n,i),e[6]=o[0],e[7]=o[1],e[8]=o[2]}function l_(e,t,n,i){n=n||1,i=i||!0;const r=e.length/3,o=t.length/3;let s;i&&(s=new Float32Array(3*r));const a=new Float32Array(3*r);let l;const c=20,u=new Array(c);for(l=0;l<c;++l)u[l]=new Uint32Array(r);for(l=0;l<r;++l)u[0][l]=0;let h,d,p;for(l=0;l<o;++l){var f=3*l,m=3*l+1,g=3*l+2;for(p=!0,h=0,d=u[0][t[f]];h<d;++h)if(t[m]===u[h+1][t[f]]){p=!1;break}for(p&&(u[0][t[f]]++,u[u[0][t[f]]][t[f]]=t[m]),p=!0,h=0,d=u[0][t[f]];h<d;++h)if(t[g]===u[h+1][t[f]]){p=!1;break}for(p&&(u[0][t[f]]++,u[u[0][t[f]]][t[f]]=t[g]),p=!0,h=0,d=u[0][t[m]];h<d;++h)if(t[f]===u[h+1][t[m]]){p=!1;break}for(p&&(u[0][t[m]]++,u[u[0][t[m]]][t[m]]=t[f]),p=!0,h=0,d=u[0][t[m]];h<d;++h)if(t[g]===u[h+1][t[m]]){p=!1;break}for(p&&(u[0][t[m]]++,u[u[0][t[m]]][t[m]]=t[g]),p=!0,h=0;h<u[0][t[g]];++h)if(t[f]===u[h+1][t[g]]){p=!1;break}for(p&&(u[0][t[g]]++,u[u[0][t[g]]][t[g]]=t[f]),p=!0,h=0,d=u[0][t[g]];h<d;++h)if(t[m]===u[h+1][t[g]]){p=!1;break}p&&(u[0][t[g]]++,u[u[0][t[g]]][t[g]]=t[m])}for(var y,v,b,x,w,_=1,S=.5,M=-1,A=.75/4.5,C=0;C<n;++C){for(l=0;l<r;++l)if(y=3*l,(b=u[0][l])<3)a[y]=e[y],a[y+1]=e[y+1],a[y+2]=e[y+2];else if(3===b||4===b){for(a[y]=0,a[y+1]=0,a[y+2]=0,h=0;h<b;++h)v=3*u[h+1][l],a[y]+=e[v],a[y+1]+=e[v+1],a[y+2]+=e[v+2];a[y]+=S*e[y],a[y+1]+=S*e[y+1],a[y+2]+=S*e[y+2],w=S+b,a[y]/=w,a[y+1]/=w,a[y+2]/=w}else{for(a[y]=0,a[y+1]=0,a[y+2]=0,h=0;h<b;++h)v=3*u[h+1][l],a[y]+=e[v],a[y+1]+=e[v+1],a[y+2]+=e[v+2];a[y]+=_*e[y],a[y+1]+=_*e[y+1],a[y+2]+=_*e[y+2],x=_+b,a[y]/=x,a[y+1]/=x,a[y+2]/=x}if(e.set(a),i){c_(e,t,s);var T=3*r;for(y=0;y<T;y+=3)e[y]+=M*A*s[y],e[y+1]+=M*A*s[y+1],e[y+2]+=M*A*s[y+2]}}}function c_(e,t,n){var i,r;if(void 0===n)n=new Float32Array(e.length);else for(i=0,r=n.length;i<r;i++)n[i]=0;var o=new Float32Array(3),s=new Float32Array(3),a=new Float32Array(3),l=new Float32Array(3),c=new Float32Array(3);if(t)for(i=0,r=t.length;i<r;i+=3){var u=3*t[i],h=3*t[i+1],d=3*t[i+2];sv(o,e,u),sv(s,e,h),sv(a,e,d),rv(l,a,s),rv(c,o,s),nv(l,l,c),n[u]+=l[0],n[u+1]+=l[1],n[u+2]+=l[2],n[h]+=l[0],n[h+1]+=l[1],n[h+2]+=l[2],n[d]+=l[0],n[d+1]+=l[1],n[d+2]+=l[2]}else for(i=0,r=e.length;i<r;i+=9)sv(o,e,i),sv(s,e,i+3),sv(a,e,i+6),rv(l,a,s),rv(c,o,s),nv(l,l,c),n[i]=l[0],n[i+1]=l[1],n[i+2]=l[2],n[i+3]=l[0],n[i+4]=l[1],n[i+5]=l[2],n[i+6]=l[0],n[i+7]=l[1],n[i+8]=l[2];return ev(n),n}function u_(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t}function h_(e,t,n,i,r){var o=1/i*3;pv(e,e,r+(o+=n)),fv(t,t,r+o),hv(e,e,i),mv(e,e),uv(e,e,i),hv(t,t,i),gv(t,t),uv(t,t,i);var s=new Float32Array(3);rv(s,t,e),hv(s,s,i),gv(s,s),fv(s,s,1);var a=256*Math.pow(10,6),l=s[0]*s[1]*s[2]*3;a<=l&&(hv(e,e,i*=Math.pow(a/l,1/3)),mv(e,e),uv(e,e,i),hv(t,t,i),gv(t,t),uv(t,t,i),rv(s,t,e),hv(s,s,i),gv(s,s),fv(s,s,1));var c=new Float32Array(e);yv(c,c);var u=e_(),h=e_();o_(h,Qp(90)),n_(u,u,h);var d=e_();i_(d,-1/i,1/i,1/i),n_(u,u,d);var p=e_();return r_(p,-i*c[2],-i*c[1],-i*c[0]),n_(u,u,p),{dim:s,tran:c,matrix:u,scaleFactor:i}}i_.__deps=[t_],r_.__deps=[t_],o_.__deps=[t_],a_.__deps=[tv,nv],Object.assign(l_,{__deps:[c_]}),Object.assign(c_,{__deps:[rv,nv,sv,ev]}),Object.assign(h_,{__deps:[Qp,pv,fv,uv,hv,mv,gv,rv,yv,e_,n_,r_,i_,o_]});class d_{constructor(e,t,n){this.name=e||"",this.path=t||"",this.info={},this.center=new mn,this.boundingBox=new ni,n instanceof Rr||n instanceof ar||n instanceof fa?this.fromGeometry(n):n&&(this.set(n.position,n.index,n.normal,n.color,n.atomindex,n.contour),this.boundingBox.setFromArray(n.position),this.boundingBox.getCenter(this.center))}get type(){return"Surface"}set(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.position=e,this.index=t,this.normal=n,this.color=i,this.atomindex=r,this.size=e.length/3,this.contour=o}fromGeometry(t){let n,i,r,o,s;if(e.Debug&&gm.time("GeometrySurface.fromGeometry"),t instanceof Rr?(t.computeVertexNormals(!0),n=(new ar).fromGeometry(t)):n=t instanceof ar?t:t[0],n.boundingBox||n.computeBoundingBox(),this.boundingBox.copy(n.boundingBox),this.boundingBox.getCenter(this.center),n instanceof ar){const e=n.attributes,t=!!e.normal&&e.normal.array;(!t||0===t[0]&&0===t[1]&&0===t[2])&&n.computeVertexNormals(),i=e.position.array,o=e.index?e.index.array:null,s=e.normal.array}this.set(i,o,s,r,void 0),e.Debug&&gm.timeEnd("GeometrySurface.setGeometry")}getPosition(){return this.position}getColor(e){const t=e||{};t.surface=this;const n=this.size,i=new Float32Array(3*n),r=Sm.getScheme(t);if(r.volumeColor||"random"===t.scheme)for(let s=0;s<n;++s)r.volumeColorToArray(s,i,3*s);else if(r.positionColor){const e=new mn,t=this.position;for(let s=0;s<n;++s){var o=3*s;e.set(t[o],t[o+1],t[o+2]),r.positionColorToArray(e,i,o)}}else if(r.atomColor&&this.atomindex){const e=t.structure.getAtomProxy(),o=this.atomindex;for(let t=0;t<n;++t)e.index=o[t],r.atomColorToArray(e,i,3*t)}else{const e=new Ri(t.value);yg(n,e.r,e.g,e.b,i)}return i}getPicking(e){return this.atomindex&&e?new mw(this.atomindex,e):new Ew(bg(this.size),this)}getNormal(){return this.normal}getSize(e,t){return gg(this.size,e*t)}getIndex(){return this.index}getFilteredIndex(e,t){if(e&&this.atomindex){const n=new Kf(e),i=t.getAtomSet(n),r=[],o=this.atomindex,s=this.index,a=s.length,l=this.contour?2:3;let c=0;for(let e=0;e<a;e+=l){let t=!0;for(let n=0;n<l;n++){const r=o[s[e+n]];if(!i.get(r)){t=!1;break}}if(t)for(let n=0;n<l;n++,c++)r[c]=s[e+n]}return Fp(r,this.position.length/3)}return this.index}getAtomindex(){return this.atomindex}dispose(){}}function p_(e,t,n,i,r){var o=new Fw(e,t,n,i,r);function s(e,t,n,i,r){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=o.triangulate(e,t,n,r,s);if(t&&!r&&(l_(a.position,a.index,t,!0),a.normal=c_(a.position,a.index)),i&&(Qy(i,a.position),a.normal)){const e=s_();a_(e,i),Jy(e,a.normal)}return a}this.getSurface=s}Object.assign(p_,{__deps:[l_,c_,Fw,Qy,Jy,s_,a_]}),_m.add("surf",(function(e,t){const n=e.data.args,i=e.data.params;if(n&&(self.volsurf=new p_(n[0],n[1],n[2],n[3],n[4])),i){const e=self.volsurf.getSurface(i.isolevel,i.smooth,i.box,i.matrix,i.contour,i.wrap),n=[e.position.buffer,e.index.buffer];e.normal&&n.push(e.normal.buffer),e.atomindex&&n.push(e.atomindex.buffer),t({sd:e,p:i},n)}}),[p_]);class f_{constructor(e,t,n,i,r,o,s){this.name=e,this.path=t,this.matrix=new Sn,this.normalMatrix=new rn,this.inverseMatrix=new Sn,this.center=new mn,this.boundingBox=new ni,this.setData(n,i,r,o,s)}get type(){return"Volume"}setData(e,t,n,i,r){this.nx=t||1,this.ny=n||1,this.nz=i||1,this.data=e||new Float32Array(1),this.setAtomindex(r),this._position=new Float32Array,delete this._min,delete this._max,delete this._mean,delete this._rms,this.worker&&this.worker.terminate()}setStats(e,t,n,i){this._min=e,this._max=t,this._mean=n,this._rms=i}setMatrix(e){this.matrix.copy(e);const t=this.boundingBox,n=this.center,i=this.nx-1,r=this.ny-1,o=this.nz-1;t.makeEmpty(),t.expandByPoint(n.set(i,r,o)),t.expandByPoint(n.set(i,r,0)),t.expandByPoint(n.set(i,0,o)),t.expandByPoint(n.set(i,0,0)),t.expandByPoint(n.set(0,r,o)),t.expandByPoint(n.set(0,0,o)),t.expandByPoint(n.set(0,r,0)),t.expandByPoint(n.set(0,0,0)),t.applyMatrix4(this.matrix),t.getCenter(this.center);const s=this.matrix.elements,a=new mn(s[0],s[1],s[2]),l=new mn(s[4],s[5],s[6]),c=new mn(s[8],s[9],s[10]),u=new mn,h=this.normalMatrix.elements;u.crossVectors(l,c),h[0]=u.x,h[1]=u.y,h[2]=u.z,u.crossVectors(c,a),h[3]=u.x,h[4]=u.y,h[5]=u.z,u.crossVectors(a,l),h[6]=u.x,h[7]=u.y,h[8]=u.z,this.inverseMatrix.getInverse(this.matrix)}setAtomindex(e){this.atomindex=e}getBox(e,t,n){return n||(n=new ni),n.set(e,e),n.expandByScalar(t),n.applyMatrix4(this.inverseMatrix),n.min.round(),n.max.round(),n}_getBox(e,t){if(!e||!t)return;this.__box||(this.__box=new ni);const n=this.getBox(e,t,this.__box);return[n.min.toArray(),n.max.toArray()]}_makeSurface(e,t,n){const i=this.name+"@"+t.toPrecision(2),r=new d_(i,"",e);return r.info.isolevel=t,r.info.smooth=n,r.info.volume=this,r}getSurface(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];e=isNaN(e)?this.getValueForSigma(2):e,t=bp(t,0),void 0===this.volsurf&&(this.volsurf=new p_(this.data,this.nx,this.ny,this.nz,this.atomindex));const s=this._getBox(n,i),a=this.volsurf.getSurface(e,t,s,this.matrix.elements,r,o);return this._makeSurface(a,e,t)}getSurfaceWorker(e,t,n,i,r,o,s){if(e=isNaN(e)?this.getValueForSigma(2):e,t=t||0,window.hasOwnProperty("Worker")){void 0===this.workerPool&&(this.workerPool=new Xy("surf",2));const a={},l=this.workerPool.getNextWorker();0===l.postCount&&Object.assign(a,{args:[this.data,this.nx,this.ny,this.nz,this.atomindex]}),Object.assign(a,{params:{isolevel:e,smooth:t,box:this._getBox(n,i),matrix:this.matrix.elements,contour:r,wrap:o}}),l.post(a,void 0,(e=>{const t=e.data.sd,n=e.data.p;s(this._makeSurface(t,n.isolevel,n.smooth))}),(a=>{console.warn("Volume.getSurfaceWorker error - trying without worker",a);const l=this.getSurface(e,t,n,i,r,o);s(l)}))}else{const a=this.getSurface(e,t,n,i,r,o);s(a)}}getValueForSigma(e){return this.mean+bp(e,2)*this.rms}getSigmaForValue(e){return(bp(e,0)-this.mean)/this.rms}get position(){if(!this._position){const e=this.nz,t=this.ny,n=this.nx,i=new Float32Array(n*t*e*3);let r=0;for(let o=0;o<e;++o)for(let e=0;e<t;++e)for(let t=0;t<n;++t)i[r+0]=t,i[r+1]=e,i[r+2]=o,r+=3;Qy(this.matrix.elements,i),this._position=i}return this._position}getDataAtomindex(){return this.atomindex}getDataPosition(){return this.position}getDataColor(e){const t=e||{};t.volume=this,t.scale=t.scale||"Spectral",t.domain=t.domain||[this.min,this.max];const n=Sm.getScheme(t),i=this.position.length/3,r=new Float32Array(3*i);for(let o=0;o<i;++o)n.volumeColorToArray(o,r,3*o);return r}getDataPicking(){const e=bg(this.position.length/3);return new Rw(e,this)}getDataSize(e,t){const n=this.data,i=this.position.length/3;let r;switch(e){case"value":case"deviation":r=new Float32Array(n);break;case"abs-value":r=new Float32Array(n);for(let e=0;e<i;++e)r[e]=Math.abs(r[e]);break;case"value-min":{r=new Float32Array(n);const e=this.min;for(let t=0;t<i;++t)r[t]-=e;break}default:r=gg(i,e)}if(1!==t)for(let o=0;o<i;++o)r[o]*=t;return r}get min(){return void 0===this._min&&(this._min=Eg(this.data)),this._min}get max(){return void 0===this._max&&(this._max=Tg(this.data)),this._max}get sum(){return void 0===this._sum&&(this._sum=Pg(this.data)),this._sum}get mean(){return void 0===this._mean&&(this._mean=Ig(this.data)),this._mean}get rms(){return void 0===this._rms&&(this._rms=Lg(this.data)),this._rms}clone(){const e=new f_(this.name,this.path,this.data,this.nx,this.ny,this.nz,this.atomindex);return e.matrix.copy(this.matrix),e.header=Object.assign({},this.header),e}dispose(){this.workerPool&&this.workerPool.terminate()}}function m_(e){return"front"===e?c:"back"===e?u:h}Tm.add("shader/Mesh.vert","#define STANDARD\nuniform float clipNear;\nuniform vec3 clipCenter;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#elif defined( NOLIGHT )\nvarying vec3 vColor;\n#else\n#include color_pars_vertex\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#endif\n#include common\nvoid main(){\n#if defined( PICKING )\nvPickingColor = unpackColor( primitiveId );\n#elif defined( NOLIGHT )\nvColor = color;\n#else\n#include color_vertex\n#include beginnormal_vertex\n#include defaultnormal_vertex\n#ifndef FLAT_SHADED\nvNormal = normalize( transformedNormal );\n#endif\n#endif\n#include begin_vertex\n#include project_vertex\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}"),Tm.add("shader/Mesh.frag","#define STANDARD\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\nuniform float objectId;\nvarying vec3 vPickingColor;\n#elif defined( NOLIGHT )\nvarying vec3 vColor;\n#else\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( PICKING )\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#elif defined( NOLIGHT )\ngl_FragColor = vec4( vColor, opacity );\n#else\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\n#include normal_fragment_begin\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\n#include interior_fragment\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include encodings_fragment\n#include fog_fragment\n#include opaque_back_fragment\n#endif\n}");const g_={f:1,v2:2,v3:3,c:3};function y_(e,t){e.matrix.copy(t),e.matrix.decompose(e.position,e.quaternion,e.scale),e.matrixWorldNeedsUpdate=!0}const v_={opaqueBack:!1,side:"double",opacity:1,depthWrite:!0,clipNear:0,clipRadius:0,clipCenter:new mn,flatShaded:!1,wireframe:!1,roughness:.4,metalness:0,diffuse:16777215,diffuseInterior:!1,useInteriorColor:!1,interiorColor:14540253,interiorDarkening:0,forceTransparent:!1,matrix:new Sn,disablePicking:!1,sortParticles:!1,background:!1},b_={opaqueBack:{updateShader:!0},side:{updateShader:!0,property:!0},opacity:{uniform:!0},depthWrite:{property:!0},clipNear:{updateShader:!0,property:!0},clipRadius:{updateShader:!0,uniform:!0},clipCenter:{uniform:!0},flatShaded:{updateShader:!0},background:{updateShader:!0},wireframe:{updateVisibility:!0},roughness:{uniform:!0},metalness:{uniform:!0},diffuse:{uniform:!0},diffuseInterior:{updateShader:!0},useInteriorColor:{updateShader:!0},interiorColor:{uniform:!0},interiorDarkening:{uniform:!0},matrix:{}};class x_{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.parameterTypes=b_,this.geometry=new ar,this.indexVersion=0,this.wireframeIndexVersion=-1,this.group=new fa,this.wireframeGroup=new fa,this.pickingGroup=new fa,this.vertexShader="",this.fragmentShader="",this.isImpostor=!1,this.isText=!1,this.isSurface=!1,this.isPoint=!1,this.isLine=!1,this.dynamic=!0,this.visible=!0,this.wireframeIndexCount=0,this.parameters=xp(t,this.defaultParameters),this.uniforms=Br.merge([Kr.common,{fogColor:{value:new Ri(0)},fogNear:{value:0},fogFar:{value:0},opacity:{value:this.parameters.opacity},clipNear:{value:0},clipRadius:{value:this.parameters.clipRadius},clipCenter:{value:this.parameters.clipCenter}},{emissive:{value:new Ri(0)},roughness:{value:this.parameters.roughness},metalness:{value:this.parameters.metalness},interiorColor:{value:new Ri(this.parameters.interiorColor)},interiorDarkening:{value:this.parameters.interiorDarkening}},Kr.lights]),this.uniforms.diffuse.value.set(this.parameters.diffuse),this.pickingUniforms={clipNear:{value:0},objectId:{value:0},opacity:{value:this.parameters.opacity}};const n=e.position||e.position1;this._positionDataSize=n?n.length/3:0,e.primitiveId||(e.primitiveId=bg(this._positionDataSize)),this.addAttributes({position:{type:"v3",value:e.position},color:{type:"c",value:e.color},primitiveId:{type:"f",value:e.primitiveId}}),t.matrix&&(this.matrix=t.matrix),e.index&&this.initIndex(e.index),this.picking=e.picking,this.makeWireframeGeometry()}get defaultParameters(){return v_}set matrix(e){this.setMatrix(e)}get matrix(){return this.group.matrix.clone()}get transparent(){return this.parameters.opacity<1||this.parameters.forceTransparent}get size(){return this._positionDataSize}get attributeSize(){return this.size}get pickable(){return!!this.picking&&!this.parameters.disablePicking}setMatrix(e){y_(this.group,e),y_(this.wireframeGroup,e),y_(this.pickingGroup,e)}initIndex(e){this.geometry.setIndex(new Gi(e,1));const t=this.geometry.getIndex();t?t.setUsage(this.dynamic?WebGLRenderingContext.DYNAMIC_DRAW:0):gm.error("Index is null")}makeMaterial(){const e=m_(this.parameters.side),t=new Ur({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!0,fog:!0,side:e});t.vertexColors=!0,t.extensions.derivatives=!0,t.extensions.fragDepth=this.isImpostor;const n=new Ur({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!1,fog:!0,side:e});n.vertexColors=!0;const i=new Ur({uniforms:this.pickingUniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:!1,depthWrite:this.parameters.depthWrite,lights:!1,fog:!1,side:e,blending:p});i.vertexColors=!0,i.extensions.fragDepth=this.isImpostor,t.clipNear=this.parameters.clipNear,n.clipNear=this.parameters.clipNear,i.clipNear=this.parameters.clipNear,this.material=t,this.wireframeMaterial=n,this.pickingMaterial=i,this.updateShader()}makeWireframeGeometry(){this.makeWireframeIndex();const e=this.geometry,t=this.wireframeIndex,n=new ar;n.attributes=e.attributes,t&&(n.setIndex(new Gi(t,1).setUsage(this.dynamic?WebGLRenderingContext.DYNAMIC_DRAW:0)),n.setDrawRange(0,this.wireframeIndexCount)),this.wireframeGeometry=n}makeWireframeIndex(){const e=[];function t(t,n){if(t>n){const e=t;t=n,n=e}const i=e[t];return void 0===i?(e[t]=[n],!0):!i.includes(n)&&(i.push(n),!0)}const n=this.geometry,i=n.index;if(this.parameters.wireframe)if(i){const r=i.array;let o,s=r.length;n.drawRange.count!==1/0&&(s=n.drawRange.count),o=this.wireframeIndex&&this.wireframeIndex.length>2*s?this.wireframeIndex:Fp(2*s,n.attributes.position.count);let a=0;e.length=0;for(let e=0;e<s;e+=3){const n=r[e+0],i=r[e+1],s=r[e+2];t(n,i)&&(o[a+0]=n,o[a+1]=i,a+=2),t(i,s)&&(o[a+0]=i,o[a+1]=s,a+=2),t(s,n)&&(o[a+0]=s,o[a+1]=n,a+=2)}this.wireframeIndex=o,this.wireframeIndexCount=a,this.wireframeIndexVersion=this.indexVersion}else{const e=n.attributes.position.count;let t;t=this.wireframeIndex&&this.wireframeIndex.length>2*e?this.wireframeIndex:Fp(2*e,e);for(let n=0,i=0;n<e;n+=3)t[i+0]=n,t[i+1]=n+1,t[i+2]=n+1,t[i+3]=n+2,t[i+4]=n+2,t[i+5]=n,i+=6;this.wireframeIndex=t,this.wireframeIndexCount=2*e,this.wireframeIndexVersion=this.indexVersion}else this.wireframeIndex=new Uint16Array(0),this.wireframeIndexCount=0}updateWireframeIndex(){if(this.wireframeGeometry&&this.wireframeIndex){if(this.wireframeGeometry.setDrawRange(0,1/0),this.wireframeIndexVersion<this.indexVersion&&this.makeWireframeIndex(),this.wireframeGeometry.index&&this.wireframeIndex.length>this.wireframeGeometry.index.array.length)this.wireframeGeometry.setIndex(new Gi(this.wireframeIndex,1).setUsage(this.dynamic?WebGLRenderingContext.DYNAMIC_DRAW:0));else{const e=this.wireframeGeometry.getIndex();if(!e)return void gm.error("Index is null");e.set(this.wireframeIndex),e.needsUpdate=this.wireframeIndexCount>0,e.updateRange.count=this.wireframeIndexCount}this.wireframeGeometry.setDrawRange(0,this.wireframeIndexCount)}}getRenderOrder(){let e=0;return this.isText?e=1:this.transparent&&(e=this.isSurface?3:2),e}_getMesh(e){this.material||this.makeMaterial();const t=this.geometry,n=this[e];let i;return i=this.isLine?new cl(t,n):this.isPoint?new gl(t,n):new Ar(t,n),i.frustumCulled=!1,i.renderOrder=this.getRenderOrder(),i}getMesh(){return this._getMesh("material")}getWireframeMesh(){let e;return this.material||this.makeMaterial(),this.wireframeGeometry||this.makeWireframeGeometry(),e=new cl(this.wireframeGeometry,this.wireframeMaterial),e.frustumCulled=!1,e.renderOrder=this.getRenderOrder(),e}getPickingMesh(){return this._getMesh("pickingMaterial")}getShader(e,t){return lg(e,this.getDefines(t))}getVertexShader(e){return this.getShader(this.vertexShader,e)}getFragmentShader(e){return this.getShader(this.fragmentShader,e)}getDefines(e){const t={};return this.parameters.clipNear&&(t.NEAR_CLIP=1),this.parameters.clipRadius&&(t.RADIUS_CLIP=1),"picking"===e?t.PICKING=1:(("background"===e||this.parameters.background)&&(t.NOLIGHT=1),this.parameters.flatShaded&&(t.FLAT_SHADED=1),this.parameters.opaqueBack&&(t.OPAQUE_BACK=1),this.parameters.diffuseInterior&&(t.DIFFUSE_INTERIOR=1),this.parameters.useInteriorColor&&(t.USE_INTERIOR_COLOR=1)),t}getParameters(){return this.parameters}addUniforms(e){this.uniforms=Br.merge([this.uniforms,e]),this.pickingUniforms=Br.merge([this.pickingUniforms,e])}addAttributes(e){for(let t in e){let n;const i=e[t],r=this.attributeSize*g_[i.type];i.value?(r!==i.value.length&&gm.error("attribute value has wrong length",t),n=i.value):n=Bp("float32",r),this.geometry.setAttribute(t,new Gi(n,g_[i.type]).setUsage(this.dynamic?WebGLRenderingContext.DYNAMIC_DRAW:0))}}updateRenderOrder(){const e=this.getRenderOrder();function t(t){t.renderOrder=e}this.group.children.forEach(t),this.pickingGroup&&this.pickingGroup.children.forEach(t)}updateShader(){const e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.vertexShader=this.getVertexShader(),e.fragmentShader=this.getFragmentShader(),e.needsUpdate=!0,t.vertexShader=this.getShader("Line.vert"),t.fragmentShader=this.getShader("Line.frag"),t.needsUpdate=!0,n.vertexShader=this.getVertexShader("picking"),n.fragmentShader=this.getFragmentShader("picking"),n.needsUpdate=!0}setParameters(e){const t=e,n=this.parameterTypes,i=this.parameters,r={},o={};let s=!1,a=!1;for(const l in t){const e=t[l];void 0!==e&&(i[l]=e,void 0!==n[l]&&(n[l].property&&(!0!==n[l].property?r[n[l].property]=e:r[l]=e),n[l].uniform&&(!0!==n[l].uniform?o[n[l].uniform]=e:o[l]=e),n[l].updateShader&&(s=!0),n[l].updateVisibility&&(a=!0),this.dynamic&&"wireframe"===l&&!0===e&&this.updateWireframeIndex(),"forceTransparent"===l&&(r.transparent=this.transparent),"matrix"===l&&(this.matrix=e)))}this.setProperties(r),this.setUniforms(o),s&&this.updateShader(),a&&this.setVisibility(this.visible)}setAttributes(e){const t=this.geometry,n=t.attributes;for(const i in e){if("picking"===i)continue;const r=e[i],o=r.length;if("index"===i){const e=t.getIndex();if(!e){gm.error("Index is null");continue}t.setDrawRange(0,1/0),o>e.array.length?t.setIndex(new Gi(r,1).setUsage(this.dynamic?WebGLRenderingContext.DYNAMIC_DRAW:0)):(e.set(r),e.count=o,e.needsUpdate=o>0,e.updateRange.count=o,t.setDrawRange(0,o)),this.indexVersion++,this.parameters.wireframe&&this.updateWireframeIndex()}else{const e=n[i];o>e.array.length?t.setAttribute(i,new Gi(r,e.itemSize).setUsage(this.dynamic?WebGLRenderingContext.DYNAMIC_DRAW:0)):(n[i].set(r),n[i].needsUpdate=o>0,n[i].updateRange.count=o)}}}setUniforms(e){if(!e)return;const t=this.material.uniforms,n=this.wireframeMaterial.uniforms,i=this.pickingMaterial.uniforms;for(let r in e)"opacity"===r&&this.setProperties({transparent:this.transparent}),void 0!==t[r]&&(t[r].value.isVector3?t[r].value.copy(e[r]):t[r].value.set?t[r].value.set(e[r]):t[r].value=e[r]),void 0!==n[r]&&(n[r].value.isVector3?n[r].value.copy(e[r]):n[r].value.set?n[r].value.set(e[r]):n[r].value=e[r]),void 0!==i[r]&&(i[r].value.isVector3?i[r].value.copy(e[r]):i[r].value.set?i[r].value.set(e[r]):i[r].value=e[r])}setProperties(e){if(!e)return;const t=this.material,n=this.wireframeMaterial,i=this.pickingMaterial;for(const r in e){const o=r;let s=e[o];"transparent"===o?this.updateRenderOrder():"side"===o&&(s=m_(s)),t[o]=s,n[o]=s,i[o]=s}t.needsUpdate=!0,n.needsUpdate=!0,i.needsUpdate=!0}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.material&&this.material.dispose(),this.wireframeMaterial&&this.wireframeMaterial.dispose(),this.pickingMaterial&&this.pickingMaterial.dispose(),this.geometry.dispose(),this.wireframeGeometry&&this.wireframeGeometry.dispose()}toJSON(){var e={};for(var t in this)"group"!==t&&"wireframeGroup"!==t&&"pickingGroup"!=t&&"picking"!==t&&(e[t]=this[t]);return e}}class w_ extends x_{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.vertexShader="Mesh.vert",this.fragmentShader="Mesh.frag",this.addAttributes({normal:{type:"v3",value:e.normal}}),void 0===e.normal&&this.geometry.computeVertexNormals()}}class __ extends w_{constructor(){super(...arguments),this.isSurface=!0}}function S_(e){e.visible=!0}function M_(e){e.visible=!1}class A_{constructor(e){this.group=new fa,this.wireframeGroup=new fa,this.pickingGroup=new fa,this.frontMeshes=[],this.backMeshes=[],this.size=e.size,this.side=e.parameters.side,this.visible=e.visible,this.geometry=e.geometry,this.picking=e.picking,this.group=new fa,this.wireframeGroup=new fa,this.pickingGroup=new fa,this.matrix=e.matrix;const t=e,n=new e.constructor({position:new Float32Array(0)});t.makeMaterial(),n.makeMaterial(),n.picking=e.picking,n.geometry=e.geometry,n.wireframeGeometry=e.wireframeGeometry,n.setParameters(e.getParameters()),n.updateShader(),t.setParameters({side:"front"}),n.setParameters({side:"back",opacity:n.parameters.opacity}),this.buffer=e,this.frontBuffer=t,this.backBuffer=n}set matrix(e){x_.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking&&!this.parameters.disablePicking}get parameters(){return this.buffer.parameters}getParameters(){const e=Object.assign({},this.buffer.parameters);return e.side=this.side,e}getMesh(e){let t,n;return e?(n=this.backBuffer.getPickingMesh(),t=this.frontBuffer.getPickingMesh()):(n=this.backBuffer.getMesh(),t=this.frontBuffer.getMesh()),this.frontMeshes.push(t),this.backMeshes.push(n),this.setParameters({side:this.side}),(new fa).add(n,t)}getWireframeMesh(){return this.buffer.getWireframeMesh()}getPickingMesh(){return this.getMesh(!0)}setAttributes(e){this.buffer.setAttributes(e)}setParameters(e){"front"===(e=Object.assign({},e)).side?(this.frontMeshes.forEach(S_),this.backMeshes.forEach(M_)):"back"===e.side?(this.frontMeshes.forEach(M_),this.backMeshes.forEach(S_)):"double"===e.side&&(this.frontMeshes.forEach(S_),this.backMeshes.forEach(S_)),void 0!==e.side&&(this.side=e.side),delete e.side,void 0!==e.matrix&&(this.matrix=e.matrix),delete e.matrix,this.frontBuffer.setParameters(e),void 0!==e.wireframe&&(this.wireframe=e.wireframe,this.setVisibility(this.visible)),delete e.wireframe,this.backBuffer.setParameters(e)}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.frontBuffer.dispose(),this.backBuffer.dispose()}toJSON(){var e={};for(var t in this)["side","size","visible","matrix","parameters"].includes(t)&&(e[t]=this[t]);return e}}Tm.add("shader/Line.vert","uniform float clipNear;\nuniform vec3 clipCenter;\nvarying vec3 vViewPosition;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#include color_pars_vertex\nvoid main(){\n#include color_vertex\n#include begin_vertex\n#include project_vertex\nvViewPosition = -mvPosition.xyz;\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}"),Tm.add("shader/Line.frag","uniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\nvarying vec3 vViewPosition;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\ngl_FragColor = vec4( vColor, opacity );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include encodings_fragment\n#include fog_fragment\n}");class C_ extends x_{constructor(){super(...arguments),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag"}}class T_ extends Wy{constructor(e,t,n){super(e,t,n),this.type="surface",this.parameters=Object.assign({isolevelType:{type:"select",options:{value:"value",sigma:"sigma"}},isolevel:{type:"number",precision:2,max:1e3,min:-1e3},negateIsolevel:{type:"boolean"},isolevelScroll:{type:"boolean"},smooth:{type:"integer",precision:1,max:10,min:0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},boxSize:{type:"integer",precision:1,max:100,min:0},colorVolume:{type:"hidden"},contour:{type:"boolean",rebuild:!0},useWorker:{type:"boolean",rebuild:!0},wrap:{type:"boolean",rebuild:!0}},this.parameters),e instanceof f_?(this.surface=void 0,this.volume=e):(this.surface=e,this.volume=void 0),this.boxCenter=new mn,this.__boxCenter=new mn,this.box=new ni,this.__box=new ni,this._position=new mn,this.inverseMatrix=new Sn,this.setBox=function(){this._position.copy(t.translationGroup.position).negate(),this._position.applyMatrix4(this.inverseMatrix),this._position.equals(this.boxCenter)||this.setParameters({boxCenter:this._position})},this.toBePrepared=!0,this.viewer.signals.ticked.add(this.setBox,this),this.init(n)}init(e){const t=e||{};t.colorScheme=bp(t.colorScheme,"uniform"),t.colorValue=bp(t.colorValue,14540253),this.isolevelType=bp(t.isolevelType,"sigma"),this.isolevel=bp(t.isolevel,2),this.negateIsolevel=bp(t.negateIsolevel,!1),this.isolevelScroll=bp(t.isolevelScroll,!1),this.smooth=bp(t.smooth,0),this.background=bp(t.background,!1),this.opaqueBack=bp(t.opaqueBack,!0),this.boxSize=bp(t.boxSize,0),this.colorVolume=bp(t.colorVolume,void 0),this.contour=bp(t.contour,!1),this.useWorker=bp(t.useWorker,!0),this.wrap=bp(t.wrap,!1),super.init(t),this.inverseMatrix.getInverse(this.matrix),this.build()}attach(e){this.bufferList.forEach((e=>{this.viewer.add(e)})),this.setVisibility(this.visible),e()}prepare(e){if(this.volume){let t;if(t="sigma"===this.isolevelType?this.volume.getValueForSigma(this.isolevel):this.isolevel,this.negateIsolevel&&(t*=-1),!this.surface||this.__isolevel!==t||this.__smooth!==this.smooth||this.__contour!==this.contour||this.__wrap!==this.wrap||this.__boxSize!==this.boxSize||this.boxSize>0&&!this.__boxCenter.equals(this.boxCenter)){this.__isolevel=t,this.__smooth=this.smooth,this.__contour=this.contour,this.__wrap=this.wrap,this.__boxSize=this.boxSize,this.__boxCenter.copy(this.boxCenter),this.__box.copy(this.box);const n=t=>{this.surface=t,e()};this.useWorker?this.volume.getSurfaceWorker(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap,n):n(this.volume.getSurface(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap))}else e()}else e()}create(){const e={position:this.surface.getPosition(),color:this.surface.getColor(this.getColorParams()),index:this.surface.getIndex()};let t;if(this.contour)t=new C_(e,this.getBufferParams({wireframe:!1}));else{Object.assign(e,{normal:this.surface.getNormal(),picking:this.surface.getPicking()});const n=new __(e,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));t=new A_(n)}this.bufferList.push(t)}update(e){if(0===this.bufferList.length)return;const t={};(e=e||{}).position&&(t.position=this.surface.getPosition()),e.color&&(t.color=this.surface.getColor(this.getColorParams())),e.index&&(t.index=this.surface.getIndex()),e.normal&&(t.normal=this.surface.getNormal()),this.bufferList.forEach((function(e){e.setAttributes(t)}))}setParameters(e,t,n){return e&&void 0!==e.isolevelType&&this.volume&&("value"===this.isolevelType&&"sigma"===e.isolevelType?this.isolevel=this.volume.getSigmaForValue(this.isolevel):"sigma"===this.isolevelType&&"value"===e.isolevelType&&(this.isolevel=this.volume.getValueForSigma(this.isolevel)),this.isolevelType=e.isolevelType),e&&e.boxCenter&&(this.boxCenter.copy(e.boxCenter),delete e.boxCenter),e&&e.wireframe&&(e.contour||void 0===e.contour&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,n),e.matrix&&this.inverseMatrix.getInverse(e.matrix),this.volume&&this.volume.getBox(this.boxCenter,this.boxSize,this.box),e&&void 0!==e.colorVolume&&t&&(t.color=!0),this.surface&&(void 0!==e.isolevel||void 0!==e.negateIsolevel||void 0!==e.smooth||void 0!==e.wrap||void 0!==e.boxSize||this.boxSize>0&&!this.__box.equals(this.box))&&this.build({position:!0,color:!0,index:!0,normal:!this.contour}),this}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}dispose(){this.viewer.signals.ticked.remove(this.setBox,this),super.dispose()}}class E_{static zoomScroll(e,t){e.trackballControls.zoom(t)}static clipNearScroll(e,t){const n=e.getParameters();e.setParameters({clipNear:n.clipNear+t/10})}static focusScroll(e,t){const n=e.getFocus(),i=Math.sign(t)*df((100-n)/10,5,.2);e.setFocus(n+i)}static zoomFocusScroll(e,t){e.trackballControls.zoom(t);const n=e.viewer.camera.position.z;e.setFocus(100-Math.abs(n/8))}static isolevelScroll(e,t){const n=Math.sign(t)/10;e.eachRepresentation(((e,t)=>{if(e.repr instanceof T_){const t=e.getParameters();t.isolevelScroll&&e.setParameters({isolevel:t.isolevel+n})}}))}static panDrag(e,t,n){e.trackballControls.pan(t,n)}static rotateDrag(e,t,n){e.trackballControls.rotate(t,n)}static zRotateDrag(e,t,n){e.trackballControls.zRotate(t,n)}static zoomDrag(e,t,n){e.trackballControls.zoom((t+n)/-2)}static zoomFocusDrag(e,t,n){e.trackballControls.zoom((t+n)/-2);const i=e.viewer.camera.position.z;e.setFocus(100-Math.abs(i/8))}static panComponentDrag(e,t,n){e.trackballControls.panComponent(t,n)}static panAtomDrag(e,t,n){e.trackballControls.panAtom(t,n)}static rotateComponentDrag(e,t,n){e.trackballControls.rotateComponent(t,n)}static movePick(e,t){t&&e.animationControls.move(t.position.clone())}static tooltipPick(e,t){const n=e.tooltip;if(e.getParameters().tooltip&&t){const e=t.mouse.position;n.innerText=t.getLabel(),n.style.bottom=window.innerHeight-e.y+3+"px",n.style.left=e.x+3+"px",n.style.display="block"}else n.style.display="none"}static measurePick(e,t){if(t&&(t.atom||t.bond)){const e=t.atom||t.closestBondAtom;t.component.measurePick(e)}else e.measureClear()}}const P_={default:[["scroll",E_.zoomScroll],["scroll-shift",E_.focusScroll],["scroll-ctrl",E_.isolevelScroll],["scroll-shift-ctrl",E_.zoomFocusScroll],["drag-left",E_.rotateDrag],["drag-right",E_.panDrag],["drag-ctrl-left",E_.panDrag],["drag-ctrl-right",E_.zRotateDrag],["drag-shift-left",E_.zoomDrag],["drag-middle",E_.zoomFocusDrag],["drag-ctrl-shift-right",E_.panComponentDrag],["drag-ctrl-shift-left",E_.rotateComponentDrag],["clickPick-right",E_.measurePick],["clickPick-ctrl-left",E_.measurePick],["clickPick-middle",E_.movePick],["clickPick-left",E_.movePick],["hoverPick",E_.tooltipPick]],pymol:[["drag-left",E_.rotateDrag],["drag-middle",E_.panDrag],["drag-right",E_.zoomDrag],["scroll",E_.focusScroll],["drag-shift-right",E_.focusScroll],["clickPick-ctrl+shift-middle",E_.movePick],["hoverPick",E_.tooltipPick]],coot:[["scroll",E_.isolevelScroll],["drag-left",E_.rotateDrag],["drag-middle",E_.panDrag],["drag-ctrl-left",E_.panDrag],["drag-right",E_.zoomFocusDrag],["drag-ctrl-right",E_.focusScroll],["clickPick-middle",E_.movePick],["hoverPick",E_.tooltipPick]],astexviewer:[["drag-left",E_.rotateDrag],["drag-ctrl-left",E_.panDrag],["drag-shift-left",E_.zoomDrag],["scroll",E_.focusScroll],["clickPick-middle",E_.movePick],["hoverPick",E_.tooltipPick]]};function I_(e){const t=e.split(/[-+]/);let n="";t.includes("scroll")&&(n="scroll"),t.includes("drag")&&(n="drag"),t.includes("click")&&(n="click"),t.includes("doubleClick")&&(n="doubleClick"),t.includes("hover")&&(n="hover"),t.includes("clickPick")&&(n="clickPick"),t.includes("hoverPick")&&(n="hoverPick");let i=0;t.includes("alt")&&(i+=1),t.includes("ctrl")&&(i+=2),t.includes("meta")&&(i+=4),t.includes("shift")&&(i+=8);let r=0;return t.includes("left")&&(r+=1),t.includes("right")&&(r+=2),t.includes("middle")&&(r+=4),[n,i,r]}class L_{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.stage=e,this.actionList=[],this.mouse=e.mouseObserver,this.disabled=t.disabled||!1,this.preset(t.preset||"default")}run(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(this.disabled)return;const r=this.mouse.key||0,o=this.mouse.buttons||0;this.actionList.forEach((t=>{t.type===e&&t.key===r&&t.button===o&&t.callback(this.stage,...n)}))}add(e,t){const[n,i,r]=I_(e);this.actionList.push({type:n,key:i,button:r,callback:t})}remove(e,t){const n=e.includes("*"),[i,r,o]=I_(e),s=this.actionList.filter((function(e){return!((e.type===i||n&&""===i)&&(e.key===r||n&&0===r)&&(e.button===o||n&&0===o)&&(e.callback===t||void 0===t))}));this.actionList=s}preset(e){this.clear(),(P_[e]||[]).forEach((e=>this.add(e[0],e[1])))}clear(){this.actionList.length=0}}class R_{static autoView(e){e.autoView(1e3)}static toggleAnimations(e){e.animationControls.toggle()}static toggleRock(e){e.toggleRock()}static toggleSpin(e){e.toggleSpin()}static toggleAntialiasing(e){const t=e.getParameters();e.setParameters({sampleLevel:-1===t.sampleLevel?0:-1})}}const k_={default:[["i",R_.toggleSpin],["k",R_.toggleRock],["p",R_.toggleAnimations],["a",R_.toggleAntialiasing],["r",R_.autoView]]};class D_{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.stage=e,this.actionList=[],this.disabled=t.disabled||!1,this.preset(t.preset||"default")}run(e){this.disabled||this.actionList.forEach((t=>{t.key===e&&t.callback(this.stage)}))}add(e,t){this.actionList.push({key:e,callback:t})}remove(e,t){const n=this.actionList.filter((function(n){return!(n.key===e&&(n.callback===t||void 0===t))}));this.actionList=n}preset(e){this.clear(),(k_[e]||[]).forEach((e=>this.add(e[0],e[1])))}clear(){this.actionList.length=0}}class O_{constructor(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this)}_onClick(e,t){const n=this.stage.pickingControls.pick(e,t);this.stage.signals.clicked.dispatch(n),this.controls.run("clickPick",n)}_onHover(e,t){const n=this.stage.pickingControls.pick(e,t);n&&this.mouse.down.equals(this.mouse.position)&&(this.stage.transformComponent=n.component,this.stage.transformAtom=n.atom),this.stage.signals.hovered.dispatch(n),this.controls.run("hoverPick",n)}dispose(){this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class N_{constructor(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.moved.add(this._onMove,this),this.mouse.signals.scrolled.add(this._onScroll,this),this.mouse.signals.dragged.add(this._onDrag,this),this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this),this.mouse.signals.doubleClicked.add(this._onDblclick,this)}_onMove(){this.stage.tooltip.style.display="none"}_onScroll(e){this.controls.run("scroll",e)}_onDrag(e,t){this.controls.run("drag",e,t)}_onClick(e,t){this.controls.run("click",e,t)}_onDblclick(e,t){this.controls.run("doubleClick",e,t)}_onHover(e,t){this.controls.run("hover",e,t)}dispose(){this.mouse.signals.moved.remove(this._onMove,this),this.mouse.signals.scrolled.remove(this._onScroll,this),this.mouse.signals.dragged.remove(this._onDrag,this),this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class B_{constructor(e){this.stage=e,this.viewer=e.viewer,this.animationControls=e.animationControls,this.viewer.signals.ticked.add(this._onTick,this)}_onTick(e){this.animationControls.run(e)}dispose(){this.viewer.signals.ticked.remove(this._onTick,this)}}const F_=!!um&&{passive:!0};class z_{constructor(e){this.stage=e,this.stage=e,this.controls=e.keyControls,this.domElement=e.viewer.renderer.domElement,this.domElement.setAttribute("tabIndex","-1"),this.domElement.style.outline="none",this._focusDomElement=this._focusDomElement.bind(this),this._onKeydown=this._onKeydown.bind(this),this._onKeyup=this._onKeyup.bind(this),this._onKeypress=this._onKeypress.bind(this),this.domElement.addEventListener("mousedown",this._focusDomElement),this.domElement.addEventListener("touchstart",this._focusDomElement,F_),this.domElement.addEventListener("keydown",this._onKeydown),this.domElement.addEventListener("keyup",this._onKeyup),this.domElement.addEventListener("keypress",this._onKeypress)}_onKeydown(){}_onKeyup(){}_onKeypress(e){let t;t="key"in KeyboardEvent.prototype?e.key:String.fromCharCode(e.which||e.keyCode),this.controls.run(t)}_focusDomElement(){this.domElement.focus()}dispose(){this.domElement.removeEventListener("mousedown",this._focusDomElement),this.domElement.removeEventListener("touchstart",this._focusDomElement,F_),this.domElement.removeEventListener("keydown",this._onKeypress),this.domElement.removeEventListener("keyup",this._onKeypress),this.domElement.removeEventListener("keypress",this._onKeypress)}}class U_{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.component=e,this.position=t,this.offsetX=bp(i.offsetX,0),this.offsetY=bp(i.offsetY,0),this.visible=bp(i.visible,!0),this.stage=e.stage,this.viewer=e.stage.viewer,this._viewerPosition=new mn,this._updateViewerPosition(),this._canvasPosition=new nn,this._cameraPosition=new mn,this.element=document.createElement("div"),Object.assign(this.element.style,{display:"block",position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",left:"-10000px"}),this.viewer.wrapper.appendChild(this.element),this.setContent(n),this.updateVisibility(),this.viewer.signals.rendered.add(this._update,this),this.component.signals.matrixChanged.add(this._updateViewerPosition,this)}setContent(e){const t=this.element.style.display;if("none"===t&&(this.element.style.left="-10000px",this.element.style.display="block"),e instanceof HTMLElement)this.element.appendChild(e);else{const t=document.createElement("div");t.innerText=e,Object.assign(t.style,{backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.element.appendChild(t)}this._clientRect=this.element.getBoundingClientRect(),"none"===t&&(this.element.style.display=t)}setVisibility(e){this.visible=e,this.updateVisibility()}getVisibility(){return this.visible&&this.component.parameters.visible}updateVisibility(){this.element.style.display=this.getVisibility()?"block":"none"}_updateViewerPosition(){this._viewerPosition.copy(this.position).applyMatrix4(this.component.matrix)}_update(){if(!this.getVisibility())return;const e=this.element.style,t=this._canvasPosition,n=this._viewerPosition,i=this._clientRect;if(this._cameraPosition.copy(n).add(this.viewer.translationGroup.position).applyMatrix4(this.viewer.rotationGroup.matrix).sub(this.viewer.camera.position),this._cameraPosition.z<0)return void(e.display="none");e.display="block";const r=this._cameraPosition.length(),o=this.viewer.scene.fog;e.opacity=(1-hf(o.near,o.far,r)).toString(),e.zIndex=Math.round(100*(o.far-r)).toString(),this.stage.viewerControls.getPositionOnCanvas(n,t),e.bottom=this.offsetX+t.y+i.height/2+"px",e.left=this.offsetY+t.x-i.width/2+"px"}dispose(){this.viewer.wrapper.removeChild(this.element),this.viewer.signals.ticked.remove(this._update,this),this.component.signals.matrixChanged.remove(this._updateViewerPosition,this)}}const H_=new Sn,G_=new mn,V_=new dn;class j_{constructor(e){this.component=e,this.signals={changed:new Sf.Signal},this.stage=e.stage,this.viewer=e.stage.viewer}get position(){return this.component.position}get rotation(){return this.component.quaternion}changed(){this.component.updateMatrix(),this.viewer.requestRender(),this.signals.changed.dispatch()}spin(e,t){H_.getInverse(this.viewer.rotationGroup.matrix),G_.copy(jp(e)).applyMatrix4(H_),H_.extractRotation(this.component.transform),H_.premultiply(this.viewer.rotationGroup.matrix),H_.getInverse(H_),G_.copy(jp(e)),G_.applyMatrix4(H_),H_.makeRotationAxis(G_,t),V_.setFromRotationMatrix(H_),this.component.quaternion.premultiply(V_),this.changed()}}const $_={"":"",vdw:"by vdW radius",covalent:"by covalent radius",sstruc:"by secondary structure",bfactor:"by bfactor",size:"size",data:"data",explicit:"explicit"};class W_{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.max=10,this.type=bp(e.type,"size"),this.scale=bp(e.scale,1),this.size=bp(e.size,1),this.data=bp(e.data,{})}atomRadius(e){let t;switch(this.type){case"vdw":t=e.vdw;break;case"covalent":t=e.covalent;break;case"bfactor":t=e.bfactor||1;break;case"sstruc":const n=e.sstruc;t="h"===n||"g"===n||"i"===n||"e"===n||"b"===n?.25:Vb.includes(e.atomname)?.4:.1;break;case"data":t=bp(this.data[e.index],1);break;case"explicit":t=e.radius,null===t&&(t=this.size);break;default:t=this.size}return Math.min(t*this.scale,this.max)}}W_.types=$_;const q_=new mn(-1,-1,-1),X_=new Sn;class Y_{constructor(e){const t=e.rows,n=t/3,i=new zw(t,3),r=new zw(3,3),o=new zw(1,3),s=new zw(3,3),a=new zw(3,3),l=Ww(e);qw(e,l),Uw(i,e),Gw(r,i,i),Jw(r,o,s,a);const c=new mn(l[0],l[1],l[2]),u=new mn(s.data[0],s.data[3],s.data[6]),h=new mn(s.data[1],s.data[4],s.data[7]),d=new mn(s.data[2],s.data[5],s.data[8]),p=u.clone().multiplyScalar(Math.sqrt(o.data[0]/n)),f=h.clone().multiplyScalar(Math.sqrt(o.data[1]/n)),m=d.clone().multiplyScalar(Math.sqrt(o.data[2]/n));this.begA=c.clone().sub(p),this.endA=c.clone().add(p),this.begB=c.clone().sub(f),this.endB=c.clone().add(f),this.begC=c.clone().sub(m),this.endC=c.clone().add(m),this.center=c,this.vecA=p,this.vecB=f,this.vecC=m,this.normVecA=u,this.normVecB=h,this.normVecC=d}getBasisMatrix(){const e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Sn;return e.makeBasis(this.normVecB,this.normVecA,this.normVecC),e.determinant()<0&&e.scale(q_),e}getRotationQuaternion(){const e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new dn;return e.setFromRotationMatrix(this.getBasisMatrix(X_)),e.inverse()}getProjectedScaleForAtoms(e){let t=-1/0,n=-1/0,i=-1/0,r=-1/0,o=-1/0,s=-1/0;const a=new mn,l=new mn,c=this.center,u=this.normVecA,h=this.normVecB,d=this.normVecC;return e.eachAtom((function(e){Zy(a.copy(e),u,c);const p=l.subVectors(a,c).normalize().dot(u),f=a.distanceTo(c);p>0?f>t&&(t=f):f>n&&(n=f),Zy(a.copy(e),h,c);const m=l.subVectors(a,c).normalize().dot(h),g=a.distanceTo(c);m>0?g>i&&(i=g):g>r&&(r=g),Zy(a.copy(e),d,c);const y=l.subVectors(a,c).normalize().dot(d),v=a.distanceTo(c);y>0?v>o&&(o=v):v>s&&(s=v)})),{d1a:t,d2a:i,d3a:o,d1b:-n,d2b:-r,d3b:-s}}}class Z_{constructor(e,t,n,i){this.volume=e,this.setFilter(t,n,i)}get header(){return this.volume.header}get matrix(){return this.volume.matrix}get normalMatrix(){return this.volume.normalMatrix}get inverseMatrix(){return this.volume.inverseMatrix}get center(){return this.volume.center}get boundingBox(){return this.volume.boundingBox}get min(){return this.volume.min}get max(){return this.volume.max}get mean(){return this.volume.mean}get rms(){return this.volume.rms}_getFilterHash(e,t,n){return JSON.stringify([e,t,n])}setFilter(e,t,n){isNaN(e)&&this.header&&(e=this.header.DMEAN+2*this.header.ARMS),e=void 0===e||isNaN(e)?-1/0:e,t=bp(t,1/0),n=bp(n,!1);const i=this.volume.data,r=this.volume.position,o=this.volume.atomindex,s=this._getFilterHash(e,t,n);if(s!==this._filterHash){if(e===-1/0&&t===1/0)this.data=i,this.position=r,this.atomindex=o;else{const s=i.length;this._dataBuffer||(this._dataBuffer=new ArrayBuffer(4*s),this._positionBuffer=new ArrayBuffer(3*s*4),o&&(this._atomindexBuffer=new ArrayBuffer(4*s)));const a=new Float32Array(this._dataBuffer),l=new Float32Array(this._positionBuffer);let c;o&&(c=new Uint32Array(this._atomindexBuffer));let u=0;for(let h=0;h<s;++h){const s=3*h,d=i[h];if(!n&&d>=e&&d<=t||n&&(d<e||d>t)){const e=3*u;a[u]=d,l[e+0]=r[s+0],l[e+1]=r[s+1],l[e+2]=r[s+2],o&&c&&(c[u]=o[h]),u+=1}}this.data=new Float32Array(this._dataBuffer,0,u),this.position=new Float32Array(this._positionBuffer,0,3*u),o&&(this.atomindex=new Int32Array(this._atomindexBuffer,0,u))}this._filterHash=s}}}Z_.prototype.getValueForSigma=f_.prototype.getValueForSigma,Z_.prototype.getSigmaForValue=f_.prototype.getSigmaForValue,Z_.prototype.getDataAtomindex=f_.prototype.getDataAtomindex,Z_.prototype.getDataPosition=f_.prototype.getDataPosition,Z_.prototype.getDataColor=f_.prototype.getDataColor,Z_.prototype.getDataPicking=f_.prototype.getDataPicking,Z_.prototype.getDataSize=f_.prototype.getDataSize;class K_{constructor(e,t){const n=Vv({nodeArray1:e.atomIndex1,nodeArray2:e.atomIndex2,edgeCount:e.count,nodeCount:t});this.countArray=n.countArray,this.offsetArray=n.offsetArray,this.indexArray=n.indexArray}}class Q_ extends zv{get _defaultFields(){return[["atomIndex1",1,"int32"],["atomIndex2",1,"int32"],["bondOrder",1,"int8"]]}addBond(e,t,n){this.growIfFull();const i=this.count,r=e.index,o=t.index;r<o?(this.atomIndex1[i]=r,this.atomIndex2[i]=o):(this.atomIndex2[i]=r,this.atomIndex1[i]=o),n&&(this.bondOrder[i]=n),this.count+=1}addBondIfConnected(e,t,n){return!!e.connectedTo(t)&&(this.addBond(e,t,n),!0)}}class J_ extends zv{get _defaultFields(){return[["residueIndex",1,"uint32"],["atomTypeId",1,"uint16"],["x",1,"float32"],["y",1,"float32"],["z",1,"float32"],["serial",1,"int32"],["bfactor",1,"float32"],["altloc",1,"uint8"],["occupancy",1,"float32"]]}setAltloc(e,t){this.altloc[e]=t.charCodeAt(0)}getAltloc(e){const t=this.altloc[e];return t?String.fromCharCode(t):""}}class eS extends zv{get _defaultFields(){return[["chainIndex",1,"uint32"],["atomOffset",1,"uint32"],["atomCount",1,"uint32"],["residueTypeId",1,"uint16"],["resno",1,"int32"],["sstruc",1,"uint8"],["inscode",1,"uint8"]]}setSstruc(e,t){this.sstruc[e]=t.charCodeAt(0)}getSstruc(e){const t=this.sstruc[e];return t?String.fromCharCode(t):""}setInscode(e,t){this.inscode[e]=t.charCodeAt(0)}getInscode(e){const t=this.inscode[e];return t?String.fromCharCode(t):""}}class tS extends zv{get _defaultFields(){return[["entityIndex",1,"uint16"],["modelIndex",1,"uint16"],["residueOffset",1,"uint32"],["residueCount",1,"uint32"],["chainname",4,"uint8"],["chainid",4,"uint8"]]}setChainname(e,t){const n=4*e;this.chainname[n]=t.charCodeAt(0),this.chainname[n+1]=t.charCodeAt(1),this.chainname[n+2]=t.charCodeAt(2),this.chainname[n+3]=t.charCodeAt(3)}getChainname(e){let t="";for(let n=0;n<4;++n){const i=this.chainname[4*e+n];if(!i)break;t+=String.fromCharCode(i)}return t}setChainid(e,t){const n=4*e;this.chainid[n]=t.charCodeAt(0),this.chainid[n+1]=t.charCodeAt(1),this.chainid[n+2]=t.charCodeAt(2),this.chainid[n+3]=t.charCodeAt(3)}getChainid(e){let t="";for(let n=0;n<4;++n){const i=this.chainid[4*e+n];if(!i)break;t+=String.fromCharCode(i)}return t}}class nS extends zv{get _defaultFields(){return[["chainOffset",1,"uint32"],["chainCount",1,"uint32"]]}}class iS{constructor(e){this.polymer=e,this.size=e.residueCount}getCenterIterator(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this.getPosition().center,n=t.length/3;let i=0,r=-1;const o=[new mn,new mn,new mn,new mn];function s(){const e=this.get(r);return r+=1,e}function a(r){r=Math.min(n-1,Math.max(0,r));const s=o[i%4],a=3*r;if(s.fromArray(t,a),e){const i=Math.min(e,r,n-r-1);for(let e=1;e<=i;++e){const n=3*e,r=(i+1-e)/(i+1);s.x+=r*t[a-n+0]+r*t[a+n+0],s.y+=r*t[a-n+1]+r*t[a+n+1],s.z+=r*t[a-n+2]+r*t[a+n+2]}s.x/=i+1,s.y/=i+1,s.z/=i+1}return i+=1,s}function l(){i=0,r=-1}return{size:n,next:s,get:a,reset:l}}getColor(e){const t=this.polymer,n=t.structure,i=t.residueCount,r=t.residueIndexStart,o=new Float32Array(3*i),s=e||{};s.structure=n;const a=Sm.getScheme(s),l=n.getResidueProxy(),c=n.getAtomProxy();for(let u=0;u<i;++u)l.index=r+u,c.index=l.traceAtomIndex,a.atomColorToArray(c,o,3*u);return{color:o}}getPicking(){const e=this.polymer,t=e.structure,n=e.residueCount,i=e.residueIndexStart,r=new Float32Array(n),o=t.getResidueProxy();for(let s=0;s<n;++s)o.index=i+s,r[s]=o.traceAtomIndex;return{picking:new mw(r,t)}}getSize(e){const t=this.polymer,n=t.structure,i=t.residueCount,r=t.residueIndexStart,o=new Float32Array(i),s=new W_(e),a=n.getResidueProxy(),l=n.getAtomProxy();for(let c=0;c<i;++c)a.index=r+c,l.index=a.traceAtomIndex,o[c]=s.atomRadius(l);return{size:o}}getPosition(){const e=this.polymer,t=e.structure,n=e.residueCount,i=n-3,r=new Float32Array(3*n),o=new Float32Array(3*n),s=new Float32Array(n),a=new Float32Array(n),l=new Float32Array(n),c=new Float32Array(n),u=new Float32Array(3*n),h=new mn,d=new mn,p=new mn,f=new mn,m=new mn,g=new mn,y=new mn,v=new mn,b=new mn,x=new mn,w=new mn,_=new mn(0,0,0),S="trace",M=t.getAtomProxy(),A=t.getAtomProxy(e.getAtomIndexByType(0,S)),C=t.getAtomProxy(e.getAtomIndexByType(1,S)),T=t.getAtomProxy(e.getAtomIndexByType(2,S));for(let k=0;k<i;++k){M.index=A.index,A.index=C.index,C.index=T.index,T.index=e.getAtomIndexByType(k+3,S);const t=3*k;h.subVectors(A,M),d.subVectors(C,A),p.subVectors(T,C),f.subVectors(h,d),m.subVectors(d,p),b.crossVectors(f,m).normalize(),b.toArray(o,t),k>0&&(s[k]=b.angleTo(x));const n=Math.cos(f.angleTo(m));c[k]=180/Math.PI*Math.acos(n);const i=f.length(),v=m.length();a[k]=Math.sqrt(v*i)/Math.max(2,2*(1-n)),l[k]=Math.abs(d.dot(b)),g.copy(f).multiplyScalar(a[k]/i),y.copy(m).multiplyScalar(a[k]/v),g.subVectors(A,g),y.subVectors(C,y),g.toArray(r,t+3),y.toArray(r,t+6),w.subVectors(M,_),w.toArray(u,t),x.copy(b),_.copy(g)}g.fromArray(r,3),y.fromArray(r,6),b.subVectors(g,y).normalize(),M.index=e.getAtomIndexByType(0,S),_.copy(M),v.copy(M),Zy(v,b,g),v.toArray(r,0),w.subVectors(_,g),w.toArray(u,0),g.fromArray(r,3*n-6),y.fromArray(r,3*n-9),b.subVectors(g,y).normalize(),M.index=e.getAtomIndexByType(n-1,S),_.copy(M),v.copy(M),Zy(v,b,g),v.toArray(r,3*n-3);for(let k=n-3;k<n;++k)g.fromArray(r,3*k),M.index=e.getAtomIndexByType(k,S),_.copy(M),w.subVectors(_,g),w.toArray(u,3*k);const E=new Float32Array(n),P=new Float32Array(n),I=new Float32Array(n),L=new Float32Array(n);E[1]=a[0],P[1]=c[0],I[1]=a[0];for(let k=2;k<n-2;++k)E[k]=.5*(a[k-2]+a[k-1]),P[k]=.5*(c[k-2]+c[k-1]),I[k]=.5*(l[k-2]+l[k-1]),g.fromArray(o,3*(k-2)),y.fromArray(o,3*(k-1)),L[k]=180/Math.PI*Math.acos(Math.cos(g.angleTo(y)));E[n-2]=a[n-4],P[n-2]=c[n-4],I[n-2]=l[n-4];const R=new Float32Array(3*n);Mg(o,R,0,0,3),Mg(o,R,0,3,3);for(let k=2;k<n-2;++k)g.fromArray(o,3*(k-2)),y.fromArray(o,3*(k-1)),b.addVectors(y,g).multiplyScalar(.5).normalize(),b.toArray(R,3*k);return Mg(o,R,3*n-12,3*n-6,3),Mg(o,R,3*n-12,3*n-3,3),{center:r,axis:R,bending:L,radius:E,rise:I,twist:P,resdir:u}}}class rS{constructor(e){this.polymer=e,this.helixorient=new iS(e),this.position=this.helixorient.getPosition()}getAxis(e,t,n,i,r){e=e||30,t=t||2.5,n=void 0!==n&&n;const o=this.polymer,s=o.structure,a=o.residueCount,l=o.residueIndexStart,c=this.position,u=i||{};u.structure=s;const h=Sm.getScheme(u),d=new W_(r);let p=0,f=0;const m=[],g=[],y=[],v=[],b=[],x=[],w=[],_=[],S=[];let M,A,C=new Float32Array(3*a),T=new Float32Array(3*a);const E=new mn,P=new mn,I=s.getResidueProxy(),L=s.getResidueProxy(),R=s.getAtomProxy(),k=new mn,D=new mn;let O=!1;for(let B=0;B<a;++B)if(I.index=l+B,k.fromArray(c.center,3*B),B===a-1?O=!0:(L.index=l+B+1,D.fromArray(c.center,3*B+3),(n&&I.sstruc!==L.sstruc||k.distanceTo(D)>t||c.bending[B]>e)&&(O=!0)),O){if(B-p<4){p=B,O=!1;continue}R.index=I.traceAtomIndex,C=c.axis.subarray(3*p+3,3*B),T=c.center.subarray(3*p,3*B+3),M=Yy(C).normalize(),A=Yy(T),E.fromArray(T),Zy(E,M,A),P.fromArray(T,T.length-3),Zy(P,M,A),M.subVectors(P,E),M.toArray(m,f),A.toArray(g,f),E.toArray(y,f),P.toArray(v,f),h.atomColorToArray(R,b,f),x.push(R.index),w.push(d.atomRadius(R)),_.push(l+p),S.push(l+B+1-p),f+=3,p=B,O=!1}const N=new Float32Array(x);return{axis:new Float32Array(m),center:new Float32Array(g),begin:new Float32Array(y),end:new Float32Array(v),color:new Float32Array(b),picking:new mw(N,s),size:new Float32Array(w),residueOffset:_,residueCount:S}}}class oS{constructor(e){this.scoreFunction=e,this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.bubbleUp(this.content.length-1)}pop(){const e=this.content[0],t=this.content.pop();return t&&this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e}peek(){return this.content[0]}remove(e){const t=this.content.length;for(let n=0;n<t;n++)if(this.content[n]===e){const i=this.content.pop();return void(i&&n!==t-1&&(this.content[n]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")}size(){return this.content.length}bubbleUp(e){const t=this.content[e];for(;e>0;){const n=Math.floor((e+1)/2)-1,i=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(i)))break;this.content[n]=t,this.content[e]=i,e=n}}sinkDown(e){const t=this.content.length,n=this.content[e],i=this.scoreFunction(n);let r=0,o=0;for(;;){const s=2*(e+1),a=s-1;let l=null;if(a<t){const e=this.content[a];r=this.scoreFunction(e),r<i&&(l=a)}if(s<t){const e=this.content[s];o=this.scoreFunction(e),o<(null===l?i:r)&&(l=s)}if(null===l)break;this.content[e]=this.content[l],this.content[l]=n,e=l}}}class sS{constructor(e,t){this.points=e,this.metric=t,this.maxDepth=0,this.currentNode=0;const n=e.length/3,i=new Uint32Array(n);for(let r=0;r<n;++r)i[r]=r;this.indices=i,this.nodes=new Int32Array(4*n),this.rootIndex=this.buildTree(0,-1,0,n)}buildTree(e,t,n,i){e>this.maxDepth&&(this.maxDepth=e);const r=i-n;if(0===r)return-1;const o=4*this.currentNode,s=this.nodes;if(this.currentNode+=1,1===r)return s[o]=n,s[o+1]=-1,s[o+2]=-1,s[o+3]=t,o;const a=this.indices,l=this.points,c=n+Math.floor(r/2),u=e%3;let h,d,p,f,m,g=n,y=i-1;for(;y>g;){for(p=g+y>>1,f=l[3*a[p]+u],d=a[p],a[p]=a[y],a[y]=d,m=g,h=g;h<y;++h)l[3*a[h]+u]<f&&(d=a[m],a[m]=a[h],a[h]=d,++m);if(d=a[y],a[y]=a[m],a[m]=d,p=m,c===p)break;c<p?y=p-1:g=p+1}return s[o]=c,s[o+1]=this.buildTree(e+1,o,n,c),s[o+2]=this.buildTree(e+1,o,c+1,i),s[o+3]=t,o}getNodeDepth(e){const t=this.nodes[e+3];return-1===t?0:this.getNodeDepth(t)+1}nearest(e,t,n){const i=new oS((e=>-e[1])),r=this.nodes,o=this.points,s=this.indices,a=l=>{let c,u;const h=this.getNodeDepth(l)%3,d=3*s[r[l]],p=[o[d+0],o[d+1],o[d+2]],f=this.metric(e,p);function m(e,n){i.push([e,n]),i.size()>t&&i.pop()}const g=r[l+1],y=r[l+2];if(-1===y&&-1===g)return void((i.size()<t||f<i.peek()[1])&&f<=n&&m(l,f));c=-1===y?g:-1===g?y:e[h]<=o[d+h]?g:y,a(c),(i.size()<t||f<i.peek()[1])&&f<=n&&m(l,f);const v=[];for(let t=0;t<3;t+=1)v[t]=t===h?e[t]:o[d+t];const b=this.metric(v,p);(i.size()<t||Math.abs(b)<i.peek()[1])&&Math.abs(b)<=n&&(u=c===g?y:g,-1!==u&&a(u))};a(this.rootIndex);const l=[];for(let c=0,u=Math.min(i.size(),t);c<u;c+=1)l.push(i.content[c]);return l}verify(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=1;if(void 0===e&&(e=this.rootIndex),-1===e)throw new Error("node is null");const i=t%3,r=this.nodes,o=this.points,s=this.indices,a=r[e+1],l=r[e+2];if(-1!==a){if(o[3*s[r[a]]+i]>o[3*s[r[e]]+i])throw new Error("left child is > parent!");n+=this.verify(a,t+1)}if(-1!==l){if(o[3*s[r[l]]+i]<o[3*s[r[e]]+i])throw new Error("right child is < parent!");n+=this.verify(l,t+1)}return n}}class aS{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get bondHash(){return this.structure.bondHash}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainIndex(){return this.residueStore.chainIndex[this.residueIndex]}get residue(){return console.warn("residue - might be expensive"),this.structure.getResidueProxy(this.residueIndex)}get residueIndex(){return this.atomStore.residueIndex[this.index]}set residueIndex(e){this.atomStore.residueIndex[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.residueIndex)}get inscode(){return this.residueStore.getInscode(this.residueIndex)}get resno(){return this.residueStore.resno[this.residueIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.residueIndex])}get atomType(){return this.atomMap.get(this.atomStore.atomTypeId[this.index])}get residueAtomOffset(){return this.residueStore.atomOffset[this.residueIndex]}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get atomname(){return this.atomType.atomname}get number(){return this.atomType.number}get element(){return this.atomType.element}get vdw(){return this.atomType.vdw}get covalent(){return this.atomType.covalent}get x(){return this.atomStore.x[this.index]}set x(e){this.atomStore.x[this.index]=e}get y(){return this.atomStore.y[this.index]}set y(e){this.atomStore.y[this.index]=e}get z(){return this.atomStore.z[this.index]}set z(e){this.atomStore.z[this.index]=e}get serial(){return this.atomStore.serial[this.index]}set serial(e){this.atomStore.serial[this.index]=e}get bfactor(){return this.atomStore.bfactor[this.index]}set bfactor(e){this.atomStore.bfactor[this.index]=e}get occupancy(){return this.atomStore.occupancy[this.index]}set occupancy(e){this.atomStore.occupancy[this.index]=e}get altloc(){return this.atomStore.getAltloc(this.index)}set altloc(e){this.atomStore.setAltloc(this.index,e)}get partialCharge(){return this.atomStore.partialCharge?this.atomStore.partialCharge[this.index]:null}set partialCharge(e){this.atomStore.partialCharge&&(this.atomStore.partialCharge[this.index]=e)}get radius(){return this.atomStore.radius?this.atomStore.radius[this.index]:null}set radius(e){this.atomStore.radius&&(this.atomStore.radius[this.index]=e)}get formalCharge(){return this.atomStore.formalCharge?this.atomStore.formalCharge[this.index]:null}set formalCharge(e){this.atomStore.formalCharge&&(this.atomStore.formalCharge[this.index]=e)}get aromatic(){return this.atomStore.aromatic?this.atomStore.aromatic[this.index]:this.residueType.isAromatic(this)?1:0}set aromatic(e){this.atomStore.aromatic&&(this.atomStore.aromatic[this.index]=e)}get bondCount(){return this.bondHash.countArray[this.index]}eachBond(e,t){t=t||this.structure._bp;const n=this.index,i=this.bondHash,r=i.indexArray,o=i.countArray[n],s=i.offsetArray[n];for(let a=0;a<o;++a)t.index=r[s+a],e(t)}eachBondedAtom(e,t){const n=t||this.structure._ap,i=this.index;this.eachBond((function(t){n.index=i!==t.atomIndex1?t.atomIndex1:t.atomIndex2,e(n)})),this.index=i}hasBondTo(e){let t=!1;return this.eachBondedAtom((function(n){e.index===n.index&&(t=!0)})),t}bondToElementCount(e){let t=0;const n=this.index;return this.eachBondedAtom((function(n){n.number===e&&(t+=1)})),this.index=n,t}hasBondToElement(e){return this.bondToElementCount(e)>0}isBackbone(){const e=this.residueType.backboneIndexList;return e.length>0&&e.includes(this.index-this.residueAtomOffset)}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return e===nb||e===ib||e===rb}}isSidechain(){return this.isPolymer()&&!this.isBackbone()}isCg(){const e=this.residueType.backboneType;return e===ub||e===hb||e===db}isTrace(){return this.index===this.residueType.traceAtomIndex+this.residueAtomOffset}isHetero(){return 1===this.residueType.hetero}isProtein(){return this.residueType.moleculeType===nb}isNucleic(){const e=this.residueType.moleculeType;return e===ib||e===rb}isRna(){return this.residueType.moleculeType===ib}isDna(){return this.residueType.moleculeType===rb}isWater(){return this.residueType.moleculeType===eb}isIon(){return this.residueType.moleculeType===tb}isSaccharide(){return this.residueType.moleculeType===ob}isHelix(){return vb.includes(this.sstruc)}isSheet(){return bb.includes(this.sstruc)}isTurn(){return xb.includes(this.sstruc)&&this.isProtein()}isBonded(){return 0!==this.bondHash.countArray[this.index]}isRing(){return void 0!==this.residueType.getRings().atomRings[this.index-this.residueAtomOffset]}isAromatic(){return 1===this.aromatic}isPolarHydrogen(){let e=!1;return 1!==this.number||(e=!this.hasBondToElement(6)),e}isMetal(){return this.atomType.isMetal()}isNonmetal(){return this.atomType.isNonmetal()}isMetalloid(){return this.atomType.isMetalloid()}isHalogen(){return this.atomType.isHalogen()}isDiatomicNonmetal(){return this.atomType.isDiatomicNonmetal()}isPolyatomicNonmetal(){return this.atomType.isPolyatomicNonmetal()}isAlkaliMetal(){return this.atomType.isAlkaliMetal()}isAlkalineEarthMetal(){return this.atomType.isAlkalineEarthMetal()}isNobleGas(){return this.atomType.isNobleGas()}isTransitionMetal(){return this.atomType.isTransitionMetal()}isPostTransitionMetal(){return this.atomType.isPostTransitionMetal()}isLanthanide(){return this.atomType.isLanthanide()}isActinide(){return this.atomType.isActinide()}getDefaultValence(){return this.atomType.getDefaultValence()}getValenceList(){return this.atomType.getValenceList()}getOuterShellElectronCount(){return this.atomType.getOuterShellElectronCount()}distanceTo(e){const t=this.atomStore,n=e.atomStore,i=this.index,r=e.index,o=t.x[i]-n.x[r],s=t.y[i]-n.y[r],a=t.z[i]-n.z[r],l=o*o+s*s+a*a;return Math.sqrt(l)}connectedTo(e){const t=this.atomStore,n=e.atomStore,i=this.index,r=e.index;if(t.altloc&&n.altloc){const e=t.altloc[i],o=n.altloc[r];if(0!==e&&0!==o&&32!==e&&32!==o&&e!==o)return!1}const o=t.x[i]-n.x[r],s=t.y[i]-n.y[r],a=t.z[i]-n.z[r],l=o*o+s*s+a*a;if(l<48&&this.isCg())return!0;if(isNaN(l))return!1;const c=this.covalent+e.covalent,u=c+.3,h=c-.5;return l<u*u&&l>h*h}positionFromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this}positionToArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.index,i=this.atomStore;return e[t+0]=i.x[n],e[t+1]=i.y[n],e[t+2]=i.z[n],e}positionToVector3(e){return void 0===e&&(e=new mn),e.x=this.x,e.y=this.y,e.z=this.z,e}positionFromVector3(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}positionAdd(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}positionSub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}getResidueBonds(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.residueAtomOffset,n=this.index-this.residueAtomOffset,i=this.residueType.getBonds(),r=i.atomIndices1,o=i.atomIndices2;let s,a,l,c;for(e||(c=[]),s=r.indexOf(n);-1!==s;){if(l=o[s]+t,!c)return l;c.push(l),s=r.indexOf(n,s+1)}for(a=o.indexOf(n);-1!==a;){if(l=r[a]+t,!c)return l;c.push(l),a=o.indexOf(n,a+1)}return c}qualifiedName(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t="";return this.resname&&!e&&(t+="["+this.resname+"]"),void 0!==this.resno&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chainname&&(t+=":"+this.chainname),this.atomname&&(t+="."+this.atomname),this.altloc&&(t+="%"+this.altloc),this.structure.modelStore.count>1&&(t+="/"+this.modelIndex),t}clone(){return new aS(this.structure,this.index)}toObject(){return{index:this.index,residueIndex:this.residueIndex,resname:this.resname,x:this.x,y:this.y,z:this.z,element:this.element,chainname:this.chainname,resno:this.resno,serial:this.serial,vdw:this.vdw,covalent:this.covalent,hetero:this.hetero,bfactor:this.bfactor,altloc:this.altloc,atomname:this.atomname,modelIndex:this.modelIndex}}}function lS(e,t){const n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return n*n+i*i+r*r}function cS(e,t){return Math.sqrt(lS(e,t))}const uS=new Float32Array(3);class hS{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.Debug&&gm.time("Kdtree build");const i=n?lS:cS,r=new Float32Array(3*t.atomCount),o=new Uint32Array(t.atomCount);let s=0;t.eachAtom((function(e){r[s+0]=e.x,r[s+1]=e.y,r[s+2]=e.z,o[s/3]=e.index,s+=3})),this.atomIndices=o,this.points=r,this.kdtree=new sS(r,i),e.Debug&&gm.timeEnd("Kdtree build")}nearest(e,t,n){e instanceof mn?e.toArray(uS):e instanceof aS&&e.positionToArray(uS);const i=this.kdtree.nearest(uS,t,n),r=this.kdtree.indices,o=this.kdtree.nodes,s=this.atomIndices,a=[];for(let l=0,c=i.length;l<c;++l){const e=i[l],t=e[0],n=e[1];a.push({index:s[r[o[t]]],distance:n})}return a}}const dS={" ":"X","!":"Y","#":"Z",$:"-X","%":"-Y","&":"-Z","'":"Y+1/2","(":"1/2+X",")":"1/2+Y","*":"1/2-X","+":"1/2+Z",",":"1/2-Y","-":"1/2-Z",".":"X+1/2","/":"Z+1/2",0:"-X+1/2",1:"-Y+1/2",2:"-Z+1/2",3:"1/4+X",4:"1/4-Y",5:"1/4+Z",6:"1/4-X",7:"1/4+Y",8:"3/4-Y",9:"3/4+Z",":":"3/4+Y",";":"3/4+X","<":"3/4-X","=":"1/4-Z",">":"3/4-Z","?":"X-Y","@":"Y-X",A:"Z+1/3",B:"Z+2/3",C:"X+2/3",D:"Y+1/3",E:"-Y+2/3",F:"X-Y+1/3",G:"Y-X+2/3",H:"-X+1/3",I:"X+1/3",J:"Y+2/3",K:"-Y+1/3",L:"X-Y+2/3",M:"Y-X+1/3",N:"-X+2/3",O:"2/3+X",P:"1/3+Y",Q:"1/3+Z",R:"2/3-Y",S:"1/3+X-Y",T:"2/3+Y-X",U:"1/3-X",V:"2/3-X",W:"1/3-Y",X:"1/3-Z",Y:"2/3+Y",Z:"1/3+Y-X","[":"2/3+X-Y","]":"1/3+X","^":"2/3+Z",_:"2/3-Z","`":"5/6+Z",a:"1/6+Z",b:"5/6-Z",c:"1/6-Z",d:"Z+5/6",e:"Z+1/6",f:"Z+1/4",g:"+Y"},pS={"P 1":" !#","P -1":" !#$%&","P 1 2 1":" !#$!&","P 1 21 1":" !#$'&","C 1 2 1":" !#$!&()#*)&","P 1 m 1":" !# %#","P 1 c 1":" !# %+","C 1 m 1":" !# %#()#(,#","C 1 c 1":" !# %+()#(,+","P 1 2/m 1":" !# %#$!&$%&","P 1 21/m 1":" !#$)&$%& ,#","C 1 2/m 1":" !# %#$!&$%&()#(,#*)&*,&","P 1 2/c 1":" !#$!-$%& %+","P 1 21/c 1":" !#$%&$)- ,+","C 1 2/c 1":" !#$!-$%& %+()#*)-*,&(,+","P 2 2 2":" !#$%#$!& %&","P 2 2 21":" !#$%+$!- %&","P 21 21 2":" !#$%#*)&(,&","P 21 21 21":" !#*%+$)-(,&","C 2 2 21":" !#$%+$!- %&()#*,+*)-(,&","C 2 2 2":" !#$%#$!& %&()#*,#*)&(,&","F 2 2 2":" !#$%#$!& %& )+$,+$)- ,-(!+*%+*!-(%-()#*,#*)&(,&","I 2 2 2":" !#$%# %&$!&.'/01/.120'2","I 21 21 21":" !#*%+$)-(,&()+$,#*!& %-","P m m 2":" !#$%# %#$!#","P m c 21":" !#$%+ %+$!#","P c c 2":" !#$%# %+$!+","P m a 2":" !#$%#(%#*!#","P c a 21":" !#$%+(%#*!+","P n c 2":" !#$%# ,+$)+","P m n 21":" !#*%+(%+$!#","P b a 2":" !#$%#(,#*)#","P n a 21":" !#$%+(,#*)+","P n n 2":" !#$%#(,+*)+","C m m 2":" !#$%# %#$!#()#*,#(,#*)#","C m c 21":" !#$%+ %+$!#()#*,+(,+*)#","C c c 2":" !#$%# %+$!+()#*,#(,+*)+","A m m 2":" !#$%# %#$!# )+$,+ ,+$)+","A b m 2":" !#$%# ,#$)# )+$,+ %+$!+","A m a 2":" !#$%#(%#*!# )+$,+(,+*)+","A b a 2":" !#$%#(,#*)# )+$,+(%+*!+","F m m 2":" !#$%# %#$!# )+$,+ ,+$)+(!+*%+(%+*!+()#*,#(,#*)#","F d d 2":" !#$%#345675 )+$,+3896:9(!+*%+;49<79()#*,#;85<:5","I m m 2":" !#$%# %#$!#()+*,+(,+*)+","I b a 2":" !#$%#(,#*)#()+*,+ %+$!+","I m a 2":" !#$%#(%#*!#()+*,+ ,+$)+","P 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#","P 2/n 2/n 2/n":" !#$%#$!& %&*,-()-(,+*)+","P 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+","P 2/b 2/a 2/n":" !#$%#$!& %&*,&()&(,#*)#","P 21/m 2/m 2/a":" !#*%#$!&(%&$%&(!& %#*!#","P 2/n 21/n 2/a":" !#*%#*)- ,-$%&(!&(,+$)+","P 2/m 2/n 21/a":" !#*%+*!- %&$%&(!-(%+$!#","P 21/c 2/c 2/a":" !#*%#$!-(%-$%&(!& %+*!+","P 21/b 21/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#","P 21/c 21/c 2/n":" !#*,#$)-(%-$%&()& ,+*!+","P 2/b 21/c 21/m":" !#$%+$)- ,&$%& !- ,+$)#","P 21/n 21/n 2/m":" !#$%#*)-(,-$%& !&(,+*)+","P 21/m 21/m 2/n":" !#$%#*'&.,&*,&.'& %#$!#","P 21/b 2/c 21/n":" !#*,+$!-(,&$%&()- %+*)#","P 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#","P 21/n 21/m 21/a":" !#0%/$'&.12$%&.!2 1#0'/","C 2/m 2/c 21/m":" !#$%+$!- %&$%& !- %+$!#()#*,+*)-(,&*,&()-(,+*)#","C 2/m 2/c 21/a":" !#$,+$)- %&$%& )- ,+$!#()#*%+*!-(,&*,&(!-(%+*)#","C 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()#*,#*)&(,&*,&()&(,#*)#","C 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+()#*,#*)-(,-*,&()&(,+*)+","C 2/m 2/m 2/a":" !#$,#$)& %&$%& )& ,#$!#()#*%#*!&(,&*,&(!&(%#*)#","C 2/c 2/c 2/a":" !#*,#$!&(,&$,-(!- ,+*!+()#$%#*)& %&*%- )-(%+$)+","F 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!# )+$,+$)- ,-$,- )- ,+$)+(!+*%+*!-(%-*%-(!-(%+*!+()#*,#*)&(,&*,&()&(,#*)#","F 2/d 2/d 2/d":" !#$%#$!& %&64=37=345675 )+$,+$)- ,-68>3:>3896:9(!+*%+*!-(%-<4>;7>;49<79()#*,#*)&(,&<8=;:=;85<:5","I 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()+*,+*)-(,-*,-()-(,+*)+","I 2/b 2/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#()+*,+$!- %-*,-()- %+$!+","I 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#()+$,#*!& %-*,- )&(%#$!+","I 21/m 21/m 21/a":" !#$,#$)& %&$%& )& ,#$!#()+*%+*!-(,-*,-(!-(%+*)+","P 4":" !#$%#% #!$#","P 41":" !#$%+% 5!$9","P 42":" !#$%#% +!$+","P 43":" !#$%+% 9!$5","I 4":" !#$%#% #!$#()+*,+,(+)*+","I 41":" !#*,+%(5)$9()+$%#, 9!*5","P -4":" !#$%#!$&% &","I -4":" !#$%#!$&% &()+*,+)*-,(-","P 4/m":" !#$%#% #!$#$%& !&!$&% &","P 42/m":" !#$%#% +!$+$%& !&!$-% -","P 4/n":" !#$%#,(#)*#*,&()&!$&% &","P 42/n":" !#$%#,(+)*+*,-()-!$&% &","I 4/m":" !#$%#% #!$#$%& !&!$&% &()+*,+,(+)*+*,-()-)*-,(-","I 41/a":" !#*,+%(5)$9$,=(!>!$&,(-()+$%#, 9!*5*%> )=)*-% &","P 4 2 2":" !#$%#% #!$#$!& %&! &%$&","P 4 21 2":" !#$%#,(#)*#*)&(,&! &%$&","P 41 2 2":" !#$%+% 5!$9$!& %-! >%$=","P 41 21 2":" !#$%+,(5)*9*)=(,>! &%$-","P 42 2 2":" !#$%#% +!$+$!& %&! -%$-","P 42 21 2":" !#$%#,(+)*+*)-(,-! &%$&","P 43 2 2":" !#$%+% 9!$5$!& %-! =%$>","P 43 21 2":" !#$%+,(9)*5*)>(,=! &%$-","I 4 2 2":" !#$%#% #!$#$!& %&! &%$&()+*,+,(+)*+*)-(,-)(-,*-","I 41 2 2":" !#*,+%(5)$9*!> ,=)(-%$&()+$%#, 9!*5$)=(%>! &,*-","P 4 m m":" !#$%#% #!$# %#$!#%$#! #","P 4 b m":" !#$%#% #!$#(,#*)#,*#)(#","P 42 c m":" !#$%#% +!$+ %+$!+%$#! #","P 42 n m":" !#$%#,(+)*+(,+*)+%$#! #","P 4 c c":" !#$%#% #!$# %+$!+%$+! +","P 4 n c":" !#$%#% #!$#(,+*)+,*+)(+","P 42 m c":" !#$%#% +!$+ %#$!#%$+! +","P 42 b c":" !#$%#% +!$+(,#*)#,*+)(+","I 4 m m":" !#$%#% #!$# %#$!#%$#! #()+*,+,(+)*+(,+*)+,*+)(+","I 4 c m":" !#$%#% #!$# %+$!+%$+! +()+*,+,(+)*+(,#*)#,*#)(#","I 41 m d":" !#*,+%(5)$9 %#*)+%*5) 9()+$%#, 9!*5(,+$!#,$9!(5","I 41 c d":" !#*,+%(5)$9 %+*)#%*9) 5()+$%#, 9!*5(,#$!+,$5!(9","P -4 2 m":" !#$%#% &!$&$!& %&%$#! #","P -4 2 c":" !#$%#% &!$&$!- %-%$+! +","P -4 21 m":" !#$%#% &!$&*)&(,&,*#)(#","P -4 21 c":" !#$%#% &!$&*)-(,-,*+)(+","P -4 m 2":" !#$%#!$&% & %#$!#! &%$&","P -4 c 2":" !#$%#% &!$& %+$!+! -%$-","P -4 b 2":" !#$%#% &!$&(,#*)#)(&,*&","P -4 n 2":" !#$%#% &!$&(,+*)+)(-,*-","I -4 m 2":" !#$%#% &!$& %#$!#! &%$&()+*,+,(-)*-(,+*)+)(-,*-","I -4 c 2":" !#$%#% &!$& %+$!+! -%$-()+*,+,(-)*-(,#*)#)(&,*&","I -4 2 m":" !#$%#% &!$&$!& %&%$#! #()+*,+,(-)*-*)-(,-,*+)(+","I -4 2 d":" !#$%#% &!$&*!>(%>,$9) 9()+*,+,(-)*-$)= ,=%*5!(5","P 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #","P 4/m 2/c 2/c":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +","P 4/n 2/b 2/m":" !#$%#% #!$#$!& %&! &%$&*,&()&)*&,(&(,#*)#,*#)(#","P 4/n 2/n 2/c":" !#$%#% #!$#$!& %&! &%$&*,-()-)*-,(-(,+*)+,*+)(+","P 4/m 21/b 2/m":" !#$%#% #!$#*)&(,&)(&,*&$%& !&!$&% &(,#*)#,*#)(#","P 4/m 21/n 2/c":" !#$%#% #!$#*)-(,-)(-,*-$%& !&!$&% &(,+*)+,*+)(+","P 4/n 21/m 2/m":" !#$%#,(#)*#*)&(,&! &%$&*,&()&!$&% & %#$!#,*#)(#","P 4/n 2/c 2/c":" !#$%#,(#)*#*)-(,-! -%$-*,&()&!$&% & %+$!+,*+)(+","P 42/m 2/m 2/c":" !#$%#% +!$+$!& %&! -%$-$%& !&!$-% - %#$!#%$+! +","P 42/m 2/c 2/m":" !#$%#% +!$+$!- %-! &%$&$%& !&!$-% - %+$!+%$#! #","P 42/n 2/b 2/c":" !#$%#,(+)*+$!- %-)(&,*&*,-()-!$&% &(,#*)#%$+! +","P 42/n 2/n 2/m":" !#$%#,(+)*+$!& %&)(-,*-*,-()-!$&% &(,+*)+%$#! #","P 42/m 21/b 2/c":" !#$%#% +!$+*)&(,&)(-,*-$%& !&!$-% -(,#*)#,*+)(+","P 42/m 21/n 2/m":" !#$%#,./'*/*'-.,-! &%$&$%& !&'*-,.-.,/*'/%$#! #","P 42/n 21/m 2/c":" !#$%#,(+)*+*)-(,-! &%$&*,-()-!$&% & %#$!#,*+)(+","P 42/n 21/c 2/m":" !#$%#,(+)*+*)&(,&! -%$-*,-()-!$&% & %+$!+,*#)(#","I 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #()+*,+,(+)*+*)-(,-)(-,*-*,-()-)*-,(-(,+*)+,*+)(+","I 4/m 2/c 2/m":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +()+*,+,(+)*+*)&(,&)(&,*&*,-()-)*-,(-(,#*)#,*#)(#","I 41/a 2/m 2/d":" !#*,+%(5)$9*!> ,=)(-%$&$,=(!>!$&,(-(,+$!#,$9!(5()+$%#, 9!*5$)=(%>! &,*-*%> )=)*-% & %#*)+%*5) 9","I 41/a 2/c 2/d":" !#*,+%(5)$9*!= ,>)(&%$-$,=(!>!$&,(-(,#$!+,$5!(9()+$%#, 9!*5$)>(%=! -,*&*%> )=)*-% & %+*)#%*9) 5","P 3":" !#%?#@$#","P 31":" !#%?A@$B","P 32":" !#%?B@$A","H 3":" !#%?#@$#CDAEFAGHAIJBKLBMNB","R 3":" !## !!# ","P -3":" !#%?#@$#$%&!@&? &","H -3":" !#%?#@$#$%&!@&? &OPQRSQTUQVWXYZX[]X]Y^W[^ZV^UR_PT_SO_","R -3":" !## !!# $%&&$%%&$","P 3 1 2":" !#%?#@$#%$&@!& ?&","P 3 2 1":" !#%?#@$#! &?%&$@&","P 31 1 2":" !#%?Q@$^%$_@!X ?&","P 31 2 1":" !#%?A@$B! &?%_$@X","P 32 1 2":" !#%?^@$Q%$X@!_ ?&","P 32 2 1":" !#%?B@$A! &?%X$@_","H 3 2":" !#%?#@$#! &?%&$@&OPQRSQTUQY]X[WXVZX]Y^W[^ZV^PO_SR_UT_","R 3 2":" !## !!# %$&$&%&%$","P 3 m 1":" !#%?#@$#%$#@!# ?#","P 3 1 m":" !#%?#@$#! #?%#$@#","P 3 c 1":" !#%?#@$#%$+@!+ ?+","P 3 1 c":" !#%?#@$#! +?%+$@+","H 3 m":" !#%?#@$#%$#@!# ?#OPQRSQTUQRUQTPQOSQ]Y^W[^ZV^WV^ZY^][^","R 3 m":" !## !!# ! # #!#! ","H 3 c":" !#%?#@$#%$+@!+ ?+OPQRSQTUQRU`TP`OS`]Y^W[^ZV^WVaZYa][a","R 3 c":" !## !!# '././'/'.","P -3 1 2/m":" !#%?#@$#%$&@!& ?&$%&!@&? &! #?%#$@#","P -3 1 2/c":" !#%?#@$#%$-@!- ?-$%&!@&? &! +?%+$@+","P -3 2/m 1":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#","P -3 2/c 1":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+","H -3 2/m":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#OPQRSQTUQY]X[WXVZXVWXYZX[]XRUQTPQOSQ]Y^W[^ZV^PO_SR_UT_UR_PT_SO_WV^ZY^][^","R -3 2/m":" !## !!# %$&$&%&%$$%&&$%%&$! # #!#! ","H -3 2/c":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+OPQRSQTUQY]b[WbVZbVWXYZX[]XRU`TP`OS`]Y^W[^ZV^POcSRcUTcUR_PT_SO_WVaZYa][a","R -3 2/c":" !## !!# 102021210$%&&$%%&$'././'/'.","P 6":" !#%?#@$#$%#!@#? #","P 61":" !#%?A@$B$%/!@d? e","P 65":" !#%?B@$A$%/!@e? d","P 62":" !#%?^@$Q$%#!@^? Q","P 64":" !#%?Q@$^$%#!@Q? ^","P 63":" !#%?#@$#$%+!@+? +","P -6":" !#%?#@$# !&%?&@$&","P 6/m":" !#%?#@$#$%#!@#? #$%&!@&? & !&%?&@$&","P 63/m":" !#%?#@$#$%+!@+? +$%&!@&? & !-%?-@$-","P 6 2 2":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&","P 61 2 2":" !#%?Q@$^$%+!@`? a! X?%&$@_%$b@!- ?c","P 65 2 2":" !#%?^@$Q$%+!@a? `! _?%&$@X%$c@!- ?b","P 62 2 2":" !#%?^@$Q$%#!@^? Q! _?%&$@X%$_@!& ?X","P 64 2 2":" !#%?Q@$^$%#!@Q? ^! X?%&$@_%$X@!& ?_","P 63 2 2":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-","P 6 m m":" !#%?#@$#$%#!@#? #%$#@!# ?#! #?%#$@#","P 6 c c":" !#%?#@$#$%#!@#? #%$+@!+ ?+! +?%+$@+","P 63 c m":" !#%?#@$#$%+!@+? +%$+@!+ ?+! #?%#$@#","P 63 m c":" !#%?#@$#$%+!@+? +%$#@!# ?#! +?%+$@+","P -6 m 2":" !#%?#@$# !&%?&@$&%$#@!# ?#%$&@!& ?&","P -6 c 2":" !#%?#@$# !-%?-@$-%$+@!+ ?+%$&@!& ?&","P -6 2 m":" !#%?#@$# !&%?&@$&! &?%&$@&! #?%#$@#","P -6 2 c":" !#%?#@$# !-%?-@$-! &?%&$@&! +?%+$@+","P 6/m 2/m 2/m":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&$%&!@&? & !&@$&%?&%$#@!# ?#! #?%#$@#","P 6/m 2/c 2/c":" !#%?#@$#$%#!@#? #! -?%-$@-%$-@!- ?-$%&!@&? & !&@$&%?&%$+@!+ ?+! +?%+$@+","P 63/m 2/c 2/m":" !#%?#@$#$%+!@+? +! -?%-$@-%$&@!& ?&$%&!@&? & !-@$-%?-%$+@!+ ?+! #?%#$@#","P 63/m 2/m 2/c":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-$%&!@&? & !-@$-%?-%$#@!# ?#! +?%+$@+","P 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ","F 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%&  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ","I 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(","P 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(","I 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- ","P 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$","P 2/n -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& *,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","F 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-($,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- *,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$","F 2/d -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& 64=37=345675=64=375345674=67=3453756 )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(68>3:>3896:9=<8=;:5;85<:4><7>;49;79<(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(<4>;7>;49<79>68>3:93896:8=<:=;85;:5<()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- <8=;:=;8f<:f><4>;79;49<78>6:>3893:96","I 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","P 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*","I 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*()+$,#*g& %-+()#$,&*!- %)+(,#$!&*%- *,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$","P 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$","P 42 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","F 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$","F 41 3 2":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46 )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<(!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86","I 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","P 43 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7;>46=:<5839398<5:6=4;>75:<983>7;=46","P 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<","I 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46","P -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ","F -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&%  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(+%*+!*-%(- +)$+,$-) -,#)(#,*&)*&,((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() +,$+)$-, -(#)*#,*&)(&,+!(+%*-!*-%(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(#,*#)*&,(&(+!*+%*-!(-%+) +,$-)$-, ","I -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","P -4 3 n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","F -4 3 c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() #,$#)$&, &(#!*#%*&!(&%+! +%$-!$-% (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(#%*#!*&%(& +!$+%$-! -%#) #,$&)$&, ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! +%$+!$-% - #)$#,$&) &,#!(#%*&!*&%(","I -4 3 d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7354<9:6>8;=357<946>:;=857394<>:6=8;()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- :;98657<=43>;9:658<=73>49:;586=7<>43","P 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","P 4/n -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/m -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/n -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","F 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#!  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*%*+!(+%(-!*-$-) -, +)$+,&,(&)*#,*#)((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%**%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*,$+) +, -)$-*&)(&,(#)*#,-%(-!*+%*+!(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$*,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$,*#)(#,(&)*&*-!(-%(+!*+%-, -)$+,$+) ","F 4/m -3 2/c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() &,$&)$#, #(#%*#!*&%(&!+!$+% -! -%$$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*,$#) #, &)$&*&!(&%(#!*#%-% -!$+%$+! (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(&%*&!*#%(# +%$+!$-% -!#)$#, &) &,$*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*%*#!(#%(&!*&$-! -% +!$+%&, &)$#,$#) ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! -%$-!$+% + #,$#)$&, &)#!*#%(&!(&%**,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$%$+! +% -!$-$&) &, #)$#,&%(&!*#%*#!(","F 41/d -3 2/m":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=4664=3:>;85<79=64>3:5;89<74=6:>385;79<,$+! #%(-)*&*&)(-% #!$+,-%(&)*+,$#!  )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<68>37=;49<:5=<8>;753496:4><:=;893756,*#!(+% &)$-*-!(&, +)$#%-, &!$+%*#)((!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<<4>;:=389675>68=379;45<:8=<7>;453:96%$#) +,(&!*-$&! -,(#)*+%&% -)$#,*+!(()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86<8=;7>3456:9><4=;:9385678>67=349;:5<%*+)(#, -!$&$-) &%(+!*#,&,(-!*#%$+) ","F 41/d -3 2/c":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46<8>;7=3496:5><8=;793456:8><7=;493:56%*#)(+, &!$-$-! &,(+)*#%&, -!$#%*+)( )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<<4=;:>385679>64=3:9;85<78=67>345;:9<%$+) #,(-!*&$&) -%(#!*+,&%(-)*#,$+! (!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<68=37>;45<:9=<4>;:5389674>6:=389;75<,*+!(#% -)$&*-)(&% +!$#,-,(&!*+%$#) ()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>8664>3:=;89<75=68>375;49<:4=<:>;853796,$#! +%(&)*-*&!(-, #)$+%-% &)$+,*#!(","I 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","I 41/a -3 2/d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<$%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*4<97358;=:6>6>:;=8357<94=8;>:694<573()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46*,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$865:;943>7<=<=73>4;9:658>43=7<5869:;","P 1 1 2":" !#$%#","P 1 1 21":" !#$%+","B 1 1 2":" !#$%#(g+*%+","A 1 2 1":" !#$!& )+$)-","C 1 21 1":" !#$)&()#*!&","I 1 2 1":" !#$!&.'/0'2","I 1 21 1":" !#$)&.'/0!-","P 1 1 m":" !# !&","P 1 1 b":" !# )&","B 1 1 m":" !# !&(!+(!-","B 1 1 b":" !# )&(!+()-","P 1 1 2/m":" !# !&$%#$%&","P 1 1 21/m":" !#$%+$%& !-","B 1 1 2/m":" !# !&$%#$%&(!+(!-*%+*%-","P 1 1 2/b":" !#$,#$%& )&","P 1 1 21/b":" !#$%&$,+ )-","B 1 1 2/b":" !#$,#$%& )&(!+*,+*%-()-","P 21 2 2":" !#$!&(%&*%#","P 2 21 2":" !# ,&$)&$%#","P 21 21 2 (a)":" !#*,#.%&$'&","P 21 2 21":" !#$!&(%-*%+","P 2 21 21":" !# %&$)-$,+","C 2 2 21a)":" !#*%+(,&$)-()#$,+ %&*!-","C 2 2 2a":" !#*,#.%&$'&()#$%# ,&*!&","F 2 2 2a":" !#*,#.%&$'& '/*%/.12$!2.!/$,/ %20'2.'#$%# 1&0!&","I 2 2 2a":" !#*,#.%&$'&()+$%+*!- ,-","P 21/m 21/m 2/n a":" !#*,#$)&(%&$%&.'& ,#*!#","P 42 21 2a":" !#*,#%.+'$+$'&.%&! -,*-","I 2 3a":" !#*,#.%&$'&!# ,- '&$%/$# !-*!/$%&.%()+$%+ ,-*!-)+(%&(!-*,#*+()&$)#*,- ,"},fS=/^[1-9]$/;function mS(e){const t=pS[e],n={};if(void 0===t)return console.warn("spacegroup '".concat(e,"' not found in symop library")),n;const i=[];for(let r=0,o=t.length;r<o;r+=3){const e=[];for(let n=0;n<3;++n)e.push(dS[t[r+n]]);i.push(e)}return i.forEach((function(e){let t=0;const i=(new Sn).set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),r=i.elements;n[e.toString()]=i,e.forEach((function(e){let n=!1,i=!1;for(let o=0,s=e.length;o<s;++o){const s=e[o];if("-"===s)n=!0;else if("+"===s)n=!1;else if("/"===s)i=!0;else if("X"===s)r[0+t]=n?-1:1;else if("Y"===s)r[4+t]=n?-1:1;else if("Z"===s)r[8+t]=n?-1:1;else if(fS.test(s)){const e=parseInt(s);i?r[12+t]/=e:r[12+t]=e}else gm.warn("getSymmetryOperations: unknown token '".concat(s,"'"))}t+=1}))})),n}function gS(e){let t="";return e.length>0&&(t=":"+Dp(e).join(" OR :")),new Kf(t)}class yS{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.name=e,this.partList=[]}get type(){return"Assembly"}addPart(e,t){const n=new vS(e,t);return this.partList.push(n),n}getAtomCount(e){return this.partList.reduce(((t,n)=>t+n.getAtomCount(e)),0)}getResidueCount(e){return this.partList.reduce(((t,n)=>t+n.getResidueCount(e)),0)}getInstanceCount(){let e=0;return this.partList.forEach((function(t){e+=t.matrixList.length})),e}isIdentity(e){if(1!==this.partList.length)return!1;const t=this.partList[0];if(1!==t.matrixList.length)return!1;if(!(new Sn).equals(t.matrixList[0]))return!1;let n=[];return e.eachChain((function(e){n.push(e.chainname)})),n=Dp(n),t.chainList.length===n.length}getBoundingBox(e){const t=new ni;return this.partList.forEach((function(n){const i=n.getBoundingBox(e);t.expandByPoint(i.min),t.expandByPoint(i.max)})),t}getCenter(e){return this.getBoundingBox(e).getCenter(new mn)}getSelection(){let e=[];return this.partList.forEach((function(t){e=e.concat(t.chainList)})),gS(e)}}class vS{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.matrixList=e,this.chainList=t}get type(){return"AssemblyPart"}_getCount(e,t){let n=0;return e.eachChain((e=>{(0===this.chainList.length||this.chainList.includes(e.chainname))&&(n+=e[t])})),this.matrixList.length*n}getAtomCount(e){return this._getCount(e,"atomCount")}getResidueCount(e){return this._getCount(e,"residueCount")}getBoundingBox(e){const t=new ni,n=new ni,i=this.getSelection(),r=e.getBoundingBox(i);return this.matrixList.forEach((function(e){n.copy(r).applyMatrix4(e),t.expandByPoint(n.min),t.expandByPoint(n.max)})),t}getSelection(){return gS(this.chainList)}getView(e){const t=this.getSelection();return t?e.getView(t):e}getInstanceList(){const e=[];for(let t=0,n=this.matrixList.length;t<n;++t)e.push({id:t+1,name:t,matrix:this.matrixList[t]});return e}}class bS{constructor(e){this.structure=e,this.currentModelindex=null,this.currentChainid=null,this.currentResname=null,this.currentResno=null,this.currentInscode=void 0,this.currentHetero=null,this.previousResname="",this.previousHetero=null,this.ai=-1,this.ri=-1,this.ci=-1,this.mi=-1}addResidueType(e){const t=this.structure.atomStore,n=this.structure.residueStore,i=this.structure.residueMap,r=n.atomCount[e],o=n.atomOffset[e],s=new Array(r);for(let a=0;a<r;++a)s[a]=t.atomTypeId[o+a];n.residueTypeId[e]=i.add(this.previousResname,s,this.previousHetero)}addAtom(e,t,n,i,r,o,s,a){const l=this.structure.atomStore,c=this.structure.residueStore,u=this.structure.chainStore,h=this.structure.modelStore;let d=!1,p=!1,f=!1;this.currentModelindex!==e?(d=!0,p=!0,f=!0,this.mi+=1,this.ci+=1,this.ri+=1):this.currentChainid!==n?(p=!0,f=!0,this.ci+=1,this.ri+=1):this.currentResno===r&&this.currentResname===i&&this.currentInscode===a||(f=!0,this.ri+=1),this.ai+=1,d&&(h.growIfFull(),h.chainOffset[this.mi]=this.ci,h.chainCount[this.mi]=0,h.count+=1,u.modelIndex[this.ci]=this.mi),p&&(u.growIfFull(),u.setChainname(this.ci,t),u.setChainid(this.ci,n),u.residueOffset[this.ci]=this.ri,u.residueCount[this.ci]=0,u.count+=1,u.modelIndex[this.ci]=this.mi,h.chainCount[this.mi]+=1,c.chainIndex[this.ri]=this.ci),f&&(this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>0&&this.addResidueType(this.ri-1),c.growIfFull(),c.resno[this.ri]=r,void 0!==s&&(c.sstruc[this.ri]=s.charCodeAt(0)),void 0!==a&&(c.inscode[this.ri]=a.charCodeAt(0)),c.atomOffset[this.ri]=this.ai,c.atomCount[this.ri]=0,c.count+=1,c.chainIndex[this.ri]=this.ci,u.residueCount[this.ci]+=1),l.count+=1,l.residueIndex[this.ai]=this.ri,c.atomCount[this.ri]+=1,this.currentModelindex=e,this.currentChainid=n,this.currentResname=i,this.currentResno=r,this.currentInscode=a,this.currentHetero=o}finalize(){this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>-1&&this.addResidueType(this.ri)}}function xS(t,n){if(!n)return;e.Debug&&gm.time("assignSecondaryStructure");const i=[];t.eachModel((function(e){e.eachChain((function(e){i.push(e.chainname)}))}));const r=i.slice().sort(),o=[];r.forEach((function(e){o.push(i.indexOf(e))}));const s=n.helices.filter((function(e){return Ip(r,e[0])>=0}));s.sort((function(e,t){const n=e[0],i=t[0],s=e[1],a=t[1];if(n===i)return s===a?0:s<a?-1:1;{const e=Ip(r,n),t=Ip(r,i);return o[e]<o[t]?-1:1}}));const a=t.residueStore;t.eachModel((function(e){let t=0;const n=s.length;if(0===n)return;let i=s[t],r=!1,o=!1;e.eachChain((function(e){let l=!1;if(e.chainname===i[0]){const c=e.residueCount,u=e.residueOffset,h=u+c;for(let d=u;d<h;++d)if(a.resno[d]===i[1]&&a.getInscode(d)===i[2]&&(r=!0),r&&(a.sstruc[d]=i[6],a.resno[d]===i[4]&&a.getInscode(d)===i[5]&&(r=!1,t+=1,t<n?(d=u-1,i=s[t],l=e.chainname!==i[0]):o=!0)),l||o)return}}))}));const l=n.sheets.filter((function(e){return Ip(r,e[0])>=0}));l.sort((function(e,t){const n=e[0],i=t[0];if(n===i)return 0;const s=Ip(r,n),a=Ip(r,i);return o[s]<o[a]?-1:1}));const c="e".charCodeAt(0);t.eachModel((function(e){let t=0;const n=l.length;if(0===n)return;let i=l[t],r=!1,o=!1;e.eachChain((function(e){let s=!1;if(e.chainname===i[0]){const u=e.residueCount,h=e.residueOffset,d=h+u;for(let p=h;p<d;++p)if(a.resno[p]===i[1]&&a.getInscode(p)===i[2]&&(r=!0),r&&(a.sstruc[p]=c,a.resno[p]===i[4]&&a.getInscode(p)===i[5]&&(r=!1,t+=1,t<n?(p=h-1,i=l[t],s=e.chainname!==i[0]):o=!0)),s||o)return}}))})),e.Debug&&gm.timeEnd("assignSecondaryStructure")}const wS=function(){const t=function(e,t,n,i){const r=e.structure,o=e.residueIndexStart,s=r.getResidueProxy(),a=r.getResidueProxy(),l=r.getAtomProxy(),c=r.getAtomProxy();for(let u=Math.max(0,t-2);u<=t;++u)for(let t=2;t<5;++t){if(u+t>=e.residueCount)continue;s.index=o+u,a.index=o+u+t,l.index=s.traceAtomIndex,c.index=a.traceAtomIndex;const r=l.distanceTo(c);if(Math.abs(r-n[t-2])>i)return!1}return!0},n=function(e,n){return t(e,n,[5.45,5.18,6.37],2.1)},i=function(e,n){return t(e,n,[6.1,10.4,13],1.42)},r=function(e){const t=e.residueStore,r=e.residueIndexStart;for(let o=0,s=e.residueCount;o<s;++o){let s="c";n(e,o)?s="h":i(e,o)&&(s="e"),t.sstruc[r+o]=s.charCodeAt(0)}},o=function(e){const t=20,n=2,i=e.residueStore,r=e.residueIndexStart,o=new rS(e).position,s=new mn,a=new mn;for(let l=0,c=e.residueCount;l<c;++l){s.fromArray(o.center,3*l),a.fromArray(o.center,3*l+3);const e=s.distanceTo(a);e<n&&e>1&&o.bending[l]<t&&(i.sstruc[r+l]="h".charCodeAt(0),i.sstruc[r+l+1]="h".charCodeAt(0))}};return function(t){e.Debug&&gm.time("calculateSecondaryStructure"),t.eachPolymer((function(e){if(e.residueCount<4)return;if(e.isCg())o(e);else{if(!e.isProtein())return;r(e)}let t,n=0;e.eachResidue((function(e){e.sstruc===t?n+=1:(1===n&&(e.index-=1,e.sstruc="c"),n=1,t=e.sstruc)}))})),e.Debug&&gm.timeEnd("calculateSecondaryStructure")}}(),_S="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function SS(e){const t=_S.length;let n=e,i=0,r=_S[n%t];for(;n>=t;)n=Math.floor(n/t),r+=_S[n%t],i+=1;return i>=5&&gm.warn("chainname overflow"),r}function MS(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.Debug&&gm.time("calculateChainnames");let i=!0;if(t.eachChain((function(e){e.chainname&&(i=!1)})),i){const e=t.modelStore,i=t.chainStore,r=t.residueStore,o=function(t,n,o,s){const a=i.count;for(let e=0;e<s;++e)r.chainIndex[o+e]=a;i.growIfFull(),i.modelIndex[a]=t,i.setChainname(a,n),i.setChainid(a,n),i.residueOffset[a]=o,i.residueCount[a]=s,i.count+=1,e.chainCount[t]+=1},s=t.getAtomProxy(),a=t.getAtomProxy();let l=0,c=0,u=0,h=0;const d=[];1===r.count?d.push({mIndex:0,chainname:"A",rStart:0,rCount:1}):t.eachResidueN(2,(function(e,t){let i=!1;const o=e.backboneType,p=t.backboneType,f=sb;h=e.index,e.modelIndex!==t.modelIndex||e.moleculeType!==t.moleculeType?i=!0:o!==f&&o===p&&(s.index=e.backboneEndAtomIndex,a.index=t.backboneStartAtomIndex,i=n?!s.hasBondTo(a):!s.connectedTo(a)),i||t.index!==r.count-1||(i=!0,h=t.index),i&&(d.push({mIndex:c,chainname:SS(l),rStart:u,rCount:h-u+1}),l+=1,e.modelIndex!==t.modelIndex&&(l=0,c+=1),t.index===r.count-1&&h!==t.index&&d.push({mIndex:c,chainname:SS(l),rStart:r.count-1,rCount:1}),u=t.index,h=t.index)})),i.count=0,e.chainCount.fill(0,0,e.count),e.chainOffset.fill(0,0,e.count),d.forEach((function(e){o(e.mIndex,e.chainname,e.rStart,e.rCount)}));let p=0;t.eachModel((function(t){e.chainOffset[t.index]=p,p+=e.chainCount[t.index]}))}e.Debug&&gm.timeEnd("calculateChainnames")}function AS(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";"none"!==n&&(e.Debug&&gm.time("calculateBonds"),IS(t,!1,n),LS(t),e.Debug&&gm.timeEnd("calculateBonds"))}const CS={"HIS|CD2|CG":2,"HIS|CE1|ND1":2,"ARG|CZ|NH2":2,"PHE|CE1|CZ":2,"PHE|CD2|CE2":2,"PHE|CD1|CG":2,"TRP|CD1|CG":2,"TRP|CD2|CE2":2,"TRP|CE3|CZ3":2,"TRP|CH2|CZ2":2,"ASN|CG|OD1":2,"GLN|CD|OE1":2,"TYR|CD1|CG":2,"TYR|CD2|CE2":2,"TYR|CE1|CZ":2,"ASP|CG|OD1":2,"GLU|CD|OE1":2,"G|C8|N7":2,"G|C4|C5":2,"G|C2|N3":2,"G|C6|O6":2,"C|C4|N3":2,"C|C5|C6":2,"C|C2|O2":2,"A|C2|N3":2,"A|C6|N1":2,"A|C4|C5":2,"A|C8|N7":2,"U|C5|C6":2,"U|C2|O2":2,"U|C4|O4":2,"DG|C8|N7":2,"DG|C4|C5":2,"DG|C2|N3":2,"DG|C6|O6":2,"DC|C4|N3":2,"DC|C5|C6":2,"DC|C2|O2":2,"DA|C2|N3":2,"DA|C6|N1":2,"DA|C4|C5":2,"DA|C8|N7":2,"DT|C5|C6":2,"DT|C2|O2":2,"DT|C4|O4":2};function TS(e,t,n){return[t,n]=t<n?[t,n]:[n,t],Db.includes(e)&&"C"===t&&"O"===n||Fb.includes(e)&&"OP1"===t&&"P"===n?2:CS["".concat(e,"|").concat(t,"|").concat(n)]||1}function ES(t){const n=t.structure,i=n.getAtomProxy(),r=n.getAtomProxy(),o=t.atomCount,s=t.atomOffset,a=s+o-1,l=[],c=[],u=[];if(o>500)e.Debug&&gm.warn("more than 500 atoms, skip residue for auto-bonding",t.qualifiedName());else if(o>50){const e=new hS(t,!0),n=t.isCg()?1.2:2.3;for(let t=s;t<a;++t){i.index=t;const o=i.covalent+n+.3,a=e.nearest(i,1/0,o*o),h=a.length;for(let e=0;e<h;++e)r.index=a[e].index,i.index<r.index&&i.connectedTo(r)&&(l.push(i.index-s),c.push(r.index-s),u.push(TS(i.resname,i.atomname,r.atomname)))}}else for(let e=s;e<a;++e){i.index=e;for(let t=e+1;t<=a;++t)r.index=t,i.connectedTo(r)&&(l.push(e-s),c.push(t-s),u.push(TS(i.resname,i.atomname,r.atomname)))}return{atomIndices1:l,atomIndices2:c,bondOrders:u}}function PS(t){e.Debug&&gm.time("calculateAtomBondMap");var n=[];return t.eachBond((function(e){var t=e.atomIndex1,i=e.atomIndex2;void 0===n[t]&&(n[t]=[]),n[t][i]=e.index})),e.Debug&&gm.timeEnd("calculateAtomBondMap"),n}function IS(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"all";e.Debug&&gm.time("calculateBondsWithin");const r=t.bondStore,o=t.rungBondStore,s=t.getAtomSet(!1),a=t.getAtomProxy(),l=t.getAtomProxy(),c=t.getBondProxy(),u=n?null:PS(t);let h;n||"auto"!==i||(h=new Set,u.forEach(((e,t)=>{h.add(t),e.forEach((e=>{h.add(e)}))}))),t.eachResidue((function(e){if(!n&&u){const t=e.atomCount,n=e.atomOffset;if(t>500)return void gm.warn("more than 500 atoms, skip residue for auto-bonding",e.qualifiedName());if("auto"===i&&e.hetero)for(let i=e.atomOffset;i<e.atomEnd;i++)if(h.has(i))return;const o=e.getBonds(),s=o.atomIndices1,d=o.atomIndices2,p=o.bondOrders,f=s.length;for(let i=0;i<f;++i){const t=s[i],o=d[i],h=t+n,f=o+n,m=u[h];void 0!==m&&void 0!==m[f]?(c.index=m[f],p[e.residueType.getBondIndex(t,o)]=c.bondOrder):(a.index=h,l.index=f,r.addBond(a,l,p[i]))}}const t=e.residueType.traceAtomIndex,d=e.residueType.rungEndAtomIndex;-1!==t&&-1!==d&&(a.index=e.traceAtomIndex,l.index=e.rungEndAtomIndex,o.addBond(a,l),s.set(a.index),s.set(l.index))})),t.atomSetDict.rung=s,e.Debug&&gm.timeEnd("calculateBondsWithin")}function LS(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.Debug&&gm.time("calculateBondsBetween");const r=t.bondStore,o=t.backboneBondStore,s=t.getAtomSet(!1),a=t.getAtomProxy(),l=t.getAtomProxy();function c(e,t){const c=e.backboneType,u=t.backboneType;if(c!==sb&&c===u){a.index=e.backboneEndAtomIndex,l.index=t.backboneStartAtomIndex;let c=!1,u=!1;i&&a.hasBondTo(l)?(c=!1,u=!0):a.connectedTo(l)&&(c=!n,u=!0),c&&r.addBond(a,l,1),u&&(a.index=e.traceAtomIndex,l.index=t.traceAtomIndex,o.addBond(a,l),s.set(a.index),s.set(l.index))}}0===o.count&&o.resize(t.residueStore.count),t.eachResidueN(2,c);const u=t.getResidueProxy(),h=t.getResidueProxy();if(t.eachChain((function(e){0!==e.residueCount&&(u.index=e.residueOffset,h.index=e.residueOffset+e.residueCount-1,c(h,u))})),t.atomSetDict.backbone=s,!n){e.Debug&&gm.time("calculateBondsBetween inter");const n=t.spatialHash;t.eachResidue((function(e){e.backboneType!==sb||e.isWater()||e.eachAtom((function(e){e.isMetal()||n.eachWithin(e.x,e.y,e.z,4,(function(t){l.index=t,e.modelIndex!==l.modelIndex||e.residueIndex===l.residueIndex||l.isMetal()||r.addBondIfConnected(e,l,1)}))}))})),e.Debug&&gm.timeEnd("calculateBondsBetween inter")}e.Debug&&gm.timeEnd("calculateBondsBetween")}function RS(t){if(!t.unitcell)return;e.Debug&&gm.time("buildUnitcellAssembly");const n=t.unitcell,i=t.center.clone().applyMatrix4(n.cartToFrac),r=i.clone().floor(),o=mS(n.spacegroup),s=new mn,a=new mn;function l(e){const t=[];return Object.keys(o).forEach((function(l){const c=o[l].clone();s.copy(i).applyMatrix4(c).floor(),a.setFromMatrixPosition(c),a.sub(s),a.add(r),e&&a.add(e),c.setPosition(a),c.multiplyMatrices(n.fracToCart,c),c.multiply(n.cartToFrac),t.push(c)})),t}const c=new yS("UNITCELL"),u=l(),h=[];if(t.biomolDict.NCS){h.push(new Sn,...t.biomolDict.NCS.partList[0].matrixList);const e=[];u.forEach((t=>{h.forEach((n=>{e.push(t.clone().multiply(n))}))})),c.addPart(e)}else c.addPart(u);const d=new mn,p=new yS("SUPERCELL"),f=Array.prototype.concat.call(l(d.set(1,0,0)),l(d.set(0,1,0)),l(d.set(0,0,1)),l(d.set(-1,0,0)),l(d.set(0,-1,0)),l(d.set(0,0,-1)),l(d.set(1,1,0)),l(d.set(1,0,1)),l(d.set(0,1,1)),l(d.set(-1,-1,0)),l(d.set(-1,0,-1)),l(d.set(0,-1,-1)),l(d.set(1,-1,-1)),l(d.set(1,1,-1)),l(d.set(1,-1,1)),l(d.set(-1,1,1)),l(d.set(-1,-1,1)),l(d.set(-1,1,-1)),l(d.set(0,1,-1)),l(d.set(0,-1,1)),l(d.set(1,0,-1)),l(d.set(-1,0,1)),l(d.set(1,-1,0)),l(d.set(-1,1,0)),l(),l(d.set(1,1,1)),l(d.set(-1,-1,-1)));if(t.biomolDict.NCS){const e=[];f.forEach((function(t){h.forEach((function(n){e.push(t.clone().multiply(n))}))})),p.addPart(e)}else p.addPart(f);t.biomolDict.UNITCELL=c,t.biomolDict.SUPERCELL=p,e.Debug&&gm.timeEnd("buildUnitcellAssembly")}const kS=["H","C","O","N","S","P"],DS=["NA","CL","FE"];function OS(e){let t=e.toUpperCase(),n=0,i=0;for(let o=0;o<t.length;o++)if(t.charCodeAt(o)<65){if(i>0)break;++n}else i=o+1;(n>0||i<t.length)&&(t=t.substring(n,i));const r=t.length;if(0===r)return"";if(1===r)return t;if(2===r){if(-1!==DS.indexOf(t))return t;if(-1!==kS.indexOf(t[0]))return t[0];if(t in wb)return t}return r>=3&&-1!==kS.indexOf(t[0])?t[0]:""}function NS(e){const t=e.bondHash,n=t.countArray,i=t.offsetArray,r=t.indexArray,o=e.getBondProxy();e.eachResidue((function(e){const t=e.residueType;if(void 0!==t.bonds)return;var s=e.atomOffset,a=[],l=[],c=[],u={};const h=s+e.atomCount;e.eachAtom((function(e){const t=e.index,d=i[t];for(let i=0,p=n[t];i<p;++i){o.index=r[d+i];let e=o.atomIndex1;if(e<s||e>=h)continue;let t=o.atomIndex2;if(t<s||t>=h)continue;if(e>t){const n=t;t=e,e=n}const n=e+"|"+t;void 0===u[n]&&(u[n]=!0,a.push(e-s),l.push(t-s),c.push(o.bondOrder))}})),t.bonds={atomIndices1:a,atomIndices2:l,bondOrders:c}}))}function BS(t){e.Debug&&gm.time("concatStructures");const n=new uM(t,""),i=new bS(n),r=n.atomStore,o=n.atomMap;r.addField("formalCharge",1,"int8"),r.addField("partialCharge",1,"float32");const s={};let a=0,l=0,c=0;for(var u=arguments.length,h=new Array(u>1?u-1:0),d=1;d<u;d++)h[d-1]=arguments[d];h.forEach((e=>{e.eachAtom((e=>{r.growIfFull(),r.atomTypeId[a]=o.add(e.atomname,e.element),r.x[a]=e.x,r.y[a]=e.y,r.z[a]=e.z,r.serial[a]=e.serial,r.formalCharge[a]=e.formalCharge,r.partialCharge[a]=e.partialCharge,r.altloc[a]=e.altloc,r.occupancy[a]=e.occupancy,r.bfactor[a]=e.bfactor,i.addAtom(e.modelIndex+c,e.chainname,e.chainid,e.resname,e.resno,1===e.hetero,e.sstruc,e.inscode),s[e.index+l]=a,a+=1})),l+=e.atomStore.count,c+=e.modelStore.count}));const p=n.bondStore,f=n.getAtomProxy(),m=n.getAtomProxy();return l=0,h.forEach((e=>{e.eachBond((e=>{f.index=s[e.atomIndex1+l],m.index=s[e.atomIndex2+l],p.addBond(f,m,e.bondOrder)})),l+=e.atomStore.count})),i.finalize(),LS(n,!0),IS(n,!0),n.finalizeAtoms(),n.finalizeBonds(),NS(n),e.Debug&&gm.timeEnd("concatStructures"),n}const FS=[3,11,19,37,55,87],zS=[4,12,20,38,56,88],US=[6,15,16,34],HS=[1,7,8,9,17,35,53],GS=[2,10,18,36,54,86],VS=[13,30,31,48,49,50,80,81,82,83,84,85,112],jS=[5,14,32,33,51,52,85],$S=[9,17,35,53,85];class WS{constructor(e,t,n){this.structure=e,this.atomname=t,n=n||OS(t),this.element=n,this.number=wb[n]||_b,this.vdw=Sb[this.number]||Mb,this.covalent=Ab[this.number]||Cb}getDefaultValence(){const e=Tb[this.number];return e?e[0]:Eb}getValenceList(){return Tb[this.number]||[]}getOuterShellElectronCount(){return Pb[this.number]||Ib}isMetal(){return this.isAlkaliMetal()||this.isAlkalineEarthMetal()||this.isLanthanide()||this.isActinide()||this.isTransitionMetal()||this.isPostTransitionMetal()}isNonmetal(){return this.isDiatomicNonmetal()||this.isPolyatomicNonmetal()||this.isNobleGas()}isMetalloid(){return jS.includes(this.number)}isHalogen(){return $S.includes(this.number)}isDiatomicNonmetal(){return HS.includes(this.number)}isPolyatomicNonmetal(){return US.includes(this.number)}isAlkaliMetal(){return FS.includes(this.number)}isAlkalineEarthMetal(){return zS.includes(this.number)}isNobleGas(){return GS.includes(this.number)}isTransitionMetal(){const e=this.number;return e>=21&&e<=29||e>=39&&e<=47||e>=72&&e<=79||e>=104&&e<=108}isPostTransitionMetal(){return VS.includes(this.number)}isLanthanide(){return this.number>=57&&this.number<=71}isActinide(){return this.number>=89&&this.number<=103}}function qS(e,t){return e+"|"+t}class XS{constructor(e){this.structure=e,this.dict={},this.list=[],this.structure=e}add(e,t){const n=qS(e=e.toUpperCase(),t=t?t.toUpperCase():OS(e));let i=this.dict[n];if(void 0===i){const r=new WS(this.structure,e,t);i=this.list.length,this.dict[n]=i,this.list.push(r)}return i}get(e){return this.list[e]}}class YS{constructor(e,t,n,i,r,o){this.structure=e,this.bondReferenceAtomIndices=[],this.resname=t,this.atomTypeIdList=n,this.hetero=i?1:0,this.chemCompType=r,this.bonds=o,this.atomCount=n.length,this.moleculeType=this.getMoleculeType(),this.backboneType=this.getBackboneType(0),this.backboneEndType=this.getBackboneType(-1),this.backboneStartType=this.getBackboneType(1),this.backboneIndexList=this.getBackboneIndexList();const s=jb[this.backboneType],a=jb[this.backboneStartType],l=jb[this.backboneEndType],c=this.getAtomIndexByName(s.trace);this.traceAtomIndex=bp(c,-1);const u=this.getAtomIndexByName(s.direction1);this.direction1AtomIndex=bp(u,-1);const h=this.getAtomIndexByName(s.direction2);this.direction2AtomIndex=bp(h,-1);const d=this.getAtomIndexByName(a.backboneStart);this.backboneStartAtomIndex=bp(d,-1);const p=this.getAtomIndexByName(l.backboneEnd);let f;this.backboneEndAtomIndex=bp(p,-1),f=Bb.includes(t)?this.getAtomIndexByName("N1"):this.getAtomIndexByName("N3"),this.rungEndAtomIndex=bp(f,-1)}getBackboneIndexList(){const e=[];let t;switch(this.moleculeType){case nb:t=Gb;break;case ib:case rb:t=Vb;break;default:return e}const n=this.structure.atomMap,i=this.atomTypeIdList;for(let r=0,o=this.atomCount;r<o;++r){const o=n.get(i[r]);t.includes(o.atomname)&&e.push(r)}return e}getMoleculeType(){return this.isProtein()?nb:this.isRna()?ib:this.isDna()?rb:this.isWater()?eb:this.isIon()?tb:this.isSaccharide()?ob:Jv}getBackboneType(e){return this.hasProteinBackbone(e)?ab:this.hasRnaBackbone(e)?lb:this.hasDnaBackbone(e)?cb:this.hasCgProteinBackbone(e)?ub:this.hasCgRnaBackbone(e)?hb:this.hasCgDnaBackbone(e)?db:sb}isProtein(){return this.chemCompType?pb.includes(this.chemCompType):this.hasAtomWithName("CA","C","N")||Db.includes(this.resname)}isCg(){const e=this.backboneType;return e===ub||e===hb||e===db}isNucleic(){return this.isRna()||this.isDna()}isRna(){return this.chemCompType?fb.includes(this.chemCompType):1!==this.hetero&&(this.hasAtomWithName(["P","O3'","O3*"],["C4'","C4*"],["O2'","O2*","F2'","F2*"])||Ob.includes(this.resname)&&this.hasAtomWithName(["O2'","O2*","F2'","F2*"]))}isDna(){return this.chemCompType?mb.includes(this.chemCompType):1!==this.hetero&&(this.hasAtomWithName(["P","O3'","O3*"],["C3'","C3*"])&&!this.hasAtomWithName(["O2'","O2*","F2'","F2*"])||Nb.includes(this.resname))}isHetero(){return 1===this.hetero}isIon(){return Ub.includes(this.resname)}isWater(){return zb.includes(this.resname)}isSaccharide(){return this.chemCompType?gb.includes(this.chemCompType):Hb.includes(this.resname)}isStandardAminoacid(){return Db.includes(this.resname)}isStandardBase(){return Fb.includes(this.resname)}hasBackboneAtoms(e,t){const n=jb[t];return-1===e?this.hasAtomWithName(n.trace,n.backboneEnd,n.direction1,n.direction2):0===e?this.hasAtomWithName(n.trace,n.direction1,n.direction2):1===e?this.hasAtomWithName(n.trace,n.backboneStart,n.direction1,n.direction2):this.hasAtomWithName(n.trace,n.backboneStart,n.backboneEnd,n.direction1,n.direction2)}hasProteinBackbone(e){return this.isProtein()&&this.hasBackboneAtoms(e,ab)}hasRnaBackbone(e){return this.isRna()&&this.hasBackboneAtoms(e,lb)}hasDnaBackbone(e){return this.isDna()&&this.hasBackboneAtoms(e,cb)}hasCgProteinBackbone(e){return this.atomCount<7&&this.isProtein()&&this.hasBackboneAtoms(e,ub)}hasCgRnaBackbone(e){return this.atomCount<11&&this.isRna()&&this.hasBackboneAtoms(e,hb)}hasCgDnaBackbone(e){return this.atomCount<11&&this.isDna()&&this.hasBackboneAtoms(e,db)}hasBackbone(e){return this.hasProteinBackbone(e)||this.hasRnaBackbone(e)||this.hasDnaBackbone(e)||this.hasCgProteinBackbone(e)||this.hasCgRnaBackbone(e)||this.hasCgDnaBackbone(e)}getAtomIndexByName(e){const t=this.atomCount,n=this.structure.atomMap,i=this.atomTypeIdList;if(Array.isArray(e))for(let r=0;r<t;++r){const t=i[r];if(e.includes(n.get(t).atomname))return r}else for(let r=0;r<t;++r){const t=i[r];if(e===n.get(t).atomname)return r}}hasAtomWithName(){const e=arguments.length;for(let t=0;t<e;++t)if(void 0!==(t<0||arguments.length<=t?void 0:arguments[t])&&void 0===this.getAtomIndexByName(t<0||arguments.length<=t?void 0:arguments[t]))return!1;return!0}getBonds(e){return void 0===this.bonds&&(this.bonds=ES(e)),this.bonds}getRings(){return void 0===this.rings&&this.calculateRings(),this.rings}getBondGraph(){return void 0===this.bondGraph&&this.calculateBondGraph(),this.bondGraph}getAromatic(e){return void 0===this.aromaticAtoms&&this.calculateAromatic(this.structure.getResidueProxy(e.residueIndex)),this.aromaticAtoms}getAromaticRings(e){return void 0===this.aromaticRings&&this.calculateAromatic(e),this.aromaticRings}calculateBondGraph(){const e=this.bondGraph={},t=this.getBonds(),n=t.atomIndices1.length,i=t.atomIndices1,r=t.atomIndices2;for(let o=0;o<n;++o){const t=i[o],n=r[o];(e[t]=e[t]||[]).push(n),(e[n]=e[n]||[]).push(t)}}calculateRings(){const e=nM(this.getBondGraph(),this.atomCount);for(let t=0;t<e.count;t++)e.visited[t]>=0||eM(e,t);this.rings={atomRings:e.atomRings,rings:e.rings}}isAromatic(e){return this.aromaticAtoms=this.getAromatic(e),1===this.aromaticAtoms[e.index-e.residueAtomOffset]}calculateAromatic(e){const t=this.aromaticAtoms=new Uint8Array(this.atomCount),n=this.getRings().rings,i=n.map((t=>QS(t.map((t=>this.structure.getAtomProxy(t+e.atomOffset)))))),r=this.aromaticRings=[];n.forEach(((e,n)=>{i[n]&&(r.push(e),e.forEach((e=>t[e]=1)))}))}assignBondReferenceAtomIndices(){const e=this.getBondGraph(),t=this.getRings(),n=t.atomRings,i=t.rings,r=this.bonds,o=r.atomIndices1,s=r.atomIndices2,a=r.bondOrders,l=this.bondReferenceAtomIndices,c=r.atomIndices1.length;l.length=0;for(let u=0;u<c;++u){if(a[u]<=1)continue;let t;const r=o[u],c=s[u],h=n[r],d=n[c];if(h&&d)for(let e=0;e<h.length;e++)if(-1!==d.indexOf(h[e])){t=i[h[e]];break}if(e[r].length>1)for(let n=0;n<e[r].length;++n){const i=e[r][n];if(i!==c&&(void 0===t||-1!==t.indexOf(i))){l[u]=i;break}}else if(e[c].length>1)for(let n=0;n<e[c].length;++n){const i=e[c][n];if(i!==r&&(void 0===t||-1!==t.indexOf(i))){l[u]=i;break}}}}getBondIndex(e,t){const n=this.bonds,i=n.atomIndices1,r=n.atomIndices2;let o=i.indexOf(e),s=r.indexOf(t);const a=s;for(;-1!==o;){for(;-1!==s;){if(o===s)return o;s=r.indexOf(t,s+1)}o=i.indexOf(e,o+1),s=a}}getBondReferenceAtomIndex(e,t){const n=this.getBondIndex(e,t);if(void 0!==n)return 0===this.bondReferenceAtomIndices.length&&this.assignBondReferenceAtomIndices(),this.bondReferenceAtomIndices[n]}}const ZS=[5,6,7,8,14,15,16,32,33,50,51,83],KS=.05;function QS(e){if(e.some((e=>!ZS.includes(e.number))))return!1;let t=0;const n=new zw(3,e.length),i=n.data;return e.forEach((e=>{i[t+0]=e.x,i[t+1]=e.y,i[t+2]=e.z,t+=3})),new Y_(n).vecC.length()<KS}function JS(e,t,n){if(n<t)return;const{pred:i,color:r,left:o,right:s}=e,a=++e.currentColor;let l=t;for(let y=0;y<tM&&(r[l]=a,l=i[l],!(l<0));y++);let c=0,u=0,h=!1,d=0;l=n;for(let y=0;y<tM;y++){if(r[l]===a){d=l,h=!0;break}if(s[u++]=l,l=i[l],l<0)break}if(!h)return;l=t;for(let y=0;y<tM&&(o[c++]=l,d!==l)&&(l=i[l],!(l<0));y++);const p=c+u,f=new Array(p);let m=0;for(let y=0;y<c;y++)f[m++]=o[y];for(let y=u-1;y>=0;y--)f[m++]=s[y];const g=e.rings.length;for(let y=0;y<p;++y){const t=f[y];e.atomRings[t]?e.atomRings[t].push(g):e.atomRings[t]=[g]}e.rings.push(f)}function eM(e,t){const{bonds:n,visited:i,queue:r,pred:o}=e;i[t]=1,r[0]=t;let s=0,a=1;for(;s<a;){const t=r[s++],l=0;if(void 0===n[t])continue;const c=n[t].length;for(let s=l;s<c;s++){const l=n[t][s];i[l]>0?o[l]!==t&&o[t]!==l&&JS(e,t,l):(i[l]=1,r[a++]=l,o[l]=t)}}}const tM=4;function nM(e,t){const n={count:t,visited:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),left:new Int32Array(tM),right:new Int32Array(tM),color:new Int32Array(t),currentColor:0,rings:[],atomRings:[],bonds:e};for(let i=0;i<t;i++)n.visited[i]=-1,n.pred[i]=-1;return n}function iM(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return e+"|"+t.join(",")+"|"+(n?1:0)+"|"+i}class rM{constructor(e){this.structure=e,this.dict={},this.list=[]}add(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4?arguments[4]:void 0;const o=iM(e=e.toUpperCase(),t,n,i);let s=this.dict[o];if(void 0===s){const a=new YS(this.structure,e,t,n,i,r);s=this.list.length,this.dict[o]=s,this.list.push(a)}return s}get(e){return this.list[e]}}class oM{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.structure=e,this.index=t,this.bondStore=e.bondStore,this._v12=new mn,this._v13=new mn,this._ap1=this.structure.getAtomProxy(),this._ap2=this.structure.getAtomProxy(),this._ap3=this.structure.getAtomProxy()}get atom1(){return this.structure.getAtomProxy(this.atomIndex1)}get atom2(){return this.structure.getAtomProxy(this.atomIndex2)}get atomIndex1(){return this.bondStore.atomIndex1[this.index]}set atomIndex1(e){this.bondStore.atomIndex1[this.index]=e}get atomIndex2(){return this.bondStore.atomIndex2[this.index]}set atomIndex2(e){this.bondStore.atomIndex2[this.index]=e}get bondOrder(){return this.bondStore.bondOrder[this.index]}set bondOrder(e){this.bondStore.bondOrder[this.index]=e}getOtherAtomIndex(e){return e===this.atomIndex1?this.atomIndex2:this.atomIndex1}getOtherAtom(e){return this.structure.getAtomProxy(this.getOtherAtomIndex(e.index))}getReferenceAtomIndex(){const e=this._ap1,t=this._ap2;if(e.index=this.atomIndex1,t.index=this.atomIndex2,e.residueIndex!==t.residueIndex)return;const n=e.index-e.residueAtomOffset,i=t.index-t.residueAtomOffset,r=e.residueType.getBondReferenceAtomIndex(n,i);if(void 0!==r)return r+e.residueAtomOffset;console.warn("No reference atom found",e.index,t.index)}calculateShiftDir(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mn;const t=this._ap1,n=this._ap2,i=this._ap3,r=this._v12,o=this._v13;t.index=this.atomIndex1,n.index=this.atomIndex2;const s=this.getReferenceAtomIndex();r.subVectors(t,n).normalize(),void 0!==s?(i.index=s,o.subVectors(t,i)):o.copy(t),o.normalize();let a=r.dot(o);return 1-Math.abs(a)<1e-5&&(o.set(1,0,0),a=r.dot(o),1-Math.abs(a)<1e-5&&(o.set(0,1,0),a=r.dot(o))),e.copy(o.sub(r.multiplyScalar(a))).normalize()}qualifiedName(){return this.atomIndex1+"="+this.atomIndex2}clone(){return new oM(this.structure,this.index)}toObject(){return{atomIndex1:this.atomIndex1,atomIndex2:this.atomIndex2,bondOrder:this.bondOrder}}}class sM{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get chain(){return this.structure.getChainProxy(this.chainIndex)}get chainIndex(){return this.residueStore.chainIndex[this.index]}set chainIndex(e){this.residueStore.chainIndex[this.index]=e}get atomOffset(){return this.residueStore.atomOffset[this.index]}set atomOffset(e){this.residueStore.atomOffset[this.index]=e}get atomCount(){return this.residueStore.atomCount[this.index]}set atomCount(e){this.residueStore.atomCount[this.index]=e}get atomEnd(){return this.atomOffset+this.atomCount-1}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get resno(){return this.residueStore.resno[this.index]}set resno(e){this.residueStore.resno[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.index)}set sstruc(e){this.residueStore.setSstruc(this.index,e)}get inscode(){return this.residueStore.getInscode(this.index)}set inscode(e){this.residueStore.setInscode(this.index,e)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.index])}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get moleculeType(){return this.residueType.moleculeType}get backboneType(){return this.residueType.backboneType}get backboneStartType(){return this.residueType.backboneStartType}get backboneEndType(){return this.residueType.backboneEndType}get traceAtomIndex(){return this.residueType.traceAtomIndex+this.atomOffset}get direction1AtomIndex(){return this.residueType.direction1AtomIndex+this.atomOffset}get direction2AtomIndex(){return this.residueType.direction2AtomIndex+this.atomOffset}get backboneStartAtomIndex(){return this.residueType.backboneStartAtomIndex+this.atomOffset}get backboneEndAtomIndex(){return this.residueType.backboneEndAtomIndex+this.atomOffset}get rungEndAtomIndex(){return this.residueType.rungEndAtomIndex+this.atomOffset}get x(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.x[t];return e/this.atomCount}get y(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.y[t];return e/this.atomCount}get z(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.z[t];return e/this.atomCount}eachAtom(e,t){const n=this.atomCount,i=this.atomOffset,r=this.structure._ap,o=i+n;if(t&&t.atomOnlyTest){const n=t.atomOnlyTest;for(let t=i;t<o;++t)r.index=t,n(r)&&e(r)}else for(let s=i;s<o;++s)r.index=s,e(r)}positionToArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}isProtein(){return this.residueType.moleculeType===nb}isNucleic(){const e=this.residueType.moleculeType;return e===ib||e===rb}isRna(){return this.residueType.moleculeType===ib}isDna(){return this.residueType.moleculeType===rb}isCg(){const e=this.residueType.backboneType;return e===ub||e===hb||e===db}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return e===nb||e===ib||e===rb}}isHetero(){return 1===this.residueType.hetero}isWater(){return this.residueType.moleculeType===eb}isIon(){return this.residueType.moleculeType===tb}isSaccharide(){return this.residueType.moleculeType===ob}isStandardAminoacid(){return this.residueType.isStandardAminoacid()}isStandardBase(){return this.residueType.isStandardBase()}isHelix(){return vb.includes(this.sstruc)}isSheet(){return bb.includes(this.sstruc)}isTurn(){return xb.includes(this.sstruc)&&this.isProtein()}getAtomType(e){return this.atomMap.get(this.atomStore.atomTypeId[e])}getResname1(){return kb[this.resname.toUpperCase()]||"X"}getBackboneType(e){switch(e){case-1:return this.residueType.backboneStartType;case 1:return this.residueType.backboneEndType;default:return this.residueType.backboneType}}getAtomIndexByName(e){let t=this.residueType.getAtomIndexByName(e);return void 0!==t&&(t+=this.atomOffset),t}hasAtomWithName(e){return this.residueType.hasAtomWithName(e)}getAtomnameList(){console.warn("getAtomnameList - might be expensive");const e=this.atomCount,t=this.atomOffset,n=new Array(e);for(let i=0;i<e;++i)n[i]=this.getAtomType(t+i).atomname;return n}connectedTo(e){const t=this.structure.getAtomProxy(this.backboneEndAtomIndex),n=this.structure.getAtomProxy(e.backboneStartAtomIndex);return!(!t||!n)&&t.connectedTo(n)}getNextConnectedResidue(){const e=this.chainStore.residueOffset[this.chainIndex],t=this.chainStore.residueCount[this.chainIndex],n=this.index+1;if(n<e+t){const e=this.structure.getResidueProxy(n);if(this.connectedTo(e))return e}else if(n===e+t){const t=this.structure.getResidueProxy(e);if(this.connectedTo(t))return t}}getPreviousConnectedResidue(e){const t=this.chainStore.residueOffset[this.chainIndex],n=this.index-1;if(n>=t){const t=bp(e,this.structure.getResidueProxy());if(t.index=n,t.connectedTo(this))return t}else if(n===t-1){const n=this.chainStore.residueCount[this.chainIndex],i=bp(e,this.structure.getResidueProxy());if(i.index=t+n-1,i.connectedTo(this))return i}}getBonds(){return this.residueType.getBonds(this)}getRings(){return this.residueType.getRings()}getAromaticRings(){return this.residueType.getAromaticRings(this)}qualifiedName(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t="";return this.resname&&!e&&(t+="["+this.resname+"]"),void 0!==this.resno&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chain&&(t+=":"+this.chainname),t+="/"+this.modelIndex,t}clone(){return new sM(this.structure,this.index)}toObject(){return{index:this.index,chainIndex:this.chainIndex,atomOffset:this.atomOffset,atomCount:this.atomCount,resno:this.resno,resname:this.resname,sstruc:this.sstruc}}}class aM{constructor(e,t,n){this.structure=e,this.residueIndexStart=t,this.residueIndexEnd=n,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueCount=n-t+1;const i=this.structure.getResidueProxy(this.residueIndexStart),r=this.structure.getResidueProxy(this.residueIndexEnd);this.isPrevConnected=void 0!==i.getPreviousConnectedResidue();const o=r.getNextConnectedResidue();this.isNextConnected=void 0!==o,this.isNextNextConnected=void 0!==o&&void 0!==o.getNextConnectedResidue(),this.isCyclic=r.connectedTo(i),this.__residueProxy=this.structure.getResidueProxy()}get chainIndex(){return this.residueStore.chainIndex[this.residueIndexStart]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}isProtein(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isProtein()}isCg(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isCg()}isNucleic(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isNucleic()}getMoleculeType(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.moleculeType}getBackboneType(e){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.getBackboneType(e)}getAtomIndexByType(e,t){this.isCyclic?-1===e?e=this.residueCount-1:e===this.residueCount&&(e=0):(-1!==e||this.isPrevConnected||(e+=1),e!==this.residueCount||this.isNextNextConnected||(e-=1));const n=this.__residueProxy;let i;switch(n.index=this.residueIndexStart+e,t){case"trace":i=n.traceAtomIndex;break;case"direction1":i=n.direction1AtomIndex;break;case"direction2":i=n.direction2AtomIndex;break;default:i=n.getAtomIndexByName(t)}return i}eachAtom(e,t){this.eachResidue((function(n){n.eachAtom(e,t)}))}eachAtomN(e,t,n){const i=this.residueCount,r=new Array(e);for(let s=0;s<e;++s)r[s]=this.structure.getAtomProxy(this.getAtomIndexByType(s,n));t.apply(this,r);for(var o=e;o<i;++o){for(let t=1;t<e;++t)r[t-1].index=r[t].index;r[e-1].index=this.getAtomIndexByType(o,n),t.apply(this,r)}}eachResidue(e){const t=this.structure.getResidueProxy(),n=this.residueCount,i=this.residueIndexStart;for(let r=0;r<n;++r)t.index=i+r,e(t)}qualifiedName(){const e=this.structure.getResidueProxy(this.residueIndexStart),t=this.structure.getResidueProxy(this.residueIndexEnd);return e.qualifiedName()+" - "+t.qualifiedName()}}class lM{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get entity(){return this.structure.entityList[this.entityIndex]}get model(){return this.structure.getModelProxy(this.modelIndex)}get entityIndex(){return this.chainStore.entityIndex[this.index]}set entityIndex(e){this.chainStore.entityIndex[this.index]=e}get modelIndex(){return this.chainStore.modelIndex[this.index]}set modelIndex(e){this.chainStore.modelIndex[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.index]}set residueOffset(e){this.chainStore.residueOffset[this.index]=e}get residueCount(){return this.chainStore.residueCount[this.index]}set residueCount(e){this.chainStore.residueCount[this.index]=e}get residueEnd(){return this.residueOffset+this.residueCount-1}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get atomCount(){return 0===this.residueCount?0:this.atomEnd-this.atomOffset+1}get chainname(){return this.chainStore.getChainname(this.index)}set chainname(e){this.chainStore.setChainname(this.index,e)}get chainid(){return this.chainStore.getChainid(this.index)}set chainid(e){this.chainStore.setChainid(this.index,e)}eachAtom(e,t){this.eachResidue((function(n){n.eachAtom(e,t)}),t)}eachResidue(e,t){const n=this.residueCount,i=this.residueOffset,r=this.structure._rp,o=i+n;if(t&&t.test){const n=t.residueOnlyTest;if(n)for(let t=i;t<o;++t)r.index=t,n(r)&&e(r);else for(let t=i;t<o;++t)r.index=t,e(r)}else for(let s=i;s<o;++s)r.index=s,e(r)}eachResidueN(e,t){const n=this.residueCount,i=this.residueOffset,r=i+n;if(n<e)return;const o=new Array(e);for(let s=0;s<e;++s)o[s]=this.structure.getResidueProxy(i+s);t.apply(this,o);for(let s=i+e;s<r;++s){for(let t=0;t<e;++t)o[t].index+=1;t.apply(this,o)}}eachPolymer(e,t){let n=0,i=0;const r=t?t.residueOnlyTest:void 0,o=this.model.structure,s=this.residueCount,a=this.residueOffset,l=a+s,c=this.structure.getResidueProxy(),u=this.structure.getResidueProxy(a),h=this.structure.getAtomProxy(),d=this.structure.getAtomProxy();let p=!0;for(let f=a+1;f<l;++f){c.index=u.index,u.index=f;const t=p?c.backboneEndType:c.backboneType,s=u.backboneType;p&&(n=c.index,p=!1),i=u.index,t!==sb&&t===s?(h.index=c.backboneEndAtomIndex,d.index=u.backboneStartAtomIndex,h&&d&&h.connectedTo(d)&&(!r||r(c)&&r(u))||(c.index-n>1&&e(new aM(o,n,c.index)),n=i)):(t!==sb&&c.index-n>1&&e(new aM(o,n,c.index)),n=i)}i-n>1&&this.structure.getResidueProxy(n).backboneEndType&&e(new aM(o,n,i))}qualifiedName(){return":"+this.chainname+"/"+this.modelIndex}clone(){return new lM(this.structure,this.index)}toObject(){return{index:this.index,residueOffset:this.residueOffset,residueCount:this.residueCount,chainname:this.chainname}}}class cM{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.structure=e,this.index=t,this.modelStore=e.modelStore,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get chainOffset(){return this.modelStore.chainOffset[this.index]}set chainOffset(e){this.modelStore.chainOffset[this.index]=e}get chainCount(){return this.modelStore.chainCount[this.index]}set chainCount(e){this.modelStore.chainCount[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.chainOffset]}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get chainEnd(){return this.chainOffset+this.chainCount-1}get residueEnd(){return this.chainStore.residueOffset[this.chainEnd]+this.chainStore.residueCount[this.chainEnd]-1}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get residueCount(){return 0===this.chainCount?0:this.residueEnd-this.residueOffset+1}get atomCount(){return 0===this.residueCount?0:this.atomEnd-this.atomOffset+1}eachAtom(e,t){this.eachChain((function(n){n.eachAtom(e,t)}),t)}eachResidue(e,t){this.eachChain((function(n){n.eachResidue(e,t)}),t)}eachPolymer(e,t){if(t&&t.chainOnlyTest){const n=t.chainOnlyTest;this.eachChain((function(i){n(i)&&i.eachPolymer(e,t)}))}else this.eachChain((function(n){n.eachPolymer(e,t)}))}eachChain(e,t){const n=this.chainCount,i=this.chainOffset,r=this.structure._cp,o=i+n;if(t&&t.test){const n=t.chainOnlyTest;if(n)for(let t=i;t<o;++t)r.index=t,n(r)&&e(r);else for(let t=i;t<o;++t)r.index=t,e(r)}else for(let s=i;s<o;++s)r.index=s,e(r)}qualifiedName(){return"/"+this.index}clone(){return new cM(this.structure,this.index)}toObject(){return{index:this.index,chainOffset:this.chainOffset,chainCount:this.chainCount}}}class uM{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.signals={refreshed:new Sf.Signal},this.checkIfShow=e=>void 0!==this.showAtoms&&this.showAtoms.length>0?this.showAtoms.includes(e):!(void 0!==this.hideAtoms&&this.hideAtoms.length>0)||!this.hideAtoms.includes(e),this.init(e,t)}init(e,t){this.name=e,this.path=t,this.title="",this.id="",this.hideAtoms=[],this.showAtoms=[],this.extraBonds=[],this.data=ex(this),this.header={},this.extraData={},this.atomSetCache={},this.atomSetDict={},this.biomolDict={},this.entityList=[],this.unitcell=void 0,this.frames=[],this.boxes=[],this.validation=void 0,this.bondStore=new Q_(0),this.backboneBondStore=new Q_(0),this.rungBondStore=new Q_(0),this.atomStore=new J_(0),this.atomStoreOld=new J_(0),this.residueStore=new eS(0),this.chainStore=new tS(0),this.modelStore=new nS(0),this.atomMap=new XS(this),this.residueMap=new rM(this),this.bondHash=void 0,this.spatialHash=void 0,this.atomSet=void 0,this.bondSet=void 0,this.center=new mn,this.boundingBox=new ni,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy()}get type(){return"Structure"}finalizeAtoms(){this.atomSet=this.getAtomSet(),this.atomCount=this.atomStore.count,this.boundingBox=this.getBoundingBox(void 0,this.boundingBox),this.center=this.boundingBox.getCenter(new mn),this.spatialHash=new Fv(this.atomStore,this.boundingBox)}finalizeBonds(){this.bondSet=this.getBondSet(),this.bondCount=this.bondStore.count,this.bondHash=new K_(this.bondStore,this.atomStore.count),this.atomSetCache={},this.atomSetDict.rung||(this.atomSetDict.rung=this.getAtomSet(!1));for(let e in this.atomSetDict)this.atomSetCache["__"+e]=this.atomSetDict[e].clone()}getBondProxy(e){return new oM(this,e)}getAtomProxy(e){return new aS(this,e)}getResidueProxy(e){return new sM(this,e)}getChainProxy(e){return new lM(this,e)}getModelProxy(e){return new cM(this,e)}getBondSet(){const e=this.bondStore.count,t=new Gv(e),n=this.atomSet;if(n)if(n.isAllSet())t.setAll();else if(n.isAllClear())t.clearAll();else{const i=this.getBondProxy();for(let r=0;r<e;++r)i.index=r,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getBackboneBondSet(){const e=this.backboneBondStore.count,t=new Gv(e),n=this.atomSetCache.__backbone;if(n){const i=this.getBondProxy();i.bondStore=this.backboneBondStore;for(let r=0;r<e;++r)i.index=r,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getRungBondSet(){const e=this.rungBondStore.count,t=new Gv(e),n=this.atomSetCache.__rung;if(n){const i=this.getBondProxy();i.bondStore=this.rungBondStore;for(let r=0;r<e;++r)i.index=r,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getAtomSet(e){const t=this.atomStore.count;if(void 0===e)return new Gv(t,!0);if(e instanceof Gv)return e;if(!0===e)return new Gv(t,!0);if(e&&e.test){const n=e.string;if(n in this.atomSetCache)return this.atomSetCache[n];if(""===n)return new Gv(t,!0);{const i=new Gv(t);return this.eachAtom((function(e){i.set(e.index)}),e),this.atomSetCache[n]=i,i}}return!1===e?new Gv(t):new Gv(t,!0)}getAtomSetWithinSelection(e,t){const n=this.spatialHash,i=this.getAtomSet(!1),r=this.getAtomProxy();return n?(this.getAtomSet(e).forEach((function(e){r.index=e,n.within(r.x,r.y,r.z,t).forEach((function(e){i.set(e)}))})),i):i}getAtomSetWithinPoint(e,t){const n=e,i=this.getAtomSet(!1);return this.spatialHash?(this.spatialHash.within(n.x,n.y,n.z,t).forEach((function(e){i.set(e)})),i):i}getAtomSetWithinVolume(e,t,n,i,r){const o=new Z_(e,n,i,r),s=o.getDataPosition(),a=s.length,l=o.matrix.getMaxScaleOnAxis(),c=this.getAtomSet(!1);if(!this.spatialHash)return c;for(let u=0;u<a;u+=3)this.spatialHash.within(s[u],s[u+1],s[u+2],l).forEach((function(e){c.set(e)}));return c}getAtomSetWithinGroup(e){const t=this.atomStore.residueIndex,n=this.getAtomSet(!1),i=this.getResidueProxy();return this.getAtomSet(e).forEach((function(e){i.index=t[e];for(let t=i.atomOffset;t<=i.atomEnd;++t)n.set(t)})),n}getSelection(){}getStructure(){return this}eachEntity(e,t){this.entityList.forEach((function(n){void 0!==t&&n.getEntityType()!==t||e(n)}))}eachBond(e,t){const n=this.getBondProxy();let i;if(t&&t.test&&(i=this.getBondSet(),this.bondSet&&i.intersection(this.bondSet)),i)i.forEach((function(t){n.index=t,e(n)}));else{const t=this.bondStore.count;for(let i=0;i<t;++i)n.index=i,e(n)}}eachAtom(e,t){if(t&&t.test)this.eachModel((function(n){n.eachAtom(e,t)}),t);else{const t=this.atomStore.count,n=this.getAtomProxy();for(let i=0;i<t;++i)n.index=i,e(n)}}eachResidue(e,t){if(t&&t.test){const n=this.modelStore.count,i=this.getModelProxy(),r=t.modelOnlyTest;if(r)for(let o=0;o<n;++o)i.index=o,r(i)&&i.eachResidue(e,t);else for(let o=0;o<n;++o)i.index=o,i.eachResidue(e,t)}else{const t=this.residueStore.count,n=this.getResidueProxy();for(let i=0;i<t;++i)n.index=i,e(n)}}eachResidueN(e,t){const n=this.residueStore.count;if(n<e)return;const i=new Array(e);for(let r=0;r<e;++r)i[r]=this.getResidueProxy(r);t.apply(this,i);for(let r=e;r<n;++r){for(let t=0;t<e;++t)i[t].index+=1;t.apply(this,i)}}eachPolymer(e,t){if(t&&t.modelOnlyTest){const n=t.modelOnlyTest;this.eachModel((function(i){n(i)&&i.eachPolymer(e,t)}))}else this.eachModel((function(n){n.eachPolymer(e,t)}))}eachChain(e,t){if(t&&t.test)this.eachModel((function(n){n.eachChain(e,t)}));else{const t=this.chainStore.count,n=this.getChainProxy();for(let i=0;i<t;++i)n.index=i,e(n)}}eachModel(e,t){const n=this.modelStore.count,i=this.getModelProxy();if(t&&t.test){const r=t.modelOnlyTest;if(r)for(let t=0;t<n;++t)i.index=t,r(i)&&e(i);else for(let t=0;t<n;++t)i.index=t,e(i)}else for(let r=0;r<n;++r)i.index=r,e(i)}getAtomData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const n=t.what,i=bp(t.atomSet,this.atomSet);let r,o;const s={},a=this.getAtomProxy();let l,c=0;i.forEach(((e,t)=>{a.index=e,l=a.serial,this.checkIfShow(l)&&(c+=1)})),n&&!n.position||(s.position=new Float32Array(3*c)),n&&!n.color||!t.colorParams||(s.color=new Float32Array(3*c),o=Sm.getScheme(t.colorParams)),n&&!n.picking||(s.picking=new mw(new Float32Array(c),this.getStructure())),n&&!n.radius||(s.radius=new Float32Array(c),r=new W_(t.radiusParams)),n&&!n.index||(s.index=new Uint32Array(c));const{position:u,color:h,picking:d,radius:p,index:f}=s;let m=0;return i.forEach(((e,t)=>{if(a.index=e,l=a.serial,this.checkIfShow(l)){const n=t-m,i=3*n;u&&a.positionToArray(u,i),h&&o.atomColorToArray(a,h,i),d&&(d.array[n]=e),p&&(p[n]=r.atomRadius(a)),f&&(f[n]=e)}else m+=1})),s}getBondData(e){var t;const n=Object.assign({},e);n.colorParams&&(n.colorParams.structure=this.getStructure());const i=n.what,r=bp(n.bondSet,this.bondSet),o=bp(n.multipleBond,"off"),s="off"!==o,a="offset"===o,l=bp(n.bondScale,.4),c=bp(n.bondSpacing,1);let u,h;const d={},p=this.getBondProxy();n.bondStore&&(p.bondStore=n.bondStore);const f=this.getAtomProxy(),m=this.getAtomProxy(),g=this.checkIfShow;let y,v,b=[];if((null===(t=this.extraBonds)||void 0===t?void 0:t.length)&&(b=this.extraBonds),s){const e=p.bondStore.bondOrder;y=0,r.forEach((function(t){y+=e[t]}))}else y=r.getSize();let x={};void 0!==this.atomSet&&this.atomSet.forEach(((e,t)=>{f.index=e,v=f.serial,x[v]=e})),r.forEach((function(e){p.index=e;let t=p.atomIndex1,n=p.atomIndex2;f.index=t,m.index=n,g(f.serial)&&g(m.serial)||(y-=1)})),y+=b.length,i&&!i.position||(d.position1=new Float32Array(3*y),d.position2=new Float32Array(3*y)),i&&!i.color||!n.colorParams||(d.color=new Float32Array(3*y),d.color2=new Float32Array(3*y),h=Sm.getScheme(n.colorParams)),i&&!i.picking||(d.picking=new yw(new Float32Array(y),this.getStructure(),n.bondStore)),(!i||i.radius||s&&i.position)&&(u=new W_(n.radiusParams)),i&&!i.radius||(d.radius=new Float32Array(y),n.radius2&&(d.radius2=new Float32Array(y)));const{position1:w,position2:_,color:S,color2:M,picking:A,radius:C,radius2:T}=d;let E,P,I,L,R,k,D=0;const O=new mn,N=new mn,B=new mn;let F,z,U;return r.forEach((e=>{if(F=e,P=3*D,p.index=e,f.index=p.atomIndex1,m.index=p.atomIndex2,g(f.serial)&&g(m.serial)){if(L=p.bondOrder,w)if(s&&L>1){const e=u.atomRadius(f);k=e*l/(.5*L),p.calculateShiftDir(B),a?(R=2*c*e,B.multiplyScalar(R),B.negate(),N.subVectors(m,f).multiplyScalar(Math.max(.1,R/1.88)),f.positionToArray(w,P),m.positionToArray(_,P),L>=2&&(O.addVectors(f,B).add(N).toArray(w,P+3),O.addVectors(m,B).sub(N).toArray(_,P+3),L>=3&&(O.subVectors(f,B).add(N).toArray(w,P+6),O.subVectors(m,B).sub(N).toArray(_,P+6)))):(R=(c-l)*e,B.multiplyScalar(R),2===L?(O.addVectors(f,B).toArray(w,P),O.subVectors(f,B).toArray(w,P+3),O.addVectors(m,B).toArray(_,P),O.subVectors(m,B).toArray(_,P+3)):3===L?(f.positionToArray(w,P),O.addVectors(f,B).toArray(w,P+3),O.subVectors(f,B).toArray(w,P+6),m.positionToArray(_,P),O.addVectors(m,B).toArray(_,P+3),O.subVectors(m,B).toArray(_,P+6)):(f.positionToArray(w,P),m.positionToArray(_,P)))}else f.positionToArray(w,P),m.positionToArray(_,P);if(S&&M&&(h.bondColorToArray(p,1,S,P),h.bondColorToArray(p,0,M,P),s&&L>1))for(E=1;E<L;++E)I=3*E+P,Ag(S,P,I,3),Ag(M,P,I,3);if(A&&A.array&&(A.array[D]=e,s&&L>1))for(E=1;E<L;++E)A.array[D+E]=e;if(C&&(C[D]=u.atomRadius(f),s&&L>1))for(k=C[D]*l/(a?1:.5*L),E=a?1:0;E<L;++E)C[D+E]=k;if(T&&(T[D]=u.atomRadius(m),s&&L>1))for(k=T[D]*l/(a?1:.5*L),E=a?1:0;E<L;++E)T[D+E]=k;D+=s?L:1}})),b.forEach((function(e){z=x[e[0]],U=x[e[1]],P=3*D,f.index=z,m.index=U,g(e[0])&&g(e[1])?(w&&(f.positionToArray(w,P),m.positionToArray(_,P)),S&&M&&(h.bondColorToArrayByAtoms(z,U,1,S,P),h.bondColorToArrayByAtoms(z,U,0,M,P)),A&&A.array&&(A.array[D]=F),C&&(C[D]=u.atomRadius(f)),T&&(T[D]=u.atomRadius(m)),D+=1):console.log("skiped")})),d}getBackboneAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__backbone},e),this.getAtomData(e)}getBackboneBondData(e){return e=Object.assign({bondSet:this.getBackboneBondSet(),bondStore:this.backboneBondStore},e),this.getBondData(e)}getRungAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__rung},e),this.getAtomData(e)}getRungBondData(e){return e=Object.assign({bondSet:this.getRungBondSet(),bondStore:this.rungBondStore},e),this.getBondData(e)}getBoundingBox(t,n){e.Debug&&gm.time("getBoundingBox"),n=n||new ni;let i=1/0,r=1/0,o=1/0,s=-1/0,a=-1/0,l=-1/0;return this.eachAtom((e=>{const t=e.x,n=e.y,c=e.z;t<i&&(i=t),n<r&&(r=n),c<o&&(o=c),t>s&&(s=t),n>a&&(a=n),c>l&&(l=c)}),t),n.min.set(i,r,o),n.max.set(s,a,l),e.Debug&&gm.timeEnd("getBoundingBox"),n}getPrincipalAxes(t){e.Debug&&gm.time("getPrincipalAxes");let n=0;const i=new zw(3,this.atomCount),r=i.data;return this.eachAtom((e=>{r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z,n+=3}),t),e.Debug&&gm.timeEnd("getPrincipalAxes"),new Y_(i)}atomCenter(e){return e?this.getBoundingBox(e).getCenter(new mn):this.center.clone()}hasCoords(){if(void 0===this._hasCoords){const e=this.atomStore;this._hasCoords=0!==Eg(e.x)||0!==Tg(e.x)||0!==Eg(e.y)||0!==Tg(e.y)||0!==Eg(e.z)||0!==Tg(e.z)||e.count/this.modelStore.count===1}return this._hasCoords}getSequence(e){const t=[],n=this.getResidueProxy();return this.eachAtom((function(e){n.index=e.residueIndex,e.index===n.traceAtomIndex&&t.push(n.getResname1())}),e),t}getAtomIndices(e){if(e&&e.string){const t=[];return this.eachAtom((function(e){t.push(e.index)}),e),new Uint32Array(t)}{const e={what:{index:!0}};return this.getAtomData(e).index}}getChainnameCount(e){const t=new Set;return this.eachChain((function(e){e.residueCount&&t.add(e.chainname)}),e),t.size}updatePosition(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=0;this.eachAtom((function(t){t.positionFromArray(e,n),n+=3}),void 0),this._hasCoords=void 0,t&&this.refreshPosition()}refreshPosition(){this.getBoundingBox(void 0,this.boundingBox),this.boundingBox.getCenter(this.center),this.spatialHash=new Fv(this.atomStore,this.boundingBox),this.signals.refreshed.dispatch(this)}dispose(){this.frames&&(this.frames.length=0),this.boxes&&(this.boxes.length=0),this.bondStore.dispose(),this.backboneBondStore.dispose(),this.rungBondStore.dispose(),this.atomStore.dispose(),this.residueStore.dispose(),this.chainStore.dispose(),this.modelStore.dispose(),delete this.bondSet,delete this.atomSet}}const hM=new ni,dM=[Iv,Cv,Lv,Pv,Rv,Tv,Av,Ev,Dv,kv,Ov,Nv],pM={aspectRatio:1.5,sphereDetail:2,radialSegments:50,disableImpostor:!1,openEnded:!1,dashedCylinder:!1,labelParams:{},pointSize:2,sizeAttenuation:!1,useTexture:!0,linewidth:2};class fM{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"shape",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.boundingBox=new ni,this.bufferList=[],this.meshCount=0,this._primitiveData={},this.name=e,this.parameters=xp(t,pM),dM.forEach((e=>{Object.keys(e.fields).forEach((t=>{this._primitiveData[e.getShapeKey(t)]=[]})),this._primitiveData[e.getShapeKey("name")]=[]}))}addBuffer(e){this.bufferList.push(e);const t=e.geometry;return t.boundingBox||t.computeBoundingBox(),this.boundingBox.union(t.boundingBox),this}addMesh(e,t,n,i,r){let o;e=qp(e),t=qp(t),Array.isArray(n)&&(n=Fp(n,e.length)),i&&(i=qp(i)),o=void 0===i||0==i.length?{position:e,color:t,index:n}:{position:e,color:t,index:n,normal:i};const s=new Cw(this,Object.assign({serial:this.meshCount,name:r},o)),a=new w_(Object.assign({picking:s},o));return this.bufferList.push(a),hM.setFromArray(e),this.boundingBox.union(hM),this.meshCount+=1,this}addSphere(e,t,n,i){return Av.objectToShape(this,{position:e,color:t,radius:n,name:i}),this}addEllipsoid(e,t,n,i,r,o){return Rv.objectToShape(this,{position:e,color:t,radius:n,majorAxis:i,minorAxis:r,name:o}),this}addTorus(e,t,n,i,r,o){return kv.objectToShape(this,{position:e,color:t,radius:n,majorAxis:i,minorAxis:r,name:o}),this}addCylinder(e,t,n,i,r){return Pv.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:r}),this}addCone(e,t,n,i,r){return Lv.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:r}),this}addArrow(e,t,n,i,r){return Iv.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:r}),this}addBox(e,t,n,i,r,o){return Cv.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:r,name:o}),this}addOctahedron(e,t,n,i,r,o){return Tv.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:r,name:o}),this}addTetrahedron(e,t,n,i,r,o){return Ev.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:r,name:o}),this}addText(e,t,n,i){return Dv.objectToShape(this,{position:e,color:t,size:n,text:i}),this}addPoint(e,t,n){return Ov.objectToShape(this,{position:e,color:t,name:n}),this}addWideline(e,t,n,i,r){return this.parameters.linewidth=i,Nv.objectToShape(this,{position1:e,position2:t,color:n,name:r}),this}addLabel(e,t,n,i){return console.warn("Shape.addLabel is deprecated, use .addText instead"),this.addText(e,t,n,i)}getBufferList(){const e=[];return dM.forEach((t=>{this._primitiveData[t.getShapeKey("color")].length&&e.push(t.bufferFromShape(this,this.parameters))})),this.bufferList.concat(e)}dispose(){this.bufferList.forEach((function(e){e.dispose()})),this.bufferList.length=0,dM.forEach((e=>{Object.keys(e.fields).forEach((t=>{this._primitiveData[e.getShapeKey(t)].length=0})),this._primitiveData[e.getShapeKey("name")].length=0}))}get center(){return this._center||(this._center=this.boundingBox.getCenter(new mn)),this._center}get type(){return"Shape"}}class mM extends Wy{constructor(e,t,n){Array.isArray(e)||(e=[e]),super(e,t,n),this.type="buffer",this.parameters=Object.assign({},this.parameters,{colorScheme:null,colorScale:null,colorValue:null,colorDomain:null,colorMode:null}),this.buffer=e,this.init(n)}init(e){super.init(e),this.build()}create(){this.bufferList.push.apply(this.bufferList,this.buffer)}attach(e){this.bufferList.forEach((e=>{this.viewer.add(e),e.setParameters(this.getBufferParams())})),this.setVisibility(this.visible),e()}}const gM=new Sn,yM=new rn;function vM(e,t){const n=t.attributes.position.array,i=t.index?t.index.array:void 0,r=e.position.length/3,o=n.length/3,s=r*o,a=new Float32Array(3*s),l=new Float32Array(3*s),c=new Float32Array(3*s);let u;return i&&(u=Fp(r*i.length,s)),{position:a,color:c,index:u,normal:l,primitiveId:e.primitiveId||xg(r,o),picking:e.picking}}class bM extends w_{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;super(vM(e,n),t),this.updateNormals=!1;const i=n.attributes.position.array,r=n.attributes.normal.array,o=n.index?n.index.array:void 0;this.geoPosition=i,this.geoNormal=r,this.geoIndex=o,this.positionCount=e.position.length/3,this.geoPositionCount=i.length/3,this.transformedGeoPosition=new Float32Array(3*this.geoPositionCount),this.transformedGeoNormal=new Float32Array(3*this.geoPositionCount);const s=this.geometry.attributes;if(this.meshPosition=s.position.array,this.meshColor=s.color.array,this.meshNormal=s.normal.array,this.setAttributes(e),o){const e=this.geometry.getIndex();if(!e)return void gm.error("Index is null");this.meshIndex=e.array,this.makeIndex()}}setAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.geometry.attributes;let i,r,o,s,a,l,c,u,h;const d=this.updateNormals;e.position&&(i=e.position,o=this.geoPosition,c=this.meshPosition,a=this.transformedGeoPosition,n.position.needsUpdate=!0,(d||t)&&(s=this.geoNormal,h=this.meshNormal,l=this.transformedGeoNormal,n.normal.needsUpdate=!0)),e.color&&(r=e.color,u=this.meshColor,n.color.needsUpdate=!0);const p=this.positionCount,f=this.geoPositionCount;for(let m=0;m<p;++m){let e,n;const p=m*f*3,g=3*m;if(i&&a&&c&&h&&o&&s&&(a.set(o),gM.makeTranslation(i[g],i[g+1],i[g+2]),this.applyPositionTransform(gM,m,g),Qy(gM.elements,a),c.set(a,p),d&&l?(l.set(s),yM.getNormalMatrix(gM),Jy(yM.elements,l),h.set(l,p)):t&&h.set(s,p)),r&&u)for(e=0;e<f;++e)n=p+3*e,u[n]=r[g],u[n+1]=r[g+1],u[n+2]=r[g+2]}}makeIndex(){const e=this.geoIndex,t=this.meshIndex;if(!e)return;const n=this.positionCount,i=this.geoPositionCount,r=e.length/3*3;for(let o=0;o<n;++o){const n=o*r,s=n+r;t.set(e,n);for(let e=n;e<s;++e)t[e]+=o*i}}}const xM=new mn,wM=Object.assign({sphereDetail:1},v_);class _M extends bM{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t,new Rl(1,bp(t.sphereDetail,1))),this.setAttributes(e,!0)}get defaultParameters(){return wM}applyPositionTransform(e,t){const n=this._radius[t];xM.set(n,n,n),e.scale(xM)}setAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}Tm.add("shader/SphereImpostor.vert","uniform mat4 projectionMatrixInverse;\nuniform float clipNear;\nvarying float vRadius;\nvarying float vRadiusSq;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\nattribute vec2 mapping;\nattribute float radius;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\n#endif\n#include matrix_scale\nconst mat4 D = mat4(\n1.0, 0.0, 0.0, 0.0,\n0.0, 1.0, 0.0, 0.0,\n0.0, 0.0, 1.0, 0.0,\n0.0, 0.0, 0.0, -1.0\n);\nmat4 transposeM( in mat4 inMatrix ) {\nvec4 i0 = inMatrix[0];\nvec4 i1 = inMatrix[1];\nvec4 i2 = inMatrix[2];\nvec4 i3 = inMatrix[3];\nmat4 outMatrix = mat4(\nvec4(i0.x, i1.x, i2.x, i3.x),\nvec4(i0.y, i1.y, i2.y, i3.y),\nvec4(i0.z, i1.z, i2.z, i3.z),\nvec4(i0.w, i1.w, i2.w, i3.w)\n);\nreturn outMatrix;\n}\nvoid ComputePointSizeAndPositionInClipCoordSphere(){\nvec2 xbc;\nvec2 ybc;\nmat4 T = mat4(\nradius, 0.0, 0.0, 0.0,\n0.0, radius, 0.0, 0.0,\n0.0, 0.0, radius, 0.0,\nposition.x, position.y, position.z, 1.0\n);\nmat4 R = transposeM( projectionMatrix * modelViewMatrix * T );\nfloat A = dot( R[ 3 ], D * R[ 3 ] );\nfloat B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );\nfloat C = dot( R[ 0 ], D * R[ 0 ] );\nxbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nxbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nfloat sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;\nA = dot( R[ 3 ], D * R[ 3 ] );\nB = -2.0 * dot( R[ 1 ], D * R[ 3 ] );\nC = dot( R[ 1 ], D * R[ 1 ] );\nybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );\nfloat sy = abs( ybc[ 0 ] - ybc[ 1 ] ) * 0.5;\ngl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );\ngl_Position.xy -= mapping * vec2( sx, sy );\ngl_Position.xy *= gl_Position.w;\n}\nvoid main(void){\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#endif\nvRadius = radius * matrixScale( modelViewMatrix );\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nmvPosition.z -= vRadius;\ngl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );\nComputePointSizeAndPositionInClipCoordSphere();\nvRadiusSq = vRadius * vRadius;\nvec4 vPoint4 = projectionMatrixInverse * gl_Position;\nvPoint = vPoint4.xyz / vPoint4.w;\nvPointViewPosition = -mvPosition.xyz / mvPosition.w;\n}"),Tm.add("shader/SphereImpostor.frag","#define STANDARD\n#define IMPOSTOR\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform mat4 projectionMatrix;\nuniform float ortho;\nvarying float vRadius;\nvarying float vRadiusSq;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nbool flag2 = false;\nbool interior = false;\nvec3 cameraPos;\nvec3 cameraNormal;\nfloat calcDepth( in vec3 cameraPos ){\nvec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\nreturn 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\nfloat calcClip( vec3 cameraPos ){\nreturn dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );\n}\nbool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){\nvec3 cameraSpherePos = -vPointViewPosition;\ncameraSpherePos.z += vRadius;\nvec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );\nvec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );\nvec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );\nfloat B = dot( rayDirection, cameraSphereDir );\nfloat det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );\nif( det < 0.0 ){\ndiscard;\nreturn false;\n}\nfloat sqrtDet = sqrt( det );\nfloat posT = mix( B + sqrtDet, B + sqrtDet, ortho );\nfloat negT = mix( B - sqrtDet, sqrtDet - B, ortho );\ncameraPos = rayDirection * negT + rayOrigin;\n#ifdef NEAR_CLIP\nif( calcDepth( cameraPos ) <= 0.0 ){\ncameraPos = rayDirection * posT + rayOrigin;\ninterior = true;\n}else if( calcClip( cameraPos ) > 0.0 ){\ncameraPos = rayDirection * posT + rayOrigin;\ninterior = true;\nflag2 = true;\n}\n#else\nif( calcDepth( cameraPos ) <= 0.0 ){\ncameraPos = rayDirection * posT + rayOrigin;\ninterior = true;\n}\n#endif\ncameraNormal = normalize( cameraPos - cameraSpherePos );\ncameraNormal *= float(!interior) * 2.0 - 1.0;\nreturn !interior;\n}\nvoid main(void){\nbool flag = Impostor( cameraPos, cameraNormal );\n#ifdef NEAR_CLIP\nif( calcClip( cameraPos ) > 0.0 )\ndiscard;\n#endif\ngl_FragDepthEXT = calcDepth( cameraPos );\nif( !flag ){\n#ifdef NEAR_CLIP\nif( flag2 ){\ngl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );\n}else if( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n#else\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n#endif\n}\nif (gl_FragDepthEXT < 0.0)\ndiscard;\nif (gl_FragDepthEXT > 1.0)\ndiscard;\n#ifdef PICKING\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 vNormal = cameraNormal;\nvec3 vViewPosition = -cameraPos;\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\n#include normal_fragment_begin\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\nif( interior ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include encodings_fragment\n#include fog_fragment\n#endif\n}");class SM extends x_{constructor(e,t){super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.index=Fp(this.indexSize,this.attributeSize),this.makeIndex(),this.initIndex(this.index),this.addAttributes({mapping:{type:e,value:null}}),this.setAttributes({primitiveId:bg(this.size)})}get attributeSize(){return this.size*this.mappingSize}get indexSize(){return this.size*this.mappingIndicesSize}addAttributes(e){const t={};for(const n in e){const i=e[n];t[n]={type:i.type,value:null}}super.addAttributes(t)}getAttributeIndex(e){return 3*e*this.mappingSize}setAttributes(e){e&&!e.position&&e.position1&&e.position2&&(e.position=fg(e.position1,e.position2));const t=this.size,n=this.mappingSize,i=this.geometry.attributes;let r,o,s,a,l,c,u;for(const h in e)if("index"!==h&&"picking"!==h){o=e[h],r=i[h],s=r.itemSize,a=r.array;for(let e=0;e<t;++e){l=e*s,c=l*n;for(let e=0;e<n;++e){u=c+s*e;for(let e=0;e<s;++e)a[u+e]=o[l+e]}}r.needsUpdate=!0}}makeMapping(){const e=this.size,t=this.mapping,n=this.mappingSize,i=this.mappingItemSize,r=this.geometry.attributes.mapping.array;for(let o=0;o<e;o++)r.set(t,o*i*n)}makeIndex(){const e=this.size,t=this.mappingSize,n=this.mappingIndices,i=this.mappingIndicesSize,r=this.index;for(let o=0;o<e;o++){const e=o*i,s=o*t;r.set(n,e);for(let t=0;t<i;++t)r[e+t]+=s}}}const MM=new Float32Array([-1,1,-1,-1,1,1,1,-1]),AM=new Uint16Array([0,1,2,1,3,2]);class CM extends SM{constructor(e){super("v2",e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}get mapping(){return MM}get mappingIndices(){return AM}get mappingIndicesSize(){return 6}get mappingSize(){return 4}get mappingItemSize(){return 2}}class TM extends CM{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.isImpostor=!0,this.vertexShader="SphereImpostor.vert",this.fragmentShader="SphereImpostor.frag",this.addUniforms({projectionMatrixInverse:{value:new Sn},ortho:{value:0}}),this.addAttributes({radius:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}}Object.assign({disableImpostor:!1},wM);class EM{constructor(e,t){return!fm||t&&t.disableImpostor?new _M(e,t):new TM(e,t)}}const PM=EM;function IM(e,t,n,i){const r=n-e,o=i-t;return Math.sqrt(r*r+o*o)}function LM(e){const t=e||{},n=bp(t.width,256),i=bp(t.height,256),r=[n/2,i/2],o=Math.min(n/2,i/2),s=bp(t.delta,1/(o+1))*o;let a=0,l=0;const c=new Uint8Array(n*i*4);for(let h=0,d=c.length;h<d;h+=4){const e=1-hf(o-s,o,IM(a,l,r[0],r[1]));c[h]=255*e,c[h+1]=255*e,c[h+2]=255*e,c[h+3]=255*e,++a===n&&(a=0,l++)}const u=new qr(c,n,i);return u.needsUpdate=!0,u}Im.add("sphere",PM),Tm.add("shader/Point.vert","uniform float clipNear;\nuniform float clipRadius;\nuniform vec3 clipCenter;\nuniform float size;\nuniform float canvasHeight;\nuniform float pixelRatio;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\nvarying vec3 vViewPosition;\n#endif\n#include common\nvoid main(){\n#if defined( PICKING )\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#endif\n#include begin_vertex\n#include project_vertex\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * pixelRatio * ( ( canvasHeight / 2.0 ) / -mvPosition.z );\n#else\ngl_PointSize = size * pixelRatio;\n#endif\n#ifndef PICKING\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n#include radiusclip_vertex\n}"),Tm.add("shader/Point.frag","uniform vec3 diffuse;\nuniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif\n#if defined( PICKING )\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\nvarying vec3 vViewPosition;\n#endif\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( PICKING )\n#ifdef USE_MAP\nif( texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) ).a < 0.5 )\ndiscard;\n#endif\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 outgoingLight = vec3( 0.0 );\nvec4 diffuseColor = vec4( diffuse, 1.0 );\n#ifdef USE_MAP\ndiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif\n#include color_fragment\n#include alphatest_fragment\noutgoingLight = diffuseColor.rgb;\ngl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include encodings_fragment\n#include fog_fragment\n#endif\n}");const RM=Object.assign({pointSize:1,sizeAttenuation:!0,sortParticles:!1,alphaTest:.5,useTexture:!1,forceTransparent:!1,edgeBleach:0},v_),kM=Object.assign({pointSize:{uniform:"size"},sizeAttenuation:{updateShader:!0},sortParticles:{},alphaTest:{updateShader:!0},useTexture:{updateShader:!0},forceTransparent:{},edgeBleach:{uniform:!0}},b_);class DM extends x_{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.parameterTypes=kM,this.vertexShader="Point.vert",this.fragmentShader="Point.frag",this.isPoint=!0,this.addUniforms({size:{value:this.parameters.pointSize},canvasHeight:{value:1},pixelRatio:{value:1},map:{value:null}})}get defaultParameters(){return RM}makeMaterial(){super.makeMaterial(),this.makeTexture();const e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.uniforms.map.value=this.tex,e.needsUpdate=!0,t.uniforms.map.value=this.tex,t.needsUpdate=!0,n.uniforms.map.value=this.tex,n.needsUpdate=!0}makeTexture(){this.tex&&this.tex.dispose(),this.tex=LM({delta:this.parameters.edgeBleach})}getDefines(e){const t=super.getDefines(e);return this.parameters.sizeAttenuation&&(t.USE_SIZEATTENUATION=1),this.parameters.useTexture&&(t.USE_MAP=1),this.parameters.alphaTest>0&&this.parameters.alphaTest<=1&&(t.ALPHATEST=this.parameters.alphaTest.toPrecision(2)),t}setUniforms(e){e&&void 0!==e.edgeBleach&&(this.makeTexture(),e.map=this.tex),super.setUniforms(e)}dispose(){super.dispose(),this.tex&&this.tex.dispose()}}Im.add("point",DM);class OM extends Wy{constructor(e,t,n){super(e,t,n),this.type="dot",this.parameters=Object.assign({thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdOut:{type:"boolean",rebuild:!0},dotType:{type:"select",rebuild:!0,options:{"":"",sphere:"sphere",point:"point"}},radiusType:{type:"select",options:{"":"",value:"value","abs-value":"abs-value","value-min":"value-min",deviation:"deviation",size:"size"}},radius:{type:"number",precision:3,max:10,min:.001,property:"size"},scale:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,disableImpostor:!0,pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{colorScheme:{type:"select",update:"color",options:{"":"",value:"value",uniform:"uniform",random:"random"}}}),e instanceof f_?(this.surface=void 0,this.volume=new Z_(e)):(this.surface=e,this.volume=void 0),this.init(n)}init(e){var t=e||{};t.colorScheme=bp(t.colorScheme,"uniform"),t.colorValue=bp(t.colorValue,14540253),this.thresholdType=bp(t.thresholdType,"sigma"),this.thresholdMin=bp(t.thresholdMin,2),this.thresholdMax=bp(t.thresholdMax,1/0),this.thresholdOut=bp(t.thresholdOut,!1),this.dotType=bp(t.dotType,"point"),this.radius=bp(t.radius,.1),this.scale=bp(t.scale,1),this.pointSize=bp(t.pointSize,1),this.sizeAttenuation=bp(t.sizeAttenuation,!0),this.sortParticles=bp(t.sortParticles,!1),this.useTexture=bp(t.useTexture,!1),this.alphaTest=bp(t.alphaTest,.5),this.forceTransparent=bp(t.forceTransparent,!1),this.edgeBleach=bp(t.edgeBleach,0),super.init(t),this.build()}attach(e){this.bufferList.forEach((e=>{this.viewer.add(e)})),this.setVisibility(this.visible),e()}create(){var e={};if(this.volume){var t,n,i=this.volume;"sigma"===this.thresholdType?(t=i.getValueForSigma(this.thresholdMin),n=i.getValueForSigma(this.thresholdMax)):(t=this.thresholdMin,n=this.thresholdMax),i.setFilter(t,n,this.thresholdOut),Object.assign(e,{position:i.getDataPosition(),color:i.getDataColor(this.getColorParams())}),"sphere"===this.dotType&&Object.assign(e,{radius:i.getDataSize(this.radius,this.scale),picking:i.getDataPicking()})}else{var r=this.surface;Object.assign(e,{position:r.getPosition(),color:r.getColor(this.getColorParams())}),"sphere"===this.dotType&&Object.assign(e,{radius:r.getSize(this.radius,this.scale),picking:r.getPicking()})}"sphere"===this.dotType?this.dotBuffer=new PM(e,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!1})):this.dotBuffer=new DM(e,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach})),this.bufferList.push(this.dotBuffer)}update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(0===this.bufferList.length)return;const t={};e.color&&(this.volume?Object.assign(t,{color:this.volume.getDataColor(this.getColorParams())}):Object.assign(t,{color:this.surface.getColor(this.getColorParams())})),"sphere"===this.dotType&&(e.radius||e.scale)&&(this.volume?Object.assign(t,{radius:this.volume.getDataSize(this.radius,this.scale)}):Object.assign(t,{radius:this.surface.getSize(this.radius,this.scale)})),this.dotBuffer.setAttributes(t)}setParameters(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return e&&void 0!==e.thresholdType&&this.volume instanceof f_&&("value"===this.thresholdType&&"sigma"===e.thresholdType?(this.thresholdMin=this.volume.getSigmaForValue(this.thresholdMin),this.thresholdMax=this.volume.getSigmaForValue(this.thresholdMax)):"sigma"===this.thresholdType&&"value"===e.thresholdType&&(this.thresholdMin=this.volume.getValueForSigma(this.thresholdMin),this.thresholdMax=this.volume.getValueForSigma(this.thresholdMax)),this.thresholdType=e.thresholdType),e&&void 0!==e.radiusType&&("radius"===e.radiusType?this.radius=.1:this.radius=parseFloat(e.radiusType),t.radius=!0,"sphere"!==this.dotType||fm&&!this.disableImpostor||(n=!0)),e&&void 0!==e.radius&&(t.radius=!0,"sphere"!==this.dotType||fm&&!this.disableImpostor||(n=!0)),e&&void 0!==e.scale&&(t.scale=!0,"sphere"!==this.dotType||fm&&!this.disableImpostor||(n=!0)),super.setParameters(e,t,n),this}}Tm.add("shader/Image.vert","uniform float clipRadius;\nuniform vec3 clipCenter;\nvarying vec2 vUv;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\nvoid main() {\n#include begin_vertex\n#include project_vertex\nvUv = uv;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n}"),Tm.add("shader/Image.frag","uniform sampler2D map;\nuniform float opacity;\nuniform vec2 mapSize;\nuniform float clipNear;\nuniform float clipRadius;\nvarying vec2 vUv;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\nuniform sampler2D pickingMap;\nuniform float objectId;\n#else\n#include fog_pars_fragment\n#endif\n#if defined( CUBIC_INTERPOLATION )\n#if defined( CATMULROM_FILTER ) || defined( MITCHELL_FILTER )\n#if defined( CATMULROM_FILTER )\nconst float B = 0.0;\nconst float C = 0.5;\n#elif defined( MITCHELL_FILTER )\nconst float B = 0.333;\nconst float C = 0.333;\n#endif\nfloat filter( float x ){\nfloat f = x;\nif( f < 0.0 ){\nf = -f;\n}\nif( f < 1.0 ){\nreturn ( ( 12.0 - 9.0 * B - 6.0 * C ) * ( f * f * f ) +\n( -18.0 + 12.0 * B + 6.0 *C ) * ( f * f ) +\n( 6.0 - 2.0 * B ) ) / 6.0;\n}else if( f >= 1.0 && f < 2.0 ){\nreturn ( ( -B - 6.0 * C ) * ( f * f * f )\n+ ( 6.0 * B + 30.0 * C ) * ( f *f ) +\n( - ( 12.0 * B ) - 48.0 * C ) * f +\n8.0 * B + 24.0 * C ) / 6.0;\n}else{\nreturn 0.0;\n}\n}\n#elif defined( BSPLINE_FILTER )\nfloat filter( float x ){\nfloat f = x;\nif( f < 0.0 ){\nf = -f;\n}\nif( f >= 0.0 && f <= 1.0 ){\nreturn ( 2.0 / 3.0 ) + ( 0.5 ) * ( f * f * f ) - ( f * f );\n}else if( f > 1.0 && f <= 2.0 ){\nreturn 1.0 / 6.0 * pow( ( 2.0 - f ), 3.0 );\n}\nreturn 1.0;\n}\n#else\nfloat filter( float x ){\nreturn 1.0;\n}\n#endif\nvec4 biCubic( sampler2D tex, vec2 texCoord ){\nvec2 texelSize = 1.0 / mapSize;\ntexCoord -= texelSize / 2.0;\nvec4 nSum = vec4( 0.0 );\nfloat nDenom = 0.0;\nvec2 cell = fract( texCoord * mapSize );\nfor( float m = -1.0; m <= 2.0; ++m ){\nfor( float n = -1.0; n <= 2.0; ++n ){\nvec4 vecData = texture2D(\ntex, texCoord + texelSize * vec2( m, n )\n);\nfloat c = filter( m - cell.x ) * filter( -n + cell.y );\nnSum += vecData * c;\nnDenom += c;\n}\n}\nreturn nSum / nDenom;\n}\n#endif\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( CUBIC_INTERPOLATION )\ngl_FragColor = biCubic( map, vUv );\n#else\ngl_FragColor = texture2D( map, vUv );\n#endif\n#if defined( PICKING )\nif( gl_FragColor.a < 0.3 )\ndiscard;\ngl_FragColor = vec4( texture2D( pickingMap, vUv ).xyz, objectId );\n#else\nif( gl_FragColor.a < 0.01 )\ndiscard;\ngl_FragColor.a *= opacity;\n#include fog_fragment\n#endif\n}");const NM=new Uint16Array([0,1,2,1,3,2]),BM=new Float32Array([0,1,0,0,1,1,1,0]),FM=Object.assign({filter:"nearest",forceTransparent:!0},v_),zM=Object.assign({filter:{updateShader:!0,uniform:!0}},b_);class UM extends x_{constructor(e,t){super({position:e.position,index:NM,picking:e.picking},t),this.parameterTypes=zM,this.alwaysTransparent=!0,this.hasWireframe=!1,this.vertexShader="Image.vert",this.fragmentShader="Image.frag";const{imageData:n,width:i,height:r}=e,o=new qr(n,i,r);o.flipY=!0,this.tex=o;const s=n.length,a=new Uint8Array(s);for(let c=0;c<s;c+=4){const e=c/4;a[c]=e>>16&255,a[c+1]=e>>8&255,a[c+2]=255&e}const l=new qr(a,i,r);l.flipY=!0,l.minFilter=le,l.magFilter=le,this.pickingTex=l,this.addUniforms({map:{value:o},pickingMap:{value:l},mapSize:{value:new nn(i,r)}}),this.geometry.setAttribute("uv",new Gi(BM,2))}get defaultParameters(){return FM}getDefines(e){const t=super.getDefines(e),n=this.parameters.filter;return n.startsWith("cubic")&&(t.CUBIC_INTERPOLATION=1,n.endsWith("bspline")?t.BSPLINE_FILTER=1:n.endsWith("catmulrom")?t.CATMULROM_FILTER=1:n.endsWith("mitchell")&&(t.MITCHELL_FILTER=1)),t}updateTexture(){const e=this.tex,t=this.parameters.filter;t.startsWith("cubic")?(e.minFilter=le,e.magFilter=le):"linear"===t?(e.minFilter=he,e.magFilter=he):(e.minFilter=le,e.magFilter=le),e.needsUpdate=!0,this.pickingTex.needsUpdate=!0}makeMaterial(){super.makeMaterial(),this.updateTexture();const e=this.material;e.uniforms.map.value=this.tex,e.blending=f,e.needsUpdate=!0;const t=this.wireframeMaterial;t.uniforms.map.value=this.tex,t.blending=f,t.needsUpdate=!0;const n=this.pickingMaterial;n.uniforms.map.value=this.tex,n.uniforms.pickingMap.value=this.pickingTex,n.blending=f,n.needsUpdate=!0}setUniforms(e){e&&void 0!==e.filter&&(this.updateTexture(),e.map=this.tex),super.setUniforms(e)}}class HM{constructor(e,t){const n=t||{};this.dimension=bp(n.dimension,"x"),this.positionType=bp(n.positionType,"percent"),this.position=bp(n.position,30),this.thresholdType=bp(n.thresholdType,"sigma"),this.thresholdMin=bp(n.thresholdMin,-1/0),this.thresholdMax=bp(n.thresholdMax,1/0),this.normalize=bp(n.normalize,!1),this.volume=e}getPositionFromCoordinate(e){const t=this.dimension,n=this.volume,i=n.matrix,r=(new mn).setFromMatrixPosition(i)[t],o=(new mn).setFromMatrixScale(i)[t];let s;return s="x"===t?n.nx:"y"===t?n.ny:n.nz,Math.round(((e-r)/(s/100)+1)/o)}getData(e){e=e||{};const t=this.volume,n=t.data,i=t.matrix;let r;function o(e){return Math.round(e/100*(r-1))}function s(e,n,i,r){return 3*(i*t.ny*t.nx+n*t.nx+e)+r}r="coordinate"===this.positionType?this.getPositionFromCoordinate(this.position):this.position;const a=new Float32Array(12),l=new mn;let c,u,h,d,p,f=0,m=0,g=0,y=t.nx,v=t.ny,b=t.nz;function x(e,t,n,r){l.set(e,t,n).applyMatrix4(i).toArray(a,r)}"x"===this.dimension?(h=o(t.nx),d=t.ny-1,p=t.nz-1,c=t.nz,u=t.ny,f=h,y=f+1,x(h,0,0,0),x(h,d,0,3),x(h,0,p,6),x(h,d,p,9)):"y"===this.dimension?(h=t.nx-1,d=o(t.ny),p=t.nz-1,c=t.nz,u=t.nx,m=d,v=m+1,x(0,d,0,0),x(h,d,0,3),x(0,d,p,6),x(h,d,p,9)):"z"===this.dimension&&(h=t.nx-1,d=t.ny-1,p=o(t.nz),c=t.nx,u=t.ny,g=p,b=g+1,x(0,0,p,0),x(0,d,p,3),x(h,0,p,6),x(h,d,p,9));let w=0,_=0;const S=new Uint8Array(c*u*4),M=new Float32Array(c*u);let A,C;"sigma"===this.thresholdType?(A=t.getValueForSigma(this.thresholdMin),C=t.getValueForSigma(this.thresholdMax)):(A=this.thresholdMin,C=this.thresholdMax);const T=Object.assign({},e.colorParams,{volume:t});this.normalize&&(T.domain=[0,1]);const E=Sm.getScheme(T),P=new Float32Array(3),I=E.getScale();let L,R=0,k=0;if(this.normalize){R=1/0,L=-1/0;for(let e=m;e<v;++e)for(let t=f;t<y;++t)for(let i=g;i<b;++i){const r=n[s(t,e,i,0)/3];r<R&&(R=r),r>L&&(L=r)}k=L-R}for(let O=m;O<v;++O)for(let e=f;e<y;++e)for(let t=g;t<b;++t){const i=s(e,O,t,0)/3;let r=n[i];this.normalize&&(r=(r-R)/k),E.colorToArray(I(r),P),S[w]=Math.round(255*P[0]),S[w+1]=Math.round(255*P[1]),S[w+2]=Math.round(255*P[2]),S[w+3]=r>A&&r<C?255:0,M[_]=i,++_,w+=4}const D=new kw(M,t);return{position:a,imageData:S,width:c,height:u,picking:D}}}class GM extends Wy{constructor(e,t,n){super(e,t,n),this.type="slice",this.parameters=Object.assign({filter:{type:"select",buffer:!0,options:{nearest:"nearest",linear:"linear","cubic-bspline":"cubic-bspline","cubic-catmulrom":"cubic-catmulrom","cubic-mitchell":"cubic-mitchell"}},positionType:{type:"select",rebuild:!0,options:{percent:"percent",coordinate:"coordinate"}},position:{type:"range",step:.1,max:100,min:1,rebuild:!0},dimension:{type:"select",rebuild:!0,options:{x:"x",y:"y",z:"z"}},thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},normalize:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null,linewidth:null,colorScheme:null,roughness:null,metalness:null,diffuse:null}),this.volume=e,this.init(n)}init(e){const t=this.volume,n=e||{};n.colorDomain=bp(n.colorDomain,[t.min,t.max]),n.colorScheme=bp(n.colorScheme,"value"),n.colorScale=bp(n.colorScale,"Spectral"),this.colorScheme="value",this.dimension=bp(n.dimension,"x"),this.filter=bp(n.filter,"cubic-bspline"),this.positionType=bp(n.positionType,"percent"),this.position=bp(n.position,30),this.thresholdType=bp(n.thresholdType,"sigma"),this.thresholdMin=bp(n.thresholdMin,-1/0),this.thresholdMax=bp(n.thresholdMax,1/0),this.normalize=bp(n.normalize,!1),super.init(n),this.build()}attach(e){this.bufferList.forEach((e=>{this.viewer.add(e)})),this.setVisibility(this.visible),e()}create(){const e=new HM(this.volume,{positionType:this.positionType,position:this.position,dimension:this.dimension,thresholdType:this.thresholdType,thresholdMin:this.thresholdMin,thresholdMax:this.thresholdMax,normalize:this.normalize}),t=new UM(e.getData({colorParams:this.getColorParams()}),this.getBufferParams({filter:this.filter}));this.bufferList.push(t)}}function VM(e){gm.error("makeRepresentation: representation type ".concat(e," unknown"))}function jM(t,n,i,r){var o;if(e.Debug&&gm.time("makeRepresentation "+t),n instanceof uM){if(!(o=Am.get(t)))return void VM(t)}else if(n instanceof d_)if("surface"===t)o=T_;else{if("dot"!==t)return void VM(t);o=OM}else if(n instanceof f_)if("surface"===t)o=T_;else if("dot"===t)o=OM;else{if("slice"!==t)return void VM(t);o=GM}else if(n instanceof fM)o=mM,n=n.getBufferList();else{if("buffer"!==t)return void gm.error("makeRepresentation: object "+n+" unknown");o=mM}const s=new o(n,i,r);return e.Debug&&gm.timeEnd("makeRepresentation "+t),s}const $M={name:"some element",status:""};class WM{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.stage=e,this.signals={statusChanged:new Sf.Signal,nameChanged:new Sf.Signal,disposed:new Sf.Signal},this.parameters=xp(t,this.defaultParameters),this.uuid=nf()}get defaultParameters(){return $M}get name(){return this.parameters.name}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}dispose(){this.signals.disposed.dispatch()}}const qM=Object.assign({visible:!0},$M);class XM extends WM{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;super(e,Object.assign({name:t.type},n)),this.parent=i,this.signals=Object.assign({visibilityChanged:new Sf.Signal,parametersChanged:new Sf.Signal},this.signals),this.setRepresentation(t)}get defaultParameters(){return qM}get visible(){return this.parameters.visible}get type(){return"representation"}getType(){return this.repr.type}setRepresentation(e){this._disposeRepresentation(),this.repr=e,this.stage.tasks.listen(this.repr.tasks),this.updateVisibility()}_disposeRepresentation(){this.repr&&(this.stage.tasks.unlisten(this.repr.tasks),this.repr.dispose())}dispose(){this.parent&&this.parent.hasRepresentation(this)?this.parent.removeRepresentation(this):(this._disposeRepresentation(),this.signals.disposed.dispatch())}setVisibility(e){return this.parameters.visible=e,this.updateVisibility(),this.signals.visibilityChanged.dispatch(this.parameters.visible),this}getVisibility(){return this.parent?this.parent.parameters.visible&&this.parameters.visible:this.parameters.visible}toggleVisibility(){return this.setVisibility(!this.parameters.visible)}updateVisibility(){this.repr.setVisibility(this.getVisibility())}update(e){return this.repr.update(e),this}build(e){return this.repr.build(e),this}setSelection(e){const t=this.repr;return t.setSelection&&t.setSelection(e),this}setParameters(e){return this.repr.setParameters(e),this.signals.parametersChanged.dispatch(this.repr.getParameters()),this}getParameters(){return this.repr.getParameters()}setColor(e){return this.repr.setColor(e),this}}const YM=new Sn,ZM=new mn,KM={name:"",status:"",visible:!0};class QM{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.stage=e,this.object=t,this.signals={representationAdded:new Sf.Signal,representationRemoved:new Sf.Signal,visibilityChanged:new Sf.Signal,matrixChanged:new Sf.Signal,statusChanged:new Sf.Signal,nameChanged:new Sf.Signal,disposed:new Sf.Signal},this.reprList=[],this.annotationList=[],this.matrix=new Sn,this.position=new mn,this.quaternion=new dn,this.scale=new mn(1,1,1),this.transform=new Sn,this.parameters=xp(n,this.defaultParameters),this.uuid=nf(),this.viewer=e.viewer,this.controls=new j_(this)}get defaultParameters(){return KM}get name(){return this.parameters.name}get status(){return this.parameters.status}get visible(){return this.parameters.visible}setPosition(e){return Array.isArray(e)?this.position.fromArray(e):this.position.copy(e),this.updateMatrix(),this}setRotation(e){if(Array.isArray(e))if(3===e.length){const t=(new Cn).fromArray(e);this.quaternion.setFromEuler(t)}else this.quaternion.fromArray(e);else e instanceof Cn?this.quaternion.setFromEuler(e):this.quaternion.copy(e);return this.updateMatrix(),this}setScale(e){return this.scale.set(e,e,e),this.updateMatrix(),this}setTransform(e){return this.transform.copy(e),this.updateMatrix(),this}updateMatrix(){const e=this.getCenterUntransformed(ZM);this.matrix.makeTranslation(-e.x,-e.y,-e.z),YM.makeRotationFromQuaternion(this.quaternion),this.matrix.premultiply(YM),YM.makeScale(this.scale.x,this.scale.y,this.scale.z),this.matrix.premultiply(YM);const t=this.position;YM.makeTranslation(t.x+e.x,t.y+e.y,t.z+e.z),this.matrix.premultiply(YM),this.matrix.premultiply(this.transform),this.updateRepresentationMatrices(),this.stage.viewer.updateBoundingBox(),this.signals.matrixChanged.dispatch(this.matrix)}updateRepresentationMatrices(){this.reprList.forEach((e=>{e.setParameters({matrix:this.matrix})}))}addAnnotation(e,t,n){const i=new U_(this,e,t,n);return this.annotationList.push(i),i}eachAnnotation(e){this.annotationList.slice().forEach(e)}removeAnnotation(e){const t=this.annotationList.indexOf(e);-1!==t&&(this.annotationList.splice(t,1),e.dispose())}removeAllAnnotations(){this.eachAnnotation((e=>e.dispose())),this.annotationList.length=0}_addRepresentation(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=n||{},o=this.stage.getParameters();r.matrix=this.matrix.clone(),r.quality=r.quality||o.quality,r.disableImpostor=bp(r.disableImpostor,!o.impostor),r.useWorker=bp(r.useWorker,o.workerDefault),r.visible=bp(r.visible,!0);const s=Object.assign({},r,{visible:this.parameters.visible&&r.visible}),a=jM(e,t,this.viewer,s),l=new XM(this.stage,a,r,this);return i||(this.reprList.push(l),this.signals.representationAdded.dispatch(l)),l}addBufferRepresentation(e,t){return this._addRepresentation.call(this,"buffer",e,t)}hasRepresentation(e){return-1!==this.reprList.indexOf(e)}eachRepresentation(e){this.reprList.slice().forEach(e)}removeRepresentation(e){const t=this.reprList.indexOf(e);-1!==t&&(this.reprList.splice(t,1),e.dispose(),this.signals.representationRemoved.dispatch(e))}updateRepresentations(e){this.reprList.forEach((t=>t.update(e))),this.stage.viewer.requestRender()}removeAllRepresentations(){this.eachRepresentation((e=>e.dispose()))}dispose(){this.removeAllAnnotations(),this.removeAllRepresentations(),this.reprList.length=0,this.signals.disposed.dispatch()}setVisibility(e){return this.parameters.visible=e,this.eachRepresentation((e=>e.updateVisibility())),this.eachAnnotation((e=>e.updateVisibility())),this.signals.visibilityChanged.dispatch(e),this}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}getBox(){return this.getBoxUntransformed(...arguments).clone().applyMatrix4(this.matrix)}getCenter(){return this.getCenterUntransformed(...arguments).clone().applyMatrix4(this.matrix)}getZoom(){return this.stage.getZoomForBox(this.getBox(...arguments))}getBoxUntransformed(){return new ni}getCenterUntransformed(){return this.getBoxUntransformed().getCenter(new mn)}autoView(e){this.stage.animationControls.zoomMove(this.getCenter(),this.getZoom(),bp(e,0))}}class JM{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.list=e;const t=e.length;for(let n=0;n<t;++n)e[n].signals.disposed.add(this._remove,this)}_remove(e){const t=this.list.indexOf(e);-1!==t&&this.list.splice(t,1)}get first(){return this.list.length>0?this.list[0]:void 0}forEach(e){return this.list.forEach(e),this}dispose(){return this.forEach((e=>e.dispose()))}}class eA extends JM{setParameters(e){return this.forEach((t=>t.setParameters(e)))}setVisibility(e){return this.forEach((t=>t.setVisibility(e)))}setSelection(e){return this.forEach((t=>t.setSelection(e)))}setColor(e){return this.forEach((t=>t.setColor(e)))}update(e){return this.forEach((t=>t.update(e)))}build(e){return this.forEach((t=>t.build(e)))}dispose(e){return this.forEach((e=>e.dispose()))}}const tA=Object.assign({defaultStep:1,defaultTimeout:50,defaultInterpolateType:"",defaultInterpolateStep:5,defaultMode:"loop",defaultDirection:"forward",initialFrame:0},$M);class nA extends WM{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(e,Object.assign({name:t.name},n)),this.trajectory=t,this.signals=Object.assign(this.signals,{frameChanged:new Sf.Signal,playerChanged:new Sf.Signal,countChanged:new Sf.Signal,parametersChanged:new Sf.Signal}),t.signals.frameChanged.add((e=>{this.signals.frameChanged.dispatch(e)})),t.signals.playerChanged.add((e=>{this.signals.playerChanged.dispatch(e)})),t.signals.countChanged.add((e=>{this.signals.countChanged.dispatch(e)})),void 0!==n.initialFrame&&this.setFrame(n.initialFrame)}get defaultParameters(){return tA}get type(){return"trajectory"}setFrame(e){this.trajectory.setFrame(e)}setParameters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.trajectory.setParameters(e),this.signals.parametersChanged.dispatch(e)}dispose(){this.trajectory.dispose(),super.dispose()}}class iA{constructor(e,t){this.name=e,this.path=t,this.coordinates=[],this.boxes=[],this.times=[],this.timeOffset=0,this.deltaTime=1}get type(){return"Frames"}}class rA{constructor(e,t){let n,i;if(this.A=new zw(3,3),this.W=new zw(1,3),this.U=new zw(3,3),this.V=new zw(3,3),this.VH=new zw(3,3),this.R=new zw(3,3),this.tmp=new zw(3,3),this.c=new zw(3,3),e instanceof uM)n=e.atomCount;else{if(!(e instanceof Float32Array))return;n=e.length/3}if(t instanceof uM)i=t.atomCount;else{if(!(t instanceof Float32Array))return;i=t.length/3}const r=Math.min(n,i),o=new zw(3,r),s=new zw(3,r);this.coords1t=new zw(r,3),this.coords2t=new zw(r,3),this.transformationMatrix=new Sn,this.c.data.set([1,0,0,0,1,0,0,0,-1]),this.prepCoords(e,o,r,!1),this.prepCoords(t,s,r,!1),this._superpose(o,s)}_superpose(t,n){this.mean1=Ww(t),this.mean2=Ww(n),qw(t,this.mean1),qw(n,this.mean2),Uw(this.coords1t,t),Uw(this.coords2t,n),Gw(this.A,this.coords2t,this.coords1t),Jw(this.A,this.W,this.U,this.V),Vw(this.V,this.VH),$w(this.R,this.U,this.VH),jw(this.R)<0&&(e.Debug&&gm.log("R not a right handed system"),$w(this.tmp,this.c,this.VH),$w(this.R,this.U,this.tmp));const i=new zw(4,4),r=new zw(4,4),o=new zw(4,4),s=new zw(4,4),a=new zw(4,4),l=new zw(4,4),c=this.R.data,u=this.mean1,h=this.mean2;s.data.set([1,0,0,-u[0],0,1,0,-u[1],0,0,1,-u[2],0,0,0,1]),a.data.set([c[0],c[1],c[2],0,c[3],c[4],c[5],0,c[6],c[7],c[8],0,0,0,0,1]),l.data.set([1,0,0,h[0],0,1,0,h[1],0,0,1,h[2],0,0,0,1]),Uw(r,s),Gw(i,a,r),Uw(o,i),Gw(r,l,o),Uw(i,r),this.transformationMatrix.elements=i.data}prepCoords(e,t,n,i){let r=0;const o=t.data;let s=3,a=3*n;if(i&&(a=4*n,s=4),e instanceof uM)e.eachAtom((function(e){r<a&&(o[r+0]=e.x,o[r+1]=e.y,o[r+2]=e.z,i&&(o[r+3]=1),r+=s)}));else if(e instanceof Float32Array)for(;r<a;r+=s)r<a&&(o[r]=e[r],o[r+1]=e[r+1],o[r+2]=e[r+2],i&&(o[r+3]=1));else gm.warn("prepCoords: input type unknown")}transform(e){let t;if(e instanceof uM)t=e.atomCount;else{if(!(e instanceof Float32Array))return;t=e.length/3}const n=new zw(4,t),i=new zw(t,4);this.prepCoords(e,n,t,!0);const r=this.transformationMatrix,o=r.determinant();if(!o)return o;const s=new zw(4,4);s.data=r.elements,Hw(i,n,s);let a=0;const l=i.data;if(e instanceof uM){e.eachAtom((function(e){e.x=l[a],e.y=l[a+1],e.z=l[a+2],a+=4}));const t=new Sn;t.getInverse(r);const n=e.biomolDict;for(let e in n)n.hasOwnProperty(e)&&n[e].partList.forEach((function(e){e.matrixList.forEach((function(e){e.premultiply(r),e.multiply(t)}))}))}else if(e instanceof Float32Array){const n=4*t;for(;a<n;a+=4)e[a]=l[a],e[a+1]=l[a+1],e[a+2]=l[a+2]}else gm.warn("transform: input type unknown");return this.transformationMatrix}}const oA={step:1,timeout:50,start:0,end:0,interpolateType:"",interpolateStep:5,mode:"loop",direction:"forward"};class sA{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.signals={startedRunning:new Sf.Signal,haltedRunning:new Sf.Signal},this._run=!1,this._previousTime=0,this._currentTime=0,this._currentStep=1,e.signals.playerChanged.add((e=>{e!==this&&this.pause()}),this);const n=bp(e.frameCount,1);this.traj=e,this.parameters=xp(t,oA),this.parameters.end=Math.min(bp(t.end,n-1),n-1),this.parameters.step=bp(t.step,Math.ceil((n+1)/100)),this._currentFrame=this.parameters.start,this._direction="bounce"===this.parameters.direction?"forward":this.parameters.direction,e.signals.countChanged.add((e=>{this.parameters.end=Math.min(bp(this.parameters.end,e-1),e-1)}),this),this._animate=this._animate.bind(this)}get isRunning(){return this._run}setParameters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};wp(this.parameters,e),void 0!==e.direction&&"bounce"!==this.parameters.direction&&(this._direction=this.parameters.direction)}_animate(){if(!this._run)return;this._currentTime=window.performance.now();const e=this._currentTime-this._previousTime,t=this.parameters.interpolateType?this.parameters.interpolateStep:1,n=this.parameters.timeout/t,i=this.traj;if(i&&i.frameCount&&!i.inProgress&&e>=n)if(this.parameters.interpolateType)if(this._currentStep>this.parameters.interpolateStep&&(this._currentStep=1),1===this._currentStep&&(this._currentFrame=this._nextInterpolated()),i.hasFrame(this._currentFrame)){this._currentStep+=1;const e=this._currentStep/(this.parameters.interpolateStep+1),[t,n,r,o]=this._currentFrame;i.setFrameInterpolated(t,n,r,o,e,this.parameters.interpolateType),this._previousTime=this._currentTime}else i.loadFrame(this._currentFrame);else{const e=this._next();i.hasFrame(e)?(i.setFrame(e),this._previousTime=this._currentTime):i.loadFrame(e)}window.requestAnimationFrame(this._animate)}_next(){const e=this.parameters;let t;return t="forward"===this._direction?this.traj.currentFrame+e.step:this.traj.currentFrame-e.step,(t>e.end||t<e.start)&&("bounce"===e.direction&&("forward"===this._direction?this._direction="backward":this._direction="forward"),"once"===e.mode?(this.pause(),t="forward"===e.direction?e.end:"backward"===e.direction||"forward"===this._direction?e.start:e.end):"forward"===this._direction?(t=e.start,e.interpolateType&&(t=Math.min(e.end,t+e.step))):(t=e.end,e.interpolateType&&(t=Math.max(e.start,t-e.step)))),t}_nextInterpolated(){const e=this.parameters,t=this._next();let n,i,r;return"forward"===this._direction?(n=Math.max(e.start,t-e.step),i=Math.max(e.start,t-2*e.step),r=Math.max(e.start,t-3*e.step)):(n=Math.min(e.end,t+e.step),i=Math.min(e.end,t+2*e.step),r=Math.min(e.end,t+3*e.step)),[t,n,i,r]}toggle(){this._run?this.pause():this.play()}play(){if(!this._run){this.traj.player!==this&&this.traj.setPlayer(this),this._currentStep=1;const e=this.parameters,t=this.traj.currentFrame;let n=Math.ceil(t/e.step)*e.step;"forward"===e.direction&&t>=e.end?n=e.start:"backward"===e.direction&&t<=e.start&&(n=e.end),this.traj.setFrame(n),this._run=!0,this._animate(),this.signals.startedRunning.dispatch()}}pause(){this._run=!1,this.signals.haltedRunning.dispatch()}stop(){this.pause(),this.traj.setFrame(this.parameters.start)}}function aA(e,t,n){if(0===n[0]||0===n[8]||0===n[4])return;const i=e.length,r=n[0],o=n[1],s=n[2],a=-t[0]+r+r/2,l=-t[1]+o+o/2,c=-t[2]+s+s/2;for(let u=0;u<i;u+=3)e[u+0]=(e[u+0]+a)%r,e[u+1]=(e[u+1]+l)%o,e[u+2]=(e[u+2]+c)%s}function lA(e,t){if(0===t[0]||0===t[8]||0===t[4])return;const n=e.length;for(let i=3;i<n;i+=3)for(let n=0;n<3;++n){const r=e[i+n]-e[i-3+n];if(Math.abs(r)>.9*t[3*n+n])if(r>0)for(let o=0;o<3;++o)e[i+o]-=t[3*n+o];else for(let o=0;o<3;++o)e[i+o]+=t[3*n+o]}return e}function cA(e,t,n){if(0===t[0]||0===t[8]||0===t[4])return;const i=e.length;for(let r=3;r<i;r+=3)for(let i=0;i<3;++i){const o=(e[r+i]-n[i])/t[3*i+i];Math.abs(o)>.5&&(e[r+i]-=t[3*i+i]*Math.round(o))}return e}function uA(e,t,n){return[pg(t,n[0],3,0,e),pg(t,n[1],3,1,e),pg(t,n[2],3,2,e)]}function hA(e){return[Ig(e,3,0),Ig(e,3,1),Ig(e,3,2)]}function dA(e,t,n,i,r){const o=e.length,s=new Float32Array(o);for(let a=0;a<o;a+=3){const o=a+1,l=a+2;s[a]=uf(i[a],n[a],t[a],e[a],r,1),s[o]=uf(i[o],n[o],t[o],e[o],r,1),s[l]=uf(i[l],n[l],t[l],e[l],r,1)}return s}function pA(e,t,n){const i=e.length,r=new Float32Array(i);for(let o=0;o<i;o+=3){const i=o+1,s=o+2;r[o]=cf(t[o],e[o],n),r[i]=cf(t[i],e[i],n),r[s]=cf(t[s],e[s],n)}return r}class fA{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.signals={countChanged:new Sf.Signal,frameChanged:new Sf.Signal,playerChanged:new Sf.Signal},this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this._frameCount=0,this._currentFrame=-1,this._disposed=!1,this.deltaTime=bp(n.deltaTime,0),this.timeOffset=bp(n.timeOffset,0),this.centerPbc=bp(n.centerPbc,!1),this.removePbc=bp(n.removePbc,!1),this.removePeriodicity=bp(n.removePeriodicity,!1),this.superpose=bp(n.superpose,!1),this.name=e.replace(/^.*[\\/]/,""),this.trajPath=e,this.selection=new Kf(bp(n.sele,"backbone and not hydrogen")),this.selection.signals.stringChanged.add((()=>{this.selectionIndices=this.structure.getAtomIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}))}get frameCount(){return this._frameCount}get currentFrame(){return this._currentFrame}_init(e){this.setStructure(e),this._loadFrameCount(),this.setPlayer(new sA(this))}_loadFrameCount(){}setStructure(e){this.structure=e,this.atomCount=e.atomCount,this.backboneIndices=this._getIndices(new Kf("backbone and not hydrogen")),this._makeAtomIndices(),this._saveStructureCoords(),this.selectionIndices=this._getIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}_saveInitialCoords(){this.structure.hasCoords()?(this.initialCoords=new Float32Array(this.structureCoords),this._makeSuperposeCoords()):this.frameCache[0]?(this.initialCoords=new Float32Array(this.frameCache[0]),this._makeSuperposeCoords()):this.loadFrame(0,(()=>this._saveInitialCoords()))}_saveStructureCoords(){const e={what:{position:!0}};this.structureCoords=this.structure.getAtomData(e).position}setSelection(e){return this.selection.setString(e),this}_getIndices(e){let t=0;const n=e.test,i=[];return n&&this.structure.eachAtom((e=>{n(e)&&i.push(t),t+=1})),i}_makeSuperposeCoords(){const e=3*this.selectionIndices.length;this.coords1=new Float32Array(e),this.coords2=new Float32Array(e);const t=this.initialCoords,n=this.coords2;for(let i=0;i<e;i+=3){const e=3*this.selectionIndices[i/3];n[i+0]=t[e+0],n[i+1]=t[e+1],n[i+2]=t[e+2]}}_makeAtomIndices(){gm.error("Trajectory._makeAtomIndices not implemented")}_resetCache(){this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this.initialCoords=new Float32Array(0)}setParameters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1;void 0!==e.centerPbc&&e.centerPbc!==this.centerPbc&&(this.centerPbc=e.centerPbc,t=!0),void 0!==e.removePeriodicity&&e.removePeriodicity!==this.removePeriodicity&&(this.removePeriodicity=e.removePeriodicity,t=!0),void 0!==e.removePbc&&e.removePbc!==this.removePbc&&(this.removePbc=e.removePbc,t=!0),void 0!==e.superpose&&e.superpose!==this.superpose&&(this.superpose=e.superpose,t=!0),this.deltaTime=bp(e.deltaTime,this.deltaTime),this.timeOffset=bp(e.timeOffset,this.timeOffset),t&&(this._resetCache(),this.setFrame(this._currentFrame))}hasFrame(e){return Array.isArray(e)?e.every((e=>!!this.frameCache[e])):!!this.frameCache[e]}setFrame(e,t){return void 0===e||(this.inProgress=!0,-1===e||this.frameCache[e]?(this._updateStructure(e),t&&t()):this.loadFrame(e,(()=>{this._updateStructure(e),t&&t()}))),this}_interpolate(e,t,n,i,r,o){const s=this.frameCache;let a;a="spline"===o?dA(s[e],s[t],s[n],s[i],r):pA(s[e],s[t],r),this.structure.updatePosition(a),this._currentFrame=e,this.signals.frameChanged.dispatch(e)}setFrameInterpolated(e,t,n,i,r,o,s){if(void 0===e)return this;const a=this.frameCache,l=[];return a[i]||l.push(i),a[n]||l.push(n),a[t]||l.push(t),a[e]||l.push(e),l.length?this.loadFrame(l,(()=>{this._interpolate(e,t,n,i,r,o),s&&s()})):(this._interpolate(e,t,n,i,r,o),s&&s()),this}loadFrame(e,t){Array.isArray(e)?e.forEach((e=>{this.loadQueue[e]||this.frameCache[e]||(this.loadQueue[e]=!0,this._loadFrame(e,(()=>{delete this.loadQueue[e]})))})):this.loadQueue[e]||this.frameCache[e]||(this.loadQueue[e]=!0,this._loadFrame(e,(()=>{delete this.loadQueue[e],t&&t()})))}_loadFrame(e,t){gm.error("Trajectory._loadFrame not implemented",e,t)}_updateStructure(e){this._disposed?console.error("updateStructure: traj disposed"):(-1===e?this.structureCoords&&this.structure.updatePosition(this.structureCoords):this.structure.updatePosition(this.frameCache[e]),this.structure.trajectory={name:this.trajPath,frame:e},this._currentFrame=e,this.inProgress=!1,this.signals.frameChanged.dispatch(e))}_doSuperpose(e){const t=3*this.selectionIndices.length,n=this.coords1,i=this.coords2;for(let r=0;r<t;r+=3){const t=3*this.selectionIndices[r/3];n[r+0]=e[t+0],n[r+1]=e[t+1],n[r+2]=e[t+2]}new rA(n,i).transform(e)}_process(e,t,n,i){if(this._setFrameCount(i),t){if(this.backboneIndices.length>0&&this.centerPbc){const e=[t[0],t[4],t[8]];aA(n,uA(this.backboneIndices,n,e),e)}this.removePeriodicity&&cA(n,t,hA(n)),this.removePbc&&lA(n,t)}this.selectionIndices.length>0&&this.coords1&&this.superpose&&this._doSuperpose(n),this.frameCache[e]=n,this.boxCache[e]=t,this.frameCacheSize+=1}_setFrameCount(e){e!==this._frameCount&&(this._frameCount=e,this.signals.countChanged.dispatch(e))}dispose(){this._resetCache(),this._disposed=!0,this.player&&this.player.stop()}setPlayer(e){this.player=e,this.signals.playerChanged.dispatch(e)}getFrameTime(e){return this.timeOffset+e*this.deltaTime}}class mA extends fA{constructor(e,t,n){const i=n||{};i.timeOffset=bp(i.timeOffset,e.timeOffset),i.deltaTime=bp(i.deltaTime,e.deltaTime),super("",t,i),this.name=e.name,this.path=e.path,this.frames=e.coordinates,this.boxes=e.boxes,this._init(t)}get type(){return"frames"}_makeAtomIndices(){"StructureView"===this.structure.type?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let n;const i=this.frames[e];if(this.atomIndices){const e=this.atomIndices,t=e.length;n=new Float32Array(3*t);for(let r=0;r<t;++r){const t=3*r,o=3*e[r];n[t+0]=i[o+0],n[t+1]=i[o+1],n[t+2]=i[o+2]}}else n=new Float32Array(i);const r=this.boxes[e],o=this.frames.length;this._process(e,r,n,o),"function"===typeof t&&t()}_loadFrameCount(){this.frames&&this._setFrameCount(this.frames.length)}}class gA extends fA{constructor(e,t,n){super("",t,n),this._init(t)}get type(){return"structure"}_makeAtomIndices(){this.structure.atomSet&&this.structure.atomSet.getSize()<this.structure.atomStore.count?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let n;const i=this.structure,r=i.frames[e];if(this.atomIndices){const e=this.atomIndices,t=e.length;n=new Float32Array(3*t);for(let i=0;i<t;++i){const t=3*i,o=3*e[i];n[t+0]=r[o+0],n[t+1]=r[o+1],n[t+2]=r[o+2]}}else n=new Float32Array(r);const o=i.boxes[e],s=i.frames.length;this._process(e,o,n,s),"function"===typeof t&&t()}_loadFrameCount(){this._setFrameCount(this.structure.frames.length)}}class yA extends fA{constructor(e,t,n){super(e,t,n),this._init(t)}get type(){return"remote"}_makeAtomIndices(){const e=[];if("StructureView"===this.structure.type){const t=this.structure.getAtomIndices(),n=t.length;let i=t[0],r=t[0];for(let o=1;o<n;++o){const n=t[o];r+1<n&&(e.push([i,r+1]),i=n),r=n}e.push([i,r+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(t,n){const i=new XMLHttpRequest,r=e.TrajectoryDatasource.getFrameUrl(this.trajPath,t),o=e.TrajectoryDatasource.getFrameParams(this.trajPath,this.atomIndices);i.open("POST",r,!0),i.responseType="arraybuffer",i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.addEventListener("load",(()=>{const e=i.response;if(!e)return void gm.error("empty arrayBuffer for '".concat(r,"'"));const o=new Int32Array(e,0,1)[0],s=new Float32Array(e,8,9),a=new Float32Array(e,44);this._process(t,s,a,o),"function"===typeof n&&n()}),!1),i.send(o)}_loadFrameCount(){const t=new XMLHttpRequest,n=e.TrajectoryDatasource.getCountUrl(this.trajPath);t.open("GET",n,!0),t.addEventListener("load",(()=>{this._setFrameCount(parseInt(t.response))}),!1),t.send()}}class vA extends fA{constructor(e,t,n){super("",t,n),this.requestCallback=e,this._init(t)}get type(){return"callback"}_makeAtomIndices(){const e=[];if("StructureView"===this.structure.type){const t=this.structure.getAtomIndices(),n=t.length;let i=t[0],r=t[0];for(let o=1;o<n;++o){const n=t[o];r+1<n&&(e.push([i,r+1]),i=n),r=n}e.push([i,r+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){this.requestCallback(((e,n,i,r)=>{this._process(e,n,i,r),"function"===typeof t&&t()}),e,this.atomIndices)}_loadFrameCount(){this.requestCallback((e=>this._setFrameCount(e)))}}function bA(e,t,n){let i;return i=e&&e instanceof iA?new mA(e,t,n):!e&&t.frames?new gA(e,t,n):e&&"function"===typeof e?new vA(e,t,n):new yA(e,t,n),i}uM.prototype.getView=function(e){let t=new xA(this,e);return t.hideAtoms=this.hideAtoms,t.extraBonds=this.extraBonds,t.showAtoms=this.showAtoms,t};class xA extends uM{constructor(e,t){super(),this.structure=e,this.selection=t,this.hideAtoms=[],this.center=new mn,this.boundingBox=new ni,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy(),this.selection&&this.selection.signals.stringChanged.add(this.refresh,this),this.structure.signals.refreshed.add(this.refresh,this),this.refresh()}init(){}get type(){return"StructureView"}get name(){return this.structure.name}get path(){return this.structure.path}get title(){return this.structure.title}get id(){return this.structure.id}get data(){return this.structure.data}get atomSetDict(){return this.structure.atomSetDict}get biomolDict(){return this.structure.biomolDict}get entityList(){return this.structure.entityList}get unitcell(){return this.structure.unitcell}get frames(){return this.structure.frames}get boxes(){return this.structure.boxes}get validation(){return this.structure.validation}get bondStore(){return this.structure.bondStore}get backboneBondStore(){return this.structure.backboneBondStore}get rungBondStore(){return this.structure.rungBondStore}get atomStore(){return this.structure.atomStore}get residueStore(){return this.structure.residueStore}get chainStore(){return this.structure.chainStore}get modelStore(){return this.structure.modelStore}get atomMap(){return this.structure.atomMap}get residueMap(){return this.structure.residueMap}get bondHash(){return this.structure.bondHash}get spatialHash(){return this.structure.spatialHash}get _hasCoords(){return this.structure._hasCoords}set _hasCoords(e){this.structure._hasCoords=e}refresh(){e.Debug&&gm.time("StructureView.refresh"),this.atomSetCache={};const t=this.structure;if(this.selection.isAllSelection()&&t!==this&&t.atomSet&&t.bondSet){this.atomSet=t.atomSet.clone(),this.bondSet=t.bondSet.clone();for(let e in this.atomSetDict){const t=this.atomSetDict[e];this.atomSetCache["__"+e]=t.clone()}this.atomCount=t.atomCount,this.bondCount=t.bondCount,this.boundingBox.copy(t.boundingBox),this.center.copy(t.center)}else if(this.selection.isNoneSelection()&&t!==this&&t.atomSet&&t.bondSet){this.atomSet=new Gv(t.atomCount),this.bondSet=new Gv(t.bondCount);for(let e in this.atomSetDict)this.atomSetCache["__"+e]=new Gv(t.atomCount);this.atomCount=0,this.bondCount=0,this.boundingBox.makeEmpty(),this.center.set(0,0,0)}else{this.atomSet=this.getAtomSet(this.selection,!0),t.atomSet&&(this.atomSet=this.atomSet.intersection(t.atomSet)),this.bondSet=this.getBondSet();for(let e in this.atomSetDict){const t=this.atomSetDict[e];this.atomSetCache["__"+e]=t.makeIntersection(this.atomSet)}this.atomCount=this.atomSet.getSize(),this.bondCount=this.bondSet.getSize(),this.boundingBox=this.getBoundingBox(),this.center=this.boundingBox.getCenter(new mn)}e.Debug&&gm.timeEnd("StructureView.refresh"),this.signals.refreshed.dispatch()}setSelection(e){this.selection=e,this.refresh()}getSelection(e){const t=[];e&&e.string&&t.push(e.string);const n=this.structure.getSelection();n&&n.string&&t.push(n.string),this.selection&&this.selection.string&&t.push(this.selection.string);let i="";return t.length>0&&(i="( ".concat(t.join(" ) AND ( ")," )")),new Kf(i)}getStructure(){return this.structure.getStructure()}eachBond(e,t){this.structure.eachBond(e,this.getSelection(t))}eachAtom(e,t){const n=this.getAtomProxy(),i=this.getAtomSet(t),r=this.atomStore.count;if(i.getSize()<r)i.forEach((function(t){n.index=t,e(n)}));else for(let o=0;o<r;++o)n.index=o,e(n)}eachResidue(e,t){this.structure.eachResidue(e,this.getSelection(t))}eachResidueN(e,t){console.error("StructureView.eachResidueN() not implemented")}eachChain(e,t){this.structure.eachChain(e,this.getSelection(t))}eachModel(e,t){this.structure.eachModel(e,this.getSelection(t))}getAtomSet(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.structure.getAtomSet(e);return!t&&this.atomSet&&(n=n.makeIntersection(this.atomSet)),n}getAtomIndices(e){let t=this.getSelection(e);return this.structure.getAtomIndices(t)}refreshPosition(){return this.structure.refreshPosition()}dispose(){this.selection&&this.selection.signals.stringChanged.remove(this.refresh,this),this.structure.signals.refreshed.remove(this.refresh,this),this.structure=new uM,delete this.atomSet,delete this.bondSet}}const wA="ACDEFGHIKLMNPQRSTVWY",_A="ARNDCQEGHILKMFPSTWYVBZ?",SA=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]],MA=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]];function AA(e,t){let n,i=0;const r={};return t.forEach((function(t){n=0;const o={};t.forEach((function(t){o[e[n++]]=t})),r[e[i++]]=o})),r}const CA={blosum62:AA(_A,MA),blosum62x:AA(wA,SA)};class TA{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-10,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"blosum62";this.seq1=e,this.seq2=t,this.gapPenalty=n,this.gapExtensionPenalty=i,r&&(this.substMatrix=CA[r])}initMatrices(){this.n=this.seq1.length,this.m=this.seq2.length,this.score=void 0,this.ali="",this.S=[],this.V=[],this.H=[];for(let e=0;e<=this.n;++e){this.S[e]=[],this.V[e]=[],this.H[e]=[];for(let t=0;t<=this.m;++t)this.S[e][t]=0,this.V[e][t]=0,this.H[e][t]=0}for(let e=0;e<=this.n;++e)this.S[e][0]=this.gap(0),this.H[e][0]=-1/0;for(let e=0;e<=this.m;++e)this.S[0][e]=this.gap(0),this.V[0][e]=-1/0;this.S[0][0]=0}gap(e){return this.gapPenalty+e*this.gapExtensionPenalty}makeScoreFn(){const e=this.seq1,t=this.seq2,n=this.substMatrix;return n?function(i,r){const o=e[i],s=t[r];try{return n[o][s]}catch(CD){return-4}}:(gm.warn("Alignment: no subst matrix"),function(n,i){return e[n]===t[i]?5:-3})}calc(){e.Debug&&gm.time("Alignment.calc"),this.initMatrices();const t=this.gap(0),n=this.makeScoreFn(),i=this.gapExtensionPenalty,r=this.V,o=this.H,s=this.S,a=this.n,l=this.m;let c,u,h,d,p;for(let e=1;e<=a;++e){u=s[e-1],c=r[e-1],h=r[e],d=o[e],p=s[e];for(let r=1;r<=l;++r)h[r]=Math.max(u[r]+t,c[r]+i),d[r]=Math.max(p[r-1]+t,d[r-1]+i),p[r]=Math.max(u[r-1]+n(e-1,r-1),h[r],d[r])}e.Debug&&gm.timeEnd("Alignment.calc"),e.Debug&&gm.log(this.S,this.V,this.H)}trace(){e.Debug&&gm.time("Alignment.trace"),this.ali1="",this.ali2="";const t=this.makeScoreFn();let n,i=this.n,r=this.m;for(this.S[i][r]>=this.V[i][r]?(n="S",this.score=this.S[i][r]):this.V[i][r]>=this.H[i][r]?(n="V",this.score=this.V[i][r]):(n="H",this.score=this.H[i][r]),e.Debug&&gm.log("Alignment: SCORE",this.score),e.Debug&&gm.log("Alignment: S, V, H",this.S[i][r],this.V[i][r],this.H[i][r]);i>0&&r>0;)"S"===n?this.S[i][r]===this.S[i-1][r-1]+t(i-1,r-1)?(this.ali1=this.seq1[i-1]+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--i,--r,n="S"):this.S[i][r]===this.V[i][r]?n="V":this.S[i][r]===this.H[i][r]?n="H":(--i,--r):"V"===n?this.V[i][r]===this.V[i-1][r]+this.gapExtensionPenalty?(this.ali1=this.seq1[i-1]+this.ali1,this.ali2="-"+this.ali2,--i,n="V"):this.V[i][r]===this.S[i-1][r]+this.gap(0)?(this.ali1=this.seq1[i-1]+this.ali1,this.ali2="-"+this.ali2,--i,n="S"):--i:"H"===n?this.H[i][r]===this.H[i][r-1]+this.gapExtensionPenalty?(this.ali1="-"+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--r,n="H"):this.H[i][r]===this.S[i][r-1]+this.gap(0)?(this.ali1="-"+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--r,n="S"):--r:gm.error("Alignment: no matrix");for(;i>0;)this.ali1=this.seq1[i-1]+this.ali1,this.ali2="-"+this.ali2,--i;for(;r>0;)this.ali1="-"+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--r;e.Debug&&gm.timeEnd("Alignment.trace"),e.Debug&&gm.log([this.ali1,this.ali2])}}function EA(e,t){let n,i,r,o,s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){let c=e,u=t;a&&l&&(c=e.getView(new Kf(a)),u=t.getView(new Kf(l)));const h=c.getSequence(),d=u.getSequence(),p=new TA(h.join(""),d.join(""));let f,m;p.calc(),p.trace(),n=0,i=0,r=p.ali1.length;const g=[],y=[];for(let e=0;e<r;++e){const t=p.ali1[e],r=p.ali2[e];f=0,m=0,"-"===t?y[i]=!1:(y[i]=!0,f=1),"-"===r?g[n]=!1:(g[n]=!0,m=1),n+=f,i+=m}const v=[],b=[],x=c.getAtomProxy(),w=u.getAtomProxy();n=0,c.eachResidue((function(e){void 0!==e.traceAtomIndex&&e.traceAtomIndex===e.getAtomIndexByName("CA")&&(g[n]&&(x.index=e.getAtomIndexByName("CA"),v.push(x.x,x.y,x.z)),n+=1)})),n=0,u.eachResidue((function(e){void 0!==e.traceAtomIndex&&e.traceAtomIndex===e.getAtomIndexByName("CA")&&(y[n]&&(w.index=e.getAtomIndexByName("CA"),b.push(w.x,w.y,w.z)),n+=1)})),o=new Float32Array(v),s=new Float32Array(b)}else o=e.getView(new Kf("".concat(a," and .CA"))),s=t.getView(new Kf("".concat(l," and .CA")));const c=new rA(o,s).transform(e);return e.refreshPosition(),c}const PA=Object.assign({sele:"",defaultAssembly:""},KM);class IA extends QM{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(e,t,Object.assign({name:t.name},n)),this.structure=t,this.trajList=[],this.signals=Object.assign(this.signals,{trajectoryAdded:new Sf.Signal,trajectoryRemoved:new Sf.Signal,defaultAssemblyChanged:new Sf.Signal}),this.initSelection(this.parameters.sele),this.pickBuffer=Xp(4),this.pickDict=Yp(),this.spacefillRepresentation=this.addRepresentation("spacefill",{sele:"none",opacity:ym.opacity,color:ym.color,disablePicking:!0,radiusType:"data"},!0),this.distanceRepresentation=this.addRepresentation("distance",ym,!0),this.angleRepresentation=this.addRepresentation("angle",ym,!0),this.dihedralRepresentation=this.addRepresentation("dihedral",ym,!0),this.measureRepresentations=new eA([this.spacefillRepresentation,this.distanceRepresentation,this.angleRepresentation,this.dihedralRepresentation]),this.setDefaultAssembly(this.parameters.defaultAssembly),this.structure.signals.refreshed.add((()=>{this.updateRepresentations({position:!0})}))}get defaultParameters(){return PA}get type(){return"structure"}initSelection(e){this.selection=new Kf(e),this.structureView=new xA(this.structure,this.selection),this.selection.signals.stringChanged.add((()=>{this.structureView.setSelection(this.selection),this.rebuildRepresentations(),this.rebuildTrajectories()}))}setSelection(e){return this.parameters.sele=e,this.selection.setString(e),this}setDefaultAssembly(e){if(void 0===this.structure.biomolDict[e]&&(e=""),this.parameters.defaultAssembly!==e){const t={defaultAssembly:e};this.reprList.forEach((e=>e.setParameters(t))),this.measureRepresentations.setParameters(t),this.parameters.defaultAssembly=e,this.signals.defaultAssemblyChanged.dispatch(e)}return this}rebuildRepresentations(){this.reprList.forEach((e=>{e.build()})),this.measureRepresentations.build()}rebuildTrajectories(){this.trajList.forEach((e=>{e.trajectory.setStructure(this.structureView)}))}updateRepresentations(e){super.updateRepresentations(e),this.measureRepresentations.update(e)}updateRepresentationMatrices(){super.updateRepresentationMatrices(),this.measureRepresentations.setParameters({matrix:this.matrix})}addRepresentation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t.defaultAssembly=this.parameters.defaultAssembly;const i=this._addRepresentation(e,this.structureView,t,n);return n||i.signals.parametersChanged.add((()=>this.measureUpdate())),i}addTrajectory(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=bA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.structureView,e),n=new nA(this.stage,t,e);return this.trajList.push(n),this.signals.trajectoryAdded.dispatch(n),n}removeTrajectory(e){const t=this.trajList.indexOf(e);-1!==t&&this.trajList.splice(t,1),e.dispose(),this.signals.trajectoryRemoved.dispatch(e)}dispose(){this.trajList.slice().forEach((e=>e.dispose())),this.trajList.length=0,this.structure.dispose(),this.measureRepresentations.dispose(),super.dispose()}autoView(e,t){"number"===typeof e&&(t=e,e=""),this.stage.animationControls.zoomMove(this.getCenter(e),this.getZoom(e),bp(t,0))}getBoxUntransformed(e){let t;return t=e?this.structureView.getBoundingBox(new Kf(e)):this.structureView.boundingBox,t}getCenterUntransformed(e){return e&&"string"===typeof e?this.structure.atomCenter(new Kf(e)):this.structure.center}superpose(e,t,n,i){return EA(this.structureView,e.structureView,t,n,i),this.updateRepresentations({position:!0}),this}getMaxRepresentationRadius(e){let t=0;const n=this.structure.getAtomProxy(e);return this.eachRepresentation((e=>{if(e.getVisibility()){const i=e.repr;t=Math.max(i.getAtomRadius(n),t)}})),t}measurePick(e){const t=this.pickBuffer.count;if(this.lastPick===e.index&&t>=1){if(t>1){const e=this.pickBuffer.data,n=this.pickBuffer.data.sort();this.pickDict.has(n)?this.pickDict.del(n):this.pickDict.add(n,e),2===t?this.distanceRepresentation.setParameters({atomPair:this.pickDict.values.filter((e=>2===e.length))}):3===t?this.angleRepresentation.setParameters({atomTriple:this.pickDict.values.filter((e=>3===e.length))}):4===t&&this.dihedralRepresentation.setParameters({atomQuad:this.pickDict.values.filter((e=>4===e.length))})}this.pickBuffer.clear(),this.lastPick=void 0}else this.pickBuffer.has(e.index)||this.pickBuffer.push(e.index),this.lastPick=e.index;this.measureUpdate()}measureClear(){this.pickBuffer.clear(),this.lastPick=void 0,this.spacefillRepresentation.setSelection("none")}measureBuild(){const e=this.measureData();this.distanceRepresentation.setParameters({atomPair:e.distance}),this.angleRepresentation.setParameters({atomTriple:e.angle}),this.dihedralRepresentation.setParameters({atomQuad:e.dihedral})}measureUpdate(){const e=this.pickBuffer.data,t={};e.forEach((e=>{const n=Math.max(.1,this.getMaxRepresentationRadius(e));t[e]=n*(2.3-hf(.1,2,n))})),this.spacefillRepresentation.setSelection(e.length?"@"+e.join(","):"none"),e.length&&this.spacefillRepresentation.setParameters({radiusData:t})}measureData(){const e=this.pickDict.values;return{distance:e.filter((e=>2===e.length)),angle:e.filter((e=>3===e.length)),dihedral:e.filter((e=>4===e.length))}}removeAllMeasurements(e){const t=this.pickDict,n=t.values,i=function(e){n.filter((t=>t.length===e)).forEach((e=>t.del(e.slice().sort())))};(!e||1&e)&&i(2),(!e||2&e)&&i(3),(!e||4&e)&&i(4),this.measureBuild()}removeMeasurement(e){this.pickDict.del(e.slice().sort()),this.measureBuild()}addMeasurement(e){if(e.length<2||e.length>4)return;const t=e.slice().sort();this.pickDict.has(t)||this.pickDict.add(t,e),this.measureBuild()}}Pm.add("structure",IA),Pm.add("structureview",IA);class LA extends QM{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(e,t,Object.assign({name:t.name},n)),this.surface=t}get type(){return"surface"}addRepresentation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._addRepresentation(e,this.surface,t)}getBoxUntransformed(){return this.surface.boundingBox}getCenterUntransformed(){return this.surface.center}dispose(){this.surface.dispose(),super.dispose()}}Pm.add("surface",LA);class RA extends QM{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(e,t,Object.assign({name:t.name},n)),this.volume=t}get type(){return"volume"}addRepresentation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._addRepresentation(e,this.volume,t)}getBoxUntransformed(){return this.volume.boundingBox}getCenterUntransformed(){return this.volume.center}dispose(){this.volume.dispose(),super.dispose()}}Pm.add("volume",RA);class kA extends JM{addRepresentation(e,t){return this.forEach((n=>n.addRepresentation(e,t)))}autoView(e){return this.forEach((t=>t.autoView(e)))}}function DA(e,t){return e instanceof RegExp?null!==t.name.match(e):t.name===e}const OA=new mn,NA={impostor:!0,quality:"medium",workerDefault:!0,sampleLevel:0,backgroundColor:"black",rotateSpeed:2,zoomSpeed:1.2,panSpeed:1,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",fogNear:50,fogFar:100,cameraFov:40,cameraEyeSep:.3,cameraType:"perspective",lightColor:14540253,lightIntensity:1,ambientColor:14540253,ambientIntensity:.2,hoverTimeout:0,tooltip:!0,mousePreset:"default"};class BA{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.signals={parametersChanged:new Sf.Signal,fullscreenChanged:new Sf.Signal,componentAdded:new Sf.Signal,componentRemoved:new Sf.Signal,clicked:new Sf.Signal,hovered:new Sf.Signal},this.tasks=new ig,this.compList=[],this.defaultFileParams={},this.logList=[],this.viewer=new iy(e),this.viewer.renderer&&(this.tooltip=document.createElement("div"),Object.assign(this.tooltip.style,{display:"none",position:"fixed",zIndex:"1000000",pointerEvents:"none",backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.viewer.container.appendChild(this.tooltip),this.mouseObserver=new cy(this.viewer.renderer.domElement),this.viewerControls=new Dy(this),this.trackballControls=new wy(this),this.pickingControls=new Ay(this),this.animationControls=new jy(this),this.mouseControls=new L_(this),this.keyControls=new D_(this),this.pickingBehavior=new O_(this),this.mouseBehavior=new N_(this),this.animationBehavior=new B_(this),this.keyBehavior=new z_(this),this.spinAnimation=this.animationControls.spin([0,1,0],.005),this.spinAnimation.pause(!0),this.rockAnimation=this.animationControls.rock([0,1,0],.005),this.rockAnimation.pause(!0),this.parameters=xp(t,NA),this.setParameters(this.parameters),this.viewer.animate())}setParameters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};wp(this.parameters,e);const t=e,n=this.parameters,i=this.viewer,r=this.trackballControls;return void 0!==t.quality&&this.setQuality(n.quality),void 0!==t.impostor&&this.setImpostor(n.impostor),void 0!==t.rotateSpeed&&(r.rotateSpeed=n.rotateSpeed),void 0!==t.zoomSpeed&&(r.zoomSpeed=n.zoomSpeed),void 0!==t.panSpeed&&(r.panSpeed=n.panSpeed),void 0!==t.mousePreset&&this.mouseControls.preset(n.mousePreset),this.mouseObserver.setParameters({hoverTimeout:n.hoverTimeout}),i.setClip(n.clipNear,n.clipFar,n.clipDist,n.clipMode,n.clipScale),i.setFog(void 0,n.fogNear,n.fogFar),i.setCamera(n.cameraType,n.cameraFov,n.cameraEyeSep),i.setSampling(n.sampleLevel),i.setBackground(n.backgroundColor),i.setLight(n.lightColor,n.lightIntensity,n.ambientColor,n.ambientIntensity),this.signals.parametersChanged.dispatch(this.getParameters()),this}log(e){console.log("STAGE LOG",e),this.logList.push(e)}getParameters(){return Object.assign({},this.parameters)}defaultFileRepresentation(t){if(t instanceof IA){let n,i,r;t.setSelection("/0");const o=t.structure;if(o.biomolDict.BU1){const e=o.biomolDict.BU1;n=e.getAtomCount(o),i=e.getResidueCount(o),r=e.getInstanceCount(),t.setDefaultAssembly("BU1")}else n=o.getModelProxy(0).atomCount,i=o.getModelProxy(0).residueCount,r=1;let s=n;hm&&(s*=4);const a=o.atomStore.count/o.residueStore.count<2;a&&(s*=10);let l="chainname",c="RdYlBu",u=!1;if(1===o.getChainnameCount(new Kf("polymer and /0"))&&(l="residueindex",c="Spectral",u=!0),e.Debug&&console.log(s,n,r,a),i/r<4)t.addRepresentation("ball+stick",{colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"});else if(r>5&&s>15e3||s>7e5){let e=Math.min(2,Math.max(.1,6e3/(s/r)));a&&(e=Math.min(e,.5)),t.addRepresentation("surface",{colorScheme:l,colorScale:c,colorReverse:u,sele:"polymer",surfaceType:"av",probeRadius:1.4,scaleFactor:e,useWorker:!1})}else s>25e4?t.addRepresentation("backbone",{colorScheme:l,colorScale:c,colorReverse:u,lineOnly:!0}):s>1e5?t.addRepresentation("backbone",{colorScheme:l,colorScale:c,colorReverse:u,quality:"low",disableImpostor:!0,radiusScale:2}):s>8e4?t.addRepresentation("backbone",{colorScheme:l,colorScale:c,colorReverse:u,radiusScale:2}):(t.addRepresentation("cartoon",{colorScheme:l,colorScale:c,colorReverse:u,radiusScale:.7,aspectRatio:5,quality:"auto"}),s<5e4&&t.addRepresentation("base",{colorScheme:l,colorScale:c,colorReverse:u,quality:"auto"}),t.addRepresentation("ball+stick",{sele:"ligand",colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"}));t.structure.frames.length&&t.addTrajectory()}else(t instanceof LA||t instanceof RA)&&t.addRepresentation("surface");this.tasks.onZeroOnce(this.autoView,this)}loadFile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Object.assign({},this.defaultFileParams,t),i=Hm(e).name;this.tasks.increment(),this.log("loading file '".concat(i,"'"));const r=e=>{this.log("loaded '".concat(i,"'"));const t=this.addComponentFromObject(e,n);return n.defaultRepresentation&&this.defaultFileRepresentation(t),this.tasks.decrement(),t},o=e=>{this.tasks.decrement();const t="error loading file: '".concat(e,"'");throw this.log(t),t},s=bp(n.ext,Hm(e).ext);let a;return a=Cm.isTrajectory(s)?Promise.reject(new Error("loadFile: ext '".concat(s,"' is a trajectory and must be loaded into a structure component"))):Vm(e,n),a.then(r,o)}loadScript(e){const t=Hm(e).name;return this.log("loading script '".concat(t,"'")),Vm(e).then((e=>{this.tasks.increment(),this.log("running script '".concat(t,"'")),e.run(this).then((()=>{this.tasks.decrement(),this.log("finished script '".concat(t,"'"))})),this.log("called script '".concat(t,"'"))}),(e=>{this.tasks.decrement();const n="errored script '".concat(t,"' \"").concat(e,'"');throw this.log(n),n}))}addComponent(e){e?(this.compList.push(e),this.signals.componentAdded.dispatch(e)):gm.warn("Stage.addComponent: no component given")}addComponentFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Pm.get(e.type);if(n){const i=new n(this,e,t);return this.addComponent(i),i}gm.warn("no component for object type",e.type)}removeComponent(e){const t=this.compList.indexOf(e);-1!==t&&(this.compList.splice(t,1),e.dispose(),this.signals.componentRemoved.dispatch(e))}removeAllComponents(){this.compList.slice().forEach((e=>this.removeComponent(e)))}handleResize(){this.viewer.handleResize()}setSize(e,t){const n=this.viewer.container;n!==document.body&&(void 0!==e&&(n.style.width=e),void 0!==t&&(n.style.height=t),this.handleResize())}toggleFullscreen(e){if(!document.fullscreenEnabled&&!document.mozFullScreenEnabled&&!document.webkitFullscreenEnabled&&!document.msFullscreenEnabled)return void gm.log("fullscreen mode (currently) not possible");const t=this;function n(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function i(){if(!n()&&t.lastFullscreenElement){const e=t.lastFullscreenElement;e.style.width=e.dataset.normalWidth||"",e.style.height=e.dataset.normalHeight||"",document.removeEventListener("fullscreenchange",i),document.removeEventListener("mozfullscreenchange",i),document.removeEventListener("webkitfullscreenchange",i),document.removeEventListener("MSFullscreenChange",i),t.handleResize(),t.signals.fullscreenChanged.dispatch(!1)}}e=e||this.viewer.container,this.lastFullscreenElement=e,n()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(e.dataset.normalWidth=e.style.width||"",e.dataset.normalHeight=e.style.height||"",e.style.width=window.screen.width+"px",e.style.height=window.screen.height+"px",e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),document.addEventListener("fullscreenchange",i),document.addEventListener("mozfullscreenchange",i),document.addEventListener("webkitfullscreenchange",i),document.addEventListener("MSFullscreenChange",i),this.handleResize(),this.signals.fullscreenChanged.dispatch(!0),setTimeout((function(){t.handleResize()}),100))}setSpin(e){e?(this.spinAnimation.resume(!0),this.rockAnimation.pause(!0)):this.spinAnimation.pause(!0)}setRock(e){e?(this.rockAnimation.resume(!0),this.spinAnimation.pause(!0)):this.rockAnimation.pause(!0)}toggleSpin(){this.setSpin(this.spinAnimation.paused)}toggleRock(){this.setRock(this.rockAnimation.paused)}getFocus(){const e=this.parameters;if("scene"!==e.clipMode)return 0;let t=e.clipNear;return"absolute"===e.clipScale&&(t=this.viewer.absoluteToRelative(t)),2*t}setFocus(e){if("scene"!==this.parameters.clipMode)return;let t,n,i,r;"relative"===this.parameters.clipScale?(t=sf(e/2,0,49.9),n=100-t,i=50,r=af(2*n-50)):(t=this.viewer.relativeToAbsolute(e/2),n=t,i=0,r=2*n),this.setParameters({clipNear:t,clipFar:n,fogNear:i,fogFar:r})}getZoomForBox(e){const t=e.getSize(OA),n=Math.max(t.x,t.y,t.z),i=Math.min(t.x,t.y,t.z);let r=n+Math.sqrt(i);const o=Qp(this.viewer.perspectiveCamera.fov),s=this.viewer.width,a=this.viewer.height,l=a<s?1:s/a;return r=Math.abs(.5*r/l/Math.sin(o/2)),r+=this.parameters.clipDist,-r}getBox(){return this.viewer.boundingBox}getZoom(){return this.getZoomForBox(this.getBox())}getCenter(e){return this.getBox().getCenter(e||new mn)}autoView(e){this.animationControls.zoomMove(this.getCenter(),this.getZoom(),bp(e,0))}makeImage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(((t,n)=>{this.tasks.onZeroOnce((()=>{this.tasks.increment(),this.viewer.makeImage(e).then((e=>{this.tasks.decrement(),t(e)})).catch((e=>{this.tasks.decrement(),n(e)}))}))}))}setImpostor(e){this.parameters.impostor=e;const t=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation((function(n){if(!t.includes(n.getType()))return;const i=n.getParameters();i.disableImpostor=!e,n.build(i)}))}setQuality(e){this.parameters.quality=e;const t=["tube","cartoon","ribbon","trace","rope"],n=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation((function(i){const r=i.getParameters();if(!t.includes(i.getType())){if(!n.includes(i.getType()))return;if(!r.disableImpostor)return void(i.repr.quality=e)}r.quality=e,i.build(r)}))}eachComponent(e,t){this.compList.slice().forEach((n=>{void 0!==t&&t!==n.type||e(n)}))}eachRepresentation(e,t){this.eachComponent((n=>{n.reprList.slice().forEach((i=>{void 0!==t&&t!==i.getType()||e(i,n)}))}))}getComponentsByName(e){const t=[];return this.eachComponent((n=>{(void 0===e||DA(e,n))&&t.push(n)})),new kA(t)}getComponentsByObject(e){const t=[];return this.eachComponent((n=>{n.object===e&&t.push(n)})),new kA(t)}getRepresentationsByName(e){const t=[];return this.eachRepresentation(((n,i)=>{(void 0===e||DA(e,n))&&t.push(n)})),new eA(t)}measureClear(){this.eachComponent((e=>e.measureClear()),"structure")}measureUpdate(){this.eachComponent((e=>e.measureUpdate()),"structure")}dispose(){this.tasks.dispose(),this.viewer.dispose(),this.mouseObserver.dispose()}}class FA extends QM{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(e,t,Object.assign({name:t.name},n)),this.shape=t}get type(){return"shape"}addRepresentation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._addRepresentation(e,this.shape,t)}getBoxUntransformed(){return this.shape.boundingBox}getCenterUntransformed(){return this.shape.center}dispose(){this.shape.dispose(),super.dispose()}}function zA(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}Pm.add("shape",FA);class UA extends wf{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=bp(e.reverse,!0)),this.scalePerModel={},e.structure.eachModel((e=>{this.parameters.domain=[e.atomOffset,e.atomEnd],this.scalePerModel[e.index]=this.getScale()}))}atomColor(e){return this.scalePerModel[e.modelIndex](e.index)}}zA([xf],UA.prototype,"atomColor",null),Sm.add("atomindex",UA);class HA extends wf{constructor(e){if(super(e),e.scale||(this.parameters.scale="OrRd"),!e.domain){let t,n=1/0,i=-1/0;e.sele&&(t=new Kf(e.sele)),e.structure.eachAtom((function(e){const t=e.bfactor;n=Math.min(n,t),i=Math.max(i,t)}),t),this.parameters.domain=[n,i]}this.bfactorScale=this.getScale()}atomColor(e){return this.bfactorScale(e.bfactor)}}zA([xf],HA.prototype,"atomColor",null),Sm.add("bfactor",HA);class GA extends wf{constructor(e){super(e),this.chainidDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((e=>{let t=0;const n={};e.eachChain((function(e){void 0===n[e.chainid]&&(n[e.chainid]=t,t+=1)})),this.parameters.domain=[0,t-1],this.chainidDictPerModel[e.index]=n,this.scalePerModel[e.index]=this.getScale()}))}atomColor(e){const t=this.chainidDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainid])}}zA([xf],GA.prototype,"atomColor",null),Sm.add("chainid",GA);class VA extends wf{constructor(e){super(e),this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((e=>{this.parameters.domain=[e.chainOffset,e.chainEnd],this.scalePerModel[e.index]=this.getScale()}))}atomColor(e){return this.scalePerModel[e.modelIndex](e.chainIndex)}}zA([xf],VA.prototype,"atomColor",null),Sm.add("chainindex",VA);class jA extends wf{constructor(e){super(e),this.chainnameDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((e=>{let t=0;const n={};e.eachChain((function(e){void 0===n[e.chainname]&&(n[e.chainname]=t,t+=1)})),this.parameters.domain=[0,t-1],this.chainnameDictPerModel[e.index]=n,this.scalePerModel[e.index]=this.getScale()}))}atomColor(e){const t=this.chainnameDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainname])}}zA([xf],jA.prototype,"atomColor",null),Sm.add("chainname",jA);class $A extends wf{constructor(e){super(e),this.rsrzDict={},this.rsccDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rsrzScale=this.getScale({domain:[2,0]}),this.rsccScale=this.getScale({domain:[.678,1]});const t=e.structure.validation;t&&(this.rsrzDict=t.rsrzDict,this.rsccDict=t.rsccDict)}atomColor(e){let t=e.resno+"";e.inscode&&(t+="^"+e.inscode),e.chainname&&(t+=":"+e.chainname),t+="/"+e.modelIndex;const n=this.rsrzDict[t];if(void 0!==n)return this.rsrzScale(n);const i=this.rsccDict[t];return void 0!==i?this.rsccScale(i):9474192}}zA([xf],$A.prototype,"atomColor",null),Sm.add("densityfit",$A);const WA={ARG:{CD:.1,CZ:.5,NE:-.1},ASN:{CG:.55,OD1:-.55},ASP:{CB:-.16,CG:.36,OD1:-.6,OD2:-.6},CYS:{CB:.19,SG:-.19},GLN:{CD:.55,OE1:-.55},GLU:{CD:.36,CG:-.16,OE1:-.6,OE2:-.6},HIS:{CB:.1,CD2:.2,CE1:.45,CG:.15,ND1:.05,NE2:.05},LYS:{CE:.25,NZ:.75},MET:{CE:.06,CG:.06,SD:-.12},PTR:{C:.55,CA:.1,CZ:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SEP:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SER:{CB:.25,OG:-.25},THR:{CB:.25,OG1:-.25},TPO:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,OG1:-1.1,O1P:-.85,O2P:-.85,O3P:-.85,P:1.4},TRP:{CD1:.06,CD2:.1,CE2:-.04,CE3:-.03,CG:-.03,NE1:-.06},TYR:{CZ:.25,OH:-.25},backbone:{C:.55,O:-.55,N:-.35,CA:.1}},qA=12,XA=1.04,YA=.25;function ZA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mn,n=!1,i=!1,r=!1;return t.set(2*e.x,2*e.y,2*e.z),e.eachBondedAtom((function(e){if(!n)return"H"===e.atomname?(t.set(e.x,e.y,e.z),void(n=!0)):void(i||"CA"!==e.atomname?r||"C"!==e.atomname||(r=!0,t.sub(e)):(t.sub(e),i=!0))})),n?t:i&&r?(t.normalize(),t.multiplyScalar(XA),t.add(e),t):void 0}function KA(e){const t=e.length,n=new Float32Array(t),i=new Float32Array(t),r=new Float32Array(t);for(let o=0;o<e.length;o++){const t=e[o];n[o]=t.x,i[o]=t.y,r[o]=t.z}return{x:n,y:i,z:r,count:t}}function QA(e){return null!==e.partialCharge?e.partialCharge:e.isProtein()&&(WA[e.resname]&&WA[e.resname][e.atomname]||WA.backbone[e.atomname])||0}class JA extends wf{constructor(e){super(e),this.delta=new mn,this.hCharges=[],e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-50,50]),this.scale=this.getScale(),this.charges=new Float32Array(e.structure.atomCount);const t=[];e.structure.eachAtom((e=>{if(this.charges[e.index]=QA(e)*e.occupancy,"N"===e.atomname){if(e.bondCount>=3)return;if(e.bondToElementCount(1))return;const n=ZA(e);void 0!==n&&(t.push(n),this.hCharges.push(YA*e.occupancy))}}));const n=e.structure.getBoundingBox();n.expandByScalar(XA),this.hStore=KA(t),this.hHash=new Fv(this.hStore,n),this.hash=new Fv(e.structure.atomStore,n)}positionColor(e){const t=this.charges,n=this.hCharges;let i=0;return this.hash.eachWithin(e.x,e.y,e.z,qA,((e,n)=>{const r=t[e];0!==r&&(i+=r/n)})),this.hHash.eachWithin(e.x,e.y,e.z,qA,((e,t)=>{const r=n[e];0!==r&&(i+=r/t)})),this.scale(332*i)}}zA([xf],JA.prototype,"positionColor",null),Sm.add("electrostatic",JA);const eC={H:16777215,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215,D:16777152,T:16777120},tC=16777215;class nC extends wf{constructor(e){e.value=bp(e.value,eC.C),super(e)}atomColor(e){const t=e.element;return"C"===t?this.parameters.value:eC[t]||tC}}zA([xf],nC.prototype,"atomColor",null),Sm.add("element",nC);class iC extends wf{constructor(e){super(e),e.scale||(this.parameters.scale="Spectral"),e.domain||(this.parameters.domain=[0,e.structure.entityList.length-1]),this.entityindexScale=this.getScale()}atomColor(e){return this.entityindexScale(e.entityIndex)}}zA([xf],iC.prototype,"atomColor",null),Sm.add("entityindex",iC);class rC extends wf{atomColor(e){const t=e.entity;switch(t?t.entityType:void 0){case Yv:return 8374655;case Zv:return 16629894;case Kv:return 12496596;case Qv:return 3697840;default:return 16777113}}}zA([xf],rC.prototype,"atomColor",null),Sm.add("entitytype",rC);class oC extends wf{constructor(e){super(e),this.geoAtomDict={},this.geoDict={};const t=e.structure.validation;t&&(this.geoAtomDict=t.geoAtomDict,this.geoDict=t.geoDict)}atomColor(e){let t,n=e.resno+"";e.inscode&&(n+="^"+e.inscode),e.chainname&&(n+=":"+e.chainname),n+="/"+e.modelIndex;const i=this.geoAtomDict[n];return t=void 0!==i?rf(i[e.atomname]||0):this.geoDict[n]||0,0===t?2188972:1===t?16703627:2===t?16018755:t>=3?10813478:9474192}}zA([xf],oC.prototype,"atomColor",null),Sm.add("geoquality",oC);class sC extends wf{constructor(e){super(e),this.resHF={},e.scale||(this.parameters.scale="RdYlGn");const t=0;for(const n in Lb)this.resHF[n]=Lb[n][t];if(this.defaultResidueHydrophobicity=Rb[t],!e.domain){let e=1/0,t=-1/0;for(const n in this.resHF){const i=this.resHF[n];e=Math.min(e,i),t=Math.max(t,i)}this.parameters.domain=[e,0,t]}this.hfScale=this.getScale()}atomColor(e){return this.hfScale(this.resHF[e.resname]||this.defaultResidueHydrophobicity)}}zA([xf],sC.prototype,"atomColor",null),Sm.add("hydrophobicity",sC);class aC extends wf{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow"),e.domain||(this.parameters.domain=[0,e.structure.modelStore.count]),this.modelindexScale=this.getScale()}atomColor(e){return this.modelindexScale(e.modelIndex)}}zA([xf],aC.prototype,"atomColor",null),Sm.add("modelindex",aC);class lC extends wf{atomColor(e){switch(e.residueType.moleculeType){case eb:return 3697840;case tb:return 15729279;case nb:return 12496596;case ib:return 16629894;case rb:return 12540695;case ob:return 8374655;default:return 16777113}}}zA([xf],lC.prototype,"atomColor",null),Sm.add("moleculetype",lC);class cC extends wf{constructor(e){super(e),e.scale||(this.parameters.scale="PuBu"),e.domain||(this.parameters.domain=[0,1]),this.occupancyScale=this.getScale()}atomColor(e){return this.occupancyScale(e.occupancy)}}zA([xf],cC.prototype,"atomColor",null),Sm.add("occupancy",cC);class uC extends wf{constructor(e){super(e),e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-1,1]),this.partialchargeScale=this.getScale()}atomColor(e){return this.partialchargeScale(e.partialCharge||0)}}function hC(){return 16777215*Math.random()}zA([xf],uC.prototype,"atomColor",null),Sm.add("partialcharge",uC);class dC extends wf{atomColor(){return hC()}volumeColor(){return hC()}positionColor(){return hC()}}zA([xf],dC.prototype,"atomColor",null),zA([xf],dC.prototype,"volumeColor",null),zA([xf],dC.prototype,"positionColor",null),Sm.add("random",dC);class pC extends wf{constructor(e){super(e),this.rciDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rciScale=this.getScale({domain:[.6,0]});const t=e.structure.validation;t&&(this.rciDict=t.rciDict)}atomColor(e){let t="[".concat(e.resname,"]").concat(e.resno);e.chainname&&(t+=":"+e.chainname);const n=this.rciDict[t];return void 0!==n?this.rciScale(n):9474192}}zA([xf],pC.prototype,"atomColor",null),Sm.add("randomcoilindex",pC);class fC extends wf{constructor(e){super(e),this.scalePerChain={},e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=bp(e.reverse,!0)),e.structure.eachChain((e=>{this.parameters.domain=[e.residueOffset,e.residueEnd],this.scalePerChain[e.index]=this.getScale()}))}atomColor(e){return this.scalePerChain[e.chainIndex](e.residueIndex)}}zA([xf],fC.prototype,"atomColor",null),Sm.add("residueindex",fC);const mC={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935,ASH:16711935,GLH:16711935,A:14423100,G:3329330,I:10145074,X:8190976,C:16766720,T:4286945,U:4251856,D:35723,DA:14423100,DG:3329330,DI:10145074,DX:8190976,DC:16766720,DT:4286945,DU:4251856,DD:35723},gC=16711935;class yC extends wf{atomColor(e){return mC[e.resname]||gC}}zA([xf],yC.prototype,"atomColor",null),Sm.add("resname",yC);const vC={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaStrand:16762880,betaTurn:6324479,coil:16777215,dna:11403518,rna:16580962,carbohydrate:10921722},bC=8421504;class xC extends wf{constructor(e){super(e),this.residueProxy=e.structure.getResidueProxy()}atomColor(e){const t=e.sstruc,n=this.residueProxy;return"h"===t?vC.alphaHelix:"g"===t?vC.threeTenHelix:"i"===t?vC.piHelix:"e"===t||"b"===t?vC.betaStrand:"t"===t?vC.betaTurn:(n.index=e.residueIndex,n.isDna()?vC.dna:n.isRna()?vC.rna:n.isSaccharide()?vC.carbohydrate:n.isProtein()||"s"===t||"l"===t?vC.coil:bC)}}zA([xf],xC.prototype,"atomColor",null),Sm.add("sstruc",xC);class wC extends wf{constructor(e){var t,n;super(e),e.scale||(this.parameters.scale="rwb"),this.atomData=null===(t=this.parameters.data)||void 0===t?void 0:t.atomData,this.bondData=null===(n=this.parameters.data)||void 0===n?void 0:n.bondData,this.scale=this.getScale(this.parameters)}atomColor(e){var t;const n=null===(t=this.atomData)||void 0===t?void 0:t[e.index];return void 0!==n?this.scale(n):this.parameters.value}bondColor(e,t){var n;const i=null===(n=this.bondData)||void 0===n?void 0:n[e.index];return void 0!==i?this.scale(i):this.atomProxy?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):this.parameters.value}}zA([xf],wC.prototype,"atomColor",null),zA([xf],wC.prototype,"bondColor",null),Sm.add("structuredata",wC);class _C extends wf{atomColor(){return this.parameters.value}bondColor(){return this.parameters.value}valueColor(){return this.parameters.value}volumeColor(){return this.parameters.value}}zA([xf],_C.prototype,"atomColor",null),zA([xf],_C.prototype,"bondColor",null),zA([xf],_C.prototype,"valueColor",null),zA([xf],_C.prototype,"volumeColor",null),Sm.add("uniform",_C);class SC extends wf{constructor(e){super(e),this.valueScale=this.getScale()}volumeColor(e){return this.valueScale(this.parameters.volume.data[e])}}zA([xf],SC.prototype,"volumeColor",null),Sm.add("value",SC);class MC extends wf{constructor(e){super(e),this.vec=new mn,this.valueScale=this.getScale()}positionColor(e){const t=this.parameters.volume;if(!t||!t.inverseMatrix)return this.parameters.value;const n=this.vec,i=t.data,r=t.nx,o=t.ny,s=r*o;n.copy(e),n.applyMatrix4(t.inverseMatrix);const a=Math.floor(n.x),l=Math.floor(n.y),c=Math.floor(n.z),u=(c*o+l)*r+a,h=u+1,d=u+r,p=u+s,f=d+1,m=p+1,g=d+s,y=g+1,v=i[u],b=i[h],x=i[d],w=i[p],_=i[f],S=i[m],M=i[g],A=i[y],C=n.x-a,T=n.y-l,E=n.z-c,P=cf(v,b,C),I=cf(w,S,C),L=cf(x,_,C),R=cf(M,A,C),k=cf(P,L,T),D=cf(I,R,T),O=cf(k,D,E);return this.valueScale(O)}}zA([xf],MC.prototype,"positionColor",null),Sm.add("volume",MC);class AC extends Wy{constructor(e,t,n){const i=n||{};if(super(e,t,i),this.type="structure",this.parameters=Object.assign({radiusType:{type:"select",options:W_.types},radiusData:{type:"hidden"},radiusSize:{type:"number",precision:3,max:10,min:.001},radiusScale:{type:"number",precision:3,max:10,min:.001},assembly:null,defaultAssembly:{type:"hidden"}},this.parameters),this.selection=new Kf(i.sele),this.dataList=[],this.structure=e,this.structureView=this.structure.getView(this.selection),e.biomolDict){const t={default:"default","":e.unitcell?"AU":"FULL"};Object.keys(e.biomolDict).forEach((function(e){t[e]=e})),this.parameters.assembly={type:"select",options:t,rebuild:!0}}else this.parameters.assembly=null}get defaultScale(){return{vdw:1,covalent:1,bfactor:.01,sstruc:1}}init(e){const t=e||{};t.colorScheme=bp(t.colorScheme,"element"),this.setRadius(t.radius,t),this.radiusType=bp(t.radiusType,"vdw"),this.radiusData=bp(t.radiusData,{}),this.radiusSize=bp(t.radiusSize,1),this.radiusScale=bp(t.radiusScale,1),this.assembly=bp(t.assembly,"default"),this.defaultAssembly=bp(t.defaultAssembly,""),"auto"===t.quality&&(t.quality=this.getQuality()),super.init(t),this.selection.signals.stringChanged.add((()=>{this.build()})),this.build()}setRadius(e,t){const n=Object.keys($_);return"string"===typeof e&&n.includes(e.toLowerCase())?t.radiusType=e:void 0!==e&&(t.radiusType="size",t.radiusSize=e),this}getAssembly(){const e="default"===this.assembly?this.defaultAssembly:this.assembly;return this.structure.biomolDict[e]}getQuality(){let e;const t=this.structureView,n=this.getAssembly();return e=n?n.getAtomCount(t):t.atomCount,hm&&(e*=4),t.atomStore.count/t.residueStore.count<2&&(e*=10),e<15e3?"high":e<8e4?"medium":"low"}create(){if(0===this.structureView.atomCount)return;if(!this.structureView.hasCoords())return void(this.needsBuild=!0);this.needsBuild=!1;const e=this.getAssembly();if(e)e.partList.forEach(((e,t)=>{const n=e.getView(this.structureView);if(0===n.atomCount)return;const i=this.createData(n,t);i&&(i.sview=n,i.instanceList=e.getInstanceList(),this.dataList.push(i))}));else{const e=this.createData(this.structureView,0);e&&(e.sview=this.structureView,this.dataList.push(e))}}update(e){!this.lazy||this.visible?this.needsBuild?this.build():this.dataList.forEach((t=>{t.bufferList.length>0&&this.updateData(e,t)}),this):Object.assign(this.lazyProps.what,e)}updateData(e,t){this.build()}getColorParams(){return Object.assign(Object.assign({},super.getColorParams()),{structure:this.structure})}getRadiusParams(e){return{type:this.radiusType,scale:this.radiusScale,size:this.radiusSize,data:this.radiusData}}getAtomParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getBondParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getAtomRadius(e){return this.structureView.atomSet.isSet(e.index)?new W_(this.getRadiusParams()).atomRadius(e):0}setSelection(e,t){return this.selection.setString(e,t),this}setParameters(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=e||{};return this.setRadius(i.radius,i),void 0===i.radiusType&&void 0===i.radiusData&&void 0===i.radiusSize&&void 0===i.radiusScale||(t.radius=!0,fm&&!this.disableImpostor||(n=!0)),void 0!==i.defaultAssembly&&i.defaultAssembly!==this.defaultAssembly&&("default"===this.assembly&&void 0===i.assembly||"default"===i.assembly)&&(n=!0),super.setParameters(i,t,n),this}getParameters(){return Object.assign(super.getParameters(),{sele:this.selection?this.selection.string:void 0,defaultAssembly:this.defaultAssembly})}attach(e){const t=this.viewer,n=this.bufferList;this.dataList.forEach((function(e){e.bufferList.forEach((function(i){n.push(i),t.add(i,e.instanceList)}))})),this.setVisibility(this.visible),e()}clear(){this.dataList.length=0,super.clear()}dispose(){this.structureView.dispose(),super.dispose()}}class CC extends AC{constructor(e,t,n){super(e,t,n),this.n=0,this.parameters=Object.assign({labelVisible:{type:"boolean"},labelSize:{type:"number",precision:3,max:10,min:.001},labelColor:{type:"color"},labelFontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:"fontFamily"},labelFontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:"fontStyle"},labelFontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:"fontWeight"},labelsdf:{type:"boolean",buffer:"sdf"},labelXOffset:{type:"number",precision:1,max:20,min:-20,buffer:"xOffset"},labelYOffset:{type:"number",precision:1,max:20,min:-20,buffer:"yOffset"},labelZOffset:{type:"number",precision:1,max:20,min:-20,buffer:"zOffset"},labelAttachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},labelBorder:{type:"boolean",buffer:"showBorder"},labelBorderColor:{type:"color",buffer:"borderColor"},labelBorderWidth:{type:"number",precision:2,max:.3,min:0,buffer:"borderWidth"},labelBackground:{type:"boolean",rebuild:!0},labelBackgroundColor:{type:"color",buffer:"backgroundColor"},labelBackgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},labelBackgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:"backgroundOpacity"},labelFixedSize:{type:"boolean",buffer:"fixedSize"},lineOpacity:{type:"range",min:0,max:1,step:.01},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters,{flatShaded:null})}init(e){const t=e||{};this.labelVisible=bp(t.labelVisible,!0),this.labelSize=bp(t.labelSize,2),this.labelColor=bp(t.labelColor,16777215),this.labelFontFamily=bp(t.labelFontFamily,"sans-serif"),this.labelFontStyle=bp(t.labelFontstyle,"normal"),this.labelFontWeight=bp(t.labelFontWeight,"bold"),this.labelsdf=bp(t.labelsdf,"Chrome"===cm),this.labelXOffset=bp(t.labelXOffset,0),this.labelYOffset=bp(t.labelYOffset,0),this.labelZOffset=bp(t.labelZOffset,.5),this.labelAttachment=bp(t.labelAttachment,"bottom-left"),this.labelBorder=bp(t.labelBorder,!1),this.labelBorderColor=bp(t.labelBorderColor,"lightgrey"),this.labelBorderWidth=bp(t.labelBorderWidth,.15),this.labelBackground=bp(t.labelBackground,!1),this.labelBackgroundColor=bp(t.labelBackgroundColor,"lightgrey"),this.labelBackgroundMargin=bp(t.labelBackgroundMargin,.5),this.labelBackgroundOpacity=bp(t.labelBackgroundOpacity,1),this.labelFixedSize=bp(t.labelFixedSize,!1),this.lineOpacity=bp(t.lineOpacity,1),this.linewidth=bp(t.linewidth,2),super.init(t)}update(e){e.position?this.build():super.update(e)}updateData(e,t){const n={};if(e&&!e.labelSize||Object.assign(n,{size:gg(this.n,this.labelSize)}),!e||e.labelColor){const e=new Ri(this.labelColor);Object.assign(n,{color:yg(this.n,e.r,e.g,e.b)})}this.textBuffer.setAttributes(n)}setParameters(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e&&e.labelSize&&(t.labelSize=!0),e&&(e.labelColor||0===e.labelColor)&&(t.labelColor=!0,n=!0),super.setParameters(e,t,n),e&&void 0!==e.opacity&&this.textBuffer.setParameters({opacity:1}),e&&void 0!==e.labelVisible&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.textBuffer&&this.textBuffer.setVisibility(this.labelVisible&&this.visible),t||this.viewer.requestRender(),this}getLabelBufferParams(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.getBufferParams(Object.assign({fontFamily:this.labelFontFamily,fontStyle:this.labelFontStyle,fontWeight:this.labelFontWeight,sdf:this.labelsdf,xOffset:this.labelXOffset,yOffset:this.labelYOffset,zOffset:this.labelZOffset,attachment:this.labelAttachment,showBorder:this.labelBorder,borderColor:this.labelBorderColor,borderWidth:this.labelBorderWidth,showBackground:this.labelBackground,backgroundColor:this.labelBackgroundColor,backgroundMargin:this.labelBackgroundMargin,backgroundOpacity:this.labelBackgroundOpacity,fixedSize:this.labelFixedSize,disablePicking:!0,visible:this.labelVisible},e,{opacity:1}))}getAtomRadius(){return 0}}function TC(e,t){const n=e.getAtomProxy(),i=new Kf,r=t.length;if(0===r)return new Float32Array(0);const o=t[0].length,s=e.getAtomSet(),a=new Float32Array(r*o*3);let l=0;return t.forEach((function(t){let r=!1;for(let c=0;c<o;c++){const o=t[c];if("number"===typeof o&&Number.isInteger(o)){if(!s.get(o)){r=!0;break}n.index=o}else{i.setString(o);const t=e.getAtomIndices(i);if(!t.length){r=!0;break}n.index=t[0]}let u=l+3*c;a[u++]=n.x,a[u++]=n.y,a[u++]=n.z}r||(l+=3*o)})),a.subarray(0,l)}function EC(e,t,n,i,r){const o=Math.cos(r),s=Math.sin(r);e[0]=t[0]+n[0]*o+i[0]*s,e[1]=t[1]+n[1]*o+i[1]*s,e[2]=t[2]+n[2]*o+i[2]*s}function PC(e,t,n,i,r,o,s){for(let a=0;a<t;a++){for(let r=0;r<n;r++)i[r]=e[r*t+a];IC(i,r,o,s,n);for(let i=0;i<n;i++)e[i*t+a]=r[i]}for(let a=0;a<n;a++){for(let n=0;n<t;n++)i[n]=e[a*t+n];IC(i,r,o,s,t);for(let n=0;n<t;n++)e[a*t+n]=Math.sqrt(r[n])}}function IC(e,t,n,i,r){n[0]=0,i[0]=Number.MIN_SAFE_INTEGER,i[1]=Number.MAX_SAFE_INTEGER;for(let o=1,s=0;o<r;o++){let t=(e[o]+o*o-(e[n[s]]+n[s]*n[s]))/(2*o-2*n[s]);for(;t<=i[s];)s--,t=(e[o]+o*o-(e[n[s]]+n[s]*n[s]))/(2*o-2*n[s]);s++,n[s]=o,i[s]=t,i[s+1]=Number.MAX_SAFE_INTEGER}for(let o=0,s=0;o<r;o++){for(;i[s+1]<o;)s++;t[o]=(o-n[s])*(o-n[s])+e[n[s]]}}Tm.add("shader/SDFFont.vert","uniform float clipNear;\nuniform float clipRadius;\nuniform vec3 clipCenter;\nuniform float xOffset;\nuniform float yOffset;\nuniform float zOffset;\nuniform bool ortho;\nuniform float canvasHeight;\nuniform float pixelRatio;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvarying vec3 vViewPosition;\n#endif\nvarying vec2 texCoord;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\n#endif\nattribute vec2 mapping;\nattribute vec2 inputTexCoord;\nattribute float inputSize;\n#include matrix_scale\n#include common\nvoid main(void){\n#if defined( PICKING )\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#endif\ntexCoord = inputTexCoord;\nfloat scale = matrixScale( modelViewMatrix );\nfloat _xOffset = xOffset * scale;\nfloat _yOffset = yOffset * scale;\nfloat _zOffset = zOffset * scale;\nif( texCoord.x == 10.0 ){\n_zOffset -= 0.001;\n}\nvec4 cameraPos = modelViewMatrix * vec4( position, 1.0 );\n#ifdef FIXED_SIZE\nif ( ortho ) {\nscale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPosition.z) * 0.1;\n} else {\nscale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPos.z) * 0.1;\n}\n#endif\nvec4 cameraCornerPos = vec4( cameraPos.xyz, 1.0 );\ncameraCornerPos.xy += mapping * inputSize * 0.01 * scale;\ncameraCornerPos.x += _xOffset;\ncameraCornerPos.y += _yOffset;\nif( ortho ){\ncameraCornerPos.xyz += normalize( -cameraPosition ) * _zOffset;\n} else {\ncameraCornerPos.xyz += normalize( -cameraCornerPos.xyz ) * _zOffset;\n}\ngl_Position = projectionMatrix * cameraCornerPos;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )\nvViewPosition = -cameraCornerPos.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n#include radiusclip_vertex\n}"),Tm.add("shader/SDFFont.frag","uniform sampler2D fontTexture;\nuniform float opacity;\nuniform bool showBorder;\nuniform vec3 borderColor;\nuniform float borderWidth;\nuniform vec3 backgroundColor;\nuniform float backgroundOpacity;\nuniform float clipNear;\nuniform float clipRadius;\nvarying vec3 vViewPosition;\nvarying vec2 texCoord;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#if defined( PICKING )\nuniform float objectId;\nvarying vec3 vPickingColor;\nconst vec3 vColor = vec3( 0.0 );\n#else\n#include common\n#include color_pars_fragment\n#include fog_pars_fragment\n#endif\nconst float gamma = 2.2 * 1.4142 / 128.0;\nconst float padding = 0.75;\nvoid main(){\n#include nearclip_fragment\n#include radiusclip_fragment\nif( texCoord.x > 1.0 ){\ngl_FragColor = vec4( backgroundColor, backgroundOpacity );\n}else{\nfloat sdf = texture2D( fontTexture, texCoord ).a;\nif( showBorder ) sdf += borderWidth;\nfloat a = smoothstep(padding - gamma, padding + gamma, sdf);\nif( a < 0.2 ) discard;\na *= opacity;\nvec3 outgoingLight = vColor;\nif( showBorder && sdf < ( padding + borderWidth ) ){\noutgoingLight = borderColor;\n}\ngl_FragColor = vec4( outgoingLight, a );\n}\n#if defined( PICKING )\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include encodings_fragment\n#include fog_fragment\n#endif\n}");const LC={};function RC(e){const t=JSON.stringify(e);return void 0===LC[t]&&(LC[t]=new DC(e)),LC[t]}const kC={font:"sans-serif",size:36,style:"normal",variant:"normal",weight:"normal",outline:3,width:1024,height:1024};class DC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.gamma=1,this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.25,this.parameters=xp(e,kC);const t=this.parameters;this.radius=t.size/8,this.padding=t.size/3;const n=this.lineHeight=t.size+2*t.outline+Math.round(t.size/4),i=this.maxWidth=t.width/4,r=this.canvas=document.createElement("canvas");r.width=i,r.height=n;const o=this.context=this.canvas.getContext("2d");o.font="".concat(t.style," ").concat(t.variant," ").concat(t.weight," ").concat(t.size,"px ").concat(t.font),o.fillStyle="black",o.textAlign="left",o.textBaseline="bottom",o.lineJoin="round",this.gridOuter=new Float64Array(n*i),this.gridInner=new Float64Array(n*i),this.f=new Float64Array(Math.max(n,i)),this.d=new Float64Array(Math.max(n,i)),this.z=new Float64Array(Math.max(n,i)+1),this.v=new Int16Array(Math.max(n,i)),this.data=new Uint8Array(t.width*t.height*4),this.canvas2=document.createElement("canvas"),this.canvas2.width=t.width,this.canvas2.height=t.height,this.context2=this.canvas2.getContext("2d"),this.placeholder=this.map(String.fromCharCode(65533));for(let s=32;s<=126;++s)this.map(String.fromCharCode(s));this.map(String.fromCharCode(176)),this.map(String.fromCharCode(8491)),this.texture=new xl(this.canvas2),this.texture.flipY=!1,this.texture.needsUpdate=!0}map(e){const t=this.parameters;return void 0===this.mapped[e]&&(this.draw(e),this.currentX+this.scratchW>t.width&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>t.height&&console.warn("canvas to small"),this.mapped[e]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH},this.context2.drawImage(this.canvas,0,0,this.scratchW,this.scratchH,this.currentX,this.currentY,this.scratchW,this.scratchH),this.currentX+=this.scratchW),this.mapped[e]}get(e){return this.mapped[e]||this.placeholder}draw(e){const t=this.parameters,n=this.lineHeight,i=t.outline,r=this.context,o=this.maxWidth,s=i,a=n-t.outline,l=r.measureText(e),c=Math.min(o,Math.ceil(l.width+2*s+1)),u=c*n;r.clearRect(0,0,c,n),r.fillText(e,s,a);const h=r.getImageData(0,0,c,n),d=h.data;for(let p=0;p<u;p++){const e=h.data[4*p+3]/255;this.gridOuter[p]=1===e?0:0===e?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-e),2),this.gridInner[p]=1===e?Number.MAX_SAFE_INTEGER:0===e?0:Math.pow(Math.max(0,e-.5),2)}PC(this.gridOuter,c,n,this.f,this.d,this.v,this.z),PC(this.gridInner,c,n,this.f,this.d,this.v,this.z);for(let p=0;p<u;p++){const e=this.gridOuter[p]-this.gridInner[p];d[4*p+3]=Math.max(0,Math.min(255,Math.round(255-255*(e/this.radius+this.cutoff))))}r.putImageData(h,0,0),this.scratchW=c,this.scratchH=n}}const OC=Object.assign({fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"bold",fontSize:36,xOffset:0,yOffset:0,zOffset:.5,attachment:"bottom-left",showBorder:!1,borderColor:"lightgrey",borderWidth:.15,showBackground:!1,backgroundColor:"lightgrey",backgroundMargin:.5,backgroundOpacity:1,forceTransparent:!0,fixedSize:!1},v_),NC=Object.assign({fontFamily:{uniform:!0},fontStyle:{uniform:!0},fontWeight:{uniform:!0},fontSize:{uniform:!0},xOffset:{uniform:!0},yOffset:{uniform:!0},zOffset:{uniform:!0},showBorder:{uniform:!0},borderColor:{uniform:!0},borderWidth:{uniform:!0},backgroundColor:{uniform:!0},backgroundOpacity:{uniform:!0},fixedSize:{updateShader:!0}},b_);function BC(e,t){const n=e.position.length/3;let i=0;for(let r=0;r<n;++r)i+=e.text[r].length;return t.showBackground&&(i+=n),i}class FC extends CM{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super({position:new Float32Array(3*BC(e,t)),color:new Float32Array(3*BC(e,t)),picking:new Aw},t),this.parameterTypes=NC,this.alwaysTransparent=!0,this.hasWireframe=!1,this.isText=!0,this.vertexShader="SDFFont.vert",this.fragmentShader="SDFFont.frag",this.text=e.text,this.positionCount=e.position.length/3,this.addUniforms({fontTexture:{value:null},xOffset:{value:this.parameters.xOffset},yOffset:{value:this.parameters.yOffset},zOffset:{value:this.parameters.zOffset},ortho:{value:!1},showBorder:{value:this.parameters.showBorder},borderColor:{value:new Ri(this.parameters.borderColor)},borderWidth:{value:this.parameters.borderWidth},backgroundColor:{value:new Ri(this.parameters.backgroundColor)},backgroundOpacity:{value:this.parameters.backgroundOpacity},canvasHeight:{value:1},pixelRatio:{value:1}}),this.addAttributes({inputTexCoord:{type:"v2",value:null},inputSize:{type:"f",value:null}}),this.setAttributes(e),this.makeTexture(),this.makeMapping()}get defaultParameters(){return OC}makeMaterial(){super.makeMaterial();const e=this.texture,t=this.material;t.transparent=!0,t.extensions.derivatives=!0,t.lights=!1,t.uniforms.fontTexture.value=e,t.needsUpdate=!0;const n=this.wireframeMaterial;n.transparent=!0,n.extensions.derivatives=!0,n.lights=!1,n.uniforms.fontTexture.value=e,n.needsUpdate=!0;const i=this.pickingMaterial;i.extensions.derivatives=!0,i.lights=!1,i.uniforms.fontTexture.value=e,i.needsUpdate=!0}setAttributes(){let e,t,n,i,r,o,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const a=this.text,l=this.geometry.attributes;s.position&&(e=s.position,i=l.position.array,l.position.needsUpdate=!0),s.size&&(t=s.size,r=l.inputSize.array,l.inputSize.needsUpdate=!0),s.color&&(n=s.color,o=l.color.array,l.color.needsUpdate=!0);const c=this.positionCount;let u,h,d,p,f,m=0;for(let g=0;g<c;++g)for(h=3*g,d=a[g],f=d.length,this.parameters.showBackground&&(f+=1),p=0;p<f;++p,++m)for(let s=0;s<4;s++)u=4*m*3+3*s,e&&(i[u]=e[h],i[u+1]=e[h+1],i[u+2]=e[h+2]),t&&(r[4*m+s]=t[g]),n&&(o[u]=n[h],o[u+1]=n[h+1],o[u+2]=n[h+2])}makeTexture(){this.textAtlas=RC({font:this.parameters.fontFamily,style:this.parameters.fontStyle,weight:this.parameters.fontWeight,size:this.parameters.fontSize}),this.texture=this.textAtlas.texture}makeMapping(){const e=this.textAtlas,t=this.text,n=this.parameters.attachment,i=e.lineHeight*this.parameters.backgroundMargin*.1-10,r=this.geometry.attributes,o=r.inputTexCoord.array,s=r.mapping.array,a=this.positionCount;let l,c,u,h,d,p,f,m,g=0;for(let y=0;y<a;++y){for(u=t[y],h=0,p=u.length,d=0;d<p;++d)l=e.get(u[d]),h+=l.w-2*e.parameters.outline;for(m=n.startsWith("top")?e.lineHeight/1.25:n.startsWith("middle")?e.lineHeight/2.5:0,f=n.endsWith("right")?h:n.endsWith("center")?h/2:0,f+=e.parameters.outline,m+=e.parameters.outline,this.parameters.showBackground&&(c=2*g*4,s[c+0]=-e.lineHeight/6-f-i,s[c+1]=e.lineHeight-m+i,s[c+2]=-e.lineHeight/6-f-i,s[c+3]=0-m-i,s[c+4]=h+e.lineHeight/6-f+2*e.parameters.outline+i,s[c+5]=e.lineHeight-m+i,s[c+6]=h+e.lineHeight/6-f+2*e.parameters.outline+i,s[c+7]=0-m-i,o[c+0]=10,o[c+2]=10,o[c+4]=10,o[c+6]=10,g+=1),h=0,d=0;d<p;++d,++g){l=e.get(u[d]),c=2*g*4,s[c+0]=h-f,s[c+1]=l.h-m,s[c+2]=h-f,s[c+3]=0-m,s[c+4]=h+l.w-f,s[c+5]=l.h-m,s[c+6]=h+l.w-f,s[c+7]=0-m;const t=e.parameters.width,n=e.parameters.height,i=[l.x/t,l.y/n,l.x/t,(l.y+l.h)/n,(l.x+l.w)/t,l.y/n,(l.x+l.w)/t,(l.y+l.h)/n];o.set(i,c),h+=l.w-2*e.parameters.outline}}r.inputTexCoord.needsUpdate=!0,r.mapping.needsUpdate=!0}getDefines(e){const t=super.getDefines(e);return this.parameters.fixedSize&&(t.FIXED_SIZE=1),t}setUniforms(e){!e||void 0===e.fontFamily&&void 0===e.fontStyle&&void 0===e.fontWeight&&void 0===e.fontSize||(this.makeTexture(),this.makeMapping(),this.texture.needsUpdate=!0,e.fontTexture=this.texture),super.setUniforms(e)}}Im.add("text",FC),Tm.add("shader/WideLine.vert","\nuniform float clipNear;\nuniform vec3 clipCenter;\nuniform float linewidth;\nuniform vec2 resolution;\nuniform mat4 projectionMatrixInverse;\nattribute vec2 mapping;\nattribute vec3 position1;\nattribute vec3 position2;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\nattribute vec3 color2;\nvarying vec3 vColor;\nvarying vec3 vColor2;\nvarying float flag;\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\nvoid trimSegment( const in vec4 start, inout vec4 end ) {\nfloat a = projectionMatrix[ 2 ][ 2 ]; float b = projectionMatrix[ 3 ][ 2 ]; float nearEstimate = - 0.5 * b / a;\nfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\nend.xyz = mix( start.xyz, end.xyz, alpha );\n}\nvoid main() {\nfloat aspect = resolution.x / resolution.y;\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\nflag = mapping.y;\nvColor = color;\nvColor2 = color2;\n#endif\nvec4 start = modelViewMatrix * vec4( position1, 1.0 );\nvec4 end = modelViewMatrix * vec4( position2, 1.0 );\nbool perspective = ( projectionMatrix[ 2 ][ 3 ] == -1.0 ); if ( perspective ) {\nif ( start.z < 0.0 && end.z >= 0.0 ) {\ntrimSegment( start, end );\n} else if ( end.z < 0.0 && start.z >= 0.0 ) {\ntrimSegment( end, start );\n}\n}\nvec4 clipStart = projectionMatrix * start;\nvec4 clipEnd = projectionMatrix * end;\nvec2 ndcStart = clipStart.xy / clipStart.w;\nvec2 ndcEnd = clipEnd.xy / clipEnd.w;\nvec2 dir = ndcEnd - ndcStart;\ndir.x *= aspect;\ndir = normalize( dir );\nvec2 offset = vec2( dir.y, - dir.x );\ndir.x /= aspect;\noffset.x /= aspect;\nif ( mapping.x < 0.0 ) offset *= - 1.0;\noffset *= linewidth;\noffset /= resolution.y;\nvec4 clip = ( mapping.y < 0.5 ) ? clipStart : clipEnd;\noffset *= clip.w;\nclip.xy += offset;\ngl_Position = clip;\n#ifndef PICKING\nvViewPosition = ( projectionMatrixInverse * clip ).xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}"),Tm.add("shader/WideLine.frag","uniform vec3 diffuse;\nuniform float opacity;\nuniform float clipNear;\nuniform float clipRadius;\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\n#include common\n#include fog_pars_fragment\nvarying vec3 vViewPosition;\nvarying vec3 vColor;\nvarying vec3 vColor2;\nvarying float flag;\n#endif\nvoid main() {\n#include nearclip_fragment\n#include radiusclip_fragment\n#if defined( PICKING )\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 outgoingLight = vec3( 0.0 );\nvec4 diffuseColor = vec4( diffuse, 1.0 );\nif ( flag < 0.0 ) {\ndiffuseColor.rgb *= vColor;\n} else {\ndiffuseColor.rgb *= vColor2;\n}\n#include alphatest_fragment\noutgoingLight = diffuseColor.rgb;\ngl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include encodings_fragment\n#include fog_fragment\n#endif\n}");const zC=Object.assign({linewidth:2},v_),UC=Object.assign({linewidth:{uniform:!0}},b_);class HC extends CM{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.parameterTypes=UC,this.vertexShader="WideLine.vert",this.fragmentShader="WideLine.frag",!e.color2&&e.color&&(e.color2=e.color),this.addUniforms({linewidth:{value:this.parameters.linewidth},resolution:{value:new nn},projectionMatrixInverse:{value:new Sn}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return zC}setParameters(e){super.setParameters(e)}}Im.add("wideline",HC);class GC extends CC{constructor(e,t,n){super(e,t,n),this.type="angle",this.parameters=Object.assign({atomTriple:{type:"hidden",rebuild:!0},vectorVisible:{type:"boolean",default:!0},arcVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.side=bp(t.side,"double"),t.opacity=bp(t.opacity,.5),this.atomTriple=bp(t.atomTriple,[]),this.arcVisible=bp(t.arcVisible,!0),this.sectorVisible=bp(t.sectorVisible,!0),this.vectorVisible=bp(t.vectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomTriple.length)return;const t=$C(jC(e,this.atomTriple)),n=this.n=t.labelPosition.length/3,i=new Ri(this.labelColor);this.textBuffer=new FC({position:t.labelPosition,size:gg(n,this.labelSize),color:yg(n,i.r,i.g,i.b),text:t.labelText},this.getLabelBufferParams());const r=new Ri(this.colorValue);return this.vectorBuffer=new HC(wv({position1:t.vectorPosition1,position2:t.vectorPosition2,color:yg(2*n,r.r,r.g,r.b),color2:yg(2*n,r.r,r.g,r.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.vectorVisible,opacity:this.lineOpacity})),this.arcLength=t.arcPosition1.length/3,this.arcBuffer=new HC(wv({position1:t.arcPosition1,position2:t.arcPosition2,color:yg(this.arcLength,r.r,r.g,r.b),color2:yg(this.arcLength,r.r,r.g,r.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.arcVisible,opacity:this.lineOpacity})),this.sectorLength=t.sectorPosition.length/3,this.sectorBuffer=new w_({position:t.sectorPosition,color:yg(this.sectorLength,r.r,r.g,r.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.vectorBuffer,this.arcBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const n={},i={},r={};if(e.color){const e=new Ri(this.colorValue);Object.assign(n,{color:yg(2*this.n,e.r,e.g,e.b),color2:yg(2*this.n,e.r,e.g,e.b)}),Object.assign(i,{color:yg(this.arcLength,e.r,e.g,e.b),color2:yg(this.arcLength,e.r,e.g,e.b)}),Object.assign(r,{color:yg(this.sectorLength,e.r,e.g,e.b)})}this.vectorBuffer.setAttributes(n),this.arcBuffer.setAttributes(i),this.sectorBuffer.setAttributes(r)}setParameters(e){var t=!1,n={};return super.setParameters(e,n,t),!e||void 0===e.vectorVisible&&void 0===e.arcVisible&&void 0===e.sectorVisible||this.setVisibility(this.visible),e&&e.lineOpacity&&(this.vectorBuffer.setParameters({opacity:e.lineOpacity}),this.arcBuffer.setParameters({opacity:e.lineOpacity})),e&&void 0!==e.opacity&&(this.vectorBuffer.setParameters({opacity:this.lineOpacity}),this.arcBuffer.setParameters({opacity:this.lineOpacity})),e&&e.linewidth&&(this.vectorBuffer.setParameters({linewidth:e.linewidth}),this.arcBuffer.setParameters({linewidth:e.linewidth})),this}setVisibility(e,t){return super.setVisibility(e,!0),this.vectorBuffer&&this.vectorBuffer.setVisibility(this.vectorVisible&&this.visible),this.arcBuffer&&this.arcBuffer.setVisibility(this.arcVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}function VC(e){const t=[],n=e.length/9;for(let o=0;o<n;o++){let n=!0;for(let t=o;t<o+3;t+=3)e[t]===e[t+3]&&e[t+1]===e[t+4]&&e[t+2]===e[t+5]&&(n=!1);n&&t.push(o)}const i=new Float32Array(9*t.length);let r=0;return t.forEach((function(t){Mg(e,i,9*t,9*r,9),r++})),i}function jC(e,t){return VC(TC(e,t))}function $C(e){const t=bp((arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).angleStep,Math.PI/90),n=e.length/9,i=new Float32Array(n),r=new Float32Array(3*n),o=new Array(n),s=new Float32Array(6*n),a=new Float32Array(6*n),l=new Array(n),c=new Array(n),u=new Array(n);let h=0;const d=tv(),p=tv(),f=tv(),m=tv(),g=tv(),y=tv(),v=tv(),b=tv(),x=tv();for(var w=0;w<n;w++){let n=9*w;sv(d,e,n),sv(p,e,n+3),sv(f,e,n+6);let _=6*w;av(d,s,_),av(p,a,_),av(p,s,_+3),av(f,a,_+3),rv(m,d,p),rv(g,f,p),dv(m,m),dv(g,g),nv(y,m,g);const S=cv(y),M=iv(m,g),A=i[w]=Math.atan2(S,M);o[w]=(dg*A).toFixed(1)+String.fromCharCode(176),0===cv(y)&&(y[0]=1,y[1]=0,y[2]=0),nv(v,y,m),dv(v,v),EC(b,p,m,v,A/2),av(b,r,3*w);const C=Math.ceil(A/t),T=new Float32Array(9*C);u[w]=T;const E=new Float32Array(3*C),P=new Float32Array(3*C);l[w]=E,c[w]=P,ov(x,p,m);const I=function(e,t){const n=9*t,i=3*t;av(p,T,n),av(x,T,n+3),av(x,E,i),EC(x,p,m,v,e),av(x,T,n+6),av(x,P,i)};let L=0;for(let e=t;e<A;e+=t)I(e,L),L++;I(A,L),h+=C}const _=3*h,S=9*h,M=new Float32Array(_),A=new Float32Array(_),C=new Float32Array(S);let T=0,E=0;for(let P=0;P<n;P++){const e=l[P],t=c[P];Mg(e,M,0,E,e.length),Mg(t,A,0,E,t.length),E+=e.length;const n=u[P];Mg(n,C,0,T,n.length),T+=n.length}return{labelPosition:r,labelText:o,vectorPosition1:s,vectorPosition2:a,arcPosition1:M,arcPosition2:A,sectorPosition:C}}Am.add("angle",GC);const WC=new mn,qC=new mn,XC=new mn,YC=new mn(0,1,0),ZC=Object.assign({radialSegments:1,openEnded:!0},v_);function KC(e){const t=QC(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),n=e.position1.length,i=t.attributes.position.array.length/3,r=n/3,o=new Float32Array(2*r*i);return xg(r,i,0,o),xg(r,i,r*i,o),{position:new Float32Array(2*n),color:new Float32Array(2*n),primitiveId:o,picking:e.picking}}function QC(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=bp(e.radialSegments,10),n=bp(e.openEnded,!0),i=(new Sn).makeRotationX(Math.PI/2),r=new zc(1,1,1,t,1,n);return r.applyMatrix4(i),r}class JC extends bM{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(KC(e,t),t,QC(t)),this.updateNormals=!0;const n=e.position1.length,i=e.radius.length;this.__center=new Float32Array(n),this._position=new Float32Array(2*n),this._color=new Float32Array(2*n),this._from=new Float32Array(2*n),this._to=new Float32Array(2*n),this._radius=new Float32Array(2*i),this.setAttributes(e,!0)}get defaultParameters(){return ZC}applyPositionTransform(e,t,n){qC.fromArray(this._from,n),XC.fromArray(this._to,n),e.lookAt(qC,XC,YC);const i=this._radius[t];WC.set(i,i,qC.distanceTo(XC)),e.scale(WC)}setAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;const n={};e.position1&&e.position2&&(fg(e.position1,e.position2,this.__center),fg(e.position1,this.__center,this._position),fg(this.__center,e.position2,this._position,e.position1.length),this._from.set(e.position1),this._from.set(this.__center,e.position1.length),this._to.set(this.__center),this._to.set(e.position2,this.__center.length),n.position=this._position),e.color&&e.color2&&(this._color.set(e.color),this._color.set(e.color2,e.color.length),n.color=this._color),e.radius&&(this._radius.set(e.radius),this._radius.set(e.radius,e.radius.length),n.radius=this._radius),super.setAttributes(n,t)}}Tm.add("shader/CylinderImpostor.vert","\nattribute vec3 mapping;\nattribute vec3 position1;\nattribute vec3 position2;\nattribute float radius;\nvarying vec3 axis;varying vec4 base_radius;varying vec4 end_b;varying vec3 U;varying vec3 V;\nvarying vec4 w;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\nattribute vec3 color2;\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#endif\nuniform mat4 modelViewMatrixInverse;\nuniform float ortho;\n#include matrix_scale\nvoid main(){\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\nvColor1 = color;\nvColor2 = color2;\n#endif\nbase_radius.w = radius * matrixScale( modelViewMatrix );\nvec3 center = position;\nvec3 dir = normalize( position2 - position1 );\nfloat ext = length( position2 - position1 ) / 2.0;\nvec3 cam_dir;\nif( ortho == 0.0 ){\ncam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;\n}else{\ncam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;\n}\ncam_dir = normalize( cam_dir );\nvec3 ldir;\nfloat b = dot( cam_dir, dir );\nend_b.w = b;\nif( b < 0.0 )\nldir = -ext * dir;\nelse\nldir = ext * dir;\nvec3 left = radius * normalize( cross( cam_dir, ldir ) );\nvec3 up = radius * normalize( cross( left, ldir ) );\naxis = normalize( normalMatrix * ldir );\nU = normalize( normalMatrix * up );\nV = normalize( normalMatrix * left );\nvec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );\nbase_radius.xyz = base4.xyz / base4.w;\nvec4 end4 = modelViewMatrix * vec4( center + ldir, 1.0 );\nend_b.xyz = end4.xyz / end4.w;\nw = modelViewMatrix * vec4(\ncenter + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0\n);\ngl_Position = projectionMatrix * w;\ngl_Position.z = 0.99;\n}"),Tm.add("shader/CylinderImpostor.frag","#define STANDARD\n#define IMPOSTOR\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform mat4 projectionMatrix;\nuniform float ortho;\nvarying vec3 axis;\nvarying vec4 base_radius;\nvarying vec4 end_b;\nvarying vec3 U;\nvarying vec3 V;\nvarying vec4 w;\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#include common\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nbool interior = false;\nfloat distSq3( vec3 v3a, vec3 v3b ){\nreturn (\n( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +\n( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +\n( v3a.z - v3b.z ) * ( v3a.z - v3b.z )\n);\n}\nfloat calcDepth( in vec3 cameraPos ){\nvec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\nreturn 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\nfloat calcClip( vec3 cameraPos ){\nreturn dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );\n}\nvoid main(){\nvec3 ray_target = w.xyz / w.w;\nvec3 base = base_radius.xyz; float vRadius = base_radius.w; vec3 end = end_b.xyz; float b = end_b.w;\nvec3 ray_origin = vec3(0.0); vec3 ortho_ray_direction = vec3(0.0, 0.0, 1.0); vec3 persp_ray_direction = normalize(ray_origin - ray_target);\nvec3 ray_direction = mix(persp_ray_direction, ortho_ray_direction, ortho);\n\nmat3 basis = mat3( U, V, axis );\nvec3 diff = ray_target - 0.5 * (base + end);\n\nvec3 P = diff * basis;\nfloat dz = dot( axis, ray_direction );\nfloat radius2 = vRadius*vRadius;\nvec3 D = vec3(dot(U, ray_direction),\ndot(V, ray_direction),\ndz);\nfloat a0 = P.x*P.x + P.y*P.y - radius2;\nfloat a1 = P.x*D.x + P.y*D.y;\nfloat a2 = D.x*D.x + D.y*D.y;\nfloat d = a1*a1 - a0*a2;\nif (d < 0.0) {\ndiscard;\n}\nfloat dist = (-a1 + sqrt(d)) / a2;\nvec3 surface_point = ray_target + dist * ray_direction;\nvec3 base_to_surface = surface_point - base;\nvec3 _normal = normalize( base_to_surface - axis * dot(base_to_surface, axis) );\nfloat base_cap_test = dot( base_to_surface, axis );\nfloat end_cap_test = dot((surface_point - end), axis);\n#ifndef CAP\nvec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;\nvec3 tmp_point2 = new_point2 - base;\n#endif\nif (base_cap_test < 0.0) {\nfloat dNV;\nfloat near;\nvec3 front_point;\nif ( ortho == 1.0 ) {\nfront_point = ray_target;\n} else {\ndNV = dot(-axis, ray_direction);\nnear = dot(-axis, (base)) / dNV;\nfront_point = ray_direction * near + ray_origin;\n}\nif (dot(front_point - base, front_point-base) > radius2) {\ndiscard;\n}\n#ifdef CAP\nsurface_point = front_point;\n_normal = axis;\n#else\nsurface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;\ndNV = dot(-axis, ray_direction);\nnear = dot(axis, end) / dNV;\nnew_point2 = ray_direction * near + ray_origin;\nif (dot(new_point2 - end, new_point2-base) < radius2) {\ndiscard;\n}\ninterior = true;\n#endif\n}\nif( end_cap_test > 0.0 )\n{\nfloat dNV;\nfloat near;\nvec3 end_point;\nif ( ortho == 1.0 ) {\nend_point = ray_target;\n} else {\ndNV = dot(axis, ray_direction);\nif (dNV < 0.0) {\ndiscard;\n}\nnear = dot(axis, end) / dNV;\nend_point = ray_direction * near + ray_origin;\n}\n\nif( dot(end_point - end, end_point-base) > radius2 ) {\ndiscard;\n}\n#ifdef CAP\nsurface_point = end_point;\n_normal = axis;\n#else\nsurface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;\ndNV = dot(-axis, ray_direction);\nnear = dot(-axis, (base)) / dNV;\nnew_point2 = ray_direction * near + ray_origin;\nif (dot(new_point2 - base, new_point2-base) < radius2) {\ndiscard;\n}\ninterior = true;\n#endif\n}\ngl_FragDepthEXT = calcDepth( surface_point );\n\n#ifdef NEAR_CLIP\nif( calcClip( surface_point ) > 0.0 ){\ndist = (-a1 - sqrt(d)) / a2;\nsurface_point = ray_target + dist * ray_direction;\nif( calcClip( surface_point ) > 0.0 ) {\ndiscard;\n}\ninterior = true;\ngl_FragDepthEXT = calcDepth( surface_point );\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );\n}\n}else if( gl_FragDepthEXT <= 0.0 ){\ndist = (-a1 - sqrt(d)) / a2;\nsurface_point = ray_target + dist * ray_direction;\ninterior = true;\ngl_FragDepthEXT = calcDepth( surface_point );\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n}\n#else\nif( gl_FragDepthEXT <= 0.0 ){\ndist = (-a1 - sqrt(d)) / a2;\nsurface_point = ray_target + dist * ray_direction;\ninterior = true;\ngl_FragDepthEXT = calcDepth( surface_point );\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );\n}\n}\n#endif\nif (gl_FragDepthEXT < 0.0) {\ndiscard;\n}\nif (gl_FragDepthEXT > 1.0) {\ndiscard;\n}\n#ifdef PICKING\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 vViewPosition = -surface_point;\nvec3 vNormal = _normal;\nvec3 vColor;\nif( distSq3( surface_point, end ) < distSq3( surface_point, base ) ){\nif( b < 0.0 ){\nvColor = vColor1;\n}else{\nvColor = vColor2;\n}\n}else{\nif( b > 0.0 ){\nvColor = vColor1;\n}else{\nvColor = vColor2;\n}\n}\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\nvec3 normal = normalize( vNormal );\nvec3 geometryNormal = normal;\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\nif( interior ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include encodings_fragment\n#include fog_fragment\n#endif\n}");const eT=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),tT=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]);class nT extends SM{constructor(e){super("v3",e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}get mapping(){return eT}get mappingIndices(){return tT}get mappingIndicesSize(){return 12}get mappingSize(){return 6}get mappingItemSize(){return 3}}const iT=Object.assign({openEnded:!1},v_),rT=Object.assign({openEnded:{updateShader:!0}},b_);class oT extends nT{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.parameterTypes=rT,this.isImpostor=!0,this.vertexShader="CylinderImpostor.vert",this.fragmentShader="CylinderImpostor.frag",this.addUniforms({modelViewMatrixInverse:{value:new Sn},ortho:{value:0}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return iT}getDefines(e){const t=nT.prototype.getDefines.call(this,e);return this.parameters.openEnded||(t.CAP=1),t}}Object.assign({disableImpostor:!1},ZC,iT);class sT{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!e.color2&&e.color&&(e.color2=e.color),!fm||t&&t.disableImpostor?new JC(e,t):new oT(e,t)}}const aT=sT;Im.add("cylinder",aT);class lT extends AC{constructor(e,t,n){super(e,t,n),this.type="axes",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0,showAxes:{type:"boolean",rebuild:!0},showBox:{type:"boolean",rebuild:!0}},this.parameters,{assembly:null}),this.init(n)}init(e){const t=e||{};t.radiusSize=bp(t.radiusSize,.5),t.colorValue=bp(t.colorValue,"lightgreen"),t.useInteriorColor=bp(t.useInteriorColor,!0),this.showAxes=bp(t.showAxes,!0),this.showBox=bp(t.showBox,!1),super.init(t)}getPrincipalAxes(){let e;const t=this.getAssembly();return t&&(e=t.partList[0].getSelection()),this.structureView.getPrincipalAxes(e)}getAxesData(e){const t=this.getPrincipalAxes(),n=new Ri(this.colorValue);let i=0,r=0;this.showAxes&&(i+=6,r+=3),this.showBox&&(i+=8,r+=12);const o=new Float32Array(3*i),s=yg(i,n.r,n.g,n.b),a=gg(i,this.radiusSize),l=new Float32Array(3*r),c=new Float32Array(3*r),u=yg(r,n.r,n.g,n.b),h=gg(r,this.radiusSize);let d=0;if(this.showAxes){const e=function(e,t){e.toArray(o,2*d),t.toArray(o,2*d+3),e.toArray(l,d),t.toArray(c,d),d+=3};e(t.begA,t.endA),e(t.begB,t.endB),e(t.begC,t.endC)}if(this.showBox){const n=new mn,{d1a:i,d2a:r,d3a:s,d1b:a,d2b:u,d3b:h}=t.getProjectedScaleForAtoms(e);let p=2*d;const f=function(e,i,r){n.copy(t.center).addScaledVector(t.normVecA,e).addScaledVector(t.normVecB,i).addScaledVector(t.normVecC,r),n.toArray(o,p),p+=3};f(i,r,s),f(i,r,h),f(i,u,h),f(i,u,s),f(a,u,h),f(a,u,s),f(a,r,s),f(a,r,h);let m=d;const g=function(e,t){n.fromArray(o,2*d+3*e).toArray(l,m),n.fromArray(o,2*d+3*t).toArray(c,m),m+=3};g(0,1),g(0,3),g(0,6),g(1,2),g(1,7),g(2,3),g(2,4),g(3,5),g(4,5),g(4,7),g(5,6),g(6,7)}const p=new gw(t);return{vertex:{position:o,color:s,radius:a,picking:p},edge:{position1:l,position2:c,color:u,color2:u,radius:h,picking:p}}}create(){const e=this.getAxesData(this.structureView);this.sphereBuffer=new PM(e.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new aT(e.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const n=this.getAxesData(t.sview),i={},r={};e&&!e.position||(Object.assign(i,{position:n.vertex.position}),Object.assign(r,{position1:n.edge.position1,position2:n.edge.position2})),e&&!e.color||(Object.assign(i,{color:n.vertex.color}),Object.assign(r,{color:n.edge.color,color2:n.edge.color})),e&&!e.radius||(Object.assign(i,{radius:n.vertex.radius}),Object.assign(r,{radius:n.edge.radius})),this.sphereBuffer.setAttributes(i),this.cylinderBuffer.setAttributes(r)}}Am.add("axes",lT);class cT extends AC{constructor(e,t,n){super(e,t,n),this.type="ball+stick",this.parameters=Object.assign({sphereDetail:!0,radialSegments:!0,openEnded:!0,disableImpostor:!0,aspectRatio:{type:"number",precision:1,max:10,min:1},lineOnly:{type:"boolean",rebuild:!0},cylinderOnly:{type:"boolean",rebuild:!0},multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondScale:{type:"number",precision:2,max:1,min:.01},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters),this.init(n)}init(e){var t=e||{};t.radiusType=bp(t.radiusType,"size"),t.radiusSize=bp(t.radiusSize,.15),t.useInteriorColor=bp(t.useInteriorColor,!0),this.aspectRatio=bp(t.aspectRatio,2),this.lineOnly=bp(t.lineOnly,!1),this.cylinderOnly=bp(t.cylinderOnly,!1),this.multipleBond=bp(t.multipleBond,"off"),this.bondSpacing=bp(t.bondSpacing,1),this.bondScale=bp(t.bondScale,.4),this.linewidth=bp(t.linewidth,2),super.init(t)}getAtomRadius(e){return this.aspectRatio*super.getAtomRadius(e)}getAtomParams(e,t){var n=super.getAtomParams(e,t);return n.radiusParams.scale*=this.aspectRatio,n}getAtomData(e,t,n){return e.getAtomData(this.getAtomParams(t,n))}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,bondScale:this.bondScale},t),super.getBondParams(e,t)}getBondData(e,t,n){return e.getBondData(this.getBondParams(t,n))}createData(e){const t=[];if(this.lineOnly)this.lineBuffer=new HC(this.getBondData(e,{position:!0,color:!0,picking:!0}),this.getBufferParams({linewidth:this.linewidth})),t.push(this.lineBuffer);else{const n=new aT(this.getBondData(e),this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}));if(t.push(n),!this.cylinderOnly){const n=new PM(this.getAtomData(e),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));t.push(n)}}return{bufferList:t}}updateData(e,t){"off"!==this.multipleBond&&e&&e.radius&&(e.position=!0);const n=this.getBondData(t.sview,e);if(this.lineOnly){const i={};e&&!e.position||Object.assign(i,{position1:n.position1,position2:n.position2}),e&&!e.color||Object.assign(i,{color:n.color,color2:n.color2}),t.bufferList[0].setAttributes(i)}else{var i={};if(e&&!e.position||Object.assign(i,{position1:n.position1,position2:n.position2}),e&&!e.color||Object.assign(i,{color:n.color,color2:n.color2}),e&&!e.radius||Object.assign(i,{radius:n.radius}),t.bufferList[0].setAttributes(i),!this.cylinderOnly){var r=this.getAtomData(t.sview,e),o={};e&&!e.position||Object.assign(o,{position:r.position}),e&&!e.color||Object.assign(o,{color:r.color}),e&&!e.radius||Object.assign(o,{radius:r.radius}),t.bufferList[1].setAttributes(o)}}}setParameters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1;const n={};return(e.aspectRatio||e.bondSpacing||e.bondScale)&&(Object.assign(n,{radius:!0}),fm&&!this.disableImpostor||(t=!0)),super.setParameters(e,n,t),this}}Am.add("ball+stick",cT);class uT extends cT{constructor(e,t,n){super(e,t,n),this.type="backbone",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null}),this.init(n)}init(e){var t=e||{};t.aspectRatio=bp(t.aspectRatio,1),t.radiusSize=bp(t.radiusSize,.25),super.init(t)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}getAtomData(e,t,n){return e.getBackboneAtomData(this.getAtomParams(t,n))}getBondData(e,t,n){return e.getBackboneBondData(this.getBondParams(t,n))}}Am.add("backbone",uT);class hT extends cT{constructor(e,t,n){super(e,t,n),this.type="base",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){let t=e||{};t.aspectRatio=bp(t.aspectRatio,1),t.radiusSize=bp(t.radiusSize,.3),super.init(t)}getAtomData(e,t,n){return e.getRungAtomData(this.getAtomParams(t,n))}getBondData(e,t,n){let i=this.getBondParams(t,n);return Object.assign(i.colorParams,{rung:!0}),e.getRungBondData(i)}}Am.add("base",hT);class dT{constructor(e,t){this.m=e,this.tension=t,this.dt=1/this.m,this.delta=1e-4,this.vec1=new mn,this.vec2=new mn,this.vDir=new mn,this.vTan=new mn,this.vNorm=new mn,this.vBin=new mn,this.m2=Math.ceil(this.m/2)}interpolateToArr(e,t,n,i,r,o,s){o[s+0]=uf(e.x,t.x,n.x,i.x,r,this.tension),o[s+1]=uf(e.y,t.y,n.y,i.y,r,this.tension),o[s+2]=uf(e.z,t.z,n.z,i.z,r,this.tension)}interpolateToVec(e,t,n,i,r,o){o.x=uf(e.x,t.x,n.x,i.x,r,this.tension),o.y=uf(e.y,t.y,n.y,i.y,r,this.tension),o.z=uf(e.z,t.z,n.z,i.z,r,this.tension)}interpolatePosition(e,t,n,i,r,o){for(var s=0;s<this.m;++s){var a=o+3*s,l=this.dt*s;this.interpolateToArr(e,t,n,i,l,r,a)}}interpolateTangent(e,t,n,i,r,o){for(var s=0;s<this.m;++s){var a=this.dt*s,l=a-this.delta,c=a+this.delta,u=o+3*s;l<0&&(l=0),c>1&&(c=1),this.interpolateToVec(e,t,n,i,l,this.vec1),this.interpolateToVec(e,t,n,i,c,this.vec2),this.vec2.sub(this.vec1).normalize(),this.vec2.toArray(r,u)}}vectorSubdivide(e,t,n,i,r){let o,s=t.next(),a=t.next(),l=t.next();const c=t.size,u=c-1;let h=i||0;for(let d=0;d<u;++d)o=s,s=a,a=l,l=t.next(),e.apply(this,[o,s,a,l,n,h]),h+=3*this.m;r&&(o=t.get(c-2),s=t.get(c-1),a=t.get(0),l=t.get(1),e.apply(this,[o,s,a,l,n,h]),h+=3*this.m)}getPosition(e,t,n,i){e.reset(),this.vectorSubdivide(this.interpolatePosition,e,t,n,i);var r=e.size-1,o=r*this.m*3;i&&(o+=3*this.m);var s=e.get(i?0:r);t[o]=s.x,t[o+1]=s.y,t[o+2]=s.z}getTangent(e,t,n,i){e.reset(),this.vectorSubdivide(this.interpolateTangent,e,t,n,i);let r=(e.size-1)*this.m*3;i&&(r+=3*this.m),Mg(t,t,r-3,r,3)}interpolateNormalDir(e,t,n,i,r,o,s,a,l,c,u,h,d){for(let p=0;p<this.m;++p){let f=h+3*p;d&&(f+=3*this.m2);const m=this.dt*p;this.interpolateToVec(e,t,n,i,m,this.vec1),this.interpolateToVec(r,o,s,a,m,this.vec2),this.vDir.subVectors(this.vec2,this.vec1).normalize(),this.vTan.fromArray(l,f),this.vBin.crossVectors(this.vDir,this.vTan).normalize(),this.vBin.toArray(u,f),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(c,f)}}interpolateNormal(e,t,n,i,r){for(var o=0;o<this.m;++o){var s=r+3*o;e.copy(this.vNorm),this.vTan.fromArray(t,s),this.vBin.crossVectors(e,this.vTan).normalize(),this.vBin.toArray(i,s),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(n,s)}}getNormal(e,t,n,i,r,o){this.vNorm.set(0,0,1);const s=e-1;let a=r||0;for(var l=0;l<s;++l)this.interpolateNormal(this.vDir,t,n,i,a),a+=3*this.m;o&&(this.interpolateNormal(this.vDir,t,n,i,a),a+=3*this.m),this.vBin.toArray(i,a),this.vNorm.toArray(n,a)}getNormalDir(e,t,n,i,r,o,s,a){e.reset(),t.reset();const l=new mn,c=new mn,u=new mn,h=new mn,d=new mn,p=(new mn).copy(e.next()),f=(new mn).copy(e.next()),m=(new mn).copy(e.next()),g=new mn,y=(new mn).copy(t.next()),v=(new mn).copy(t.next()),b=(new mn).copy(t.next());this.vNorm.set(0,0,1);let x=e.size,w=x-1,_=o||0;for(var S=0;S<w;++S)d.copy(p),p.copy(f),f.copy(m),m.copy(e.next()),g.copy(y),y.copy(v),v.copy(b),b.copy(t.next()),0===S?(l.subVectors(g,d),c.subVectors(y,p),l.dot(c)<0&&(c.multiplyScalar(-1),y.addVectors(p,c)),u.subVectors(v,f),c.dot(u)<0&&(u.multiplyScalar(-1),v.addVectors(f,u))):u.copy(h),h.subVectors(b,m),u.dot(h)<0&&(h.multiplyScalar(-1),b.addVectors(m,h)),this.interpolateNormalDir(d,p,f,m,g,y,v,b,n,i,r,_,a),_+=3*this.m;if(s&&(d.copy(e.get(x-2)),p.copy(e.get(x-1)),f.copy(e.get(0)),m.copy(e.get(1)),g.copy(t.get(x-2)),y.copy(t.get(x-1)),v.copy(t.get(0)),b.copy(t.get(1)),u.copy(h),h.subVectors(b,m),u.dot(h)<0&&(h.multiplyScalar(-1),b.addVectors(m,h)),this.interpolateNormalDir(d,p,f,m,g,y,v,b,n,i,r,_,a),_+=3*this.m),a){this.vBin.fromArray(r,3*this.m2),this.vNorm.fromArray(i,3*this.m2);for(var M=0;M<this.m2;++M)this.vBin.toArray(r,3*M),this.vNorm.toArray(i,3*M)}else this.vBin.toArray(r,_),this.vNorm.toArray(i,_)}interpolateColor(e,t,n,i,r){var o,s;for(o=0;o<this.m2;++o)s=r+3*o,n.apply(this,[e,i,s]);for(o=this.m2;o<this.m;++o)s=r+3*o,n.apply(this,[t,i,s])}getColor(e,t,n,i,r){let o;e.reset(),e.next();let s=e.next();for(var a=e.size,l=a-1,c=i||0,u=0;u<l;++u)o=s,s=e.next(),this.interpolateColor(o,s,t,n,c),c+=3*this.m;r&&(o=e.get(a-1),s=e.get(0),this.interpolateColor(o,s,t,n,c),c+=3*this.m),n[c]=n[c-3],n[c+1]=n[c-2],n[c+2]=n[c-1]}interpolatePicking(e,t,n,i,r){var o;for(o=0;o<this.m2;++o)i[r+o]=n.apply(this,[e]);for(o=this.m2;o<this.m;++o)i[r+o]=n.apply(this,[t])}getPicking(e,t,n,i,r){let o;e.reset(),e.next();let s=e.next();const a=e.size,l=a-1;let c=i||0;for(var u=0;u<l;++u)o=s,s=e.next(),this.interpolatePicking(o,s,t,n,c),c+=this.m;r&&(o=e.get(a-1),s=e.get(0),this.interpolatePicking(o,s,t,n,c),c+=this.m),n[c]=n[c-1]}interpolateSize(e,t,n,i,r){const o=n.apply(this,[e]),s=n.apply(this,[t]);for(let a=0;a<this.m;++a){let e=a/this.m;i[r+a]=(1-e)*o+e*s}}getSize(e,t,n,i,r){let o;e.reset(),e.next();let s=e.next();const a=e.size,l=a-1;let c=i||0;for(var u=0;u<l;++u)o=s,s=e.next(),this.interpolateSize(o,s,t,n,c),c+=this.m;r&&(o=e.get(a-1),s=e.get(0),this.interpolateSize(o,s,t,n,c),c+=this.m),n[c]=n[c-1]}}class pT{constructor(e,t){this.polymer=e,this.size=e.residueCount;var n=t||{};this.directional=n.directional||!1,this.positionIterator=n.positionIterator||!1,this.subdiv=n.subdiv||1,this.smoothSheet=n.smoothSheet||!1,n.tension?this.tension=n.tension:this.tension=this.polymer.isNucleic()?.5:.9,this.interpolator=new dT(this.subdiv,this.tension)}getAtomIterator(e,t){const n=this.polymer,i=n.structure,r=n.residueCount;let o=0,s=-1;const a=[i.getAtomProxy(),i.getAtomProxy(),i.getAtomProxy(),i.getAtomProxy()],l=[new mn,new mn,new mn,new mn];function c(){var e=d(s);return s+=1,e}var u=i.getAtomProxy(),h=i.getAtomProxy();function d(i){var s=a[o%4];if(s.index=n.getAtomIndexByType(i,e),t&&i>0&&i<r&&"e"===s.sstruc){var c=l[o%4];return u.index=n.getAtomIndexByType(i+1,e),h.index=n.getAtomIndexByType(i-1,e),c.addVectors(u,h).add(s).add(s).multiplyScalar(.25),o+=1,c}return o+=1,s}function p(){o=0,s=-1}return{size:r,next:c,get:d,reset:p}}getSubdividedColor(e){var t=this.subdiv,n=this.polymer,i=(n.residueCount-1)*t*3+3;n.isCyclic&&(i+=3*t);var r=new Float32Array(i),o=this.getAtomIterator("trace"),s=e||{};s.structure=n.structure;var a=Sm.getScheme(s);function l(e,t,n){a.atomColorToArray(e,t,n)}return this.interpolator.getColor(o,l,r,0,n.isCyclic),{color:r}}getSubdividedPicking(){var e=this.subdiv,t=this.polymer,n=(t.residueCount-1)*e+1;t.isCyclic&&(n+=e);var i=t.structure,r=this.getAtomIterator("trace"),o=new Float32Array(n);function s(e){return e.index}return this.interpolator.getPicking(r,s,o,0,t.isCyclic),{picking:new mw(o,i)}}getSubdividedPosition(){return{position:this.getPosition()}}getSubdividedOrientation(){const e=this.getTangent(),t=this.getNormals(e);return{tangent:e,normal:t.normal,binormal:t.binormal}}getSubdividedSize(e){var t=this.subdiv,n=this.polymer,i=(n.residueCount-1)*t+1;n.isCyclic&&(i+=t);var r=new Float32Array(i),o=this.getAtomIterator("trace"),s=new W_(e);function a(e){return s.atomRadius(e)}return this.interpolator.getSize(o,a,r,0,n.isCyclic),{size:r}}getPosition(){const e=this.subdiv,t=this.polymer;let n=(t.residueCount-1)*e*3+3;t.isCyclic&&(n+=3*e);const i=new Float32Array(n),r=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getPosition(r,i,0,t.isCyclic),i}getTangent(){const e=this.subdiv,t=this.polymer;let n=(this.size-1)*e*3+3;t.isCyclic&&(n+=3*e);const i=new Float32Array(n),r=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getTangent(r,i,0,t.isCyclic),i}getNormals(e){const t=this.subdiv,n=this.polymer,i=n.isProtein(),r=this.size;let o=(r-1)*t*3+3;n.isCyclic&&(o+=3*t);const s=new Float32Array(o),a=new Float32Array(o);if(this.directional&&!this.polymer.isCg()){const t=this.getAtomIterator("direction1"),r=this.getAtomIterator("direction2");this.interpolator.getNormalDir(t,r,e,s,a,0,n.isCyclic,i)}else this.interpolator.getNormal(r,e,s,a,0,n.isCyclic);return{normal:s,binormal:a}}}const fT=new mn,mT=new mn,gT=Object.assign({radialSegments:4,capped:!1,aspectRatio:1},v_);function yT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=bp(t.radialSegments,4),i=bp(t.capped,!1),r=i?n:0,o=i?n-2:0,s=e.position.length/3,a=s*n*3+2*r*3,l=2*(s-1)*n*3+2*o*3;return{position:new Float32Array(a),color:new Float32Array(a),index:Fp(l,a/3),normal:new Float32Array(a),picking:e.picking}}class vT extends w_{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(yT(e,t),t),this.capVertices=this.parameters.capped?this.parameters.radialSegments:0,this.capTriangles=this.parameters.capped?this.parameters.radialSegments-2:0,this.size2=e.position.length/3,e.primitiveId=bg(this.size2),this.setAttributes(e),this.makeIndex()}get defaultParameters(){return gT}setAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.parameters.aspectRatio,n=this.size2,i=n-1,r=this.parameters.radialSegments,o=this.geometry.attributes;let s,a,l,c,u,h,d,p,f,m,g,y,v;e.position&&(s=e.position,a=e.normal,l=e.binormal,c=e.tangent,h=e.size,p=o.position.array,m=o.normal.array,o.position.needsUpdate=!0,o.normal.needsUpdate=!0),e.color&&(u=e.color,f=o.color.array,o.color.needsUpdate=!0),e.primitiveId&&(d=e.primitiveId,g=o.primitiveId.array,o.primitiveId.needsUpdate=!0);let b=0,x=0,w=0,_=0,S=0,M=0,A=0,C=0,T=0,E=0;const P=[],I=[],L=[],R=[],k=[],D=[];if(s)for(let O=0;O<r;++O){const e=O/r*2*Math.PI;P[O]=t*Math.cos(e),I[O]=Math.sin(e),L[O]=t*Math.cos(e-.01),R[O]=Math.sin(e-.01),k[O]=t*Math.cos(e+.01),D[O]=Math.sin(e+.01)}for(let O=0;O<n;++O){y=3*O,v=y*r,s&&c&&a&&l&&h&&(fT.set(c[y],c[y+1],c[y+2]),x=a[y],w=a[y+1],_=a[y+2],S=l[y],M=l[y+1],A=l[y+2],C=s[y],T=s[y+1],E=s[y+2],b=h[O]);for(let e=0;e<r;++e){const t=v+3*e;if(s){const n=-b*P[e],i=b*I[e],r=-b*L[e],o=b*R[e],s=-b*k[e],a=b*D[e];p[t]=C+n*x+i*S,p[t+1]=T+n*w+i*M,p[t+2]=E+n*_+i*A,mT.set(s*x+a*S-(r*x+o*S),s*w+a*M-(r*w+o*M),s*_+a*A-(r*_+o*A)).cross(fT),m[t]=mT.x,m[t+1]=mT.y,m[t+2]=mT.z}u&&(f[t]=u[y],f[t+1]=u[y+1],f[t+2]=u[y+2]),d&&(g[O*r+e]=d[O])}}y=0,v=3*n*r;for(let O=0;O<r;++O){const e=y+3*O,t=v+3*O;s&&c&&(p[t]=p[e],p[t+1]=p[e+1],p[t+2]=p[e+2],m[t]=c[y],m[t+1]=c[y+1],m[t+2]=c[y+2]),u&&(f[t]=f[e],f[t+1]=f[e+1],f[t+2]=f[e+2]),d&&(g[n*r+O]=g[0+O])}y=3*(n-1)*r,v=3*(n+1)*r;for(let O=0;O<r;++O){const e=y+3*O,t=v+3*O;s&&c&&(p[t]=p[e],p[t+1]=p[e+1],p[t+2]=p[e+2],m[t]=c[3*i],m[t+1]=c[3*i+1],m[t+2]=c[3*i+2]),u&&(f[t]=f[e],f[t+1]=f[e+1],f[t+2]=f[e+2]),d&&(g[(n+1)*r+O]=g[(n-1)*r+O])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void gm.error("Index is null");const t=e.array,n=this.size2,i=n-1,r=this.capTriangles,o=this.parameters.radialSegments,s=this.parameters.radialSegments+1;let a,l;for(let u=0;u<i;++u){const e=u*o*3*2,n=u*o,i=(u+1)*o;for(let r=0;r<o;++r)l=e+3*r*2,t[l]=n+r,t[l+1]=n+(r+1)%o,t[l+2]=i+r,t[l+3]=i+r,t[l+4]=n+(r+1)%o,t[l+5]=i+(r+1)%o}const c=[0];for(let u=1;u<s/2;++u)c.push(u),o-u!==u&&c.push(o-u);l=i*o*3*2,a=n*o;for(let u=0;u<c.length-2;++u)u%2===0?(t[l+3*u+0]=a+c[u+0],t[l+3*u+1]=a+c[u+1],t[l+3*u+2]=a+c[u+2]):(t[l+3*u+0]=a+c[u+2],t[l+3*u+1]=a+c[u+1],t[l+3*u+2]=a+c[u+0]);l=i*o*3*2+3*r,a=n*o+o;for(let u=0;u<c.length-2;++u)u%2===0?(t[l+3*u+0]=a+c[u+0],t[l+3*u+1]=a+c[u+1],t[l+3*u+2]=a+c[u+2]):(t[l+3*u+0]=a+c[u+2],t[l+3*u+1]=a+c[u+1],t[l+3*u+2]=a+c[u+0])}}class bT extends AC{constructor(e,t,n){super(e,t,n),this.type="cartoon",this.parameters=Object.assign({aspectRatio:{type:"number",precision:1,max:10,min:1,rebuild:!0},subdiv:{type:"integer",max:50,min:1,rebuild:!0},radialSegments:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},capped:{type:"boolean",rebuild:!0},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters),this.init(n)}init(e){var t=e||{};t.colorScheme=bp(t.colorScheme,"chainname"),t.colorScale=bp(t.colorScale,"RdYlBu"),t.radiusType=bp(t.radiusType,"sstruc"),t.radiusScale=bp(t.radiusScale,.7),t.useInteriorColor=bp(t.useInteriorColor,!0),this.aspectRatio=bp(t.aspectRatio,5),this.tension=bp(t.tension,NaN),this.capped=bp(t.capped,!0),this.smoothSheet=bp(t.smoothSheet,!1),"low"===t.quality?(this.subdiv=3,this.radialSegments=6):"medium"===t.quality?this.subdiv=6:"high"===t.quality?this.subdiv=12:this.subdiv=bp(t.subdiv,6),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:1!==this.aspectRatio,smoothSheet:this.smoothSheet},e)}getSpline(e){return new pT(e,this.getSplineParams())}getAspectRatio(e){return e.isCg()?1:this.aspectRatio}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){let t=[],n=[];return this.structure.eachPolymer((e=>{if(e.residueCount<4)return;n.push(e);const i=this.getSpline(e),r=this.getAspectRatio(e),o=i.getSubdividedPosition(),s=i.getSubdividedOrientation(),a=i.getSubdividedColor(this.getColorParams()),l=i.getSubdividedPicking(),c=i.getSubdividedSize(this.getRadiusParams());t.push(new vT(Object.assign({},o,s,a,l,c),this.getBufferParams({radialSegments:this.radialSegments,aspectRatio:r,capped:this.capped})))}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(t,n){e.Debug&&gm.time(this.type+" repr update"),t=t||{};for(var i=0,r=n.polymerList.length;i<r;++i){var o={},s=n.polymerList[i],a=this.getSpline(s),l=this.getAspectRatio(s);if(Object.assign(n.bufferList[i],{aspectRatio:l}),t.position||t.radius){var c=a.getSubdividedPosition(),u=a.getSubdividedOrientation(),h=a.getSubdividedSize(this.getRadiusParams(l));o.position=c.position,o.normal=u.normal,o.binormal=u.binormal,o.tangent=u.tangent,o.size=h.size}if(t.color){var d=a.getSubdividedColor(this.getColorParams());o.color=d.color}if(t.picking){var p=a.getSubdividedPicking();o.picking=p.picking}n.bufferList[i].setAttributes(o)}e.Debug&&gm.timeEnd(this.type+" repr update")}setParameters(e){const t=!1;var n={};return e&&e.aspectRatio&&(n.radius=!0),e&&e.tension&&(n.position=!0),super.setParameters(e,n,t),this}}Am.add("cartoon",bT);class xT extends AC{constructor(e,t,n){super(e,t,n),this.type="contact",this.parameters=Object.assign({hydrogenBond:{type:"boolean",rebuild:!0},weakHydrogenBond:{type:"boolean",rebuild:!0},waterHydrogenBond:{type:"boolean",rebuild:!0},backboneHydrogenBond:{type:"boolean",rebuild:!0},hydrophobic:{type:"boolean",rebuild:!0},halogenBond:{type:"boolean",rebuild:!0},ionicInteraction:{type:"boolean",rebuild:!0},metalCoordination:{type:"boolean",rebuild:!0},cationPi:{type:"boolean",rebuild:!0},piStacking:{type:"boolean",rebuild:!0},filterSele:{type:"text",rebuild:!0},labelVisible:{type:"boolean",rebuild:!0},labelFixedSize:{type:"boolean",buffer:"fixedSize"},labelSize:{type:"number",precision:3,max:10,min:.001,rebuild:!0},labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},maxHydrophobicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondSulfurDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondAccAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondDonAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondAccPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxHbondDonPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxPiStackingDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingAngle:{type:"integer",max:180,min:0,rebuild:!0},maxCationPiDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxCationPiOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxIonicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondAngle:{type:"integer",max:180,min:0,rebuild:!0},maxMetalDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},refineSaltBridges:{type:"boolean",rebuild:!0},masterModelIndex:{type:"integer",max:1e3,min:-1,rebuild:!0},lineOfSightDistFactor:{type:"number",precision:1,max:10,min:0,rebuild:!0},radialSegments:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){var t=e||{};t.radiusSize=bp(t.radiusSize,.05),t.useInteriorColor=bp(t.useInteriorColor,!0),this.hydrogenBond=bp(t.hydrogenBond,!0),this.weakHydrogenBond=bp(t.weakHydrogenBond,!1),this.waterHydrogenBond=bp(t.waterHydrogenBond,!1),this.backboneHydrogenBond=bp(t.backboneHydrogenBond,!1),this.hydrophobic=bp(t.hydrophobic,!1),this.halogenBond=bp(t.halogenBond,!0),this.ionicInteraction=bp(t.ionicInteraction,!0),this.metalCoordination=bp(t.metalCoordination,!0),this.cationPi=bp(t.cationPi,!0),this.piStacking=bp(t.piStacking,!0),this.filterSele=bp(t.filterSele,""),this.labelVisible=bp(t.labelVisible,!1),this.labelFixedSize=bp(t.labelFixedSize,!1),this.labelSize=bp(t.labelSize,2),this.labelUnit=bp(t.labelUnit,""),this.maxHydrophobicDist=bp(t.maxHydrophobicDist,4),this.maxHbondDist=bp(t.maxHbondDist,3.5),this.maxHbondSulfurDist=bp(t.maxHbondSulfurDist,4.1),this.maxHbondAccAngle=bp(t.maxHbondAccAngle,45),this.maxHbondDonAngle=bp(t.maxHbondDonAngle,45),this.maxHbondAccPlaneAngle=bp(t.maxHbondAccPlaneAngle,90),this.maxHbondDonPlaneAngle=bp(t.maxHbondDonPlaneAngle,30),this.maxPiStackingDist=bp(t.maxPiStackingDist,5.5),this.maxPiStackingOffset=bp(t.maxPiStackingOffset,2),this.maxPiStackingAngle=bp(t.maxPiStackingAngle,30),this.maxCationPiDist=bp(t.maxCationPiDist,6),this.maxCationPiOffset=bp(t.maxCationPiOffset,2),this.maxIonicDist=bp(t.maxIonicDist,5),this.maxHalogenBondDist=bp(t.maxHalogenBondDist,3.5),this.maxHalogenBondAngle=bp(t.maxHalogenBondAngle,30),this.maxMetalDist=bp(t.maxMetalDist,3),this.refineSaltBridges=bp(t.refineSaltBridges,!0),this.masterModelIndex=bp(t.masterModelIndex,-1),this.lineOfSightDistFactor=bp(t.lineOfSightDistFactor,1),super.init(t)}getAtomRadius(){return 0}getContactData(e){const t={maxHydrophobicDist:this.maxHydrophobicDist,maxHbondDist:this.maxHbondDist,maxHbondSulfurDist:this.maxHbondSulfurDist,maxHbondAccAngle:this.maxHbondAccAngle,maxHbondDonAngle:this.maxHbondDonAngle,maxHbondAccPlaneAngle:this.maxHbondAccPlaneAngle,maxHbondDonPlaneAngle:this.maxHbondDonPlaneAngle,maxPiStackingDist:this.maxPiStackingDist,maxPiStackingOffset:this.maxPiStackingOffset,maxPiStackingAngle:this.maxPiStackingAngle,maxCationPiDist:this.maxCationPiDist,maxCationPiOffset:this.maxCationPiOffset,maxIonicDist:this.maxIonicDist,maxHalogenBondDist:this.maxHalogenBondDist,maxHalogenBondAngle:this.maxHalogenBondAngle,maxMetalDist:this.maxMetalDist,refineSaltBridges:this.refineSaltBridges,masterModelIndex:this.masterModelIndex,lineOfSightDistFactor:this.lineOfSightDistFactor},n={hydrogenBond:this.hydrogenBond,weakHydrogenBond:this.weakHydrogenBond,waterHydrogenBond:this.waterHydrogenBond,backboneHydrogenBond:this.backboneHydrogenBond,hydrophobic:this.hydrophobic,halogenBond:this.halogenBond,ionicInteraction:this.ionicInteraction,metalCoordination:this.metalCoordination,cationPi:this.cationPi,piStacking:this.piStacking,radius:this.radiusSize*this.radiusScale,filterSele:this.filterSele};return cw(rw(e,t),e,n)}createData(e){const t=this.getContactData(e),n=[new aT(bv(t),this.getBufferParams({sphereDetail:1,dullInterior:!0,disableImpostor:this.disableImpostor}))];if(this.labelVisible){const e={size:this.labelSize,unit:this.labelUnit};n.push(new FC(uw(t,e),this.getBufferParams({fixedSize:this.labelFixedSize})))}return{bufferList:n}}}Am.add("contact",xT);class wT extends CC{constructor(e,t,n){super(e,t,n),this.type="dihedral",this.parameters=Object.assign({atomQuad:{type:"hidden",rebuild:!0},extendLine:{type:"boolean",rebuild:!0,default:!0},lineVisible:{type:"boolean",default:!0},planeVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.side=bp(t.side,"double"),t.opacity=bp(t.opacity,.5),this.atomQuad=bp(t.atomQuad,[]),this.extendLine=bp(t.extendLine,!0),this.lineVisible=bp(t.lineVisible,!0),this.planeVisible=bp(t.planeVisible,!0),this.sectorVisible=bp(t.sectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomQuad.length)return;const t=_T(TC(e,this.atomQuad),{extendLine:this.extendLine}),n=this.n=t.labelText.length,i=new Ri(this.labelColor);this.textBuffer=new FC({position:t.labelPosition,size:gg(n,this.labelSize),color:yg(n,i.r,i.g,i.b),text:t.labelText},this.getLabelBufferParams());const r=new Ri(this.colorValue);this.lineLength=t.linePosition1.length/3;const o=yg(this.lineLength,r.r,r.g,r.b);return this.lineBuffer=new HC(wv({position1:t.linePosition1,position2:t.linePosition2,color:o,color2:o}),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),this.planeLength=t.planePosition.length/3,this.planeBuffer=new w_({position:t.planePosition,color:yg(this.planeLength,r.r,r.g,r.b)},this.getBufferParams({visible:this.planeVisible})),this.sectorLength=t.sectorPosition.length/3,this.sectorBuffer=new w_({position:t.sectorPosition,color:yg(this.sectorLength,r.r,r.g,r.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.lineBuffer,this.planeBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const n={},i={},r={};if(e.color){const e=new Ri(this.colorValue);Object.assign(n,{color:yg(this.lineLength,e.r,e.g,e.b),color2:yg(this.lineLength,e.r,e.g,e.b)}),Object.assign(i,{color:yg(this.planeLength,e.r,e.g,e.b)}),Object.assign(r,{color:yg(this.sectorLength,e.r,e.g,e.b)})}this.lineBuffer.setAttributes(n),this.planeBuffer.setAttributes(i),this.sectorBuffer.setAttributes(r)}setParameters(e){var t=!1,n={};return super.setParameters(e,n,t),!e||void 0===e.lineVisible&&void 0===e.sectorVisible&&void 0===e.planeVisible||this.setVisibility(this.visible),e&&e.lineOpacity&&this.lineBuffer.setParameters({opacity:e.lineOpacity}),e&&void 0!==e.opacity&&this.lineBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.lineBuffer.setParameters({linewidth:e.linewidth}),this}setVisibility(e,t){return super.setVisibility(e,!0),this.lineBuffer&&this.lineBuffer.setVisibility(this.lineVisible&&this.visible),this.planeBuffer&&this.planeBuffer.setVisibility(this.planeVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}function _T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=bp(t.angleStep,Math.PI/90),i=e.length,r=e.length/12,o=new Float32Array(r),s=new Float32Array(3*r),a=new Array(r),l=new Array(r),c=new Array(r),u=new Array(r),h=new Array(r);let d=0,p=0,f=0;const m=tv(),g=tv(),y=tv(),v=tv(),b=tv(),x=tv(),w=tv(),_=tv(),S=tv(),M=tv(),A=tv(),C=tv(),T=tv(),E=tv(),P=tv();let I=0;for(var L=0;L<i;L+=12){if(sv(m,e,L),sv(g,e,L+3),sv(y,e,L+6),sv(v,e,L+9),rv(b,m,g),rv(x,y,g),0===cv(x))continue;rv(w,v,y),hv(_,x,.5),ov(S,g,_),dv(b,b),dv(x,x),dv(w,w),rv(_,m,S);const i=iv(_,x)>0;rv(_,v,S);const r=iv(_,x)<0;if(hv(_,x,iv(x,b)),rv(M,b,_),hv(_,x,iv(x,w)),rv(A,w,_),0===cv(M)||0===cv(A))continue;dv(M,M),dv(A,A);const R=o[I]=vv(M,A);a[I]=(dg*R).toFixed(1)+String.fromCharCode(176),nv(E,M,x),dv(E,E),iv(E,A)<0&&yv(E,E),EC(_,S,M,E,R/2),av(_,s,3*I);const k=Math.ceil(R/n),D=k+(t.extendLine?4:2),O=t.extendLine?36:0,N=new Float32Array(3*D),B=new Float32Array(3*D),F=new Float32Array(9*k),z=new Float32Array(O);l[I]=N,c[I]=B,u[I]=F,h[I]=z,t.extendLine&&(i?(rv(_,m,y),dv(_,_),hv(C,_,1/iv(M,_)),ov(C,C,y)):(hv(C,b,1/iv(M,b)),ov(C,C,g)),r?(rv(_,v,g),dv(_,_),hv(T,_,1/iv(A,_)),ov(T,T,g)):(hv(T,w,1/iv(A,w)),ov(T,T,y))),ov(P,S,M);let U=0;t.extendLine?(av(m,N,U),av(C,B,U),U+=3,av(C,N,U),av(P,B,U),U+=3,av(C,z,0),av(P,z,3),av(i?y:g,z,6),av(i?y:g,z,9),av(P,z,12),av(S,z,15)):(av(S,N,U),av(P,B,U),U+=3);const H=function(e,t){const n=9*t;av(S,F,n),av(P,F,n+3),av(P,N,U),EC(P,S,M,E,e),av(P,F,n+6),av(P,B,U),U+=3};let G=0;for(let e=n;e<R;e+=n)H(e,G++);H(R,G++),t.extendLine?(av(P,N,3*(D-2)),av(T,B,3*(D-2)),av(T,N,3*(D-1)),av(v,B,3*(D-1)),av(T,z,18),av(P,z,21),av(r?g:y,z,24),av(r?g:y,z,27),av(P,z,30),av(S,z,33)):(av(P,N,U),av(S,B,U),U+=3),d+=3*D,p+=9*k,f+=O,I+=1}const R=I,k=new Float32Array(d),D=new Float32Array(d),O=new Float32Array(p),N=new Float32Array(f);let B=0,F=0,z=0;for(let U=0;U<R;U++){const e=l[U],t=c[U],n=u[U],i=h[U];Mg(e,k,0,B,e.length),Mg(t,D,0,B,t.length),Mg(n,O,0,F,n.length),Mg(i,N,0,z,i.length),B+=e.length,F+=n.length,z+=i.length}return{labelPosition:s.subarray(0,3*R),labelText:a.slice(0,R),linePosition1:k,linePosition2:D,planePosition:N,sectorPosition:O}}Am.add("dihedral",wT);const ST=3,MT=3;function AT(e,t){function n(e,t){return t in e}const i=Object.assign({},e);for(const r in i)n(i,r)&&n(t,r)&&(i[r]=bp(t[r],i[r]));return i}function CT(e,t){const n=new Ri(e),i=new Float32Array(3*t);return yg(t,n.r,n.g,n.b,i),i}class TT extends AC{constructor(e,t,n){super(e,t,n),this.type="dihedral-histogram",this.parameters=Object.assign({histogramsData:{type:"hidden",rebuild:!0},histogramBinBorderVisible:{type:"boolean",default:!0},scaleBinToSectorArea:{type:"boolean",rebuild:!0,default:!1}},this.parameters),this.init(n)}init(e){const t=e||{},n=AT({histogramBinBorderColor:"grey",adjacentBondArrowColor:"black",distantBondArrowColor:"magenta",frontHistogramColor:"green",backHistogramColor:"blue",opaqueMiddleDiscColor:"white"},t);Object.assign(this,n);const i=AT({histogramsData:[],histogramOpacity:1,opaqueMiddleDiscVisible:!0,opaqueMiddleDiscOpacity:1,histogramBinBorderVisible:!0,histogramBinBorderWidth:1,histogramBinBorderOpacity:.5,bondArrowVisible:!0,bondArrowWidth:2,bondArrowOpacity:1,scaleBinToSectorArea:!1},t);Object.assign(this,i),this.histogramsData.forEach((e=>{const t=AT(n,e);Object.assign(e,t)})),t.side=bp(t.side,"double"),t.opacity=bp(t.opacity,.5),t.radiusType=bp(t.radiusType,"size"),t.radiusSize=bp(t.radiusSize,.15),super.init(t)}getHistogramBinBorderBufferParameters(){return this.getBufferParams({linewidth:this.histogramBinBorderWidth,visible:this.histogramBinBorderVisible,opacity:this.histogramBinBorderOpacity})}getBondArrowsBufferParameters(){return this.getBufferParams({linewidth:this.bondArrowWidth,visible:this.bondArrowVisible,opacity:this.bondArrowOpacity})}getOpaqueMiddleDiscBufferParameters(){return this.getBufferParams({visible:this.opaqueMiddleDiscVisible,opacity:this.opaqueMiddleDiscOpacity})}getHistogramBufferParameters(){return this.getBufferParams({visible:!0,opacity:this.histogramOpacity,side:"double"})}createData(e){if(!e.atomCount||!this.histogramsData.length)return;this.histogramsData.forEach((t=>t.atomPositions=TC(e,[t.atomQuad])));const t=this.scaleBinToSectorArea?function(e){return Math.sqrt(e)}:function(e){return e};function n(e){const t=e.map((e=>e.length)),n=new Float32Array(Pg(t));let i=0;for(let r=0;r<e.length;r++)n.set(e[r],i),i+=e[r].length;return n}function i(e,t){return new HC({position1:n(e.map((e=>e.startPoints))),position2:n(e.map((e=>e.endPoints))),color:n(e.map((e=>e.startColors))),color2:n(e.map((e=>e.endColors)))},t)}function r(e,t){return new w_({position:n(e.map((e=>e.triangles))),color:n(e.map((e=>e.triangleColors)))},t)}this.histogramsData.forEach((e=>e.histogram360Scaled=e.histogram360.map(t)));const o=[];for(let s=0;s<this.histogramsData.length;s++){let e,t=this.histogramsData[s];t.histogram360.length>=3&&(e=ET(t)),"undefined"!==typeof e&&o.push(e)}return this.frontHistogramBinBordersBuffer=i(o.map((e=>e.frontHistogramBinBorders)),this.getHistogramBinBorderBufferParameters()),this.backHistogramBinBordersBuffer=i(o.map((e=>e.backHistogramBinBorders)),this.getHistogramBinBorderBufferParameters()),this.adjacentBondArrowsBuffer=i(o.map((e=>e.adjacentBondArrows)),this.getBondArrowsBufferParameters()),this.distantBondArrowsBuffer=i(o.map((e=>e.distantBondArrows)),this.getBondArrowsBufferParameters()),this.opaqueMiddleDiscBuffer=r(o.map((e=>e.opaqueMiddleDisc)),this.getOpaqueMiddleDiscBufferParameters()),this.frontHistogramBuffer=r(o.map((e=>e.frontHistogram)),this.getHistogramBufferParameters()),this.backHistogramBuffer=r(o.map((e=>e.backHistogram)),this.getHistogramBufferParameters()),{bufferList:[].concat(this.frontHistogramBinBordersBuffer,this.backHistogramBinBordersBuffer,this.adjacentBondArrowsBuffer,this.distantBondArrowsBuffer,this.opaqueMiddleDiscBuffer,this.frontHistogramBuffer,this.backHistogramBuffer)}}setParameters(e){const t=!1,n={};return super.setParameters(e,n,t),e&&void 0!==e.histogramBinBorderVisible&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.frontHistogramBinBordersBuffer&&this.frontHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),this.backHistogramBinBordersBuffer&&this.backHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),t||this.viewer.requestRender(),this}}function ET(e){const t=e.atomPositions,n=e.histogram360Scaled,i=n.length<=180?360:2*n.length,r=2,o={triangles:new Float32Array(i*MT*ST),triangleColors:CT(e.opaqueMiddleDiscColor,i*MT)},s={triangles:new Float32Array(n.length*MT*ST),triangleColors:CT(e.frontHistogramColor,n.length*MT)},a={triangles:new Float32Array(n.length*MT*ST),triangleColors:CT(e.backHistogramColor,n.length*MT)},l={startPoints:new Float32Array(n.length*ST),endPoints:new Float32Array(n.length*ST),startColors:CT(e.histogramBinBorderColor,n.length),endColors:CT(e.histogramBinBorderColor,n.length)},c={startPoints:new Float32Array(n.length*ST),endPoints:new Float32Array(n.length*ST),startColors:CT(e.histogramBinBorderColor,n.length),endColors:CT(e.histogramBinBorderColor,n.length)},u={startPoints:new Float32Array(r*ST),endPoints:new Float32Array(r*ST),startColors:CT(e.adjacentBondArrowColor,n.length),endColors:CT(e.adjacentBondArrowColor,n.length)},h={startPoints:new Float32Array(r*ST),endPoints:new Float32Array(r*ST),startColors:CT(e.distantBondArrowColor,n.length),endColors:CT(e.distantBondArrowColor,n.length)},d=tv(),p=tv(),f=tv(),m=tv(),g=tv(),y=tv(),v=tv(),b=tv(),x=tv(),w=tv(),_=tv(),S=tv(),M=tv(),A=tv(),C=tv(),T=tv(),E=[d,p,f,m];for(let B=0;B<E.length;B++)sv(E[B],t,B*ST);if(rv(g,d,p),rv(y,f,p),rv(b,m,f),0===cv(y))return;if(hv(C,y,.5),ov(x,p,C),dv(g,g),dv(y,y),dv(b,b),yv(v,y),hv(C,v,iv(v,g)),rv(w,g,C),hv(C,y,iv(y,b)),rv(_,b,C),0===cv(w)||0===cv(_))return;dv(w,w),dv(_,_);const P=Math.acos(iv(w,_));nv(S,v,w),nv(M,y,_),dv(S,S),dv(M,M);let I=P;iv(S,_)<0&&(I=-P),ov(A,x,w);const L=Math.max.apply(null,n),R=2*Math.PI/n.length;function k(e,t,i,r,o){const s=t*MT*ST;av(x,e,s);const a=Number(n[t])/L;hv(C,i,a),hv(T,r,a),EC(A,x,C,T,t*o),av(A,e,s+1*ST),EC(A,x,C,T,(t+1)*o),av(A,e,s+2*ST)}function D(e,t,i,r,o){Mg(x,u.startPoints,0,i*ST,x.length),EC(C,x,r,o,0+0*R),Mg(C,u.endPoints,0,i*ST,x.length),Mg(x,h.startPoints,0,i*ST,x.length),EC(C,x,r,o,I),Mg(C,h.endPoints,0,i*ST,x.length);for(let s=0;s<n.length;s++)Mg(x,t.startPoints,0,3*s,x.length),EC(C,x,r,o,0+R*s),Mg(C,t.endPoints,0,3*s,C.length);for(let s=0;s<n.length;s++)k(e.triangles,s,r,o,R)}const O=2*Math.PI/i;for(let B=0;B<i;B++){const e=B*MT*ST;av(x,o.triangles,e),EC(A,x,w,S,B*O),av(A,o.triangles,e+1*ST),EC(A,x,w,S,(B+1)*O),av(A,o.triangles,e+2*ST)}const N=.01;return hv(C,y,-N),ov(x,x,C),D(s,l,0,w,S),hv(C,y,2*N),ov(x,x,C),D(a,c,1,_,M),{opaqueMiddleDisc:o,frontHistogram:s,backHistogram:a,frontHistogramBinBorders:l,backHistogramBinBorders:c,adjacentBondArrows:u,distantBondArrows:h}}Am.add("dihedral-histogram",TT);class PT extends CC{constructor(e,t,n){super(e,t,n),this.type="distance",this.parameters=Object.assign({radialSegments:!0,openEnded:!0,disableImpostor:!0,labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},useCylinder:{type:"boolean",rebuild:!0},atomPair:{type:"hidden",rebuild:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.linewidth=bp(t.linewidth,5),t.radiusType=bp(t.radiusType,"size"),t.radiusSize=bp(t.radiusSize,.2),this.labelUnit=bp(t.labelUnit,""),this.useCylinder=bp(t.useCylinder,!1),this.atomPair=bp(t.atomPair,[]),super.init(t)}getDistanceData(e,t){let n=t.length;const i=new Array(n);let r=new Float32Array(3*n);const o=new Kf,s=new Kf,a=new Q_,l=e.getAtomProxy(),c=e.getAtomProxy();let u=0;const h=e.getAtomSet();t.forEach(((t,n)=>{let d=t[0],p=t[1];if("number"===typeof d&&Number.isInteger(d)&&"number"===typeof p&&Number.isInteger(p)){if(!h.get(d)||!h.get(p))return void(u+=1);l.index=d,c.index=p}else{o.setString(d),s.setString(p);var f=e.getAtomIndices(o),m=e.getAtomIndices(s);if(!f.length||!m.length)return void(u+=1);l.index=f[0],c.index=m[0]}a.addBond(l,c,1),n-=u;var g=l.distanceTo(c);switch(this.labelUnit){case"angstrom":i[n]=g.toFixed(2)+" "+String.fromCharCode(8491);break;case"nm":i[n]=(g/10).toFixed(2)+" nm";break;default:i[n]=g.toFixed(2)}var y=3*n;r[y+0]=(l.x+c.x)/2,r[y+1]=(l.y+c.y)/2,r[y+2]=(l.z+c.z)/2})),u>0&&(n-=u,r=r.subarray(0,3*n));var d=new Gv(a.count,!0);return{text:i,position:r,bondSet:d,bondStore:a}}getBondData(e,t,n){const i=e.getBondData(this.getBondParams(t,n));return i.picking&&(i.picking=new ww(i.picking.array,i.picking.structure,n.bondStore)),i}createData(e){if(!e.atomCount||!this.atomPair.length)return;const t=this.atomPair.length,n=new Ri(this.labelColor),i=this.getDistanceData(e,this.atomPair);this.textBuffer=new FC({position:i.position,size:gg(t,this.labelSize),color:yg(t,n.r,n.g,n.b),text:i.text},this.getLabelBufferParams());const r={bondSet:i.bondSet,bondStore:i.bondStore},o=this.getBondData(e,{position:!0,color:!0,picking:!0,radius:this.useCylinder},r);return this.useCylinder?this.distanceBuffer=new aT(o,this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})):this.distanceBuffer=new HC(xv(o),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),{bondSet:i.bondSet,bondStore:i.bondStore,position:i.position,bufferList:[this.textBuffer,this.distanceBuffer]}}updateData(e,t){super.updateData(e,t);const n={bondSet:t.bondSet,bondStore:t.bondStore},i=this.getBondData(t.sview,e,n),r={};e&&!e.color||Object.assign(r,{color:i.color,color2:i.color2}),e&&!e.radius||Object.assign(r,{radius:i.radius}),this.distanceBuffer.setAttributes(r)}setParameters(e){let t=!1;const n={};return super.setParameters(e,n,t),this.useCylinder||(e&&e.lineOpacity&&this.distanceBuffer.setParameters({opacity:e.lineOpacity}),e&&void 0!==e.opacity&&this.distanceBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.distanceBuffer.setParameters({linewidth:e.linewidth})),this}}function IT(e){return e.position.length/3*2*3}Am.add("distance",PT);const LT=Object.assign({scale:1,color:"grey"},v_);class RT extends x_{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super({position:new Float32Array(IT(e)),color:new Float32Array(IT(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag";const n=new Ri(this.parameters.color),i=this.geometry.attributes;yg(IT(e)/3,n.r,n.g,n.b,i.color.array),this.setAttributes(e)}get defaultParameters(){return LT}setAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.geometry.attributes;let n,i,r;e.position&&e.vector&&(n=e.position,i=e.vector,r=t.position.array,t.position.needsUpdate=!0);const o=this.size/2,s=this.parameters.scale;if(n&&i)for(let a=0;a<o;a++){const e=2*a*3,t=3*a;r[e+0]=n[t+0],r[e+1]=n[t+1],r[e+2]=n[t+2],r[e+3]=n[t+0]+i[t+0]*s,r[e+4]=n[t+1]+i[t+1]*s,r[e+5]=n[t+2]+i[t+2]*s}}}class kT extends AC{constructor(e,t,n){super(e,t,n),this.type="helixorient",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){const t=e||{};t.colorScheme=bp(t.colorScheme,"sstruc"),t.radiusType=bp(t.radiusType,"size"),t.radiusSize=bp(t.radiusSize,.15),t.radiusScale=bp(t.radiusScale,1),t.useInteriorColor=bp(t.useInteriorColor,!0),super.init(t)}createData(e){const t=[],n=[];return this.structure.eachPolymer((e=>{if(e.residueCount<4)return;n.push(e);const i=new iS(e),r=i.getPosition(),o=i.getColor(this.getColorParams()),s=i.getSize(this.getRadiusParams()),a=i.getPicking();t.push(new PM({position:r.center,color:o.color,radius:s.size,picking:a.picking},this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),new RT({position:r.center,vector:r.axis},this.getBufferParams({color:"skyblue",scale:1})),new RT({position:r.center,vector:r.resdir},this.getBufferParams({color:"lightgreen",scale:1})))}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(t,n){e.Debug&&gm.time(this.type+" repr update"),t=t||{};for(let e=0,i=n.polymerList.length;e<i;++e){const i=3*e,r={},o=n.polymerList[e],s=new iS(o);if(t.position){const e=s.getPosition();Object.assign(r,{position:e.center}),n.bufferList[i+1].setAttributes({position:e.center,vector:e.axis}),n.bufferList[i+2].setAttributes({position:e.center,vector:e.resdir})}n.bufferList[i].setAttributes(r)}e.Debug&&gm.timeEnd(this.type+" repr update")}}Am.add("helixorient",kT);class DT extends cT{constructor(e,t,n){super(e,t,n),this.type="licorice",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,super.init(t)}}Am.add("licorice",DT),Tm.add("shader/HyperballStickImpostor.vert","\nattribute vec3 mapping;\nattribute float radius;\nattribute float radius2;\nattribute vec3 position1;\nattribute vec3 position2;\nvarying mat4 matrix_near;\nvarying vec4 prime1;\nvarying vec4 prime2;\nvarying float vRadius;\nvarying float vRadius2;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\nattribute vec3 color2;\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#endif\nuniform float shrink;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewProjectionMatrixInverse;\nvoid main(){\nvRadius = radius;\nvRadius2 = radius2;\nvec4 spaceposition;\nvec3 position_atom1;\nvec3 position_atom2;\nvec4 vertex_position;\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\nvColor1 = color;\nvColor2 = color2;\n#endif\nfloat radius1 = radius;\nposition_atom1 = position1;\nposition_atom2 = position2;\nfloat distance = distance( position_atom1, position_atom2 );\nspaceposition.z = mapping.z * distance;\nif (radius1 > radius2) {\nspaceposition.y = mapping.y * 1.5 * radius1;\nspaceposition.x = mapping.x * 1.5 * radius1;\n} else {\nspaceposition.y = mapping.y * 1.5 * radius2;\nspaceposition.x = mapping.x * 1.5 * radius2;\n}\nspaceposition.w = 1.0;\nvec4 e3 = vec4( 1.0 );\nvec3 e1, e1_temp, e2, e2_temp;\ne3.xyz = normalize(position_atom1-position_atom2);\nif (e3.z == 0.0) { e3.z = 0.0000000000001;}\nif ( (position_atom1.x - position_atom2.x) == 0.0) { position_atom1.x += 0.001;}\nif ( (position_atom1.y - position_atom2.y) == 0.0) { position_atom1.y += 0.001;}\nif ( (position_atom1.z - position_atom2.z) == 0.0) { position_atom1.z += 0.001;}\nvec4 focus = vec4( 1.0 );\nfocus.x = ( position_atom1.x*position_atom1.x - position_atom2.x*position_atom2.x +\n( radius2*radius2 - radius1*radius1 )*e3.x*e3.x/shrink )/(2.0*(position_atom1.x - position_atom2.x));\nfocus.y = ( position_atom1.y*position_atom1.y - position_atom2.y*position_atom2.y +\n( radius2*radius2 - radius1*radius1 )*e3.y*e3.y/shrink )/(2.0*(position_atom1.y - position_atom2.y));\nfocus.z = ( position_atom1.z*position_atom1.z - position_atom2.z*position_atom2.z +\n( radius2*radius2 - radius1*radius1 )*e3.z*e3.z/shrink )/(2.0*(position_atom1.z - position_atom2.z));\ne1.x = 1.0;\ne1.y = 1.0;\ne1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;\ne1_temp = e1 - focus.xyz;\ne1 = normalize(e1_temp);\ne2_temp = e1.yzx * e3.zxy - e1.zxy * e3.yzx;\ne2 = normalize(e2_temp);\nmat3 R= mat3( e1.xyz, e2.xyz, e3.xyz );\nvertex_position.xyz = R * spaceposition.xyz;\nvertex_position.w = 1.0;\nvertex_position.x += (position_atom1.x+position_atom2.x) / 2.0;\nvertex_position.y += (position_atom1.y+position_atom2.y) / 2.0;\nvertex_position.z += (position_atom1.z+position_atom2.z) / 2.0;\ngl_Position = modelViewProjectionMatrix * vertex_position;\nvec4 i_near, i_far;\nvec4 near = gl_Position;\nnear.z = 0.0 ;\nnear = modelViewProjectionMatrixInverse * near;\ni_near = near;\nvec4 far = gl_Position;\nfar.z = far.w ;\ni_far = modelViewProjectionMatrixInverse * far;\nprime1 = vec4( position_atom1 - (position_atom1 - focus.xyz)*shrink, 1.0 );\nprime2 = vec4( position_atom2 - (position_atom2 - focus.xyz)*shrink, 1.0 );\nfloat Rsquare = (radius1*radius1/shrink) - (\n(position_atom1.x - focus.x)*(position_atom1.x - focus.x) +\n(position_atom1.y - focus.y)*(position_atom1.y - focus.y) +\n(position_atom1.z - focus.z)*(position_atom1.z - focus.z)\n);\nfocus.w = Rsquare;\nmatrix_near = mat4( i_near, i_far, focus, e3 );\ngl_Position.z = 1.0;\n}"),Tm.add("shader/HyperballStickImpostor.frag","#define STANDARD\n#define IMPOSTOR\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 interiorColor;\nuniform float interiorDarkening;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float clipNear;\nuniform float shrink;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrixInverseTranspose;\nuniform mat4 projectionMatrix;\nvarying mat4 matrix_near;\nvarying vec4 prime1;\nvarying vec4 prime2;\nvarying float vRadius;\nvarying float vRadius2;\n#ifdef PICKING\nuniform float objectId;\nvarying vec3 vPickingColor;\n#else\nvarying vec3 vColor1;\nvarying vec3 vColor2;\n#include common\n#include fog_pars_fragment\n#include bsdfs\n#include lights_pars_begin\n#include lights_physical_pars_fragment\n#endif\nbool interior = false;\nfloat calcClip( vec4 cameraPos ){\nreturn dot( cameraPos, vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );\n}\nfloat calcClip( vec3 cameraPos ){\nreturn calcClip( vec4( cameraPos, 1.0 ) );\n}\nfloat calcDepth( in vec3 cameraPos ){\nvec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;\nreturn 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\nstruct Ray {\nvec3 origin ;\nvec3 direction ;\n};\nbool cutoff_plane (vec3 M, vec3 cutoff, vec3 x3){\nfloat a = x3.x;\nfloat b = x3.y;\nfloat c = x3.z;\nfloat d = -x3.x*cutoff.x-x3.y*cutoff.y-x3.z*cutoff.z;\nfloat l = a*M.x+b*M.y+c*M.z+d;\nif (l<0.0) {return true;}\nelse{return false;}\n}\nvec3 isect_surf(Ray r, mat4 matrix_coef){\nvec4 direction = vec4(r.direction, 0.0);\nvec4 origin = vec4(r.origin, 1.0);\nfloat a = dot(direction,(matrix_coef*direction));\nfloat b = dot(origin,(matrix_coef*direction));\nfloat c = dot(origin,(matrix_coef*origin));\nfloat delta =b*b-a*c;\ngl_FragColor.a = 1.0;\nif (delta<0.0){\ndiscard;\n}\nfloat t1 =(-b-sqrt(delta))/a;\nreturn r.origin+t1*r.direction;\n}\nvec3 isect_surf2(Ray r, mat4 matrix_coef){\nvec4 direction = vec4(r.direction, 0.0);\nvec4 origin = vec4(r.origin, 1.0);\nfloat a = dot(direction,(matrix_coef*direction));\nfloat b = dot(origin,(matrix_coef*direction));\nfloat c = dot(origin,(matrix_coef*origin));\nfloat delta =b*b-a*c;\ngl_FragColor.a = 1.0;\nif (delta<0.0){\ndiscard;\n}\nfloat t2 =(-b+sqrt(delta))/a;\nreturn r.origin+t2*r.direction;\n}\nRay primary_ray(vec4 near1, vec4 far1){\nvec3 near=near1.xyz/near1.w;\nvec3 far=far1.xyz/far1.w;\nreturn Ray(near,far-near);\n}\nfloat update_z_buffer(vec3 M, mat4 ModelViewP){\nfloat depth1;\nvec4 Ms=(ModelViewP*vec4(M,1.0));\nreturn depth1=(1.0+Ms.z/Ms.w)/2.0;\n}\nvoid main(){\nfloat radius = max( vRadius, vRadius2 );\nvec4 i_near, i_far, focus;\nvec3 e3, e1, e1_temp, e2;\ni_near = vec4(matrix_near[0][0],matrix_near[0][1],matrix_near[0][2],matrix_near[0][3]);\ni_far = vec4(matrix_near[1][0],matrix_near[1][1],matrix_near[1][2],matrix_near[1][3]);\nfocus = vec4(matrix_near[2][0],matrix_near[2][1],matrix_near[2][2],matrix_near[2][3]);\ne3 = vec3(matrix_near[3][0],matrix_near[3][1],matrix_near[3][2]);\ne1.x = 1.0;\ne1.y = 1.0;\ne1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;\ne1_temp = e1 - focus.xyz;\ne1 = normalize(e1_temp);\ne2 = normalize(cross(e1,e3));\nvec4 equation = focus;\nfloat shrinkfactor = shrink;\nfloat t1 = -1.0/(1.0-shrinkfactor);\nfloat t2 = 1.0/(shrinkfactor);\nvec4 colonne1, colonne2, colonne3, colonne4;\nmat4 mat;\nvec3 equation1 = vec3(t2,t2,t1);\nfloat A1 = - e1.x*equation.x - e1.y*equation.y - e1.z*equation.z;\nfloat A2 = - e2.x*equation.x - e2.y*equation.y - e2.z*equation.z;\nfloat A3 = - e3.x*equation.x - e3.y*equation.y - e3.z*equation.z;\nfloat A11 = equation1.x*e1.x*e1.x + equation1.y*e2.x*e2.x + equation1.z*e3.x*e3.x;\nfloat A21 = equation1.x*e1.x*e1.y + equation1.y*e2.x*e2.y + equation1.z*e3.x*e3.y;\nfloat A31 = equation1.x*e1.x*e1.z + equation1.y*e2.x*e2.z + equation1.z*e3.x*e3.z;\nfloat A41 = equation1.x*e1.x*A1 + equation1.y*e2.x*A2 + equation1.z*e3.x*A3;\nfloat A22 = equation1.x*e1.y*e1.y + equation1.y*e2.y*e2.y + equation1.z*e3.y*e3.y;\nfloat A32 = equation1.x*e1.y*e1.z + equation1.y*e2.y*e2.z + equation1.z*e3.y*e3.z;\nfloat A42 = equation1.x*e1.y*A1 + equation1.y*e2.y*A2 + equation1.z*e3.y*A3;\nfloat A33 = equation1.x*e1.z*e1.z + equation1.y*e2.z*e2.z + equation1.z*e3.z*e3.z;\nfloat A43 = equation1.x*e1.z*A1 + equation1.y*e2.z*A2 + equation1.z*e3.z*A3;\nfloat A44 = equation1.x*A1*A1 + equation1.y*A2*A2 + equation1.z*A3*A3 - equation.w;\ncolonne1 = vec4(A11,A21,A31,A41);\ncolonne2 = vec4(A21,A22,A32,A42);\ncolonne3 = vec4(A31,A32,A33,A43);\ncolonne4 = vec4(A41,A42,A43,A44);\nmat = mat4(colonne1,colonne2,colonne3,colonne4);\nRay ray = primary_ray(i_near,i_far) ;\nvec3 M;\nM = isect_surf(ray, mat);\nif (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }\nvec4 M1 = vec4(M,1.0);\nvec4 M2 = mat*M1;\nvec3 _normal = ( modelViewMatrixInverseTranspose * M2 ).xyz;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\n#ifdef NEAR_CLIP\nif( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 ){\nM = isect_surf2(ray, mat);\nif( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 )\ndiscard;\ninterior = true;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / radius ) );\n}\n}else if( gl_FragDepthEXT <= 0.0 ){\nM = isect_surf2(ray, mat);\ninterior = true;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix);\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );\n}\n}\n#else\nif( gl_FragDepthEXT <= 0.0 ){\nM = isect_surf2(ray, mat);\ninterior = true;\ngl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;\nif( gl_FragDepthEXT >= 0.0 ){\ngl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );\n}\n}\n#endif\nif (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }\nif (gl_FragDepthEXT < 0.0)\ndiscard;\nif (gl_FragDepthEXT > 1.0)\ndiscard;\nfloat distance_ratio = ((M.x-prime2.x)*e3.x + (M.y-prime2.y)*e3.y +(M.z-prime2.z)*e3.z) /\ndistance(prime2.xyz,prime1.xyz);\n#ifdef PICKING\nif( opacity < 0.3 )\ndiscard;\ngl_FragColor = vec4( vPickingColor, objectId );\n#else\nvec3 vViewPosition = -( modelViewMatrix * vec4( M, 1.0 ) ).xyz;\nvec3 vNormal = _normal;\nvec3 vColor;\nif( distance_ratio>0.5 ){\nvColor = vColor1;\n}else{\nvColor = vColor2;\n}\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveLight = emissive;\n#include color_fragment\n#include roughnessmap_fragment\n#include metalnessmap_fragment\nvec3 normal = normalize( vNormal );\nvec3 geometryNormal = normal;\n#include lights_physical_fragment\n#include lights_fragment_begin\n#include lights_fragment_end\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\nif( interior ){\n#ifdef USE_INTERIOR_COLOR\noutgoingLight.xyz = interiorColor;\n#else\n#ifdef DIFFUSE_INTERIOR\noutgoingLight.xyz = vColor;\n#endif\n#endif\noutgoingLight.xyz *= 1.0 - interiorDarkening;\n}\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include premultiplied_alpha_fragment\n#include tonemapping_fragment\n#include encodings_fragment\n#include fog_fragment\n#endif\n}");const OT=new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1]),NT=new Uint16Array([0,1,2,0,2,3,1,5,6,1,6,2,4,6,5,4,7,6,0,7,4,0,3,7,0,5,1,0,4,5,3,2,6,3,6,7]);class BT extends SM{constructor(e){super("v3",e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}get mapping(){return OT}get mappingIndices(){return NT}get mappingIndicesSize(){return 36}get mappingSize(){return 8}get mappingItemSize(){return 3}}const FT=Object.assign({shrink:.14},v_),zT=Object.assign({shrink:{uniform:!0}},b_);class UT extends BT{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.parameterTypes=zT,this.isImpostor=!0,this.vertexShader="HyperballStickImpostor.vert",this.fragmentShader="HyperballStickImpostor.frag",this.addUniforms({modelViewProjectionMatrix:{value:new Sn},modelViewProjectionMatrixInverse:{value:new Sn},modelViewMatrixInverseTranspose:{value:new Sn},shrink:{value:this.parameters.shrink}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null},radius2:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return FT}}Object.assign({disableImpostor:!1},ZC,FT);class HT{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!fm||t&&t.disableImpostor?(e.radius=Sg(e.radius,e.radius2),new JC(e,t)):new UT(e,t)}}const GT=HT;class VT extends DT{constructor(e,t,n){super(e,t,n),this.type="hyperball",this.parameters=Object.assign({shrink:{type:"number",precision:3,max:1,min:.001,buffer:!0}},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){var t=e||{};t.radiusScale=bp(t.radiusScale,.2),t.radiusType=bp(t.radiusType,"vdw"),t.useInteriorColor=bp(t.useInteriorColor,!0),this.shrink=bp(t.shrink,.12),super.init(t)}getBondParams(e,t){return e&&!e.radius||(t=Object.assign({radius2:!0},t)),super.getBondParams(e,t)}createData(e){var t=new PM(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));return this.__center=new Float32Array(3*e.bondCount),{bufferList:[t,new GT(e.getBondData(this.getBondParams()),this.getBufferParams({shrink:this.shrink,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams()),i=t.sview.getBondData(this.getBondParams()),r={},o={};if(!e||e.position){Object.assign(r,{position:n.position});var s=i.position1,a=i.position2;Object.assign(o,{position:fg(s,a,this.__center),position1:s,position2:a})}e&&!e.color||(Object.assign(r,{color:n.color}),Object.assign(o,{color:i.color,color2:i.color2})),e&&!e.radius||(Object.assign(r,{radius:n.radius}),Object.assign(o,{radius:i.radius,radius2:i.radius2})),t.bufferList[0].setAttributes(r),t.bufferList[1].setAttributes(o)}}Am.add("hyperball",VT);const jT={"":"",atomname:"atom name",atomindex:"atom index",occupancy:"occupancy",bfactor:"b-factor",serial:"serial",element:"element",atom:"atom name + index",resname:"residue name",resno:"residue no",res:"one letter code + no",residue:"[residue name] + no + inscode",text:"text",format:"format",qualified:"qualified name"};class $T{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.type=e,this.text=t,this.format=n,this.errorLogged=!1}atomLabel(e){let t;switch(this.type){case"atomname":t=e.atomname;break;case"atomindex":t="".concat(e.index);break;case"occupancy":t=e.occupancy.toFixed(2);break;case"bfactor":t=e.bfactor.toFixed(2);break;case"serial":t="".concat(e.serial);break;case"element":t=e.element;break;case"atom":t="".concat(e.atomname,"|").concat(e.index);break;case"resname":t=e.resname;break;case"resno":t="".concat(e.resno);break;case"res":t="".concat(kb[e.resname.toUpperCase()]||e.resname).concat(e.resno);break;case"residue":const n=kb[e.resname.toUpperCase()];t=n&&!e.inscode?"".concat(n).concat(e.resno):"[".concat(e.resname,"]").concat(e.resno).concat(e.inscode);break;case"text":t=this.text[e.index];break;case"format":try{t=jm.sprintf(this.format,e)}catch(CD){this.errorLogged||(this.errorLogged=!0,console.log(CD.message))}break;default:t=e.qualifiedName()}return void 0===t?"":t}}$T.types=jT;class WT extends AC{constructor(e,t,n){super(e,t,n),this.type="label",this.parameters=Object.assign({labelType:{type:"select",options:$T.types,rebuild:!0},labelText:{type:"hidden",rebuild:!0},labelFormat:{type:"text",rebuild:!0},labelGrouping:{type:"select",options:{atom:"atom",residue:"residue"},rebuild:!0},fontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:!0},fontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:!0},fontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:!0},xOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},yOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},zOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},attachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},showBorder:{type:"boolean",buffer:!0},borderColor:{type:"color",buffer:!0},borderWidth:{type:"number",precision:2,max:.3,min:0,buffer:!0},showBackground:{type:"boolean",rebuild:!0},backgroundColor:{type:"color",buffer:!0},backgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},backgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:!0},fixedSize:{type:"boolean",buffer:!0}},this.parameters,{side:null,flatShaded:null,wireframe:null,linewidth:null,roughness:null,metalness:null,diffuse:null}),this.init(n)}init(e){const t=e||{};this.labelType=bp(t.labelType,"res"),this.labelText=bp(t.labelText,{}),this.labelFormat=bp(t.labelFormat,""),this.labelGrouping=bp(t.labelGrouping,"atom"),this.fontFamily=bp(t.fontFamily,"sans-serif"),this.fontStyle=bp(t.fontStyle,"normal"),this.fontWeight=bp(t.fontWeight,"bold"),this.xOffset=bp(t.xOffset,0),this.yOffset=bp(t.yOffset,0),this.zOffset=bp(t.zOffset,.5),this.attachment=bp(t.attachment,"bottom-left"),this.showBorder=bp(t.showBorder,!1),this.borderColor=bp(t.borderColor,"lightgrey"),this.borderWidth=bp(t.borderWidth,.15),this.showBackground=bp(t.showBackground,!1),this.backgroundColor=bp(t.backgroundColor,"lightgrey"),this.backgroundMargin=bp(t.backgroundMargin,.5),this.backgroundOpacity=bp(t.backgroundOpacity,1),this.fixedSize=bp(t.fixedSize,!1),super.init(t)}getTextData(e,t){const n=this.getAtomParams(t),i=new $T(this.labelType,this.labelText,this.labelFormat);let r,o,s,a,l,c,u;if("atom"===this.labelGrouping){const l=e.getAtomData(n);r=l.position,o=l.radius,s=l.color,t&&!t.text||(a=[],e.eachAtom((e=>a.push(i.atomLabel(e)))))}else if("residue"===this.labelGrouping){t&&!t.position||(l=[]),t&&!t.color||(u=[]),t&&!t.radius||(c=[]),t&&!t.text||(a=[]),n.colorParams&&(n.colorParams.structure=e.getStructure());const h=Sm.getScheme(n.colorParams),d=new W_(n.radiusParams),p=e.getAtomProxy();let f=0;e.eachResidue((e=>{const n=3*f;e.isProtein()||e.isNucleic()?(p.index=e.traceAtomIndex,t&&!t.position||p.positionToArray(l,n)):(p.index=e.atomOffset,t&&!t.position||e.positionToArray(l,n)),t&&!t.color||h.atomColorToArray(p,u,n),t&&!t.radius||(c[f]=d.atomRadius(p)),t&&!t.text||a.push(i.atomLabel(p)),++f})),t&&!t.position||(r=new Float32Array(l)),t&&!t.color||(s=new Float32Array(u)),t&&!t.radius||(o=new Float32Array(c))}return{position:r,size:o,color:s,text:a}}createData(e){const t={position:!0,color:!0,radius:!0,text:!0};return{bufferList:[new FC(this.getTextData(e,t),this.getBufferParams({fontFamily:this.fontFamily,fontStyle:this.fontStyle,fontWeight:this.fontWeight,xOffset:this.xOffset,yOffset:this.yOffset,zOffset:this.zOffset,attachment:this.attachment,showBorder:this.showBorder,borderColor:this.borderColor,borderWidth:this.borderWidth,showBackground:this.showBackground,backgroundColor:this.backgroundColor,backgroundMargin:this.backgroundMargin,backgroundOpacity:this.backgroundOpacity,fixedSize:this.fixedSize}))]}}updateData(e,t){t.bufferList[0].setAttributes(this.getTextData(t.sview,e))}getAtomRadius(){return 0}}function qT(e){const t=e.getAtomSet(),n=e.getBondSet(),i=e.getBondProxy();return n.forEach((function(e){i.index=e,t.clear(i.atomIndex1),t.clear(i.atomIndex2)})),t}Am.add("label",WT);class XT extends AC{constructor(e,t,n){super(e,t,n),this.type="line",this.parameters=Object.assign({multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0},lines:{type:"boolean",rebuild:!0},crosses:{type:"select",rebuild:!0,options:{off:"off",lone:"lone",all:"all"}},crossSize:{type:"number",precision:2,max:2,min:.1}},this.parameters,{flatShaded:null,side:null,wireframe:null,roughness:null,metalness:null}),this.init(n)}init(e){var t=e||{};this.multipleBond=bp(t.multipleBond,"off"),this.bondSpacing=bp(t.bondSpacing,1),this.linewidth=bp(t.linewidth,2),this.lines=bp(t.lines,!0),this.crosses=bp(t.crosses,"lone"),this.crossSize=bp(t.crossSize,.4),super.init(t)}getAtomRadius(e){return.1}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,radiusParams:{type:"size",size:.1,scale:1}},t),super.getBondParams(e,t)}_crossData(e,t){if(e&&!e.position&&!e.color)return;const n={};"lone"===this.crosses&&Object.assign(n,{atomSet:qT(t)});const i=t.getAtomData(this.getAtomParams(e,n)),r={},o=i.position,s=i.color,a=i.picking,l=(o||s).length,c=3*l;let u=new Float32Array(0),h=new Float32Array(0),d=new Float32Array(0),p=new Float32Array(0),f=0,m=new Float32Array(0);e&&!e.position||(u=r.position1=new Float32Array(c),h=r.position2=new Float32Array(c),f=this.crossSize/2),e&&!e.color||(d=r.color=new Float32Array(c),p=r.color2=new Float32Array(c)),e&&!e.picking||(m=new Float32Array(3*i.picking.array.length));for(let g=0;g<l;g++){const t=3*g,n=3*t;if(!e||e.position){const e=o[t],i=o[t+1],r=o[t+2];u[n]=e-f,u[n+1]=i,u[n+2]=r,h[n]=e+f,h[n+1]=i,h[n+2]=r,u[n+3]=e,u[n+4]=i-f,u[n+5]=r,h[n+3]=e,h[n+4]=i+f,h[n+5]=r,u[n+6]=e,u[n+7]=i,u[n+8]=r-f,h[n+6]=e,h[n+7]=i,h[n+8]=r+f}if(!e||e.color){const e=n+9;for(let i=n;i<e;i+=3)d[i]=p[i]=s[t],d[i+1]=p[i+1]=s[t+1],d[i+2]=p[i+2]=s[t+2]}e&&!e.picking||(m[t]=m[t+1]=m[t+2]=a.array[g])}return e&&!e.picking||(r.picking=new mw(m,a.structure)),r}createData(e){const t={position:!0,color:!0,picking:!0},n=[];if(this.lines){const i=e.getBondData(this.getBondParams(t)),r=new HC(i,this.getBufferParams({linewidth:this.linewidth}));n.push(r)}if("off"!==this.crosses){const i=new HC(this._crossData(t,e),this.getBufferParams({linewidth:this.linewidth}));n.push(i)}return{bufferList:n}}updateData(e,t){let n=0;if(this.lines){const i=t.sview.getBondData(this.getBondParams(e)),r={};e&&!e.position||Object.assign(r,{position1:i.position1,position2:i.position2}),e&&!e.color||Object.assign(r,{color:i.color,color2:i.color2}),t.bufferList[n++].setAttributes(r)}if("off"!==this.crosses){const i=this._crossData(e,t.sview),r={};e&&!e.position||Object.assign(r,{position1:i.position1,position2:i.position2}),e&&!e.color||Object.assign(r,{color:i.color,color2:i.color2}),t.bufferList[n++].setAttributes(r)}}setParameters(e){var t=!1,n={};return e&&(e.bondSpacing||e.crossSize)&&Object.assign(n,{position:!0}),super.setParameters(e,n,t),this}}function YT(e,t,n,i,r){const o=new(i=i||Int32Array)(e*t*n*(r=r||1));function s(e,i,o){return((e*t+i)*n+o)*r}function a(e,t,n){const i=s(e,t,n);for(let s=0;s<r;++s)o[i+s]=s+3<3||arguments.length<=s+3?void 0:arguments[s+3]}function l(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const l=s(e,t,n);for(let s=0;s<r;++s)i[a+s]=o[l+s]}function c(e,t,n,i){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const l=s(e,t,n);for(let s=0;s<r;++s)o[l+s]=i[a+s]}function u(e){o.set(e.data)}return{data:o,index:s,set:a,toArray:l,fromArray:c,copy:u}}function ZT(e,t,n){var i=u_(t),r=Ky(e);0===e.length&&(r[0].set([0,0,0]),r[1].set([0,0,0]));var o,s,a,l,c,u,h,d,p,f,m,g,y,v,b,x=r[0],w=r[1];function _(e,t,n,r,_){o=t||1.4,s=n||2,g=_||!0;var S=0;for(var M in i)S=Math.max(S,M);var A=h_(x,w,S,s,e?o:0);l=A.dim[0],c=A.dim[1],u=A.dim[2],h=A.matrix,d=A.tran,s=A.scaleFactor,p={},f={},T(e),m=o*s,a=r||o/s,y=new Uint8Array(l*c*u),e&&(v=new Float64Array(l*c*u)),g&&(b=new Int32Array(l*c*u))}var S=1,M=2,A=4,C=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];function T(e){var t,n,r,a,l,c,u,h,d,m;for(var g in i)if(t=parseFloat(g),!p[g]){for(c=(u=e?(t+o)*s+.5:t*s+.5)*u,h=Math.floor(u)+1,d=new Int32Array(h*h),m=0,n=0;n<h;++n)for(r=0;r<h;++r)(a=n*n+r*r)>c?d[m]=-1:(l=Math.sqrt(c-a),d[m]=Math.floor(l)),++m;f[g]=h,p[g]=d}}function E(n){var i,r,o,a,h,m,v,x,w,_,M,A,C,T,E,P,I,L,R=3*n,k=n;i=Math.floor(.5+s*(e[R]+d[0])),r=Math.floor(.5+s*(e[R+1]+d[1])),o=Math.floor(.5+s*(e[R+2]+d[2]));var D,O=t[k],N=p[O],B=0,F=c*u,z=f[O];for(_=0;_<z;++_)for(M=0;M<z;++M){if(-1!==(D=N[B]))for(P=-1;P<2;++P)for(I=-1;I<2;++I)for(L=-1;L<2;++L)if(0!==P&&0!==I&&0!==L)for(v=P*_,w=L*M,A=0;A<=D;++A)if(T=r+(x=A*I),E=o+w,!((C=i+v)<0||T<0||E<0||C>=l||T>=c||E>=u)){var U=C*F+T*u+E;if(g)if(y[U]&S){if(y[U]&S){var H=b[U];H!==R&&v*v+x*x+w*w<(a=i+v-Math.floor(.5+s*(e[H]+d[0])))*a+(h=r+x-Math.floor(.5+s*(e[H+1]+d[1])))*h+(m=o+w-Math.floor(.5+s*(e[H+2]+d[2])))*m&&(b[U]=n)}}else y[U]|=S,b[U]=n;else y[U]|=S}B++}}function P(t){var n,i;for(console.time("EDTSurface fillvoxels"),n=0,i=y.length;n<i;++n)y[n]=0,t&&(v[n]=-1),g&&(b[n]=-1);for(n=0,i=e.length/3;n<i;++n)E(n);for(n=0,i=y.length;n<i;++n)y[n]&S&&(y[n]|=M);console.timeEnd("EDTSurface fillvoxels")}function I(n){var i,r,o,a,h,m,v,x,w,_,S,A,C,T,E,P,I,L,R,k=3*n,D=n,O=0;i=Math.floor(.5+s*(e[k]+d[0])),r=Math.floor(.5+s*(e[k+1]+d[1])),o=Math.floor(.5+s*(e[k+2]+d[2]));var N=t[D],B=c*u;for(C=0,R=f[N];C<R;++C)for(T=0;T<R;++T){if(-1!==p[N][O])for(P=-1;P<2;++P)for(I=-1;I<2;++I)for(L=-1;L<2;++L)if(0!==P&&0!==I&&0!==L)for(v=P*C,w=L*T,E=0;E<=p[N][O];++E)if(S=r+(x=E*I),A=o+w,!((_=i+v)<0||S<0||A<0||_>=l||S>=c||A>=u)){var F=_*B+S*u+A;if(y[F]&M){if(g){var z=b[F];v*v+x*x+w*w<(a=Math.floor(.5+s*(e[z]+d[0])))*a+(h=Math.floor(.5+s*(e[z+1]+d[1])))*h+(m=Math.floor(.5+s*(e[z+2]+d[2])))*m&&(b[F]=n)}}else y[F]|=M,g&&(b[F]=n)}O++}}function L(){var t,n;for(t=0,n=y.length;t<n;++t)y[t]&=~M;for(t=0,n=e.length/3;t<n;++t)I(t)}function R(){var e,t,n,i=c*u;for(e=0;e<l;++e)for(t=0;t<u;++t)for(n=0;n<c;++n){var r=e*i+n*u+t;if(y[r]&S)for(var o=0;o<26;){var s=e+C[o][0],a=t+C[o][2],h=n+C[o][1];if(s>-1&&s<l&&h>-1&&h<c&&a>-1&&a<u&&!(y[s*i+h*u+a]&S)){y[r]|=A;break}o++}}}function k(){var e,t,n,i;console.time("EDTSurface fastdistancemap");var r,o=YT(l,c,u,Uint16Array,3),s=c*u,h=m*m,d=0;for(e=0;e<l;++e)for(t=0;t<c;++t)for(n=0;n<u;++n)y[r=e*s+t*u+n]&=~M,y[r]&S&&y[r]&A&&(o.set(e,t,n,e,t,n),v[r]=0,y[r]|=M,d+=1);var p=new Int32Array(3*d),f=0,x=new Int32Array(3*d),w=0;for(e=0;e<l;++e)for(t=0;t<c;++t)for(n=0;n<u;++n)y[r=e*s+t*u+n]&A&&(p[f]=e,p[f+1]=t,p[f+2]=n,f+=3,y[r]&=~A);do{for(w=D(p,o,f,x),f=0,e=0,i=w;e<i;e+=3)r=s*x[e]+u*x[e+1]+x[e+2],y[r]&=~A,v[r]<=1.0404*h&&(p[f]=x[e],p[f+1]=x[e+1],p[f+2]=x[e+2],f+=3)}while(f>0);var _,C=a*a,T=new Uint16Array(3);for(e=0;e<l;++e)for(t=0;t<c;++t)for(n=0;n<u;++n)y[r=e*s+t*u+n]&=~A,y[r]&S&&(y[r]&M&&!(y[r]&M&&v[r]>=C)||(y[r]|=A,g&&y[r]&M&&(o.toArray(e,t,n,T),_=T[0]*s+T[1]*u+T[2],b[r]=b[_])));console.timeEnd("EDTSurface fastdistancemap")}function D(e,t,n,i){var r,o,s,a,h,d,p,f,m,g,b,x,w=new Uint16Array(3),_=0;if(0===n)return _;var T=-1,E=-1,P=-1,I=c*u;for(p=0,m=n;p<m;p+=3)for(r=e[p],o=e[p+1],s=e[p+2],t.toArray(r,o,s,w),f=0;f<6;++f)T=r+(x=C[f])[0],E=o+x[1],P=s+x[2],T<l&&T>-1&&E<c&&E>-1&&P<u&&P>-1&&(y[b=T*I+u*E+P]&S&&!(y[b]&M)?(t.fromArray(T,E,P,w),g=(a=T-w[0])*a+(h=E-w[1])*h+(d=P-w[2])*d,v[b]=g,y[b]|=M,y[b]|=A,i[_]=T,i[_+1]=E,i[_+2]=P,_+=3):y[b]&S&&y[b]&M&&(g=(a=T-w[0])*a+(h=E-w[1])*h+(d=P-w[2])*d)<v[b]&&(t.fromArray(T,E,P,w),v[b]=g,y[b]&A||(y[b]|=A,i[_]=T,i[_+1]=E,i[_+2]=P,_+=3)));for(p=0,m=n;p<m;p+=3)for(r=e[p],o=e[p+1],s=e[p+2],t.toArray(r,o,s,w),f=6;f<18;f++)T=r+(x=C[f])[0],E=o+x[1],P=s+x[2],T<l&&T>-1&&E<c&&E>-1&&P<u&&P>-1&&(y[b=T*I+u*E+P]&S&&!(y[b]&M)?(t.fromArray(T,E,P,w),g=(a=T-w[0])*a+(h=E-w[1])*h+(d=P-w[2])*d,v[b]=g,y[b]|=M,y[b]|=A,i[_]=T,i[_+1]=E,i[_+2]=P,_+=3):y[b]&S&&y[b]&M&&(g=(a=T-w[0])*a+(h=E-w[1])*h+(d=P-w[2])*d)<v[b]&&(t.fromArray(T,E,P,w),v[b]=g,y[b]&A||(y[b]|=A,i[_]=T,i[_+1]=E,i[_+2]=P,_+=3)));for(p=0,m=n;p<m;p+=3)for(r=e[p],o=e[p+1],s=e[p+2],t.toArray(r,o,s,w),f=18;f<26;f++)T=r+(x=C[f])[0],E=o+x[1],P=s+x[2],T<l&&T>-1&&E<c&&E>-1&&P<u&&P>-1&&(y[b=T*I+u*E+P]&S&&!(y[b]&M)?(t.fromArray(T,E,P,w),g=(a=T-w[0])*a+(h=E-w[1])*h+(d=P-w[2])*d,v[b]=g,y[b]|=M,y[b]|=A,i[_]=T,i[_+1]=E,i[_+2]=P,_+=3):y[b]&S&&y[b]&M&&(g=(a=T-w[0])*a+(h=E-w[1])*h+(d=P-w[2])*d)<v[b]&&(t.fromArray(T,E,P,w),v[b]=g,y[b]&A||(y[b]|=A,i[_]=T,i[_+1]=E,i[_+2]=P,_+=3)));return _}function O(e){var t,n=y.length;if("vws"===e)for(t=0;t<n;++t)y[t]&=~A,y[t]=y[t]&M?1:0;else if("ms"===e)for(t=0;t<n;++t)y[t]&=~M,y[t]&A&&(y[t]|=M),y[t]&=~A,y[t]=y[t]&M?1:0;else if("ses"===e)for(t=0;t<n;++t)y[t]&A&&y[t]&M?y[t]&=~A:y[t]&A&&!(y[t]&M)&&(y[t]|=M),y[t]=y[t]&M?1:0;else if("sas"===e)for(t=0;t<n;++t)y[t]&=~A,y[t]=y[t]&M?1:0}this.getVolume=function(e,t,i,r,o){console.time("EDTSurface.getVolume");var s="vws"!==e;_(s,t,i,r,o),P(s),R(),"ms"!==e&&"ses"!==e||k(),"ses"===e&&(T(!1),L()),O(e);for(var a=0,h=b.length;a<h;++a)b[a]=n[b[a]];return console.timeEnd("EDTSurface.getVolume"),{data:y,nx:u,ny:c,nz:l,atomindex:b}},this.getSurface=function(e,t,n,i,r,o,s){var a=this.getVolume(e,t,n,i,r);return new p_(a.data,a.nx,a.ny,a.nz,a.atomindex).getSurface(1,o,void 0,h,s)}}function KT(e,t,n,i,r,o,s){s=Math.max(.1,s);var a=e.length,l=r[0],c=r[1],u=r[2],h=o[0],d=o[1],p=o[2];function f(e,t){return Math.floor((e-t)/s)}for(var m=f(h,l)+1,g=f(d,c)+1,y=f(p,u)+1,v=m*g*y,b=g*y,x=function(e,t,n){return(f(e,l)*g+f(t,c))*y+f(n,u)},w=[],_=0;_<a;_++){var S=x(e[_],t[_],n[_]);void 0===w[S]?w[S]=[_]:w[S].push(_)}var M=new Uint32Array(v),A=new Uint16Array(v),C=new Uint32Array(a),T=0,E=0;for(_=0;_<v;_++){var P=M[_]=T,I=w[_];if(void 0!==I)for(var L=0;L<I.length;L++)C[T]=I[L],T++;var R=T-P;A[_]=R,R>E&&(E=R)}const k=function(r,o,s,a,h){for(var d=0,p=f(r,l),v=f(o,c),x=f(s,u),w=Math.max(0,p-1),_=Math.max(0,v-1),S=Math.max(0,x-1),T=Math.min(m,p+2),E=Math.min(g,v+2),P=Math.min(y,x+2),I=w;I<T;++I)for(var L=I*b,R=_;R<E;++R)for(var k=R*y,D=S;D<P;++D)for(var O=L+k+D,N=M[O],B=N+A[O],F=N;F<B;F++){var z=C[F],U=e[z]-r,H=t[z]-o,G=n[z]-s,V=i[z]+a;U*U+H*H+G*G<=V*V&&(h[d++]=C[F])}h[d]=-1};return{neighbourListLength:27*E+1,withinRadii:k}}function QT(e,t,n){const i=t.length,r=new Float32Array(i),o=new Float32Array(i),s=new Float32Array(i);for(let X=0;X<i;X++){const t=3*X;r[X]=e[t],o[X]=e[t+1],s[X]=e[t+2]}let a=Ky(e);0===e.length&&(a[0].set([0,0,0]),a[1].set([0,0,0]));const l=a[0],c=a[1];let u,h,d,p,f,m,g,y,v,b,x,w,_,S,M,A,C,T,E=-1;const P=new Float32Array([0,0,0]),I=new Float32Array([0,0,0]),L=new Float32Array([0,0,0]),R=new Float32Array([0,0,0]);let k;function D(e,n,r,o){p=bp(e,1.4),f=bp(n,2),m=bp(r,!0),g=bp(o,30),u=new Float32Array(i),h=new Float32Array(i);for(let i=0;i<u.length;++i){var s=t[i]+p;u[i]=s,h[i]=s*s}d=0;for(let t=0;t<u.length;++t)u[t]>d&&(d=u[t]);N(),B(),F(),E=-1}function O(e,t,n){for(let i=0;i<e.length;i++)e[i]=t+n*i}function N(){const e=h_(l,c,d,f,0);f=e.scaleFactor,y=e.dim,v=e.matrix,k=Math.max(5,2+Math.floor(p*f)),b=gg(y[0]*y[1]*y[2],-1001),x=new Int32Array(b.length),w=new Float32Array(y[0]),_=new Float32Array(y[1]),S=new Float32Array(y[2]),O(w,l[0],1/f),O(_,l[1],1/f),O(S,l[2],1/f)}function B(){var e=0,t=2*Math.PI/g;A=new Float32Array(g),M=new Float32Array(g);for(var n=0;n<g;n++)A[n]=Math.cos(e),M[n]=Math.sin(e),e+=t}function F(){C=KT(r,o,s,u,l,c,2.01*d),T=new Int32Array(C.neighbourListLength)}function z(e,t,n,i,r){let o;if(-1!==E){if(o=E,o!==i&&o!==r&&U(o,e,t,n))return o;E=-1}var s=0;for(o=T[s];o>=0;){if(o!==i&&o!==r&&U(o,e,t,n))return E=o,o;o=T[++s]}return E=-1,-1}function U(t,n,i,r){var o=3*t,s=h[t],a=e[o]-n,l=e[o+1]-i,c=e[o+2]-r;return a*a+l*l+c*c<s}function H(){for(var e=0;e<i;e++){var t=r[e],n=o[e],a=s[e],c=u[e],d=h[e];C.withinRadii(t,n,a,c,T);for(var p=Math.ceil(c*f),g=Math.floor(f*(t-l[0])),v=Math.floor(f*(n-l[1])),M=Math.floor(f*(a-l[2])),A=Math.max(0,g-p),E=Math.max(0,v-p),P=Math.max(0,M-p),I=Math.min(y[0],g+p+2),L=Math.min(y[1],v+p+2),R=Math.min(y[2],M+p+2),k=A;k<I;k++)for(var D=w[k]-t,O=y[1]*y[2]*k,N=E;N<L;N++)for(var B=_[N]-n,F=D*D+B*B,U=O+y[2]*N,H=P;H<R;H++){var G=S[H]-a,V=F+G*G;if(V<d){var j=H+U;b[j]<0&&(b[j]=-b[j]);var $=Math.sqrt(V),W=c/$,q=D*W,X=B*W,Y=G*W;if(-1===z(q+=t,X+=n,Y+=a,e,-1)){var Z=c-$;Z<b[j]&&(b[j]=Z,m&&(x[j]=e))}}}}}function G(){for(var e=0;e<i;e++){C.withinRadii(r[e],o[e],s[e],u[e],T);for(var t=0,n=T[t];n>=0;)e<n&&V(e,n),n=T[++t]}}function V(e,t){var n=u[e],i=u[t],a=P[0]=r[t]-r[e],c=P[1]=o[t]-o[e],h=P[2]=s[t]-s[e],d=a*a+c*c+h*h,p=Math.sqrt(d),v=n*((n*n+p*p-i*i)/(2*n*p));dv(P,P),j(L,P),dv(L,L),nv(R,P,L),dv(R,R);var C=Math.sqrt(n*n-v*v);hv(L,L,C),hv(R,R,C),hv(P,P,v),I[0]=P[0]+r[e],I[1]=P[1]+o[e],I[2]=P[2]+s[e],E=-1;for(var T=k,D=0;D<g;D++){var O=A[D],N=M[D],B=I[0]+O*L[0]+N*R[0],F=I[1]+O*L[1]+N*R[1],U=I[2]+O*L[2]+N*R[2];if(-1===z(B,F,U,e,t))for(var H=Math.floor(f*(B-l[0])),G=Math.floor(f*(F-l[1])),V=Math.floor(f*(U-l[2])),$=Math.max(0,H-T),W=Math.max(0,G-T),q=Math.max(0,V-T),X=Math.min(y[0],H+T+2),Y=Math.min(y[1],G+T+2),Z=Math.min(y[2],V+T+2),K=$;K<X;K++){a=B-w[K];for(var Q=y[1]*y[2]*K,J=W;J<Y;J++)for(var ee=a*a+(c=F-_[J])*c,te=Q+y[2]*J,ne=q;ne<Z;ne++){d=ee+(h=U-S[ne])*h;var ie=ne+te,re=b[ie];if(re>0&&d<re*re&&(b[ie]=Math.sqrt(d),m)){const n=a*P[0]+c*P[1]+h*P[2];x[ie]=n<0?t:e}}}}}function j(e,t){return e[0]=e[1]=e[2]=1,0!==t[0]?e[0]=(t[1]+t[2])/-t[0]:0!==t[1]?e[1]=(t[0]+t[2])/-t[1]:0!==t[2]&&(e[2]=(t[0]+t[1])/-t[2]),e}function $(){for(var e=0;e<b.length;e++)b[e]<0&&(b[e]=0)}function W(){for(var e=0;e<x.length;e++)x[e]=n[x[e]]}function q(e,t,n){console.time("AVSurface.getVolume"),console.time("AVSurface.init"),D(e,t,n),console.timeEnd("AVSurface.init"),console.time("AVSurface.projectPoints"),H(),console.timeEnd("AVSurface.projectPoints"),console.time("AVSurface.projectTorii"),G(),console.timeEnd("AVSurface.projectTorii"),$(),W(),console.timeEnd("AVSurface.getVolume")}this.getSurface=function(e,t,n,i,r,o,s){return q(t,n,r),new p_(b,y[2],y[1],y[0],x).getSurface(t,!1,void 0,v,s)}}Am.add("line",XT),Object.assign(ZT,{__deps:[h_,u_,p_,Ky,YT]}),Object.assign(QT,{__deps:[h_,p_,gg,Ky,hv,nv,dv,KT,bp]}),_m.add("molsurf",(function(e,t){const n=e.data.args,i=e.data.params;if(n&&i){const e=new("av"===i.type?QT:ZT)(n.coordList,n.radiusList,n.indexList).getSurface(i.type,i.probeRadius,i.scaleFactor,i.cutoff,!0,i.smooth,i.contour),r=[e.position.buffer,e.index.buffer];e.normal&&r.push(e.normal.buffer),e.atomindex&&r.push(e.atomindex.buffer),t({sd:e,p:i},r)}}),[ZT,QT]);class JT{constructor(e){this.structure=e}_getAtomData(e){return this.structure.getAtomData({what:{position:!0,radius:!0,index:!0},radiusParams:bp(e.radiusParams,{type:"vdw",scale:1})})}_makeSurface(e,t){var n=new d_(t.name,"",e);return n.info.type=t.type,n.info.probeRadius=t.probeRadius,n.info.scaleFactor=t.scaleFactor,n.info.smooth=t.smooth,n.info.cutoff=t.cutoff,n}getSurface(e){const t=e||{},n=this._getAtomData(e),i=n.position,r=n.radius,o=n.index,s=new("av"===t.type?QT:ZT)(i,r,o).getSurface(t.type,t.probeRadius,t.scaleFactor,t.cutoff,!0,t.smooth,t.contour);return this._makeSurface(s,t)}getSurfaceWorker(e,t){const n=Object.assign({},e);if(window.hasOwnProperty("Worker")){void 0===this.worker&&(this.worker=new qy("molsurf"));const i=this._getAtomData(e),r=i.position,o=i.radius,s=i.index,a={args:{coordList:r,radiusList:o,indexList:s},params:n},l=[r.buffer,o.buffer,s.buffer];this.worker.post(a,l,(e=>{t(this._makeSurface(e.data.sd,n))}),(e=>{console.warn("MolecularSurface.getSurfaceWorker error - trying without worker",e),this.worker.terminate(),this.worker=void 0;const i=this.getSurface(n);t(i)}))}else{const e=this.getSurface(n);t(e)}}dispose(){this.worker&&this.worker.terminate()}}class eE extends AC{constructor(e,t,n){super(e,t,n),this.type="surface",this.parameters=Object.assign({surfaceType:{type:"select",rebuild:!0,options:{vws:"vws",sas:"sas",ms:"ms",ses:"ses",av:"av"}},probeRadius:{type:"number",precision:1,max:20,min:0,rebuild:!0},smooth:{type:"integer",precision:1,max:10,min:0,rebuild:!0},scaleFactor:{type:"number",precision:1,max:5,min:0,rebuild:!0},cutoff:{type:"number",precision:2,max:50,min:0,rebuild:!0},contour:{type:"boolean",rebuild:!0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},filterSele:{type:"text",rebuild:!0},colorVolume:{type:"hidden"},useWorker:{type:"boolean",rebuild:!0}},this.parameters,{radius:null,scale:null}),this.__infoList=[],this.structure.signals.refreshed.add((()=>{this.__forceNewMolsurf=!0})),this.toBePrepared=!0,this.init(n)}init(e){const t=e||{};t.colorScheme=bp(t.colorScheme,"uniform"),t.colorValue=bp(t.colorValue,14540253),t.disablePicking=bp(t.disablePicking,!0),this.surfaceType=bp(t.surfaceType,"ms"),this.probeRadius=bp(t.probeRadius,1.4),this.smooth=bp(t.smooth,2),this.scaleFactor=bp(t.scaleFactor,2),this.cutoff=bp(t.cutoff,0),this.contour=bp(t.contour,!1),this.background=bp(t.background,!1),this.opaqueBack=bp(t.opaqueBack,!0),this.filterSele=bp(t.filterSele,""),this.colorVolume=bp(t.colorVolume,void 0),this.useWorker=bp(t.useWorker,!0),super.init(e)}prepareData(e,t,n){let i=this.__infoList[t];if(i||(i={},this.__infoList[t]=i),i.molsurf&&i.sele===e.selection.string)n(t);else{if(this.filterSele){const i=e.structure.getView(new Kf(this.filterSele)),r=i.boundingBox.getSize(new mn),o=Math.max(r.x,r.y,r.z),s=e.getAtomSetWithinPoint(i.center,o/2+6);if(0===(e=e.getView(new Kf(e.getAtomSetWithinSelection(s,3).toSeleString()))).atomCount)return void n(t)}i.sele=e.selection.string,i.molsurf=new JT(e);const r=this.getSurfaceParams(),o=e=>{i.surface=e,n(t)};this.useWorker?i.molsurf.getSurfaceWorker(r,o):o(i.molsurf.getSurface(r))}}prepare(e){if((this.__forceNewMolsurf||this.__sele!==this.selection.string||this.__surfaceParams!==JSON.stringify(this.getSurfaceParams()))&&(this.__infoList.forEach((e=>{e&&e.molsurf&&e.molsurf.dispose()})),this.__infoList.length=0),0===this.structureView.atomCount)return void e();const t=()=>{this.__sele=this.selection.string,this.__surfaceParams=JSON.stringify(this.getSurfaceParams()),this.__forceNewMolsurf=!1,e()},n="default"===this.assembly?this.defaultAssembly:this.assembly,i=this.structure.biomolDict[n];i?i.partList.forEach(((e,n)=>{const r=e.getView(this.structureView);this.prepareData(r,n,(e=>{e===i.partList.length-1&&t()}))})):this.prepareData(this.structureView,0,t)}createData(e,t){const n=this.__infoList[t],i=n.surface;if(!i)return;const r={position:i.getPosition(),color:i.getColor(this.getColorParams()),index:i.getFilteredIndex(this.filterSele,e)},o=[];if(i.contour){const e=new C_(r,this.getBufferParams({wireframe:!1}));o.push(e)}else{Object.assign(r,{normal:i.getNormal(),picking:i.getPicking(e.getStructure())});const t=new __(r,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));if("double"==this.getBufferParams().side){const e=new A_(t);o.push(e)}else o.push(t)}return{bufferList:o,info:n}}updateData(e,t){const n={};if(e.position||e.radius)return this.__forceNewMolsurf=!0,void this.build();e.color&&(n.color=t.info.surface.getColor(this.getColorParams())),e.index&&(n.index=t.info.surface.getFilteredIndex(this.filterSele,t.sview)),t.bufferList[0].setAttributes(n)}setParameters(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return e&&e.filterSele&&(t.index=!0),e&&void 0!==e.colorVolume&&(t.color=!0),e&&e.wireframe&&(e.contour||void 0===e.contour&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,n),this}getSurfaceParams(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({type:this.surfaceType,probeRadius:this.probeRadius,scaleFactor:this.scaleFactor,smooth:this.smooth&&!this.contour,cutoff:this.cutoff,contour:this.contour,useWorker:this.useWorker,radiusParams:this.getRadiusParams()},e)}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}getAtomRadius(){return 0}clear(){super.clear()}dispose(){this.__infoList.forEach((e=>{e&&e.molsurf&&e.molsurf.dispose()})),this.__infoList.length=0,super.dispose()}}Am.add("surface",eE);class tE extends AC{constructor(e,t,n){super(e,t,n),this.type="point",this.parameters=Object.assign({pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{flatShaded:null,wireframe:null,linewidth:null,side:null,roughness:null,metalness:null}),this.init(n)}init(e){var t=e||{};this.pointSize=bp(t.pointSize,1),this.sizeAttenuation=bp(t.sizeAttenuation,!0),this.sortParticles=bp(t.sortParticles,!1),this.useTexture=bp(t.useTexture,!1),this.alphaTest=bp(t.alphaTest,.5),this.forceTransparent=bp(t.forceTransparent,!1),this.edgeBleach=bp(t.edgeBleach,0),super.init(t)}createData(e){var t={position:!0,color:!0,picking:!0},n=e.getAtomData(this.getAtomParams(t));return{bufferList:[new DM(n,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams(e)),i={};e&&!e.position||Object.assign(i,{position:n.position}),e&&!e.color||Object.assign(i,{color:n.color}),t.bufferList[0].setAttributes(i)}getAtomRadius(){return.1}}Am.add("point",tE),Tm.add("shader/Ribbon.vert","#define STANDARD\nuniform float clipNear;\nuniform vec3 clipCenter;\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvarying vec3 vViewPosition;\n#endif\n#if defined( RADIUS_CLIP )\nvarying vec3 vClipCenter;\n#endif\nattribute vec3 dir;\nattribute float size;\n#ifdef PICKING\n#include unpack_color\nattribute float primitiveId;\nvarying vec3 vPickingColor;\n#else\n#include color_pars_vertex\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#endif\n#include common\nvoid main(void){\n#ifdef PICKING\nvPickingColor = unpackColor( primitiveId );\n#else\n#include color_vertex\n#include beginnormal_vertex\n#include defaultnormal_vertex\n#ifndef FLAT_SHADED\nvNormal = normalize( transformedNormal );\n#endif\n#endif\n#include begin_vertex\ntransformed += normalize( dir ) * size;\n#include project_vertex\n#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )\nvViewPosition = -mvPosition.xyz;\n#endif\n#if defined( RADIUS_CLIP )\nvClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;\n#endif\n#include nearclip_vertex\n}");const nE=new Uint16Array([0,1,2,1,3,2]);function iE(e){return 4*(e.position.length/3-1)*3}class rE extends w_{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super({position:new Float32Array(iE(e)),color:new Float32Array(iE(e)),index:Fp(iE(e),iE(e)/3),normal:new Float32Array(iE(e)),picking:e.picking},t),this.vertexShader="Ribbon.vert";const n=e.position.length/3-1,i=4*n,r=3*i;this.addAttributes({dir:{type:"v3",value:new Float32Array(r)}}),this.addAttributes({size:{type:"f",value:new Float32Array(i)}}),e.primitiveId=bg(n),this.setAttributes(e),this.makeIndex()}setAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.size/4,n=this.geometry.attributes;let i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,v,b,x,w;e.position&&(i=e.position,c=n.position.array,n.position.needsUpdate=!0),e.normal&&(r=e.normal,u=n.normal.array,n.normal.needsUpdate=!0),e.size&&(o=e.size,h=n.size.array,n.size.needsUpdate=!0),e.dir&&(s=e.dir,d=n.dir.array,n.dir.needsUpdate=!0),e.color&&(a=e.color,p=n.color.array,n.color.needsUpdate=!0),e.primitiveId&&(l=e.primitiveId,f=n.primitiveId.array,n.primitiveId.needsUpdate=!0);let _=o?o[0]:null;for(m=0;m<t;++m){for(x=3*m,y=3*m*4,b=4*m,i&&(c[y]=c[y+3]=i[x],c[y+1]=c[y+4]=i[x+1],c[y+2]=c[y+5]=i[x+2],c[y+6]=c[y+9]=i[x+3],c[y+7]=c[y+10]=i[x+4],c[y+8]=c[y+11]=i[x+5]),r&&(u[y]=u[y+3]=-r[x],u[y+1]=u[y+4]=-r[x+1],u[y+2]=u[y+5]=-r[x+2],u[y+6]=u[y+9]=-r[x+3],u[y+7]=u[y+10]=-r[x+4],u[y+8]=u[y+11]=-r[x+5]),g=0;g<4;++g)v=y+3*g,a&&(p[v]=a[x],p[v+1]=a[x+1],p[v+2]=a[x+2]),l&&(f[b+g]=l[m]);o&&(w=o[m],_!==o[m]?(h[b]=_,h[b+1]=_,h[b+2]=w,h[b+3]=w):(h[b]=w,h[b+1]=w,h[b+2]=w,h[b+3]=w),_=w),s&&(d[y]=s[x],d[y+1]=s[x+1],d[y+2]=s[x+2],d[y+3]=-s[x],d[y+4]=-s[x+1],d[y+5]=-s[x+2],d[y+6]=s[x+3],d[y+7]=s[x+4],d[y+8]=s[x+5],d[y+9]=-s[x+3],d[y+10]=-s[x+4],d[y+11]=-s[x+5])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void gm.error("Index is null");const t=e.array,n=t.length/4/3;for(let i=0;i<n;++i){const e=6*i,n=4*i;t.set(nE,e);for(let i=0;i<6;++i)t[e+i]+=n}}}class oE extends AC{constructor(e,t,n){super(e,t,n),this.type="ribbon",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{side:null,wireframe:null,linewidth:null}),this.init(n)}init(e){var t=e||{};t.colorScheme=bp(t.colorScheme,"chainname"),t.colorScale=bp(t.colorScale,"RdYlBu"),t.radiusType=bp(t.radiusType,"sstruc"),t.radiusScale=bp(t.radiusScale,4),"low"===t.quality?this.subdiv=3:"medium"===t.quality?this.subdiv=6:"high"===t.quality?this.subdiv=12:this.subdiv=bp(t.subdiv,6),this.tension=bp(t.tension,NaN),this.smoothSheet=bp(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!0,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){var t=[],n=[];return this.structure.eachPolymer((e=>{if(!(e.residueCount<4)){n.push(e);var i=new pT(e,this.getSplineParams()),r=i.getSubdividedPosition(),o=i.getSubdividedOrientation(),s=i.getSubdividedColor(this.getColorParams()),a=i.getSubdividedPicking(),l=i.getSubdividedSize(this.getRadiusParams());t.push(new rE({position:r.position,normal:o.binormal,dir:o.normal,color:s.color,size:l.size,picking:a.picking},this.getBufferParams()))}}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){e=e||{};var n=0,i=t.polymerList.length;for(n=0;n<i;++n){var r={},o=new pT(t.polymerList[n],this.getSplineParams());if(e.position){var s=o.getSubdividedPosition(),a=o.getSubdividedOrientation();Object.assign(r,{position:s.position,normal:a.binormal,dir:a.normal})}if(e.radius||e.scale){var l=o.getSubdividedSize(this.getRadiusParams());Object.assign(r,{size:l.size})}if(e.color){var c=o.getSubdividedColor(this.getColorParams());Object.assign(r,{color:c.color})}t.bufferList[n].setAttributes(r)}}setParameters(e){var t=!1,n={};return e&&e.tension&&Object.assign(n,{position:!0}),super.setParameters(e,n,t),this}}Am.add("ribbon",oE);class sE extends AC{constructor(e,t,n){super(e,t,n),this.type="rocket",this.parameters=Object.assign({localAngle:{type:"integer",max:180,min:0,rebuild:!0},centerDist:{type:"number",precision:1,max:10,min:0,rebuild:!0},ssBorder:{type:"boolean",rebuild:!0},radialSegments:!0,openEnded:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){let t=e||{};t.colorScheme=bp(t.colorScheme,"sstruc"),t.radiusSize=bp(t.radiusSize,1.5),t.radiusScale=bp(t.radiusScale,1),t.openEnded=bp(t.openEnded,!1),t.useInteriorColor=bp(t.useInteriorColor,!0),this.localAngle=bp(t.localAngle,30),this.centerDist=bp(t.centerDist,2.5),this.ssBorder=bp(t.ssBorder,!1),super.init(t)}createData(e){let t=0;const n=[],i=[];this.structure.eachPolymer((e=>{if(e.residueCount<4||e.isNucleic())return;const r=new rS(e),o=r.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());t+=o.size.length,n.push(o),i.push(r)}),e.getSelection());const r={begin:new Float32Array(3*t),end:new Float32Array(3*t),size:new Float32Array(t),color:new Float32Array(3*t),picking:{}};let o=new Float32Array(t),s=0;return n.forEach((function(e){r.begin.set(e.begin,3*s),r.end.set(e.end,3*s),r.size.set(e.size,s),r.color.set(e.color,3*s),o.set(e.picking.array,s),s+=e.size.length})),t&&(r.picking=new mw(o,e.getStructure())),{bufferList:[new aT({position1:r.begin,position2:r.end,color:r.color,color2:r.color,radius:r.size,picking:r.picking},this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))],axisList:n,helixbundleList:i,axisData:r}}updateData(e,t){if((e=e||{}).position)this.build();else{var n={};if(e.color||e.radius){var i=0;t.helixbundleList.forEach((n=>{var r=n.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());e.color&&t.axisData.color.set(r.color,3*i),(e.radius||e.scale)&&t.axisData.size.set(r.size,i),i+=r.size.length})),e.color&&Object.assign(n,{color:t.axisData.color,color2:t.axisData.color}),(e.radius||e.scale)&&Object.assign(n,{radius:t.axisData.size})}t.bufferList[0].setAttributes(n)}}}Am.add("rocket",sE);class aE extends bT{constructor(e,t,n){super(e,t,n),this.type="rope",this.parameters=Object.assign({smooth:{type:"integer",max:15,min:0,rebuild:!0}},this.parameters,{aspectRatio:null,smoothSheet:null})}init(e){var t=e||{};t.aspectRatio=1,t.tension=bp(t.tension,.5),t.radiusScale=bp(t.radiusScale,5),t.smoothSheet=!1,this.smooth=bp(t.smooth,2),super.init(t)}getSpline(e){var t=new iS(e);return new pT(e,this.getSplineParams({directional:!1,positionIterator:t.getCenterIterator(this.smooth)}))}}Am.add("rope",aE);class lE extends AC{constructor(e,t,n){super(e,t,n),this.type="spacefill",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){var t=e||{};t.useInteriorColor=bp(t.useInteriorColor,!0),super.init(t)}createData(e){return{bufferList:[new PM(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0,disableImpostor:this.disableImpostor}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams(e)),i={};e&&!e.position||Object.assign(i,{position:n.position}),e&&!e.color||Object.assign(i,{color:n.color}),e&&!e.radius||Object.assign(i,{radius:n.radius}),t.bufferList[0].setAttributes(i)}}function cE(e){return 3*(e.position.length/3-1)*2}Am.add("spacefill",lE);class uE extends x_{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super({position:new Float32Array(cE(e)),color:new Float32Array(cE(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag",this.setAttributes(e)}setAttributes(e){let t,n,i,r;const o=this.geometry.attributes;if(e.position&&(t=e.position,i=o.position.array,o.position.needsUpdate=!0),e.color&&(n=e.color,r=o.color.array,o.color.needsUpdate=!0),!t&&!n)return void gm.warn("TraceBuffer.prototype.setAttributes no data");let s,a;const l=this.size-1;for(let c=0;c<l;++c)s=3*c,a=3*c*2,t&&(i[a]=t[s],i[a+1]=t[s+1],i[a+2]=t[s+2],i[a+3]=t[s+3],i[a+4]=t[s+4],i[a+5]=t[s+5]),n&&(r[a]=n[s],r[a+1]=n[s+1],r[a+2]=n[s+2],r[a+3]=n[s+3],r[a+4]=n[s+4],r[a+5]=n[s+5])}}class hE extends AC{constructor(e,t,n){super(e,t,n),this.type="trace",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null}),this.init(n)}init(e){var t=e||{};t.colorScheme=bp(t.colorScheme,"chainname"),t.colorScale=bp(t.colorScale,"RdYlBu"),"low"===t.quality?this.subdiv=3:"medium"===t.quality?this.subdiv=6:"high"===t.quality?this.subdiv=12:this.subdiv=bp(t.subdiv,6),this.tension=bp(t.tension,NaN),this.smoothSheet=bp(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!1,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?.1:0}createData(e){var t=[],n=[];return this.structure.eachPolymer((e=>{if(!(e.residueCount<4)){n.push(e);var i=new pT(e,this.getSplineParams()),r=i.getSubdividedPosition(),o=i.getSubdividedColor(this.getColorParams());t.push(new uE(Object.assign({},r,o),this.getBufferParams()))}}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){e=e||{};var n=0,i=t.polymerList.length;for(n=0;n<i;++n){var r={},o=new pT(t.polymerList[n],this.getSplineParams());if(e.position){var s=o.getSubdividedPosition();Object.assign(r,{position:s.position})}if(e.color){var a=o.getSubdividedColor(this.getColorParams());Object.assign(r,{color:a.color})}t.bufferList[n].setAttributes(r)}}setParameters(e){var t=!1,n={};return e&&e.tension&&Object.assign(n,{position:!0}),super.setParameters(e,n,t),this}}Am.add("trace",hE);class dE extends bT{constructor(e,t,n){super(e,t,n),this.type="tube",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,t.radiusScale=bp(t.radiusScale,2),"low"===t.quality&&(this.radialSegments=5),super.init(t)}getSplineParams(){return super.getSplineParams({directional:!1})}}Am.add("tube",dE);class pE extends AC{constructor(e,t,n){super(e,t,n),this.type="unitcell",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0},this.parameters,{assembly:null}),this.init(n)}init(e){const t=e||{};let n=.5;this.structure.unitcell&&(n=Math.cbrt(this.structure.unitcell.volume)/200),t.radiusSize=bp(t.radiusSize,n),t.colorValue=bp(t.colorValue,"orange"),t.useInteriorColor=bp(t.useInteriorColor,!0),super.init(t)}getUnitcellData(e){return e.unitcell.getData(e)}create(){const e=this.structureView.getStructure();if(!e.unitcell)return;const t=this.getUnitcellData(e);this.sphereBuffer=new PM(t.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new aT(t.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const n=t.sview.getStructure();if(!n.unitcell)return;const i=this.getUnitcellData(n),r={},o={};e&&!e.position||(Object.assign(r,{position:i.vertex.position}),Object.assign(o,{position1:i.edge.position1,position2:i.edge.position2})),e&&!e.color||(Object.assign(r,{color:i.vertex.color}),Object.assign(o,{color:i.edge.color,color2:i.edge.color2})),e&&!e.radius||(Object.assign(r,{radius:i.vertex.radius}),Object.assign(o,{radius:i.edge.radius})),this.sphereBuffer.setAttributes(r),this.cylinderBuffer.setAttributes(o)}}Am.add("unitcell",pE);class fE extends AC{constructor(e,t,n){super(e,t,n),this.type="validation",this.parameters=Object.assign({},this.parameters,{radiusType:null,radiusSize:null,radiusScale:null}),this.init(n)}init(e){const t=e||{};t.colorValue=bp(t.colorValue,"#f0027f"),t.useInteriorColor=bp(t.useInteriorColor,!0),super.init(t)}createData(e){if(!e.validation)return;const t=e.validation.getClashData({structure:e,color:this.colorValue});return{bufferList:[new aT(t,this.getBufferParams({openEnded:!1}))]}}}Am.add("validation",fE);const mE=new mn,gE=new mn,yE=new mn,vE=new mn(0,1,0);function bE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new Hc(1,1,bp(e.radialSegments,60),1,bp(e.openEnded,!1));return t.applyMatrix4((new Sn).makeRotationX(-Math.PI/2)),t}const xE=Object.assign({radialSegments:60,openEnded:!1},v_);class wE extends bM{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super({position:new Float32Array(e.position1.length),color:e.color,picking:e.picking},t,bE(t)),this.updateNormals=!0,this._position=new Float32Array(e.position1.length),this.setAttributes(e,!0)}get defaultParameters(){return xE}applyPositionTransform(e,t,n){gE.fromArray(this._position1,n),yE.fromArray(this._position2,n),e.lookAt(gE,yE,vE);const i=this._radius[t];mE.set(i,i,gE.distanceTo(yE)),e.scale(mE)}setAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;e.position1&&e.position2&&(fg(e.position1,e.position2,this._position),this._position1=e.position1,this._position2=e.position2,e.position=this._position),e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}Im.add("cone",wE);class _E{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.geometryList=e}computeBoundingBox(){this.boundingBox?this.boundingBox.empty():this.boundingBox=new ni,this.geometryList.forEach((e=>{e.boundingBox||e.computeBoundingBox(),this.boundingBox.union(e.boundingBox)}))}}const SE=Object.assign({aspectRatio:1.5,radialSegments:50,openEnded:!1,disableImpostor:!1},v_);class ME{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.group=new fa,this.wireframeGroup=new fa,this.pickingGroup=new fa,this.visible=!0,this.parameters=xp(t,this.defaultParameters),this.splitPosition=new Float32Array(e.position1.length),this.cylinderRadius=new Float32Array(e.radius.length);const n=this.makeAttributes(e),i={radialSegments:this.parameters.radialSegments,openEnded:this.parameters.openEnded,disableImpostor:this.parameters.disableImpostor};this.cylinderBuffer=new aT(n.cylinder,i),this.coneBuffer=new wE(n.cone,i),this.geometry=new _E([this.cylinderBuffer.geometry,this.coneBuffer.geometry]),this.matrix=bp(t.matrix,new Sn),this.picking=e.picking}get defaultParameters(){return SE}set matrix(e){x_.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking}makeAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.splitPosition,n=this.cylinderRadius,i=this.parameters.aspectRatio;let r,o;const s={},a={};if(e.radius){for(r=0,o=n.length;r<o;++r)n[r]=e.radius[r]/i;s.radius=n,a.radius=e.radius}if(e.position1&&e.position2){const l=new mn,c=new mn,u=new mn,h=new mn;for(r=0,o=t.length;r<o;r+=3){l.fromArray(e.position1,r),c.fromArray(e.position2,r),u.subVectors(l,c);const o=u.length(),s=n[r/3]*i*2,a=Math.min(o,s);u.setLength(a),h.copy(c).add(u),h.toArray(t,r)}s.position1=e.position1,s.position2=t,a.position1=t,a.position2=e.position2}return e.color&&(s.color=e.color,s.color2=e.color,a.color=e.color),{cylinder:s,cone:a}}getMesh(){return(new fa).add(this.cylinderBuffer.getMesh(),this.coneBuffer.getMesh())}getWireframeMesh(){return(new fa).add(this.cylinderBuffer.getWireframeMesh(),this.coneBuffer.getWireframeMesh())}getPickingMesh(){return(new fa).add(this.cylinderBuffer.getPickingMesh(),this.coneBuffer.getPickingMesh())}setAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.makeAttributes(e);this.cylinderBuffer.setAttributes(t.cylinder),this.coneBuffer.setAttributes(t.cone)}setParameters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign({},e),e&&void 0!==e.matrix&&(this.matrix=e.matrix),delete e.matrix,e&&void 0!==e.wireframe&&(this.parameters.wireframe=e.wireframe,this.setVisibility(this.visible)),this.cylinderBuffer.setParameters(e),this.coneBuffer.setParameters(e)}setVisibility(e){x_.prototype.setVisibility.call(this,e)}dispose(){this.cylinderBuffer.dispose(),this.coneBuffer.dispose()}}Im.add("arrow",ME);const AE=new mn,CE=new mn,TE=new mn,EE=new mn(0,0,0);class PE extends bM{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},new Dr(1,1,1)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){CE.fromArray(this._heightAxis,n),TE.fromArray(this._depthAxis,n),e.lookAt(EE,CE,TE),AE.set(this._size[t],TE.length(),CE.length()),e.scale(AE)}setAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}Im.add("box",PE);const IE=new mn,LE=new mn,RE=new mn,kE=new mn(0,0,0),DE=Object.assign({sphereDetail:2},v_);class OE extends bM{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t,new Rl(1,bp(t.sphereDetail,2))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return DE}applyPositionTransform(e,t,n){LE.fromArray(this._majorAxis,n),RE.fromArray(this._minorAxis,n),e.lookAt(kE,LE,RE),IE.set(this._radius[t],RE.length(),LE.length()),e.scale(IE)}setAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}}Im.add("ellipsoid",OE);const NE=new mn,BE=new mn,FE=new mn,zE=new mn(0,0,0);class UE extends bM{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},new Il(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){BE.fromArray(this._heightAxis,n),FE.fromArray(this._depthAxis,n),e.lookAt(zE,BE,FE),NE.set(this._size[t],FE.length(),BE.length()),e.scale(NE)}setAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}Im.add("octahedron",UE);const HE=new mn,GE=new mn,VE=new mn,jE=new mn(0,0,0);class $E extends bM{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},new El(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){GE.fromArray(this._heightAxis,n),VE.fromArray(this._depthAxis,n),e.lookAt(jE,GE,VE),HE.set(this._size[t],VE.length(),GE.length()),e.scale(HE)}setAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}Im.add("tetrahedron",$E);const WE=new mn,qE=new mn,XE=new mn,YE=new mn(0,0,0),ZE=Object.assign({radiusRatio:.2,radialSegments:16,tubularSegments:32},v_);class KE extends bM{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t,new Ul(1,bp(t.radiusRatio,.2),bp(t.radialSegments,16),bp(t.tubularSegments,32))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return ZE}applyPositionTransform(e,t,n){qE.fromArray(this._majorAxis,n),XE.fromArray(this._minorAxis,n),e.lookAt(YE,qE,XE);const i=this._radius[t];WE.set(i,i,i),e.scale(WE)}setAttributes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}}Im.add("torus",KE);class QE{constructor(e,t){var n=t||{};this.streamer=e,this.name=bp(n.name,""),this.path=bp(n.path,"")}get type(){return""}get __objName(){return""}get isBinary(){return!1}get isJson(){return!1}get isXml(){return!1}parse(){return this.streamer.read().then((()=>(this._beforeParse(),this._parse(),this._afterParse(),this[this.__objName])))}_parse(){}_beforeParse(){}_afterParse(){e.Debug&&gm.log(this[this.__objName])}}class JE extends QE{constructor(e,t){var n=t||{};super(e,n),this.firstModelOnly=bp(n.firstModelOnly,!1),this.asTrajectory=bp(n.asTrajectory,!1),this.cAlphaOnly=bp(n.cAlphaOnly,!1),this.structure=new uM(this.name,this.path),this.structureBuilder=new bS(this.structure)}get type(){return"structure"}get __objName(){return"structure"}}function eP(e){switch(e=e.toLowerCase()){case"polymer":return Yv;case"non-polymer":return Zv;case"macrolide":return Kv;case"water":return Qv;default:return Xv}}function tP(e){switch(e){case Yv:return"polymer";case Zv:return"non-polymer";case Kv:return"macrolide";case Qv:return"water";default:return}}class nP{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];this.structure=e,this.index=t,this.description=n,this.entityType=eP(i||""),this.chainIndexList=r,r.forEach((function(n){e.chainStore.entityIndex[n]=t}))}get type(){return tP(this.entityType)}getEntityType(){return this.entityType}isPolymer(){return this.entityType===Yv}isNonPolymer(){return this.entityType===Zv}isMacrolide(){return this.entityType===Kv}isWater(){return this.entityType===Qv}eachChain(e){const t=this.structure.getChainProxy();this.chainIndexList.forEach((function(n){t.index=n,e(t)}))}}const iP={a:1,b:1,c:1,alpha:90,beta:90,gamma:90,spacegroup:"P 1"};class rP{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:iP;this.cartToFrac=new Sn,this.fracToCart=new Sn,this.a=e.a,this.b=e.b,this.c=e.c,this.alpha=e.alpha,this.beta=e.beta,this.gamma=e.gamma,this.spacegroup=e.spacegroup;const t=Qp(this.alpha),n=Qp(this.beta),i=Qp(this.gamma),r=Math.cos(t),o=Math.cos(n),s=Math.cos(i),a=Math.sin(n),l=Math.sin(i);if(this.volume=this.a*this.b*this.c*Math.sqrt(1-r*r-o*o-s*s+2*r*o*s),void 0===e.cartToFrac){const e=this.a*this.b*l/this.volume,t=(o*s-r)/(a*l);this.fracToCart.set(this.a,0,0,0,this.b*s,this.b*l,0,0,this.c*o,-this.c*a*t,1/e,0,0,0,0,1).transpose(),this.cartToFrac.getInverse(this.fracToCart)}else this.cartToFrac.copy(e.cartToFrac),this.fracToCart.getInverse(this.cartToFrac)}getPosition(e){const t=new Float32Array(24);if(e.unitcell){const n=e.unitcell,i=e.center.clone().applyMatrix4(n.cartToFrac).floor(),r=new mn;let o=0;const s=function(e,s,a){r.set(e,s,a).add(i).applyMatrix4(n.fracToCart).toArray(t,o),o+=3};s(0,0,0),s(1,0,0),s(0,1,0),s(0,0,1),s(1,1,0),s(1,0,1),s(0,1,1),s(1,1,1)}return t}getCenter(e){return vg(this.getPosition(e))}getData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=bp(t.colorValue,"orange"),i=bp(t.radius,Math.cbrt(this.volume)/200),r=new Ri(n),o=new mn,s=this.getPosition(e),a=yg(8,r.r,r.g,r.b),l=gg(8,i),c=new Float32Array(36),u=new Float32Array(36),h=yg(12,r.r,r.g,r.b),d=gg(12,i);let p=0;function f(e,t){o.fromArray(s,3*e).toArray(c,p),o.fromArray(s,3*t).toArray(u,p),p+=3}f(0,1),f(0,2),f(0,3),f(1,4),f(1,5),f(2,6),f(3,5),f(4,7),f(5,7),f(2,4),f(7,6),f(3,6);const m=new Lw(this,e);return{vertex:{position:s,color:a,radius:l,picking:m},edge:{position1:c,position2:u,color:h,color2:h,radius:d,picking:m}}}}const oP={1:"h",2:"h",3:"i",4:"h",5:"g",6:"h",7:"h",8:"h",9:"h",10:"h",0:"h"},sP=["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"],aP=["MOL_ID","MOLECULE","CHAIN","FRAGMENT","SYNONYM","EC","ENGINEERED","MUTATION","OTHER_DETAILS"],lP=/\s+/;function cP(e,t,n){let i="".concat(e);return t&&(i+=":".concat(t)),n&&(i+="^".concat(n)),i}class uP extends JE{constructor(e,t){const n=t||{};super(e,n),this.hex=bp(n.hex,!1),this.inferBonds=bp(n.inferBonds,"all")}get type(){return"pdb"}_parse(){e.Debug&&gm.time("PdbParser._parse "+this.name);let t=!1;const n=this.streamer.peekLines(1)[0],i=n.substr(62,4),r=n.substr(72,4);i===r&&r.trim()&&(t=!0);const o="pqr"===this.type,s="pdbqt"===this.type,a=this.structure,l=this.structureBuilder,c=this.hex;let u=10,h=10;const d=this.firstModelOnly,p=this.asTrajectory,f=this.cAlphaOnly,m=a.frames,g=a.boxes;let y,v,b=!1;const x=a.biomolDict;let w,_,S,M,A,C,T,E,P,I,L,R,k,D,O,N,B,F,z,U,H,G,V={};const j={},$={},W=[];let q,X;const Y={},Z={},K={};let Q,J,ee,te,ne,ie,re;const oe={};let se;const ae={helices:[],sheets:[]},le=ae.helices,ce=ae.sheets,ue=a.atomMap,he=a.atomStore;he.resize(Math.round(this.streamer.data.length/80)),(o||s)&&he.addField("partialCharge",1,"float32"),o&&he.addField("radius",1,"float32");const de=a.getAtomProxy(),pe=a.getAtomProxy();let fe=0,me=0,ge=!0;function ye(e,n,i){for(let r=e;r<n;++r)if(M=i[r],A=M.substr(0,6),"ATOM  "===A||"HETATM"===A){if(ge&&(p?(b?(y=new Float32Array(3*he.count),m.push(y)):y=[],v=0):d||(V={}),Q=1,J=Q.toString(),ee=!0,ge=!1),d&&me>0)continue;let e,n,i,r,a,g=0;if(o){if(r=M.split(lP),g=10===r.length?1:0,R=r[2],f&&"CA"!==R)continue;e=parseFloat(r[6-g]),n=parseFloat(r[7-g]),i=parseFloat(r[8-g])}else{if(R=M.substr(12,4).trim(),f&&"CA"!==R)continue;e=parseFloat(M.substr(30,8)),n=parseFloat(M.substr(38,8)),i=parseFloat(M.substr(46,8))}if(p){const t=3*v;if(y[t+0]=e,y[t+1]=n,y[t+2]=i,v+=1,b)continue}o?(C=parseInt(r[1]),a="",k="H"===M[0],T=g?"":r[4],E=parseInt(r[5-g]),L="",P=r[3],O="",I=1):(C=parseInt(M.substr(6,5),u),c&&99999===C&&(u=16),k="H"===M[0],T=M[21].trim(),E=parseInt(M.substr(22,4),h),c&&9999===E&&(h=16),L=M[26].trim(),P=M.substr(17,4).trim()||"MOL",D=parseFloat(M.substr(60,6)),O=M[16].trim(),I=parseFloat(M.substr(54,6)),t||(s?(a=M.substr(76,3).trim(),a in $b&&(a=$b[a])):(a=M.substr(76,2).trim(),T||(T=M.substr(72,4).trim())),N=parseInt((M.substr(79,1)+M.substr(78,1)).trim()))),he.growIfFull(),he.atomTypeId[fe]=ue.add(R,a),he.x[fe]=e,he.y[fe]=n,he.z[fe]=i,he.serial[fe]=C,he.altloc[fe]=O.charCodeAt(0),he.occupancy[fe]=isNaN(I)?0:I,o?(he.partialCharge[fe]=parseFloat(r[9-g]),he.radius[fe]=parseFloat(r[10-g])):(he.bfactor[fe]=isNaN(D)?0:D,s&&(he.partialCharge[fe]=parseFloat(M.substr(70,6))),isFinite(N)&&(he.formalCharge||he.addField("formalCharge",1,"int8"),he.formalCharge[fe]=N));const x=cP(E,T,L);!k||Z[x]||sP.includes(P)?ee||te===T||(Q+=1,J=Q.toString()):te===T&&ie===P&&(zb.includes(P)||ne===E&&re===L)||(Q+=1,J=Q.toString(),ne=E,ie=P,re=L),l.addAtom(me,T,J,P,E,k,void 0,L),V[C]=fe,fe+=1,ee=!1,te=T}else if("CONECT"===A){const e=V[parseInt(M.substr(6,5))],t=[11,16,21,26],n={};if(void 0===e)continue;for(let i=0;i<4;++i){let r=parseInt(M.substr(t[i],5));if(!Number.isNaN(r)&&(r=V[r],void 0!==r))if(e<r?(de.index=e,pe.index=r):(de.index=r,pe.index=e),void 0!==n[r])a.bondStore.bondOrder[n[r]]+=1;else{const e=de.index+"|"+pe.index;void 0===$[e]&&($[e]=!0,n[r]=a.bondStore.count,a.bondStore.addBond(de,pe,1))}}}else if("HELIX "===A){B=M[19].trim(),F=parseInt(M.substr(21,4)),z=M[25].trim(),U=M[31].trim(),H=parseInt(M.substr(33,4)),G=M[37].trim();let e=parseInt(M.substr(39,1));e=(oP[e]||oP[0]).charCodeAt(0),le.push([B,F,z,U,H,G,e])}else if("SHEET "===A)B=M[21].trim(),F=parseInt(M.substr(22,4)),z=M[26].trim(),U=M[32].trim(),H=parseInt(M.substr(33,4)),G=M[37].trim(),ce.push([B,F,z,U,H,G]);else if("HETNAM"===A)Y[M.substr(11,3)]=M.substr(15).trim();else if("SEQRES"===A){const e=M[11].trim();e!==se&&(oe[e]=[],se=e),oe[e].push(...M.substr(19).trim().split(lP))}else if("MODRES"===A){const e=M.substr(12,3).trim(),t=M[16].trim(),n=M[22].trim(),i=parseInt(M.substr(18,4).trim()),r=cP(i,t,n);Z[r]={resname:e,chainname:t,inscode:n,resno:i}}else if("COMPND"===A){const e=M.substr(10,70).trim(),t=e.indexOf(":"),n=e.substring(0,t);let i;aP.includes(n)?(X=n,i=e.substring(t+2)):i=e,i=i.replace(/;$/,""),"MOL_ID"===X?(q={chainList:[],name:""},W.push(q)):"MOLECULE"===X?(q.name&&(q.name+=" "),q.name+=i):"CHAIN"===X&&Array.prototype.push.apply(q.chainList,i.split(/\s*,\s*/))}else if(M.startsWith("TER")){const e=a.getChainProxy(a.chainStore.count-1);K[e.chainname]=e.index,Q+=1,J=Q.toString(),ee=!0}else if("REMARK"===A&&"350"===M.substr(7,3)){if("BIOMOLECULE:"===M.substr(11,12)){let e=M.substr(23).trim();/^(0|[1-9][0-9]*)$/.test(e)&&(e="BU"+e),w=new yS(e),x[e]=w}else if("BIOMT"===M.substr(13,5)){const e=M.split(/\s+/),t=parseInt(M[18])-1;0===t&&(S=new Sn,_.matrixList.push(S));const n=S.elements;n[0+t]=parseFloat(e[4]),n[4+t]=parseFloat(e[5]),n[8+t]=parseFloat(e[6]),n[12+t]=parseFloat(e[7])}else if("APPLY THE FOLLOWING TO CHAINS:"===M.substr(11,30)||"                   AND CHAINS:"===M.substr(11,30)){"APPLY"===M.substr(11,5)&&(_=w.addPart());const e=M.substr(41,30).split(",");for(let t=0,n=e.length;t<n;++t){const n=e[t].trim();n&&_.chainList.push(n)}}}else if("HEADER"===A)a.id=M.substr(62,4);else if("TITLE "===A)a.title+=(a.title?" ":"")+M.substr(10,70).trim();else if("MODEL "===A)ge=!0;else if("ENDMDL"===A||"END"===M.trim()){if(ge)continue;p&&!b&&(m.push(new Float32Array(y)),b=!0),me+=1,ge=!0}else if("MTRIX"===M.substr(0,5)){if("1"===M[59])continue;if(!w||"NCS"!==w.name){const e="NCS";w=new yS(e),x[e]=w,_=w.addPart()}const e=M.split(/\s+/),t=parseInt(M[5])-1;0===t&&(S=new Sn,_.matrixList.push(S));const n=S.elements;n[0+t]=parseFloat(e[2]),n[4+t]=parseFloat(e[3]),n[8+t]=parseFloat(e[4]),n[12+t]=parseFloat(e[5])}else if("ORIGX"===M.substr(0,5)){j.origx||(j.origx=new Sn);const e=M.split(/\s+/),t=parseInt(M[5])-1,n=j.origx.elements;n[0+t]=parseFloat(e[1]),n[4+t]=parseFloat(e[2]),n[8+t]=parseFloat(e[3]),n[12+t]=parseFloat(e[4])}else if("SCALE"===M.substr(0,5)){j.scale||(j.scale=new Sn);const e=M.split(/\s+/),t=parseInt(M[5])-1,n=j.scale.elements;n[0+t]=parseFloat(e[1]),n[4+t]=parseFloat(e[2]),n[8+t]=parseFloat(e[3]),n[12+t]=parseFloat(e[4])}else if("CRYST1"===A){const e=parseFloat(M.substr(6,9)),t=parseFloat(M.substr(15,9)),n=parseFloat(M.substr(24,9)),i=parseFloat(M.substr(33,7)),r=parseFloat(M.substr(40,7)),o=parseFloat(M.substr(47,7)),s=M.substr(55,11).trim(),a=new Float32Array(9);a[0]=e,a[4]=t,a[8]=n,g.push(a),0===me&&(j.a=e,j.b=t,j.c=n,j.alpha=i,j.beta=r,j.gamma=o,j.spacegroup=s)}}this.streamer.eachChunkOfLines((function(e){ye(0,e.length,e)})),l.finalize();const ve=W.length;if(ve){a.eachChain((function(e){e.entityIndex=ve})),W.forEach((function(e,t){const n=e.chainList.map((function(e){return K[e]}));a.entityList.push(new nP(a,t,e.name,"polymer",n))}));let e=W.length;const t=a.getResidueProxy(),n={};a.eachChain((function(e){e.entityIndex===ve&&(t.index=e.residueOffset,n[t.resname]||(n[t.resname]=[]),n[t.resname].push(e.index))})),Object.keys(n).forEach((function(t){const i=n[t];let r="non-polymer",o=Y[t]||t;zb.includes(t)&&(o="water",r="water"),a.entityList.push(new nP(a,e,o,r,i)),e+=1}))}void 0!==j.a?a.unitcell=new rP(j):a.unitcell=void 0,(le.length||ce.length)&&xS(a,ae),a.finalizeAtoms(),t||MS(a),AS(a,this.inferBonds),a.finalizeBonds(),le.length||ce.length||wS(a),RS(a),e.Debug&&gm.timeEnd("PdbParser._parse "+this.name)}}Cm.add("pdb",uP),Cm.add("pdb1",uP),Cm.add("ent",uP);const hP=/\s+/,dP=/'((?:(?!'\s).)*)'|"((?:(?!"\s).)*)"|(\S+)/g,pP=/"/g,fP=/^['"]+|['"]+$/g,mP=/^\D{1,2}/;function gP(e){return!e||e[0]!==e[e.length-1]||"'"!==e[0]&&'"'!==e[0]?e:e.substring(1,e.length-1)}function yP(e,t){Array.isArray(e[t])||Object.keys(e).forEach((function(t){e[t]=[e[t]]}))}function vP(e){return"?"!==e}function bP(e,t){return vP(e)?e:t}function xP(e){switch(e.toLowerCase()){case"?":case"sing":return 1;case"doub":return 2;case"trip":return 3;case"quad":return 4}return 0}function wP(e,t,n){const i=t.atomStore,r=t.atomMap;let o,s;const a=e.chem_comp,l=e.chem_comp_atom,c=e.chem_comp_bond;a&&(a.name&&(t.title=a.name.trim().replace(fP,"")),a.id&&(t.id=a.id.trim().replace(fP,"")));var u={};if(l){var h,d,p,f;for(yP(l,"comp_id"),s=l.comp_id.length,o=0;o<s;++o)i.growIfFull(),h=l.atom_id[o].replace(pP,""),d=l.type_symbol[o],u[h]=o,i.atomTypeId[o]=r.add(h,d),i.x[o]=l.model_Cartn_x[o],i.y[o]=l.model_Cartn_y[o],i.z[o]=l.model_Cartn_z[o],i.serial[o]=o,p=l.pdbx_component_comp_id[o],f=l.pdbx_residue_numbering?l.pdbx_residue_numbering[o]:1,n.addAtom(0,"","",p,f,!0);for(o=0;o<s;++o){var m=o+s;i.growIfFull(),h=l.atom_id[o].replace(pP,""),d=l.type_symbol[o],i.atomTypeId[m]=r.add(h,d),i.x[m]=l.pdbx_model_Cartn_x_ideal[o],i.y[m]=l.pdbx_model_Cartn_y_ideal[o],i.z[m]=l.pdbx_model_Cartn_z_ideal[o],i.serial[m]=m,p=l.pdbx_component_comp_id[o],f=l.pdbx_residue_numbering?l.pdbx_residue_numbering[o]:1,n.addAtom(1,"","",p,f,!0)}}if(l&&c){var g,y,v;yP(c,"comp_id"),s=c.comp_id.length;var b=l.comp_id.length,x=t.getAtomProxy(),w=t.getAtomProxy();for(o=0;o<s;++o)g=c.atom_id_1[o].replace(pP,""),y=c.atom_id_2[o].replace(pP,""),v=xP(c.value_order[o]),x.index=u[g],w.index=u[y],t.bondStore.growIfFull(),t.bondStore.addBond(x,w,v),x.index+=b,w.index+=b,t.bondStore.growIfFull(),t.bondStore.addBond(x,w,v)}}function _P(e,t,n){var i,r=t.atomStore,o=t.atomMap;e.data&&(t.id=e.data,t.name=e.data),t.unitcell=new rP({a:parseFloat(e.cell_length_a),b:parseFloat(e.cell_length_b),c:parseFloat(e.cell_length_c),alpha:parseFloat(e.cell_angle_alpha),beta:parseFloat(e.cell_angle_beta),gamma:parseFloat(e.cell_angle_gamma),spacegroup:gP(e["symmetry_space_group_name_H-M"])});const s=new mn,a=new mn,l=e.atom_site_type_symbol.length,c={};for(let g=0;g<l;++g){r.growIfFull();const l=e.atom_site_label[g],u=e.atom_site_type_symbol[g];let h=c[u];if(!h){const e=u.match(mP);c[u]=h=null!==(i=null===e||void 0===e?void 0:e[0])&&void 0!==i?i:u}r.atomTypeId[g]=o.add(l,h),s.set(e.atom_site_fract_x[g],e.atom_site_fract_y[g],e.atom_site_fract_z[g]),s.applyMatrix4(t.unitcell.fracToCart),a.add(s),r.x[g]=s.x,r.y[g]=s.y,r.z[g]=s.z,e.atom_site_occupancy&&(r.occupancy[g]=parseFloat(e.atom_site_occupancy[g])),r.serial[g]=g,n.addAtom(0,"","","HET",1,!0)}a.divideScalar(l),t.center=a,RS(t);const u=new mn,h=new mn,d=t.biomolDict.SUPERCELL.partList[0].matrixList;let p=l;function f(e){return o.get(r.atomTypeId[e]).covalent}const m=new Sn;for(let g=0;g<l;++g){const e=f(g);s.set(r.x[g],r.y[g],r.z[g]),d.forEach((function(t){if(!m.equals(t)){u.copy(s),u.applyMatrix4(t);for(let t=0;t<l;++t){h.set(r.x[t],r.y[t],r.z[t]);const i=u.distanceToSquared(h),o=f(t)+e,s=o+.3,a=o-.5;if(i<s*s&&i>a*a)return r.growIfFull(),r.atomTypeId[p]=r.atomTypeId[g],r.x[p]=u.x,r.y[p]=u.y,r.z[p]=u.z,r.occupancy[p]=r.occupancy[g],r.serial[p]=p,r.altloc[p]="A".charCodeAt(0),n.addAtom(0,"","","HET",1,!0),void(p+=1)}}}))}}function SP(e,t,n){var i,r,o,s,a=[],l=[],c=e.struct_conf;if(null===c||void 0===c?void 0:c.pdbx_PDB_helix_class)for(yP(c,"id"),i=0,r=c.beg_auth_seq_id.length;i<r;++i){var u=parseInt(c.pdbx_PDB_helix_class[i]);Number.isNaN(u)||(o=c.pdbx_beg_PDB_ins_code[i],s=c.pdbx_end_PDB_ins_code[i],a.push([n[c.beg_label_asym_id[i]],parseInt(c.beg_auth_seq_id[i]),bP(o,""),n[c.end_label_asym_id[i]],parseInt(c.end_auth_seq_id[i]),bP(s,""),(oP[u]||oP[0]).charCodeAt(0)]))}var h=e.struct_sheet_range;if(h)for(yP(h,"id"),i=0,r=h.beg_auth_seq_id.length;i<r;++i)o=h.pdbx_beg_PDB_ins_code[i],s=h.pdbx_end_PDB_ins_code[i],l.push([n[h.beg_label_asym_id[i]],parseInt(h.beg_auth_seq_id[i]),bP(o,""),n[h.end_label_asym_id[i]],parseInt(h.end_auth_seq_id[i]),bP(s,"")]);return!(!c&&!h)&&{helices:a,sheets:l}}function MP(e,t,n){var i={},r=t.biomolDict;if(e.pdbx_struct_oper_list){var o=e.pdbx_struct_oper_list;yP(o,"id"),o.id.forEach((function(e,t){var n=new Sn,r=n.elements;r[0]=parseFloat(o["matrix[1][1]"][t]),r[1]=parseFloat(o["matrix[1][2]"][t]),r[2]=parseFloat(o["matrix[1][3]"][t]),r[4]=parseFloat(o["matrix[2][1]"][t]),r[5]=parseFloat(o["matrix[2][2]"][t]),r[6]=parseFloat(o["matrix[2][3]"][t]),r[8]=parseFloat(o["matrix[3][1]"][t]),r[9]=parseFloat(o["matrix[3][2]"][t]),r[10]=parseFloat(o["matrix[3][3]"][t]),r[3]=parseFloat(o["vector[1]"][t]),r[7]=parseFloat(o["vector[2]"][t]),r[11]=parseFloat(o["vector[3]"][t]),n.transpose(),i[e]=n}))}if(e.pdbx_struct_assembly_gen){var s=e.pdbx_struct_assembly_gen;yP(s,"assembly_id");var a=function(e){var t={};return e.replace(/[()']/g,"").split(",").forEach((function(e){if(e.includes("-"))for(var n=e.split("-"),r=parseInt(n[0]),o=parseInt(n[1]);r<=o;++r)t[r]=i[r];else t[e]=i[e]})),t};s.assembly_id.forEach((function(e,t){var i={},o=s.oper_expression[t].replace(/['"]\(|['"]/g,"");if(o.includes(")(")||o.indexOf("(")>0){o=o.split("(");var l=a(o[0]),c=a(o[1]);Object.keys(l).forEach((function(e){Object.keys(c).forEach((function(t){var n=new Sn;n.multiplyMatrices(l[e],c[t]),i[e+"x"+t]=n}))}))}else i=a(o);var u=[];for(var h in i)u.push(i[h]);var d=e;/^(0|[1-9][0-9]*)$/.test(d)&&(d="BU"+d);for(var p=s.asym_id_list[t].split(","),f=0,m=p.length;f<m;++f)p[f]=n[p[f]];void 0===r[d]&&(r[d]=new yS(d)),r[d].addPart(u,p)}))}if(e.struct_ncs_oper){var l=e.struct_ncs_oper;yP(l,"id");var c="NCS";r[c]=new yS(c);var u=r[c].addPart();l.id.forEach((function(e,t){if("given"!==l.code[t]){var n=new Sn,i=n.elements;i[0]=parseFloat(l["matrix[1][1]"][t]),i[1]=parseFloat(l["matrix[1][2]"][t]),i[2]=parseFloat(l["matrix[1][3]"][t]),i[4]=parseFloat(l["matrix[2][1]"][t]),i[5]=parseFloat(l["matrix[2][2]"][t]),i[6]=parseFloat(l["matrix[2][3]"][t]),i[8]=parseFloat(l["matrix[3][1]"][t]),i[9]=parseFloat(l["matrix[3][2]"][t]),i[10]=parseFloat(l["matrix[3][3]"][t]),i[3]=parseFloat(l["vector[1]"][t]),i[7]=parseFloat(l["vector[2]"][t]),i[11]=parseFloat(l["vector[3]"][t]),n.transpose(),u.matrixList.push(n)}})),0===u.matrixList.length&&delete r[c]}const h={};if(e.cell){const n=e.cell,i=parseFloat(n.length_a),r=parseFloat(n.length_b),o=parseFloat(n.length_c),s=new Float32Array(9);s[0]=i,s[4]=r,s[8]=o,t.boxes.push(s),h.a=i,h.b=r,h.c=o,h.alpha=parseFloat(n.angle_alpha),h.beta=parseFloat(n.angle_beta),h.gamma=parseFloat(n.angle_gamma)}e.symmetry&&(h.spacegroup=gP(e.symmetry["space_group_name_H-M"]));var d=new Sn;if(e.database_PDB_matrix){var p=e.database_PDB_matrix,f=d.elements;f[0]=parseFloat(p["origx[1][1]"]),f[1]=parseFloat(p["origx[1][2]"]),f[2]=parseFloat(p["origx[1][3]"]),f[4]=parseFloat(p["origx[2][1]"]),f[5]=parseFloat(p["origx[2][2]"]),f[6]=parseFloat(p["origx[2][3]"]),f[8]=parseFloat(p["origx[3][1]"]),f[9]=parseFloat(p["origx[3][2]"]),f[10]=parseFloat(p["origx[3][3]"]),f[3]=parseFloat(p["origx_vector[1]"]),f[7]=parseFloat(p["origx_vector[2]"]),f[11]=parseFloat(p["origx_vector[3]"]),d.transpose(),h.origx=d}var m=new Sn;if(e.atom_sites){var g=e.atom_sites,y=m.elements;y[0]=parseFloat(g["fract_transf_matrix[1][1]"]),y[1]=parseFloat(g["fract_transf_matrix[1][2]"]),y[2]=parseFloat(g["fract_transf_matrix[1][3]"]),y[4]=parseFloat(g["fract_transf_matrix[2][1]"]),y[5]=parseFloat(g["fract_transf_matrix[2][2]"]),y[6]=parseFloat(g["fract_transf_matrix[2][3]"]),y[8]=parseFloat(g["fract_transf_matrix[3][1]"]),y[9]=parseFloat(g["fract_transf_matrix[3][2]"]),y[10]=parseFloat(g["fract_transf_matrix[3][3]"]),y[3]=parseFloat(g["fract_transf_vector[1]"]),y[7]=parseFloat(g["fract_transf_vector[2]"]),y[11]=parseFloat(g["fract_transf_vector[3]"]),m.transpose(),h.scale=m}void 0!==h.a?t.unitcell=new rP(h):t.unitcell=void 0}function AP(t,n,i){var r=t.struct_conn;if(r){yP(r,"id");for(var o=/"/g,s=n.getAtomProxy(),a=n.getAtomProxy(),l={},c=0,u=r.id.length;c<u;++c){var h=r.conn_type_id[c];if("hydrog"!==h&&"mismat"!==h&&"saltbr"!==h&&"1_555"===r.ptnr1_symmetry[c]&&"1_555"===r.ptnr2_symmetry[c]){var d=r.pdbx_ptnr1_PDB_ins_code[c],p=r.pdbx_ptnr1_label_alt_id[c],f=r.ptnr1_auth_seq_id[c]+(vP(d)?"^"+d:"")+":"+i[r.ptnr1_label_asym_id[c]]+"."+r.ptnr1_label_atom_id[c].replace(o,"")+(vP(p)?"%"+p:""),m=l[f];if(!m){var g=new Kf(f);if(g.selection.error){e.Debug&&gm.warn("invalid selection for connection",f);continue}m=n.getAtomIndices(g),l[f]=m}var y=r.pdbx_ptnr2_PDB_ins_code[c],v=r.pdbx_ptnr2_label_alt_id[c],b=r.ptnr2_auth_seq_id[c]+(vP(y)?"^"+y:"")+":"+i[r.ptnr2_label_asym_id[c]]+"."+r.ptnr2_label_atom_id[c].replace(o,"")+(vP(v)?"%"+v:""),x=l[b];if(!x){var w=new Kf(b);if(w.selection.error){e.Debug&&gm.warn("invalid selection for connection",b);continue}x=n.getAtomIndices(w),l[b]=x}var _=m.length,S=x.length;if(_>S){var M=_;_=S,S=M;var A=m;m=x,x=A}if(0!==_&&0!==S)for(var C=0;C<S;++C)s.index=m[C%_],a.index=x[C],s&&a?n.bondStore.addBond(s,a,xP(r.pdbx_value_order[c])):gm.log("atoms for connection not found");else e.Debug&&gm.warn("no atoms found for",f,b)}}}}function CP(e,t,n){if(e.entity){yP(e.entity,"id");for(var i=e.entity,r=i.id.length,o=0;o<r;++o){var s=i.pdbx_description[o],a=i.type[o],l=Array.from(n[i.id[o]]);t.entityList[o]=new nP(t,o,s,a,l)}}}class TP extends JE{get type(){return"cif"}_parse(){gm.time("CifParser._parse "+this.name);var t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,v,b,x,w,_,S=this.structure,M=this.structureBuilder,A=this.firstModelOnly,C=this.asTrajectory,T=this.cAlphaOnly,E=S.frames,P={},I={},L={},R=!1,k=null,D=!1,O=!1,N=!1,B=[],F=null,z=null,U=null,H=null,G=[],V=S.atomMap,j=S.atomStore;j.resize(this.streamer.data.length/100);var $,W=0,q=0;function X(X,Y,Z){for(var K=X;K<Y;++K)if(i=Z[K],((r=i.trim())||R||O)&&"#"!==r[0])if("data_"===r.substring(0,5))P.data=r.substring(5).trim();else if(";"===r[0])R?(O?(F===B.length&&(F=0),B[F].push(k),F+=1):!1===U?P[z]=k:P[z][U]=k,R=!1,k=null):(R=!0,k=r.substring(1));else if("loop_"===r)O=!0,N=!0,B.length=0,G.length=0,F=0;else if("_"===r[0]){var Q,J,ee;if(O&&!N&&(O=!1),O)J=(Q=r.split("."))[0].substring(1),ee=Q[1],1===Q.length?(ee=!1,P[J]||(P[J]=[]),B.push(P[J])):(P[J]||(P[J]={}),P[J][ee]?e.Debug&&gm.warn(J,ee,"already exists"):(P[J][ee]=[],B.push(P[J][ee]),G.push(ee))),z=J,U=ee,H=!0;else{var te=r.match(dP),ne=te[0],ie=te[1];J=(Q=ne.split("."))[0].substring(1),ee=Q[1],1===Q.length?(ee=!1,P[J]=ie):(P[J]||(P[J]={}),P[J][ee]?e.Debug&&gm.warn(J,ee,"already exists"):P[J][ee]=ie),ie||(D=!0),z=J,U=ee}}else if(R)k+=i;else if(O){if(!r)continue;if("atom_site"===z){const i=r.split(hP);H&&(o=G.indexOf("auth_asym_id"),s=G.indexOf("auth_seq_id"),a=G.indexOf("label_seq_id"),l=G.indexOf("label_atom_id"),c=G.indexOf("label_comp_id"),u=G.indexOf("label_asym_id"),h=G.indexOf("label_entity_id"),d=G.indexOf("label_alt_id"),v=G.indexOf("Cartn_x"),b=G.indexOf("Cartn_y"),x=G.indexOf("Cartn_z"),f=G.indexOf("id"),m=G.indexOf("type_symbol"),p=G.indexOf("group_PDB"),w=G.indexOf("B_iso_or_equiv"),g=G.indexOf("pdbx_PDB_model_num"),y=G.indexOf("pdbx_PDB_ins_code"),_=G.indexOf("occupancy"),H=!1,$=parseInt(i[g]),C&&(t=[],n=0));const P=parseInt(i[g]);if($!==P&&(C&&(0===q&&E.push(new Float32Array(t)),t=new Float32Array(3*j.count),E.push(t),n=0),q+=1),$=P,A&&q>0)continue;const R=i[l].replace(pP,"");if(T&&"CA"!==R)continue;const k=parseFloat(i[v]),D=parseFloat(i[b]),O=parseFloat(i[x]);if(C){const e=3*n;if(t[e+0]=k,t[e+1]=D,t[e+2]=O,n+=1,q>0)continue}const N=i[c],B=parseInt(i[-1!==s?s:a]);let F=i[y];F="?"===F?"":F;const z=i[o],U=i[u],X="H"===i[p][0],Y=i[m],Z=parseFloat(i[w]),K=parseFloat(i[_]);let Q=i[d];if(Q="."===Q?"":Q,j.growIfFull(),j.atomTypeId[W]=V.add(R,Y),j.x[W]=k,j.y[W]=D,j.z[W]=O,j.serial[W]=parseInt(i[f]),j.bfactor[W]=isNaN(Z)?0:Z,j.occupancy[W]=isNaN(K)?0:K,j.altloc[W]=Q.charCodeAt(0),M.addAtom(q,z,U,N,B,X,void 0,F),e.Debug){const t=I[U];void 0!==t&&t!==z&&e.Debug&&gm.warn(t,z)}I[U]=z;const J=i[h];L[J]||(L[J]=new Set),L[J].add(S.chainStore.count-1),W+=1}else{const e=r.match(dP),t=e.length;F===B.length&&(F=0);for(let n=0;n<t;++n)B[F+n].push(e[n]);F+=t}N=!1}else if("'"===r[0]&&"'"===r[r.length-1]){const e=r.substring(1,r.length-1);!1===U?P[z]=e:P[z][U]=e}else D?!1===U?P[z]=r:P[z][U]=r:e.Debug&&gm.log("CifParser._parse: unknown state",r);else R=!1,O=!1,D=!1,B.length=0,F=null,z=null,U=null,H=null,G.length=0}if(this.streamer.eachChunkOfLines((function(e){X(0,e.length,e)})),P.chem_comp&&P.chem_comp_atom&&!P.struct)wP(P,S,M),M.finalize(),S.finalizeAtoms(),S.finalizeBonds(),NS(S);else if(P.atom_site_type_symbol&&P.atom_site_label&&P.atom_site_fract_x)_P(P,S,M),M.finalize(),S.finalizeAtoms(),AS(S),S.finalizeBonds();else{var Y=SP(P,S,I);if(MP(P,S,I),AP(P,S,I),CP(P,S,L),P.struct&&P.struct.title&&(S.title=P.struct.title.trim().replace(fP,"")),P.entry&&P.entry.id&&(S.id=P.entry.id.trim().replace(fP,"")),P.pdbx_audit_revision_history){if(P.pdbx_audit_revision_history.revision_date){yP(P.pdbx_audit_revision_history,"revision_date");const e=P.pdbx_audit_revision_history.revision_date.filter(vP);e.length&&(S.header.releaseDate=e[0])}if(P.pdbx_database_status.recvd_initial_deposition_date){yP(P.pdbx_database_status,"recvd_initial_deposition_date");const e=P.pdbx_database_status.recvd_initial_deposition_date.filter(vP);e.length&&(S.header.depositionDate=e[0])}}else if(P.database_PDB_rev){if(P.database_PDB_rev.date){yP(P.database_PDB_rev,"date");const e=P.database_PDB_rev.date.filter(vP);e.length&&(S.header.releaseDate=e[0])}if(P.database_PDB_rev.date_original){yP(P.database_PDB_rev,"date_original");const e=P.database_PDB_rev.date_original.filter(vP);e.length&&(S.header.depositionDate=e[0])}}P.reflns&&P.reflns.d_resolution_high?vP(P.reflns.d_resolution_high)&&(S.header.resolution=parseFloat(P.reflns.d_resolution_high)):P.refine&&P.refine.ls_d_res_high&&vP(P.refine.ls_d_res_high)&&(S.header.resolution=parseFloat(P.refine.ls_d_res_high)),P.refine&&P.refine.ls_R_factor_R_free&&vP(P.refine.ls_R_factor_R_free)&&(S.header.rFree=parseFloat(P.refine.ls_R_factor_R_free)),P.refine&&P.refine.ls_R_factor_R_work&&vP(P.refine.ls_R_factor_R_work)&&(S.header.rWork=parseFloat(P.refine.ls_R_factor_R_work)),P.exptl&&P.exptl.method&&(yP(P.exptl,"method"),S.header.experimentalMethods=P.exptl.method.map((function(e){return e.replace(fP,"")}))),M.finalize(),S.finalizeAtoms(),AS(S),S.finalizeBonds(),Y?xS(S,Y):wS(S),RS(S),S.extraData.cif=P}e.Debug&&gm.timeEnd("CifParser._parse "+this.name)}}Cm.add("cif",TP),Cm.add("mcif",TP),Cm.add("mmcif",TP);class EP extends JE{get type(){return"gro"}_parse(){e.Debug&&gm.time("GroParser._parse "+this.name);var t,n,i=this.structure,r=this.structureBuilder,o=this.firstModelOnly,s=this.asTrajectory,a=this.cAlphaOnly,l=i.frames,c=i.boxes,u=this.streamer.peekLines(3);i.title=u[0].trim();var h,d,p,f,m=u[2].length-u[2].lastIndexOf(".")-1+5,g=20,y=20+m,v=20+2*m,b=parseInt(u[1]),x=b+3,w=i.atomMap,_=i.atomStore;_.resize(b);var S=0,M=0,A=0;function C(e,i,u){for(var C=e;C<i;++C){var T=++A-1,E=u[C];if(E)if(T%x===0)s&&(t=new Float32Array(3*b),l.push(t),n=0);else if(T%x===1);else if(T%x===x-1){var P=E.trim().split(/\s+/),I=new Float32Array(9);if(I[0]=10*parseFloat(P[0]),I[4]=10*parseFloat(P[1]),I[8]=10*parseFloat(P[2]),c.push(I),o)return!0;M+=1}else{if(h=E.substr(10,5).trim(),a&&"CA"!==h)continue;var L=10*parseFloat(E.substr(g,m)),R=10*parseFloat(E.substr(y,m)),k=10*parseFloat(E.substr(v,m));if(s){var D=3*n;if(t[D+0]=L,t[D+1]=R,t[D+2]=k,n+=1,T>x)continue}d=E.substr(5,5).trim(),p=parseInt(E.substr(0,5)),f=parseInt(E.substr(15,5)),_.growIfFull(),_.atomTypeId[S]=w.add(h),_.x[S]=L,_.y[S]=R,_.z[S]=k,_.serial[S]=f,r.addAtom(M,"","",d,p,!1,"l"),S+=1}}}this.streamer.eachChunkOfLines((function(e){C(0,e.length,e)})),r.finalize(),i.finalizeAtoms(),MS(i),AS(i),i.finalizeBonds(),wS(i),e.Debug&&gm.timeEnd("GroParser._parse "+this.name)}}Cm.add("gro",EP);var PP=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"].concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]);function IP(e,t,n){return t?new e(t.buffer,t.byteOffset,t.byteLength/(n||1)):void 0}function LP(e){return IP(DataView,e)}function RP(e){return IP(Uint8Array,e)}function kP(e){return IP(Int8Array,e)}function DP(e){return IP(Int32Array,e,4)}function OP(e){return IP(Float32Array,e,4)}function NP(e,t){var n=e.length/2;t||(t=new Int16Array(n));for(var i=0,r=0;i<n;++i,r+=2)t[i]=e[r]<<8^e[r+1]<<0;return t}function BP(e,t){var n=e.length/4;t||(t=new Int32Array(n));for(var i=0,r=0;i<n;++i,r+=4)t[i]=e[r]<<24^e[r+1]<<16^e[r+2]<<8^e[r+3]<<0;return t}function FP(e,t){var n=e.length;t||(t=new Float32Array(n/4));for(var i=LP(t),r=LP(e),o=0,s=0,a=n/4;o<a;++o,s+=4)i.setFloat32(s,r.getFloat32(s),!0);return t}function zP(e,t,n){var i=e.length,r=1/t;n||(n=new Float32Array(i));for(var o=0;o<i;++o)n[o]=e[o]*r;return n}function UP(e,t){var n,i;if(!t){var r=0;for(n=0,i=e.length;n<i;n+=2)r+=e[n+1];t=new e.constructor(r)}var o=0;for(n=0,i=e.length;n<i;n+=2)for(var s=e[n],a=e[n+1],l=0;l<a;++l)t[o]=s,++o;return t}function HP(e,t){var n=e.length;t||(t=new e.constructor(n)),n&&(t[0]=e[0]);for(var i=1;i<n;++i)t[i]=e[i]+t[i-1];return t}function GP(e,t){var n,i,r=e instanceof Int8Array?127:32767,o=-r-1,s=e.length;if(!t){var a=0;for(n=0;n<s;++n)e[n]<r&&e[n]>o&&++a;t=new Int32Array(a)}for(n=0,i=0;n<s;){for(var l=0;e[n]===r||e[n]===o;)l+=e[n],++n;l+=e[n],++n,t[i]=l,++i}return t}function VP(e,t){return HP(UP(e),t)}function jP(e,t,n){return zP(UP(e,DP(n)),t,n)}function $P(e,t,n){return zP(HP(e,DP(n)),t,n)}function WP(e,t,n){return zP(GP(e,DP(n)),t,n)}function qP(e,t,n){var i=GP(e,DP(n));return $P(i,t,OP(i))}function XP(e){var t=LP(e),n=t.getInt32(0),i=t.getInt32(4),r=e.subarray(8,12);return[n,e=e.subarray(12),i,r]}function YP(e){var t=0,n=new DataView(e.buffer);function i(e){for(var t={},n=0;n<e;n++)t[a()]=a();return t}function r(n){var i=e.subarray(t,t+n);return t+=n,i}function o(n){var i=e.subarray(t,t+n);t+=n;var r=65535;if(n>r){for(var o=[],s=0;s<i.length;s+=r)o.push(String.fromCharCode.apply(null,i.subarray(s,s+r)));return o.join("")}return String.fromCharCode.apply(null,i)}function s(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=a();return t}function a(){var a,l,c=e[t];if(0===(128&c))return t++,c;if(128===(240&c))return t++,i(l=15&c);if(144===(240&c))return t++,s(l=15&c);if(160===(224&c))return t++,o(l=31&c);if(224===(224&c))return a=n.getInt8(t),t++,a;switch(c){case 192:return t++,null;case 194:return t++,!1;case 195:return t++,!0;case 196:return l=n.getUint8(t+1),t+=2,r(l);case 197:return l=n.getUint16(t+1),t+=3,r(l);case 198:return l=n.getUint32(t+1),t+=5,r(l);case 202:return a=n.getFloat32(t+1),t+=5,a;case 203:return a=n.getFloat64(t+1),t+=9,a;case 204:return a=e[t+1],t+=2,a;case 205:return a=n.getUint16(t+1),t+=3,a;case 206:return a=n.getUint32(t+1),t+=5,a;case 208:return a=n.getInt8(t+1),t+=2,a;case 209:return a=n.getInt16(t+1),t+=3,a;case 210:return a=n.getInt32(t+1),t+=5,a;case 217:return l=n.getUint8(t+1),t+=2,o(l);case 218:return l=n.getUint16(t+1),t+=3,o(l);case 219:return l=n.getUint32(t+1),t+=5,o(l);case 220:return l=n.getUint16(t+1),t+=3,s(l);case 221:return l=n.getUint32(t+1),t+=5,s(l);case 222:return l=n.getUint16(t+1),t+=3,i(l);case 223:return l=n.getUint32(t+1),t+=5,i(l)}throw new Error("Unknown type 0x"+c.toString(16))}return a()}function ZP(e,t,n,i){switch(e){case 1:return FP(t);case 2:return kP(t);case 3:return NP(t);case 4:return BP(t);case 5:return RP(t);case 6:return UP(BP(t),new Uint8Array(n));case 7:return UP(BP(t));case 8:return VP(BP(t));case 9:return jP(BP(t),BP(i)[0]);case 10:return qP(NP(t),BP(i)[0]);case 11:return zP(NP(t),BP(i)[0]);case 12:return WP(NP(t),BP(i)[0]);case 13:return WP(kP(t),BP(i)[0]);case 14:return GP(NP(t));case 15:return GP(kP(t))}}function KP(e,t){var n=(t=t||{}).ignoreFields,i={};return PP.forEach((function(t){var r=!!n&&-1!==n.indexOf(t),o=e[t];r||void 0===o||(o instanceof Uint8Array?i[t]=ZP.apply(null,XP(o)):i[t]=o)})),i}const QP={0:"i".charCodeAt(0),1:"s".charCodeAt(0),2:"h".charCodeAt(0),3:"e".charCodeAt(0),4:"g".charCodeAt(0),5:"b".charCodeAt(0),6:"t".charCodeAt(0),7:"l".charCodeAt(0),"-1":"".charCodeAt(0)};class JP extends JE{get type(){return"mmtf"}get isBinary(){return!0}_parse(){let t,n,i,r,o;e.Debug&&gm.time("MmtfParser._parse "+this.name);const s=this.structure,a=KP(YP(this.streamer.data));let l,c,u,h,d,p;if(["depositionDate","releaseDate","resolution","rFree","rWork","experimentalMethods"].forEach((function(e){void 0!==a[e]&&(s.header[e]=a[e])})),s.id=a.structureId,s.title=a.title,s.atomStore.addField("formalCharge",1,"int8"),this.firstModelOnly||this.asTrajectory){for(d=1,h=a.chainsPerModel[0],u=0,t=0,n=h;t<n;++t)u+=a.groupsPerChain[t];for(c=0,t=0,n=u;t<n;++t)o=a.groupList[a.groupTypeList[t]],c+=o.atomNameList.length;l=a.numBonds,p=[h]}else l=a.numBonds,c=a.numAtoms,u=a.numGroups,h=a.numChains,d=a.numModels,p=a.chainsPerModel;if(l+=u,this.asTrajectory)for(t=0,n=a.numModels;t<n;++t){const e=new Float32Array(3*c),n=c*t;for(i=0;i<c;++i){const t=3*i,r=i+n;e[t]=a.xCoordList[r],e[t+1]=a.yCoordList[r],e[t+2]=a.zCoordList[r]}s.frames.push(e)}const f=new Uint32Array(l),m=new Uint32Array(l),g=new Uint8Array(l),y=new Uint32Array(c),v=new Int8Array(c),b=new Uint32Array(u),x=new Uint32Array(u),w=new Uint16Array(u),_=new Uint16Array(h),S=new Uint32Array(h),M=new Uint32Array(h),A=new Uint32Array(d),C=new Uint32Array(d);let T=0;for(t=0,n=d;t<n;++t){const e=p[t];for(A[t]=T,C[t]=e,i=0;i<e;++i)_[i+T]=t;T+=e}const E=a.groupsPerChain;let P=0;for(t=0,n=h;t<n;++t){const e=E[t];for(S[t]=P,M[t]=e,i=0;i<e;++i)b[i+P]=t;P+=e}let I=0,L=0;for(t=0,n=u;t<n;++t){o=a.groupList[a.groupTypeList[t]];const e=o.atomNameList.length,n=o.formalChargeList,s=o.bondAtomList,l=o.bondOrderList;for(i=0,r=l.length;i<r;++i)f[L]=I+s[2*i],m[L]=I+s[2*i+1],g[L]=l[i],L+=1;for(x[t]=I,w[t]=e,i=0;i<e;++i)y[I]=t,v[I]=n[i],I+=1}const R=a.bondAtomList;if(R)for(a.bondOrderList&&g.set(a.bondOrderList,L),t=0,n=R.length;t<n;t+=2){const e=R[t],n=R[t+1];e<c&&n<c&&(f[L]=e,m[L]=n,L+=1)}s.bondStore.length=g.length,s.bondStore.count=L,s.bondStore.atomIndex1=f,s.bondStore.atomIndex2=m,s.bondStore.bondOrder=g,s.atomStore.length=c,s.atomStore.count=c,s.atomStore.residueIndex=y,s.atomStore.atomTypeId=new Uint16Array(c),s.atomStore.x=a.xCoordList.subarray(0,c),s.atomStore.y=a.yCoordList.subarray(0,c),s.atomStore.z=a.zCoordList.subarray(0,c),s.atomStore.serial=a.atomIdList.subarray(0,c),s.atomStore.bfactor=a.bFactorList.subarray(0,c),s.atomStore.altloc=a.altLocList.subarray(0,c),s.atomStore.occupancy=a.occupancyList.subarray(0,c),s.atomStore.formalCharge=v,s.residueStore.length=u,s.residueStore.count=u,s.residueStore.chainIndex=b,s.residueStore.residueTypeId=a.groupTypeList,s.residueStore.atomOffset=x,s.residueStore.atomCount=w,s.residueStore.resno=a.groupIdList.subarray(0,u),s.residueStore.sstruc=a.secStructList.subarray(0,u),s.residueStore.inscode=a.insCodeList.subarray(0,u),s.chainStore.length=h,s.chainStore.count=h,s.chainStore.entityIndex=new Uint16Array(h),s.chainStore.modelIndex=_,s.chainStore.residueOffset=S,s.chainStore.residueCount=M,s.chainStore.chainname=a.chainNameList.subarray(0,4*h),s.chainStore.chainid=a.chainIdList.subarray(0,4*h),s.modelStore.length=d,s.modelStore.count=d,s.modelStore.chainOffset=A,s.modelStore.chainCount=C;let k={};for(t=0,n=a.groupList.length;t<n;++t){const e=a.groupList[t],n=[];for(i=0,r=e.atomNameList.length;i<r;++i){const t=e.elementList[i].toUpperCase(),r=e.atomNameList[i];n.push(s.atomMap.add(r,t))}const o=e.chemCompType.toUpperCase(),l=yb.includes(o),c=e.bondOrderList.length,u=new Array(c),h=new Array(c);for(i=0;i<c;++i)u[i]=e.bondAtomList[2*i],h[i]=e.bondAtomList[2*i+1];const d={atomIndices1:u,atomIndices2:h,bondOrders:e.bondOrderList};k[t]=s.residueMap.add(e.groupName,n,l,o,d)}for(t=0,n=u;t<n;++t)s.residueStore.residueTypeId[t]=k[s.residueStore.residueTypeId[t]];for(t=0,n=s.atomStore.count;t<n;++t){const e=s.atomStore.residueIndex[t],n=s.residueMap.list[s.residueStore.residueTypeId[e]],i=s.residueStore.atomOffset[e];s.atomStore.atomTypeId[t]=n.atomTypeIdList[t-i]}if(a.secStructList){const e=a.secStructList.length;for(t=0,n=s.residueStore.count;t<n;++t){const n=QP[s.residueStore.sstruc[t%e]];void 0!==n&&(s.residueStore.sstruc[t]=n)}}if(a.entityList&&a.entityList.forEach((function(e,t){s.entityList[t]=new nP(s,t,e.description,e.type,e.chainIndexList)})),a.bioAssemblyList&&a.bioAssemblyList.forEach((function(e,t){const n=t+1,i=new yS(""+n);s.biomolDict["BU"+n]=i;let r={};e.transformList.forEach((function(e){const t=(new Sn).fromArray(e.matrix).transpose(),n=e.chainIndexList.map((function(e){let t="";for(let n=0;n<4;++n){const i=a.chainNameList[4*e+n];if(!i)break;t+=String.fromCharCode(i)}return t})),o=r[n.toString()];o?o.matrixList.push(t):r[n.toString()]=i.addPart([t],n)}))})),a.ncsOperatorList){const e="NCS",t=new yS(e),n=t.addPart();a.ncsOperatorList.forEach((function(e){const t=(new Sn).fromArray(e).transpose();n.matrixList.push(t)})),n.matrixList.length>0&&(s.biomolDict[e]=t)}const D=a.unitCell;D&&Array.isArray(D)&&D[0]?s.unitcell=new rP({a:D[0],b:D[1],c:D[2],alpha:D[3],beta:D[4],gamma:D[5],spacegroup:a.spaceGroup}):s.unitcell=void 0,LS(s,!0),IS(s,!0),s.finalizeAtoms(),s.finalizeBonds(),RS(s),e.Debug&&gm.timeEnd("MmtfParser._parse "+this.name)}}Cm.add("mmtf",JP);const eI=/\s+/,tI={1:1,2:2,3:3,am:1,ar:1,du:1,un:1,nc:0};class nI extends JE{get type(){return"mol2"}_parse(){e.Debug&&gm.time("Mol2Parser._parse "+this.name);const t=this.structure,n=this.structureBuilder,i=this.firstModelOnly,r=this.asTrajectory,o=t.frames;let s,a,l=!1;const c=t.atomMap,u=t.atomStore;u.resize(Math.round(this.streamer.data.length/60)),u.addField("partialCharge",1,"float32");let h=0,d=0,p=0,f=-1,m=0,g=0,y=1,v=2,b=3;const x=t.getAtomProxy(),w=t.getAtomProxy();function _(e,_,S){for(let M=e;M<_;++M){const e=S[M].trim();if(""!==e&&"#"!==e[0])if("@"===e[0])"@<TRIPOS>MOLECULE"===e?(g=y,d=0,++f):"@<TRIPOS>ATOM"===e?(g=v,p=u.count,r&&(a=0,s=new Float32Array(3*m),o.push(s),f>0&&(l=!0))):g="@<TRIPOS>BOND"===e?b:0;else if(g===y){if(0===d)t.title=e,t.id=e;else if(1===d){const t=e.split(eI);m=parseInt(t[0])}++d}else if(g===v){const t=e.split(eI);if(i&&f>0)continue;const o=parseFloat(t[2]),d=parseFloat(t[3]),p=parseFloat(t[4]);if(r){const e=3*a;if(s[e+0]=o,s[e+1]=d,s[e+2]=p,a+=1,l)continue}const m=t[0],g=t[1],y=t[5].split(".")[0],v=t[6]?parseInt(t[6]):1,b=t[7]?t[7]:"",x=t[8]?parseFloat(t[8]):0;u.growIfFull(),u.atomTypeId[h]=c.add(g,y),u.x[h]=o,u.y[h]=d,u.z[h]=p,u.serial[h]=m,u.partialCharge[h]=x,n.addAtom(f,"","",b,v,!0),h+=1}else if(g===b){if(i&&f>0)continue;if(r&&f>0)continue;const n=e.split(eI);x.index=parseInt(n[1])-1+p,w.index=parseInt(n[2])-1+p;const o=tI[n[3]];t.bondStore.addBond(x,w,o)}}}this.streamer.eachChunkOfLines((function(e){_(0,e.length,e)})),n.finalize(),t.finalizeAtoms(),MS(t),IS(t,!0),LS(t,!0),t.finalizeBonds(),NS(t),wS(t),e.Debug&&gm.timeEnd("Mol2Parser._parse "+this.name)}}Cm.add("mol2",nI);class iI extends uP{get type(){return"pdbqt"}}Cm.add("pdbqt",iI);class rI extends uP{get type(){return"pqr"}}Cm.add("pqr",rI);const oI=/> +<(.+)>/;class sI extends JE{get type(){return"sdf"}_parse(){e.Debug&&gm.time("SdfParser._parse "+this.name);const t=this.structure,n=this.structureBuilder,i=this.firstModelOnly,r=this.asTrajectory,o=this.streamer.peekLines(2);t.id=o[0].trim(),t.title=o[1].trim();const s=t.frames;let a,l,c=!1;const u=t.atomMap,h=t.atomStore;h.resize(Math.round(this.streamer.data.length/50)),h.addField("formalCharge",1,"int8");const d=t.getAtomProxy(),p=t.getAtomProxy();let f=0,m=0,g=0,y=0;const v=[];let b,x,w,_,S,M,A,C,T,E,P,I,L,R,k=!1,D={};t.extraData.sdf=v;let O=!1,N=!1,B=!1,F=[],z=[];const U=new Map;function H(e,o,H){for(let G=e;G<o;++G){const e=H[G];if(O&&e&&(F=e.substring(7).split(" "),z.length&&(F=[...z,...F],z=[]),"-"===F[F.length-1]))F.pop(),z=F;else{if("$$$$"===e.substr(0,4))m=-1,++g,y=h.count,v.push(D),D={},k=!1,O=!1;else if(3===m)O=e.indexOf(" V3000")>-1,O?U.clear():(x=parseInt(e.substr(0,3)),w=parseInt(e.substr(3,3)),_=4,S=_+x,M=S,A=M+w,r&&(l=0,a=new Float32Array(3*x),s.push(a),g>0&&(c=!0)));else if(O&&"COUNTS"===F[0])x=parseInt(F[1]),r&&(l=0,a=new Float32Array(3*x),s.push(a),g>0&&(c=!0));else if(O&&2==F.length)"ATOM"===F[1]?"BEGIN"===F[0]?N=!0:"END"===F[0]&&(N=!1):"BOND"===F[1]&&("BEGIN"===F[0]?B=!0:"END"===F[0]&&(B=!1));else if(N||!O&&m>=_&&m<S){if(i&&g>0)continue;let t=0;if(O){if(C=parseFloat(F[2]),T=parseFloat(F[3]),E=parseFloat(F[4]),I=F[1],L=parseInt(F[0]),U.set(L,f),P=I+L,F.length>6){let e=F.slice(6).find((e=>0===e.indexOf("CHG=")));e&&(t=parseInt(e.substring(4)))}}else C=parseFloat(e.substr(0,10)),T=parseFloat(e.substr(10,10)),E=parseFloat(e.substr(20,10)),I=e.substr(31,3).trim(),P=I+(f-y+1);if(r){const e=3*l;if(a[e+0]=C,a[e+1]=T,a[e+2]=E,l+=1,c)continue}h.growIfFull(),h.atomTypeId[f]=u.add(P,I),h.x[f]=C,h.y[f]=T,h.z[f]=E,h.serial[f]=O?L:f,h.formalCharge[f]=t,n.addAtom(g,"","","HET",1,!0),f+=1}else if(B||!O&&m>=M&&m<A){if(i&&g>0)continue;if(r&&g>0)continue;O?(d.index=U.get(parseInt(F[2])),p.index=U.get(parseInt(F[3])),R=parseInt(F[1])):(d.index=parseInt(e.substr(0,3))-1+y,p.index=parseInt(e.substr(3,3))-1+y,R=parseInt(e.substr(6,3))),t.bondStore.addBond(d,p,R)}else if("M  CHG"===e.substr(0,6)){const t=parseInt(e.substr(6,3));for(let n=0,i=10;n<t;++n,i+=8){const t=parseInt(e.substr(i,3))-1+y,n=parseInt(e.substr(i+4,3));h.formalCharge[t]=n}}else">"===e.charAt(0)&&(b=e.match(oI))?(k=b[1],D[k]=[]):!1!==k&&e&&D[k].push(e);++m}}}this.streamer.eachChunkOfLines((function(e){H(0,e.length,e)})),n.finalize(),t.finalizeAtoms(),t.finalizeBonds(),NS(t),e.Debug&&gm.timeEnd("SdfParser._parse "+this.name)}_postProcess(){NS(this.structure)}}Cm.add("sdf",sI),Cm.add("sd",sI),Cm.add("mol",sI);const aI=18.2223;function lI(e,t,n){return parseInt(e.substr(t,n).trim())}class cI extends JE{get type(){return"prmtop"}_parse(){e.Debug&&gm.time("PrmtopParser._parse "+this.name);const t=this.structure,n=this.structureBuilder,i=t.atomMap,r=t.atomStore;r.addField("partialCharge",1,"float32"),r.addField("radius",1,"float32");const o=[],s={},a=["NATOM","NTYPES","NBONH","MBONA","NTHETH","MTHETA","NPHIH","MPHIA","NHPARM","NPARM","NNB","NRES","NBONA","NTHETA","NPHIA","NUMBND","NUMANG","NPTRA","NATYP","NPHB","IFPERT","NBPER","NGPER","NDPER","MBPER","MGPER","MDPER","IFBOX","NMXRS","IFCAP","NUMEXTRA","NCOPY"];let l,c,u,h,d;a.forEach((e=>{s[e]=0}));let p,f,m,g,y,v=new Uint8Array(0);function b(e,t,n){for(let i=e;i<t;++i){const e=n[i],t=e.trim();if(t)if(e.startsWith("%FORMAT"));else if(e.startsWith("%FLAG")){const t=e.substr(5).trim();g=0,"TITLE"===t?m=0:"POINTERS"===t?m=1:"ATOM_NAME"===t?m=2:"CHARGE"===t?m=3:"MASS"===t?m=4:"RESIDUE_LABEL"===t?m=5:"RESIDUE_POINTER"===t?m=6:"BONDS_INC_HYDROGEN"===t?(y=0,m=7):"BONDS_WITHOUT_HYDROGEN"===t?(y=s.NBONH,m=8):m="RADII"===t?9:void 0}else if(0===m)o.push(t);else if(1===m){const t=Math.min(g+10,32);for(let i=0;g<t;++i,++g)s[a[g]]=parseInt(e.substr(8*i,8).trim());l=new Array(s.NATOM),c=new Float32Array(s.NATOM),u=new Float32Array(s.NATOM),r.resize(s.NATOM);const n=s.NBONH+s.MBONA;h=new Uint32Array(n),d=new Uint32Array(n),v=new Uint8Array(n),p=new Array(s.NRES),f=new Uint32Array(s.NRES)}else if(2===m){const t=Math.min(g+20,s.NATOM);for(let n=0;g<t;++n,++g)l[g]=e.substr(4*n,4).trim()}else if(3===m){const t=Math.min(g+5,s.NATOM);for(let n=0;g<t;++n,++g)c[g]=parseFloat(e.substr(16*n,16))/aI}else if(4===m);else if(5===m){const t=Math.min(g+20,s.NRES);for(let n=0;g<t;++n,++g)p[g]=e.substr(4*n,4).trim()}else if(6===m){const t=Math.min(g+10,s.NRES);for(let n=0;g<t;++n,++g)f[g]=lI(e,8*n,8)}else if(7===m){const t=Math.min(g+10,3*s.NBONH);for(let n=0;g<t;++n,++g){const t=g%3;0===t&&(h[y]=lI(e,8*n,8)/3),1===t&&(d[y]=lI(e,8*n,8)/3,v[y]=1,++y)}}else if(8===m){const t=Math.min(g+10,3*s.MBONA);for(let n=0;g<t;++n,++g){const t=g%3;0===t&&(h[y]=lI(e,8*n,8)/3),1===t&&(d[y]=lI(e,8*n,8)/3,v[y]=1,++y)}}else if(9===m){const t=Math.min(g+5,s.NATOM);for(let n=0;g<t;++n,++g)u[g]=parseFloat(e.substr(16*n,16))}}}this.streamer.eachChunkOfLines((function(e){b(0,e.length,e)})),t.title=o.join(" ");const x=s.NATOM;let w=0,_=p[0],S=1;for(let e=0;e<x;++e)e+1===f[w+1]&&(++w,_=p[w],S=w+1),r.atomTypeId[e]=i.add(l[e]),r.serial[e]=e+1,n.addAtom(0,"","",_,S,!1);r.partialCharge.set(c),r.radius.set(u),t.bondStore.length=v.length,t.bondStore.count=v.length,t.bondStore.atomIndex1=h,t.bondStore.atomIndex2=d,t.bondStore.bondOrder=v,n.finalize(),t.finalizeAtoms(),t.finalizeBonds(),IS(t,!0),LS(t,!0,!0),MS(t,!0),NS(t),e.Debug&&gm.timeEnd("PrmtopParser._parse "+this.name)}}Cm.add("prmtop",cI),Cm.add("parm7",cI);const uI=1,hI=2,dI=3,pI=4,fI=5,mI=6,gI=/\s+/,yI=/(^\*|REMARK)*/;class vI extends JE{get type(){return"psf"}_parse(){e.Debug&&gm.time("PsfParser._parse "+this.name);const t=this.structure,n=this.structureBuilder,i=t.atomMap,r=t.atomStore;r.addField("partialCharge",1,"float32");const o=[];let s,a,l,c,u,h,d=0,p=0,f=0;function m(e,t,m){for(let g=e;g<t;++g){const e=m[g].trim();if(e)if(s===hI){const t=e.split(gI),o=parseInt(t[0]),s=t[1],c=parseInt(t[2]),u=t[3],h=t[4],f=parseFloat(t[6]);s!==l&&(a=SS(p),++p),r.growIfFull(),r.atomTypeId[d]=i.add(h),r.serial[d]=o,r.partialCharge[d]=f,n.addAtom(0,a,a,u,c,!1),d+=1,l=s}else if(s===dI){const t=e.split(gI);for(let e=0,n=t.length;e<n;e+=2)c[f]=parseInt(t[e])-1,u[f]=parseInt(t[e+1])-1,h[f]=1,f+=1}else if(s===uI)o.push(e.replace(yI,"").trim());else if(s===pI);else if(s===fI);else if(s===mI);else if(e.includes("!NATOM")){s=hI;const t=parseInt(e.split(gI)[0]);r.resize(t)}else if(e.includes("!NBOND")){s=dI;const t=parseInt(e.split(gI)[0]);c=new Uint32Array(t),u=new Uint32Array(t),h=new Uint8Array(t)}else e.includes("!NTITLE")?s=uI:e.includes("!NTHETA")?s=pI:e.includes("!NPHI")?s=fI:e.includes("!NIMPHI")&&(s=mI);else s=void 0}}this.streamer.eachChunkOfLines((function(e){m(0,e.length,e)})),t.title=o.join(" "),t.bondStore.length=h.length,t.bondStore.count=f,t.bondStore.atomIndex1=c,t.bondStore.atomIndex2=u,t.bondStore.bondOrder=h,n.finalize(),t.finalizeAtoms(),t.finalizeBonds(),IS(t,!0),LS(t,!0,!0),NS(t),e.Debug&&gm.timeEnd("PsfParser._parse "+this.name)}}Cm.add("psf",vI);const bI=/\[ (.+) \]/,xI=/\s+/;class wI extends JE{get type(){return"top"}_parse(){e.Debug&&gm.time("TopParser._parse "+this.name);const t=this.structure,n=this.structureBuilder,i=t.atomMap,r=t.bondStore,o=t.atomStore;o.addField("partialCharge",1,"float32");const s=[],a={};let l,c;function u(e,n,i){for(let r=e;r<n;++r){const e=i[r];let n=e.trim();if(!n||"*"===n[0]||";"===n[0])continue;if(n.startsWith("#include"))throw new Error("TopParser: #include statements not allowed");const o=e.match(bI);if(null!==o){const e=o[1];"moleculetype"===e?(c=2,l={atoms:[],bonds:[]}):c="atoms"===e?3:"bonds"===e?4:"system"===e?0:"molecules"===e?1:void 0;continue}const u=n.indexOf(";");if(-1!==u&&(n=n.substring(0,u).trim()),2===c){const e=n.split(xI)[0];a[e]=l}else if(3===c){const e=n.split(xI);l.atoms.push([parseInt(e[2]),e[3],e[4],parseFloat(e[6])])}else if(4===c){const e=n.split(xI);l.bonds.push([parseInt(e[0]),parseInt(e[1])])}else if(0===c)t.title=n;else if(1===c){const e=n.split(xI);s.push([e[0],parseInt(e[1])])}}}this.streamer.eachChunkOfLines((function(e){u(0,e.length,e)}));let h=0,d=0;s.forEach((function(e){const[t,n]=e,i=a[t];h+=n*i.atoms.length,d+=n*i.bonds.length})),o.resize(h),r.resize(d);let p,f=0,m=0,g=0,y=0,v=0,b=0;s.forEach((function(e){const[t,s]=e,l=a[t],c=SS(y);for(let a=0;a<s;++a){p=-1;const e=zb.includes(t)?c:SS(g);l.atoms.forEach((function(t){const[r,s,a,l]=t;r!==p&&++m,o.atomTypeId[f]=i.add(a),o.serial[f]=f+1,o.partialCharge[f]=l,n.addAtom(0,c,e,s,m+1,!1),++f,p=r})),l.bonds.forEach((function(e){r.atomIndex1[v]=b+e[0]-1,r.atomIndex2[v]=b+e[1]-1,++v})),++g,b+=l.atoms.length}++y})),r.count=d,n.finalize(),t.finalizeAtoms(),t.finalizeBonds(),IS(t,!0),LS(t,!0,!0),NS(t),e.Debug&&gm.timeEnd("TopParser._parse "+this.name)}}Cm.add("top",wI);class _I extends QE{constructor(e,t){super(e,t),this.frames=new iA(this.name,this.path)}get type(){return"trajectory"}get __objName(){return"frames"}}const SI=20.45482949774598;class MI extends _I{get type(){return"dcd"}get isBinary(){return!0}_parse(){e.Debug&&gm.time("DcdParser._parse "+this.name);const t=Up(this.streamer.data),n=new DataView(t),i=this.frames,r=i.coordinates,o=i.boxes,s={};let a=0;const l=new Int32Array(t,0,23),c=l[0]!==n.getInt32(0);if(84!==l[0]){const e=t.byteLength;for(let t=0;t<e;t+=4)n.setFloat32(t,n.getFloat32(t),!0)}84!==l[0]&&gm.error("dcd bad format, header block start"),"CORD"!==String.fromCharCode(n.getUint8(4),n.getUint8(5),n.getUint8(6),n.getUint8(7))&&gm.error("dcd bad format, format string");let u=!1,h=!1,d=!1;0!==l[22]&&(u=!0,0!==l[12]&&(h=!0),1===l[13]&&(d=!0)),s.NSET=l[2],s.ISTART=l[3],s.NSAVC=l[4],s.NAMNF=l[10],s.DELTA=u?n.getFloat32(44,c):n.getFloat64(44,c),84!==l[22]&&gm.error("dcd bad format, header block end"),a=a+84+8;const p=n.getInt32(a,c),f=a+1;if((p-4)%80!==0&&gm.error("dcd bad format, title block start"),s.TITLE=Op(new Uint8Array(t,f,p)),n.getInt32(f+p+4-1,c)!==p&&gm.error("dcd bad format, title block end"),a=a+p+8,4!==n.getInt32(a,c)&&gm.error("dcd bad format, natom block start"),s.NATOM=n.getInt32(a+4,c),4!==n.getInt32(a+8,c)&&gm.error("dcd bad format, natom block end"),a=a+4+8,s.NAMNF>0)return void gm.error("dcd format with fixed atoms unsupported, aborting");const m=s.NATOM,g=4*m;for(let e=0,y=s.NSET;e<y;++e){if(h){a+=4;const e=new Float32Array(9);e[0]=n.getFloat64(a,c),e[4]=n.getFloat64(a+16,c),e[8]=n.getFloat64(a+40,c),o.push(e),a+=48,a+=4}const i=new Float32Array(3*m);for(let r=0;r<3;++r){n.getInt32(a,c)!==g&&gm.error("dcd bad format, coord block start",e,r),a+=4;const o=new Float32Array(t,a,m);for(let e=0;e<m;++e)i[3*e+r]=o[e];a+=g,n.getInt32(a,c)!==g&&gm.error("dcd bad format, coord block end",e,r),a+=4}r.push(i),d&&(a+=4+n.getInt32(a,c)+4)}s.DELTA&&(i.deltaTime=s.DELTA*SI),s.ISTART>=1&&(i.timeOffset=(s.ISTART-1)*i.deltaTime),e.Debug&&gm.timeEnd("DcdParser._parse "+this.name)}}function AI(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: "+t)}function CI(e){e.offset%4!==0&&e.skip(4-e.offset%4)}function TI(e){const t=e.readUint32(),n=e.readChars(t);return CI(e),n}Cm.add("dcd",MI);const EI={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function PI(e){switch(Number(e)){case EI.BYTE:return"byte";case EI.CHAR:return"char";case EI.SHORT:return"short";case EI.INT:return"int";case EI.FLOAT:return"float";case EI.DOUBLE:return"double";default:return"undefined"}}function II(e){switch(Number(e)){case EI.BYTE:case EI.CHAR:return 1;case EI.SHORT:return 2;case EI.INT:case EI.FLOAT:return 4;case EI.DOUBLE:return 8;default:return-1}}function LI(e){switch(String(e)){case"byte":return EI.BYTE;case"char":return EI.CHAR;case"short":return EI.SHORT;case"int":return EI.INT;case"float":return EI.FLOAT;case"double":return EI.DOUBLE;default:return-1}}function RI(e,t){if(1!==e){const n=new Array(e);for(let i=0;i<e;i++)n[i]=t();return n}return t()}function kI(e,t,n){switch(t){case EI.BYTE:return e.readBytes(n);case EI.CHAR:return DI(e.readChars(n));case EI.SHORT:return RI(n,e.readInt16.bind(e));case EI.INT:return RI(n,e.readInt32.bind(e));case EI.FLOAT:return RI(n,e.readFloat32.bind(e));case EI.DOUBLE:return RI(n,e.readFloat64.bind(e));default:return void AI(!0,"non valid type "+t)}}function DI(e){return 0===e.charCodeAt(e.length-1)?e.substring(0,e.length-1):e}function OI(e,t){const n=LI(t.type),i=t.size/II(n),r=new Array(i);for(let o=0;o<i;o++)r[o]=kI(e,n,1);return r}function NI(e,t,n){const i=LI(t.type),r=t.size?t.size/II(i):1,o=n.length,s=new Array(o),a=n.recordStep;for(let l=0;l<o;l++){const t=e.offset;s[l]=kI(e,i,r),e.seek(t+a)}return s}const BI=0,FI=10,zI=11,UI=12;function HI(e,t){const n={recordDimension:{length:e.readUint32()}};n.version=t;const i=GI(e);n.recordDimension.id=i.recordId,n.recordDimension.name=i.recordName,n.dimensions=i.dimensions,n.globalAttributes=VI(e);const r=jI(e,i.recordId,t);return n.variables=r.variables,n.recordDimension.recordStep=r.recordStep,n}function GI(e){let t,n,i;const r=e.readUint32();if(r===BI)return AI(e.readUint32()!==BI,"wrong empty tag for list of dimensions"),[];{AI(r!==FI,"wrong tag for list of dimensions");const o=e.readUint32();t=new Array(o);for(let r=0;r<o;r++){const o=TI(e),s=e.readUint32();0===s&&(n=r,i=o),t[r]={name:o,size:s}}return{dimensions:t,recordId:n,recordName:i}}}function VI(e){let t;const n=e.readUint32();if(n===BI)return AI(e.readUint32()!==BI,"wrong empty tag for list of attributes"),[];{AI(n!==UI,"wrong tag for list of attributes");const i=e.readUint32();t=new Array(i);for(let n=0;n<i;n++){const i=TI(e),r=e.readUint32();AI(r<1||r>6,"non valid type "+r);const o=e.readUint32(),s=kI(e,r,o);CI(e),t[n]={name:i,type:PI(r),value:s}}}return t}function jI(e,t,n){const i=e.readUint32();let r,o=0;if(i===BI)return AI(e.readUint32()!==BI,"wrong empty tag for list of variables"),[];{AI(i!==zI,"wrong tag for list of variables");const s=e.readUint32();r=new Array(s);for(let i=0;i<s;i++){const s=TI(e),a=e.readUint32(),l=new Array(a);for(let t=0;t<a;t++)l[t]=e.readUint32();const c=VI(e),u=e.readUint32();AI(u<1&&u>6,"non valid type "+u);const h=e.readUint32();let d=e.readUint32();2===n&&(AI(d>0,"offsets larger than 4GB not supported"),d=e.readUint32()),l[0]===t&&(o+=h),r[i]={name:s,dimensions:l,attributes:c,type:PI(u),size:h,offset:d,record:l[0]===t}}}return{variables:r,recordStep:o}}class $I{constructor(e){const t=new tg(e);t.setBigEndian(),AI("CDF"!==t.readChars(3),"should start with CDF");const n=t.readByte();AI(n>2,"unknown version"),this.header=HI(t,n),this.buffer=t}get version(){return 1===this.header.version?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(e){return-1!==this.header.variables.findIndex((function(t){return t.name===e}))}getDataVariable(e){let t;return t="string"===typeof e?this.header.variables.find((function(t){return t.name===e})):e,AI(void 0===t,"variable not found"),this.buffer.seek(t.offset),t.record?NI(this.buffer,t,this.header.recordDimension):OI(this.buffer,t)}}class WI extends _I{get type(){return"nctraj"}get isBinary(){return!0}_parse(){e.Debug&&gm.time("NctrajParser._parse "+this.name);const t=new $I(this.streamer.data),n=this.frames,i=n.coordinates,r=n.boxes,o=n.times;t.getDataVariable("coordinates").forEach((function(e){i.push(new Float32Array(e))})),t.hasDataVariable("cell_lengths")&&t.getDataVariable("cell_lengths").forEach((function(e){r.push(new Float32Array(e))})),t.hasDataVariable("time")&&t.getDataVariable("time").forEach((function(e){o.push(e)})),o.length>=1&&(n.timeOffset=o[0]),o.length>=2&&(n.deltaTime=o[1]-o[0]),e.Debug&&gm.timeEnd("NctrajParser._parse "+this.name)}}Cm.add("nctraj",WI),Cm.add("ncdf",WI),Cm.add("nc",WI);class qI extends _I{get type(){return"trr"}get isBinary(){return!0}_parse(){e.Debug&&gm.time("TrrParser._parse "+this.name);const t=Up(this.streamer.data),n=new DataView(t),i=this.frames,r=i.coordinates,o=i.boxes,s=i.times;let a=0;for(;;){a+=8;const e=n.getInt32(a);a+=4,a+=e;const i=n.getInt32(a+8),l=n.getInt32(a+12),c=n.getInt32(a+16),u=n.getInt32(a+28),h=n.getInt32(a+32),d=n.getInt32(a+36),p=n.getInt32(a+40);a+=52;const f=i/9,m=3*p;if(8===f?s.push(n.getFloat64(a)):s.push(n.getFloat32(a)),a+=2*f,i){const e=new Float32Array(9);if(8===f)for(let t=0;t<9;++t)e[t]=10*n.getFloat64(a),a+=8;else for(let t=0;t<9;++t)e[t]=10*n.getFloat32(a),a+=4;o.push(e)}if(a+=l,a+=c,u){let e;if(8===f){e=new Float32Array(m);for(let t=0;t<m;++t)e[t]=10*n.getFloat64(a),a+=8}else{const n=new Uint32Array(t,a,m);for(let e=0;e<m;++e){const t=n[e];n[e]=(255&t)<<24|(65280&t)<<8|t>>8&65280|t>>24&255}e=new Float32Array(t,a,m);for(let t=0;t<m;++t)e[t]*=10,a+=4}r.push(e)}if(a+=h,a+=d,a>=t.byteLength)break}s.length>=1&&(i.timeOffset=s[0]),s.length>=2&&(i.deltaTime=s[1]-s[0]),e.Debug&&gm.timeEnd("TrrParser._parse "+this.name)}}Cm.add("trr",qI);const XI=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),YI=9;function ZI(e){let t=1,n=0;for(;e>=t&&n<32;)n++,t<<=1;return n}const KI=new Uint8Array(32);function QI(e,t){let n=1,i=0;KI[0]=1;for(let o=0;o<e;o++){let e,i=0;for(e=0;e<n;e++)i+=KI[e]*t[o],KI[e]=255&i,i>>=8;for(;0!==i;)KI[e++]=255&i,i>>=8;n=e}let r=1;for(n--;KI[n]>=r;)i++,r*=2;return i+8*n}function JI(e,t,n,i){const r=(1<<n)-1;let o=i[1],s=i[2],a=e[0],l=0;for(;n>=8;)s=s<<8|t[a++],l|=s>>o<<n-8,n-=8;return n>0&&(o<n&&(o+=8,s=s<<8|t[a++]),o-=n,l|=s>>o&(1<<n)-1),l&=r,e[0]=a,e[1]=o,e[2]=s,l}const eL=new Int32Array(32);function tL(e,t,n,i,r,o,s){let a=0;for(eL[1]=0,eL[2]=0,eL[3]=0;i>8;)eL[a++]=JI(e,t,8,s),i-=8;i>0&&(eL[a++]=JI(e,t,i,s));for(let l=n-1;l>0;l--){let e=0;for(let t=a-1;t>=0;t--){e=e<<8|eL[t];const n=e/r[l]|0;eL[t]=n,e-=n*r[l]}o[l]=e}o[0]=eL[0]|eL[1]<<8|eL[2]<<16|eL[3]<<24}class nL extends _I{get type(){return"xtc"}get isBinary(){return!0}_parse(){e.Debug&&gm.time("XtcParser._parse "+this.name);const t=Up(this.streamer.data),n=new DataView(t),i=this.frames,r=i.coordinates,o=i.boxes,s=i.times,a=new Int32Array(6),l=new Int32Array(3),c=new Int32Array(3),u=new Uint32Array(3),h=new Float32Array(3),d=new Float32Array(3);let p=0;const f=new Int32Array(3),m=new Uint32Array(f.buffer);for(;;){let e;const i=n.getInt32(p+4);p+=12;const g=3*i;s.push(n.getFloat32(p)),p+=4;const y=new Float32Array(9);for(let t=0;t<9;++t)y[t]=10*n.getFloat32(p),p+=4;if(o.push(y),i<=9){e=new Float32Array(i);for(let t=0;t<i;++t)e[t]=n.getFloat32(p),p+=4}else{f[0]=f[1]=f[2]=0,l[0]=l[1]=l[2]=0,u[0]=u[1]=u[2]=0,c[0]=c[1]=c[2]=0,h[0]=h[1]=h[2]=0,d[0]=d[1]=d[2]=0,e=new Float32Array(g);let i=0;const r=n.getInt32(p);p+=4;const o=n.getFloat32(p);let s;p+=4,a[0]=n.getInt32(p),a[1]=n.getInt32(p+4),a[2]=n.getInt32(p+8),a[3]=n.getInt32(p+12),a[4]=n.getInt32(p+16),a[5]=n.getInt32(p+20),l[0]=a[3]-a[0]+1,l[1]=a[4]-a[1]+1,l[2]=a[5]-a[2]+1,p+=24,(l[0]|l[1]|l[2])>16777215?(c[0]=ZI(l[0]),c[1]=ZI(l[1]),c[2]=ZI(l[2]),s=0):s=QI(3,l);let y=n.getInt32(p);p+=4;let v=y-1;v=YI>v?YI:v;let b=XI[v]/2|0,x=XI[y]/2|0;u[0]=u[1]=u[2]=XI[y];let w=4*Math.ceil(n.getInt32(p)/4);p+=4;const _=1/o;let S=0,M=0;const A=new Uint8Array(t,p);for(h[0]=h[1]=h[2]=0;M<r;){0===s?(h[0]=JI(f,A,c[0],m),h[1]=JI(f,A,c[1],m),h[2]=JI(f,A,c[2],m)):tL(f,A,3,s,l,h,m),M++,h[0]+=a[0],h[1]+=a[1],h[2]+=a[2],d[0]=h[0],d[1]=h[1],d[2]=h[2];let t=0;if(1===JI(f,A,1,m)&&(S=JI(f,A,5,m),t=S%3,S-=t,t--),S>0){h[0]=h[1]=h[2]=0;for(let t=0;t<S;t+=3){if(tL(f,A,3,y,u,h,m),M++,h[0]+=d[0]-x,h[1]+=d[1]-x,h[2]+=d[2]-x,0===t){let t=h[0];h[0]=d[0],d[0]=t,t=h[1],h[1]=d[1],d[1]=t,t=h[2],h[2]=d[2],d[2]=t,e[i++]=d[0]*_,e[i++]=d[1]*_,e[i++]=d[2]*_}else d[0]=h[0],d[1]=h[1],d[2]=h[2];e[i++]=h[0]*_,e[i++]=h[1]*_,e[i++]=h[2]*_}}else e[i++]=h[0]*_,e[i++]=h[1]*_,e[i++]=h[2]*_;if(y+=t,t<0?(x=b,b=y>YI?XI[y-1]/2|0:0):t>0&&(b=x,x=XI[y]/2|0),u[0]=u[1]=u[2]=XI[y],0===u[0]||0===u[1]||0===u[2])return void console.error("(xdrfile error) Undefined error.")}p+=w}for(let t=0;t<g;t++)e[t]*=10;if(r.push(e),p>=t.byteLength)break}s.length>=1&&(i.timeOffset=s[0]),s.length>=2&&(i.deltaTime=s[1]-s[0]),e.Debug&&gm.timeEnd("XtcParser._parse "+this.name)}}Cm.add("xtc",nL);class iL extends QE{constructor(e,t){const n=t||{};super(e,n),this.volume=new f_(this.name,this.path),this.voxelSize=bp(n.voxelSize,1)}get type(){return"volume"}get __objName(){return"volume"}_afterParse(){this.volume.setMatrix(this.getMatrix()),super._afterParse()}getMatrix(){return new Sn}}const rL=/\s+/,oL=/-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,sL=.529177210859;class aL extends iL{get type(){return"cube"}_parse(){e.Debug&&gm.time("CubeParser._parse "+this.name);const t=this.volume,n=this.streamer.peekLines(6),i={},r=sL*this.voxelSize;function o(e,t){var i=n[e].trim().split(rL)[t];return parseFloat(i)}i.atomCount=Math.abs(o(2,0)),i.originX=o(2,1)*sL,i.originY=o(2,2)*sL,i.originZ=o(2,3)*sL,i.NVX=o(3,0),i.NVY=o(4,0),i.NVZ=o(5,0),i.basisX=new mn(o(3,1),o(3,2),o(3,3)).multiplyScalar(r),i.basisY=new mn(o(4,1),o(4,2),o(4,3)).multiplyScalar(r),i.basisZ=new mn(o(5,1),o(5,2),o(5,3)).multiplyScalar(r);const s=new Float32Array(i.NVX*i.NVY*i.NVZ);let a=0,l=0;const c=o(2,0)>0?0:1;function u(e,t,n){for(let r=e;r<t;++r){const e=n[r].trim();if(""!==e&&l>=i.atomCount+6+c){const t=e.match(oL);for(let e=0,n=t.length;e<n;++e)s[a]=parseFloat(t[e]),++a}++l}}this.streamer.eachChunkOfLines((function(e){u(0,e.length,e)})),t.header=i,t.setData(s,i.NVZ,i.NVY,i.NVX),e.Debug&&gm.timeEnd("CubeParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=new Sn;return t.multiply((new Sn).makeTranslation(e.originX,e.originY,e.originZ)),t.multiply((new Sn).makeBasis(e.basisZ,e.basisY,e.basisX)),t}}Cm.add("cub",aL),Cm.add("cube",aL);class lL extends iL{get type(){return"dsn6"}get isBinary(){return!0}_parse(){e.Debug&&gm.time("Dsn6Parser._parse "+this.name);const t=this.volume,n={};let i,r;const o=Up(this.streamer.data),s=new Int16Array(o),a=new Uint8Array(o),l=String.fromCharCode.apply(null,a.subarray(0,512));if(l.startsWith(":-)"))n.xStart=parseInt(l.substr(10,5)),n.yStart=parseInt(l.substr(15,5)),n.zStart=parseInt(l.substr(20,5)),n.xExtent=parseInt(l.substr(32,5)),n.yExtent=parseInt(l.substr(38,5)),n.zExtent=parseInt(l.substr(42,5)),n.xRate=parseInt(l.substr(52,5)),n.yRate=parseInt(l.substr(58,5)),n.zRate=parseInt(l.substr(62,5)),n.xlen=parseFloat(l.substr(73,10))*this.voxelSize,n.ylen=parseFloat(l.substr(83,10))*this.voxelSize,n.zlen=parseFloat(l.substr(93,10))*this.voxelSize,n.alpha=parseFloat(l.substr(103,10)),n.beta=parseFloat(l.substr(113,10)),n.gamma=parseFloat(l.substr(123,10)),i=parseFloat(l.substr(138,12))/100,r=parseInt(l.substr(155,8)),n.sigma=100*parseFloat(l.substr(170,12));else{if(100!==s[18])for(let n=0,i=s.length;n<i;++n){const e=s[n];s[n]=(255&e)<<8|e>>8&255}n.xStart=s[0],n.yStart=s[1],n.zStart=s[2],n.xExtent=s[3],n.yExtent=s[4],n.zExtent=s[5],n.xRate=s[6],n.yRate=s[7],n.zRate=s[8];const e=1/s[17],t=e*this.voxelSize;n.xlen=s[9]*t,n.ylen=s[10]*t,n.zlen=s[11]*t,n.alpha=s[12]*e,n.beta=s[13]*e,n.gamma=s[14]*e,i=s[15]/100,r=s[16],n.gamma=s[14]*e}t.header=n,e.Debug&&gm.log(n,i,r);const c=new Float32Array(n.xExtent*n.yExtent*n.zExtent);let u=512;const h=Math.ceil(n.xExtent/8),d=Math.ceil(n.yExtent/8),p=Math.ceil(n.zExtent/8);for(var f=0;f<p;++f)for(var m=0;m<d;++m)for(var g=0;g<h;++g)for(var y=0;y<8;++y)for(var v=8*f+y,b=0;b<8;++b)for(var x=8*m+b,w=0;w<8;++w){var _=8*g+w;if(!(_<n.xExtent&&x<n.yExtent&&v<n.zExtent)){u+=8-w;break}c[(_*n.yExtent+x)*n.zExtent+v]=(a[u]-r)/i,++u}t.setData(c,n.zExtent,n.yExtent,n.xExtent),n.sigma&&t.setStats(void 0,void 0,void 0,n.sigma),e.Debug&&gm.timeEnd("Dsn6Parser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],n=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],i=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const r=[[],t,n,i],o=[0,e.xRate,e.yRate,e.zRate],s=[0,1,2,3],a=new Sn;return a.set(r[s[1]][0]/o[s[1]],r[s[2]][0]/o[s[2]],r[s[3]][0]/o[s[3]],0,r[s[1]][1]/o[s[1]],r[s[2]][1]/o[s[2]],r[s[3]][1]/o[s[3]],0,r[s[1]][2]/o[s[1]],r[s[2]][2]/o[s[2]],r[s[3]][2]/o[s[3]],0,0,0,0,1),a.multiply((new Sn).makeRotationY(Qp(90))),a.multiply((new Sn).makeTranslation(-e.zStart,e.yStart,e.xStart)),a.multiply((new Sn).makeScale(-1,1,1)),a}}Cm.add("dsn6",lL),Cm.add("brix",lL);const cL=/\s+/;class uL extends iL{get type(){return"dx"}_parse(){e.Debug&&gm.time("DxParser._parse "+this.name);const t=this.volume,n=this.streamer.peekLines(30),i=this.parseHeaderLines(n),r=this.volume.header,o=i.dataLineStart,s=r.nx*r.ny*r.nz,a=new Float32Array(s);let l=0,c=0;function u(e,t,n){for(let i=e;i<t;++i){if(l<s&&c>o){const e=n[i].trim();if(""!==e){const t=e.split(cL);for(let e=0,n=t.length;e<n;++e)a[l]=parseFloat(t[e]),++l}}++c}}this.streamer.eachChunkOfLines((function(e){u(0,e.length,e)})),t.setData(a,r.nz,r.ny,r.nx),e.Debug&&gm.timeEnd("DxParser._parse "+this.name)}parseHeaderLines(e){const t={},n=e.length;let i=0,r=0,o=0;for(let s=0;s<n;++s){let n;const a=e[s];if(a.startsWith("object 1"))n=a.split(cL),t.nx=parseInt(n[5]),t.ny=parseInt(n[6]),t.nz=parseInt(n[7]);else if(a.startsWith("origin"))n=a.split(cL),t.xmin=parseFloat(n[1]),t.ymin=parseFloat(n[2]),t.zmin=parseFloat(n[3]);else if(a.startsWith("delta"))n=a.split(cL),0===o?t.hx=parseFloat(n[1])*this.voxelSize:1===o?t.hy=parseFloat(n[2])*this.voxelSize:2===o&&(t.hz=parseFloat(n[3])*this.voxelSize),o+=1;else if(a.startsWith("object 3")){i=s,r+=a.length+1;break}r+=a.length+1}return this.volume.header=t,{dataLineStart:i,headerByteCount:r}}getMatrix(){const e=this.volume.header,t=new Sn;return t.multiply((new Sn).makeRotationY(Qp(90))),t.multiply((new Sn).makeTranslation(-e.zmin,e.ymin,e.xmin)),t.multiply((new Sn).makeScale(-e.hz,e.hy,e.hx)),t}}Cm.add("dx",uL);class hL extends uL{get type(){return"dxbin"}get isBinary(){return!0}_parse(){e.Debug&&gm.time("DxbinParser._parse "+this.name);const t=Up(this.streamer.data),n=Np(new Uint8Array(t,0,1e3)),i=this.parseHeaderLines(n),r=this.volume.header,o=i.headerByteCount,s=r.nx*r.ny*r.nz,a=new DataView(t),l=new Float32Array(s);for(let e=0;e<s;++e)l[e]=a.getFloat64(8*e+o,!0);this.volume.setData(l,r.nz,r.ny,r.nx),e.Debug&&gm.timeEnd("DxbinParser._parse "+this.name)}}Cm.add("dxbin",hL);class dL extends iL{get type(){return"mrc"}get isBinary(){return!0}_parse(){e.Debug&&gm.time("MrcParser._parse "+this.name);const t=this.volume,n={},i=Up(this.streamer.data),r=new Int32Array(i,0,56),o=new Float32Array(i,0,56),s=new DataView(i);if(n.MAP=String.fromCharCode(s.getUint8(208),s.getUint8(209),s.getUint8(210),s.getUint8(211)),n.MACHST=[s.getUint8(212),s.getUint8(213)],17===n.MACHST[0]&&17===n.MACHST[1]){const e=i.byteLength;for(let t=0;t<e;t+=4)s.setFloat32(t,s.getFloat32(t),!0)}let a;if(n.NX=r[0],n.NY=r[1],n.NZ=r[2],n.MODE=r[3],n.NXSTART=r[4],n.NYSTART=r[5],n.NZSTART=r[6],n.MX=r[7],n.MY=r[8],n.MZ=r[9],n.xlen=o[10]*this.voxelSize,n.ylen=o[11]*this.voxelSize,n.zlen=o[12]*this.voxelSize,n.alpha=o[13],n.beta=o[14],n.gamma=o[15],n.MAPC=r[16],n.MAPR=r[17],n.MAPS=r[18],n.DMIN=o[19],n.DMAX=o[20],n.DMEAN=o[21],n.ISPG=r[22],n.NSYMBT=r[23],n.LSKFLG=r[24],n.originX=o[49],n.originY=o[50],n.originZ=o[51],n.ARMS=o[54],t.header=n,2===n.MODE)a=new Float32Array(i,1024+n.NSYMBT,n.NX*n.NY*n.NZ);else if(0===n.MODE){if(a=new Float32Array(new Int8Array(i,1024+n.NSYMBT,n.NX*n.NY*n.NZ)),-128===r[39]&&127===r[40]){const e=(n.DMAX-n.DMIN)/255,t=.5*(n.DMIN+n.DMAX+e);for(let n=0,i=a.length;n<i;++n)a[n]=e*a[n]+t}}else gm.error("MrcParser unknown mode",n.MODE);t.setData(a,n.NX,n.NY,n.NZ),0!==n.ARMS&&t.setStats(n.DMIN,n.DMAX,n.DMEAN,n.ARMS),e.Debug&&gm.timeEnd("MrcParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],n=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],i=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const r=[[],t,n,i],o=[0,e.MX,e.MY,e.MZ],s=[0,e.MAPC,e.MAPR,e.MAPS],a=new Sn;return a.set(r[s[1]][0]/o[s[1]],r[s[2]][0]/o[s[2]],r[s[3]][0]/o[s[3]],0,r[s[1]][1]/o[s[1]],r[s[2]][1]/o[s[2]],r[s[3]][1]/o[s[3]],0,r[s[1]][2]/o[s[1]],r[s[2]][2]/o[s[2]],r[s[3]][2]/o[s[3]],0,0,0,0,1),a.setPosition(new mn(e.originX,e.originY,e.originZ)),a.multiply((new Sn).makeTranslation(e.NXSTART,e.NYSTART,e.NZSTART)),a}}Cm.add("mrc",dL),Cm.add("ccp4",dL),Cm.add("map",dL);const pL=/\s+/;function fL(e){return e.trim().split(pL).map(parseFloat)}class mL extends iL{get type(){return"xplor"}_parse(){e.Debug&&gm.time("XplorParser._parse "+this.name);const t=this.volume,n=this.streamer.peekLines(8),i={};let r;r=n[2].startsWith("REMARKS")?parseInt(n[1].substring(0,8))+2:5;const o=r+3,s=fL(n[r]);i.NA=s[0],i.AMIN=s[1],i.AMAX=s[2],i.NB=s[3],i.BMIN=s[4],i.BMAX=s[5],i.NC=s[6],i.CMIN=s[7],i.CMAX=s[8];const a=fL(n[r+1]);i.a=a[0]*this.voxelSize,i.b=a[1]*this.voxelSize,i.c=a[2]*this.voxelSize,i.alpha=a[3],i.beta=a[4],i.gamma=a[5];const l=i.AMAX-i.AMIN+1,c=i.BMAX-i.BMIN+1,u=i.CMAX-i.CMIN+1,h=l*c*u,d=new Float32Array(h),p=Math.ceil(1+l*c/6);let f=0,m=0;function g(e,t,n){for(let r=e;r<t;++r){const e=n[r];if(m>=o&&(m-o)%p!==0&&f<h)for(let t=0,n=6;t<n;++t){const n=parseFloat(e.substr(12*t,12));if(isNaN(n))break;d[f++]=n}else if(f===h){const t=e.trim();if(t&&"-9999"!==t){const t=fL(e);i.RAVE=t[0],i.RSIGMA=t[1]}}++m}}this.streamer.eachChunkOfLines((function(e){g(0,e.length,e)})),t.header=i,t.setData(d,l,c,u),0!==i.RAVE&&1!==i.RSIGMA&&t.setStats(void 0,void 0,i.RAVE,i.RSIGMA),e.Debug&&gm.timeEnd("XplorParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.a,0,0],n=[e.b*Math.cos(Math.PI/180*e.gamma),e.b*Math.sin(Math.PI/180*e.gamma),0],i=[e.c*Math.cos(Math.PI/180*e.beta),e.c*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.c*e.c*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const r=[[],t,n,i],o=[0,e.NA,e.NB,e.NC],s=[0,1,2,3],a=new Sn;return a.set(r[s[1]][0]/o[s[1]],r[s[2]][0]/o[s[2]],r[s[3]][0]/o[s[3]],0,r[s[1]][1]/o[s[1]],r[s[2]][1]/o[s[2]],r[s[3]][1]/o[s[3]],0,r[s[1]][2]/o[s[1]],r[s[2]][2]/o[s[2]],r[s[3]][2]/o[s[3]],0,0,0,0,1),a.multiply((new Sn).makeTranslation(e.AMIN,e.BMIN,e.CMIN)),a}}function gL(e,t,n){let i,r,o;e/=360,t/=100,n/=100;const s=Math.floor(6*e),a=6*e-s,l=n*(1-t),c=n*(1-a*t),u=n*(1-(1-a)*t);switch(s%6){case 0:i=n,r=u,o=l;break;case 1:i=c,r=n,o=l;break;case 2:i=l,r=n,o=u;break;case 3:i=l,r=c,o=n;break;case 4:i=u,r=l,o=n;break;case 5:i=n,r=l,o=c}return[i,r,o]}Cm.add("xplor",mL),Cm.add("cns",mL);const yL={red:gL(0,100,100),orange:gL(20,100,100),gold:gL(40,100,100),yellow:gL(60,100,100),lime:gL(80,100,100),green:gL(120,80,100),sea:gL(150,100,100),cyan:gL(180,100,85),sky:gL(210,75,95),blue:gL(240,70,100),purple:gL(275,75,100),magenta:gL(300,95,100),hotpink:gL(335,100,100),pink:gL(350,55,100),peach:gL(25,75,100),lilac:gL(275,55,100),pinktint:gL(340,30,100),peachtint:gL(25,50,100),yellowtint:gL(60,50,100),greentint:gL(135,40,100),bluetint:gL(220,40,100),lilactint:gL(275,35,100),white:gL(0,0,100),gray:gL(0,0,50),brown:gL(20,45,75),deadwhite:[1,1,1],deadblack:[0,0,0],invisible:[0,0,0]},vL=/[\s,]+/,bL=/[^{}\s]*{[^{}]+}|[^{}\s]+/g,xL=/^{+|}+$/g,wL=/^['"]+|['"]+$/g,_L=/\s*=\s*/g;function SL(e){let t,n,i,r=[];const o=(e=e.replace(_L,"=")).match(bL);for(let s=1;s<o.length;++s){const e=o[s];if("{"===e[0])t=e.substring(1,e.length-1);else{const t=e.split("=");2===t.length&&("color"===t[0]?n=yL[t[1]]:"width"===t[0]?i=parseInt(t[1]):"master"===t[0]&&r.push(t[1].replace(xL,"")))}}return{listName:t,listColor:n,listMasters:r,listWidth:i}}function ML(e){const t=(e=e.trim()).indexOf("{"),n=e.indexOf("}"),i=e.substr(n+1).split(vL),r=e.substr(t+1,n-1),o=[parseFloat(i[i.length-3]),parseFloat(i[i.length-2]),parseFloat(i[i.length-1])];let s,a,l,c=!1,u=!1;for(let h=4;h<=i.length;h++){const e=i[i.length-h];e in yL&&(s=yL[i[i.length-h]]),e.startsWith("width")&&(a=parseInt(e.substring(5))),e.startsWith("r=")&&(l=parseFloat(e.split("=")[1])),e.startsWith("P")&&(c=!0),e.startsWith("X")&&(u=!0)}return{label:r,position:o,color:s,radius:l,width:a,isLineBreak:c,isTriangleBreak:u}}function AL(e){const t=e.indexOf("{"),n=e.indexOf("}");return e.substring(-1!==t?t+1:0,-1!==n?n:void 0).trim()}function CL(e){const t=e.indexOf("}");return-1===t?void 0:e.substr(t+1).trim()}function TL(e){let t="",n=[],i={};const r=(e=e.replace(_L,"=")).match(bL);for(let o=1;o<r.length;++o){const e=r[o];if("{"===e[0])t=e.substring(1,e.length-1);else{const t=e.split("=");2===t.length?"master"===t[0]?n.push(t[1].replace(xL,"")):i[t[0]]=t[1].replace(xL,""):i[t[0]]=!0}}return{groupName:t,groupFlags:i,groupMasters:n}}function EL(e){let{labelArray:t,positionArray:n,colorArray:i,breakArray:r}=e,o=[];for(let u=0;u<3*(t.length-2);++u)o[u]=t[u-2*Math.floor(u/3)];let s=[];for(let u=0;u<3*(r.length-2);++u)s[u]=r[u-2*Math.floor(u/3)];let a=[];for(let u=0;u<9*(n.length/3-2);++u)a[u]=n[u-6*Math.floor(u/9)];let l=[];for(let u=0;u<9*(i.length/3-2);++u)l[u]=i[u-6*Math.floor(u/9)];let c=[];for(let u=0;u<a.length/3;++u)c.push(new mn(a[3*u],a[3*u]+1,a[3*u]+2));return{name:e.name,masterArray:e.masterArray,labelArray:o,positionArray:a,breakArray:s,colorArray:l}}function PL(e){let{labelArray:t,positionArray:n,colorArray:i,breakArray:r}=e,o=[],s=[],a=[],l=[];for(let c=0;c<r.length/3;c++){let e=3*c,u=9*c;r[e+1]||r[e+2]||(o.push(t[e]),o.push(t[e+1]),o.push(t[e+2]),l.push(r[e]),l.push(r[e+1]),l.push(r[e+2]),s.push(n[u]),s.push(n[u+1]),s.push(n[u+2]),s.push(n[u+3]),s.push(n[u+4]),s.push(n[u+5]),s.push(n[u+6]),s.push(n[u+7]),s.push(n[u+8]),a.push(i[u]),a.push(i[u+1]),a.push(i[u+2]),a.push(i[u+3]),a.push(i[u+4]),a.push(i[u+5]),a.push(i[u+6]),a.push(i[u+7]),a.push(i[u+8]))}return{name:e.name,masterArray:e.masterArray,labelArray:o,positionArray:s,breakArray:l,colorArray:a}}class IL extends QE{get type(){return"kin"}get __objName(){return"kinemage"}_parse(){e.Debug&&gm.time("KinParser._parse ".concat(this.name));const t={kinemage:void 0,onewidth:void 0,"1viewid":void 0,pdbfile:void 0,texts:[],text:"",captions:[],caption:"",groupDict:{},subgroupDict:{},masterDict:{},pointmasterDict:{},dotLists:[],vectorLists:[],ballLists:[],ribbonLists:[]};let n,i;this.kinemage=t;let r,o,s,a,l,c,u,h,d,p,f,m,g,y,v,b,x,w,_,S,M,A,C=!1,T="",E=!1,P="",I=null,L=null,R=!1,k="",D=!1,O="",N=!1,B=!1;function F(e,F,z){for(let H=e;H<F;++H){const e=z[H];if("@"===e[0]&&(C=!1,E=!1,R=!1,D=!1,N=!1,B=!1),e)if(e.startsWith("@dotlist")){let{listColor:l,listName:c,listMasters:u}=SL(e);C=!0,T="",o=[],s=[],a=[],r=l,n&&(u=u.concat(n)),i&&(u=u.concat(i)),t.dotLists.push({name:c,masterArray:u,labelArray:o,positionArray:s,colorArray:a})}else if(e.startsWith("@vectorlist")){let{listMasters:r,listName:o,listWidth:s,listColor:a}=SL(e);r&&r.forEach((function(e){t.masterDict[e]||(t.masterDict[e]={indent:!1,visible:!1})})),E=!0,P="",I=null,L=null,u=[],h=[],d=[],p=[],f=[],m=[],l=a,c=[],s&&c.push(s),n&&(r=r.concat(n)),i&&(r=r.concat(i)),t.vectorLists.push({name:o,masterArray:r,label1Array:u,label2Array:h,position1Array:d,position2Array:p,color1Array:f,color2Array:m,width:c})}else if(e.startsWith("@balllist")){let{listName:r,listColor:o,listMasters:s}=SL(e);s&&s.forEach((function(e){t.masterDict[e]||(t.masterDict[e]={indent:!1,visible:!1})})),R=!0,k="",v=[],g=[],b=[],x=[],y=o,n&&(s=s.concat(n)),i&&(s=s.concat(i)),t.ballLists.push({name:r,masterArray:s,labelArray:v,radiusArray:g,positionArray:b,colorArray:x})}else if(e.startsWith("@ribbonlist")||e.startsWith("@trianglelist")){let{listMasters:r,listName:o,listColor:s}=SL(e);r&&r.forEach((function(e){t.masterDict[e]||(t.masterDict[e]={indent:!1,visible:!1})})),D=!0,O="",_=[],S=[],M=[],A=[],w=s,n&&(r=r.concat(n)),i&&(r=r.concat(i)),t.ribbonLists.push({name:o,masterArray:r,labelArray:_,positionArray:S,breakArray:M,colorArray:A})}else if(e.startsWith("@text"))N=!0,t.texts.push(e.substr(5));else if(e.startsWith("@caption"))B=!0,t.captions.push(e.substr(8));else if(C){let{label:t,color:n,position:i}=ML(e);'"'===t?t=T:T=t,void 0===n&&(n=r),o.push(t),s.push(...i),a.push(...n)}else if(E){let t=e.replace(/(?!^){/g,"\n{").split(/\n/);for(var U=0;U<t.length;U++){let e=t[U],{label:n,color:i,width:r,position:o,isLineBreak:s}=ML(e);'"'===n?n=P:P=n,void 0===i&&(i=l),s||null!==I&&(r&&c.push(r),u.push(P),d.push(...I),f.push(...L),h.push(n),p.push(...o),m.push(...i)),P=n,I=o,L=i}}else if(R){let{label:t,radius:n,color:i,position:r}=ML(e);'"'===t?t=k:k=t,void 0===n&&(n=1),void 0===i&&(i=y),v.push(t),g.push(n),b.push(...r),x.push(...i)}else if(D){let{label:t,color:n,position:i,isTriangleBreak:r}=ML(e);'"'===t?t=O:O=t,void 0===n&&(n=w),_.push(t),S.push(...i),M.push(r),A.push(...n)}else if(N)t.texts.push(e);else if(B)t.captions.push(e);else if(e.startsWith("@kinemage"))t.kinemage=parseInt(e.substr(9).trim());else if(e.startsWith("@onewidth"))t.onewidth=!0;else if(e.startsWith("@1viewid"))t["1viewid"]=AL(e);else if(e.startsWith("@pdbfile"))t.pdbfile=AL(e);else if(e.startsWith("@group")){let{groupName:i,groupFlags:r,groupMasters:o}=TL(e);t.groupDict[i]||(t.groupDict[i]={dominant:!1,animate:!1},n=o),n&&n.forEach((function(e){t.masterDict[e]||(t.masterDict[e]={indent:!1,visible:!1})}));for(let e in r)t.groupDict[i][e]=r[e]}else if(e.startsWith("@subgroup")){const{groupName:n,groupFlags:r,groupMasters:o}=TL(e);t.subgroupDict[n]||(t.subgroupDict[n]={dominant:!1,animate:!1},i=o),i&&i.forEach((function(e){t.masterDict[e]||(t.masterDict[e]={indent:!1,visible:!1})}));for(let e in r)t.subgroupDict[n][e]=r[e]}else if(e.startsWith("@master")){const n=AL(e),i=CL(e);t.masterDict[n]||(t.masterDict[n]={indent:!1,visible:!1}),"on"===i?t.masterDict[n].visible=!0:"off"===i?t.masterDict[n].visible=!1:"indent"===i&&(t.masterDict[n].indent=!0)}else if(e.startsWith("@pointmaster")){const{groupName:n,groupFlags:i}=TL(e);t.pointmasterDict[n]={id:Object.keys(i)[0].replace(wL,"")}}else console.log(e);else C=!1,E=!1,R=!1,D=!1}}if(this.streamer.eachChunkOfLines((function(e){F(0,e.length,e)})),t.text=t.texts.join("\n").trim(),t.caption=t.captions.join("\n").trim(),t.ribbonLists){let e=[];t.ribbonLists.forEach((function(t){e.push(PL(EL(t)))})),t.ribbonLists=e}e.Debug&&gm.timeEnd("KinParser._parse ".concat(this.name))}}Cm.add("kin",IL);class LL extends QE{constructor(e,t){super(e,t),this.loader=this.getLoader(),this.surface=new d_(this.name,this.path)}get type(){return"surface"}get __objName(){return"surface"}_parse(){var e=this.loader.parse(this.streamer.asText());this.surface.fromGeometry(e)}}const RL=function(){this.regexp={vertex_pattern:/^v\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,normal_pattern:/^vn\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,uv_pattern:/^vt\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};RL.prototype={constructor:RL,setPath:function(e){this.path=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);this.object={name:e||"",geometry:{vertices:[],normals:[]},fromDeclaration:!1!==t},this.objects.push(this.object)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},addVertex:function(e,t,n){var i=this.vertices,r=this.object.geometry.vertices;r.push(i[e+0]),r.push(i[e+1]),r.push(i[e+2]),r.push(i[t+0]),r.push(i[t+1]),r.push(i[t+2]),r.push(i[n+0]),r.push(i[n+1]),r.push(i[n+2])},addVertexLine:function(e){var t=this.vertices,n=this.object.geometry.vertices;n.push(t[e+0]),n.push(t[e+1]),n.push(t[e+2])},addNormal:function(e,t,n){var i=this.normals,r=this.object.geometry.normals;r.push(i[e+0]),r.push(i[e+1]),r.push(i[e+2]),r.push(i[t+0]),r.push(i[t+1]),r.push(i[t+2]),r.push(i[n+0]),r.push(i[n+1]),r.push(i[n+2])},addFace:function(e,t,n,i,r,o,s,a){var l,c=this.vertices.length,u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),d=this.parseVertexIndex(n,c);if(void 0===i?this.addVertex(u,h,d):(l=this.parseVertexIndex(i,c),this.addVertex(u,h,l),this.addVertex(h,d,l)),void 0!==r){var p=this.normals.length;u=this.parseNormalIndex(r,p),h=r===o?u:this.parseNormalIndex(o,p),d=r===s?u:this.parseNormalIndex(s,p),void 0===i?this.addNormal(u,h,d):(l=this.parseNormalIndex(a,p),this.addNormal(u,h,l),this.addNormal(h,d,l))}},addLineGeometry:function(e){this.object.geometry.type="Line";for(var t=this.vertices.length,n=0,i=e.length;n<i;n++)this.addVertexLine(this.parseVertexIndex(e[n],t))}};return e.startObject("",!1),e},parse:function(e){var t,n,i=this._createParserState();-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));var r=e.split("\n"),o="",s="",a="",l=[],c="function"===typeof"".trimLeft;for(t=0,n=r.length;t<n;t++)if(o=r[t],0!==(o=c?o.trimLeft():o.trim()).length&&"#"!==(s=o.charAt(0)))if("v"===s){if(" "===(a=o.charAt(1))&&null!==(l=this.regexp.vertex_pattern.exec(o)))i.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if("n"===a&&null!==(l=this.regexp.normal_pattern.exec(o)))i.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if("t"!==a||null===this.regexp.uv_pattern.exec(o))throw new Error("Unexpected vertex/normal/uv line: '"+o+"'")}else if("f"===s)if(null!==(l=this.regexp.face_vertex_uv_normal.exec(o)))i.addFace(l[1],l[4],l[7],l[10],l[3],l[6],l[9],l[12]);else if(null!==this.regexp.face_vertex_uv.exec(o));else if(null!==(l=this.regexp.face_vertex_normal.exec(o)))i.addFace(l[1],l[3],l[5],l[7],l[2],l[4],l[6],l[8]);else{if(null===(l=this.regexp.face_vertex.exec(o)))throw new Error("Unexpected face line: '"+o+"'");i.addFace(l[1],l[2],l[3],l[4])}else if("l"===s){var u=o.substring(1).trim().split(" "),h=[],d=[];if(-1===o.indexOf("/"))h=u;else for(var p=0,f=u.length;p<f;p++){var m=u[p].split("/");""!==m[0]&&h.push(m[0]),""!==m[1]&&d.push(m[1])}i.addLineGeometry(h,d)}else if(null!==(l=this.regexp.object_pattern.exec(o))){var g=l[0].substr(1).trim();i.startObject(g)}else if(this.regexp.material_use_pattern.test(o));else if(this.regexp.material_library_pattern.test(o));else if(null===this.regexp.smoothing_pattern.exec(o)){if("\0"===o)continue;throw new Error("Unexpected line: '"+o+"'")}var y=[];for(t=0,n=i.objects.length;t<n;t++){var v=i.objects[t].geometry;if(0!==v.vertices.length){var b=new ar;b.setAttribute("position",new Gi(new Float32Array(v.vertices),3)),v.normals.length>0?b.setAttribute("normal",new Gi(new Float32Array(v.normals),3)):b.computeVertexNormals(),y.push(b)}}return y}};class kL extends LL{get type(){return"obj"}getLoader(){return new RL}}Cm.add("obj",kL);const DL=function(){this.propertyNameMapping={}};DL.prototype={constructor:DL,setPropertyNameMapping:function(e){this.propertyNameMapping=e},bin2str:function(e){for(var t=new Uint8Array(e),n="",i=0;i<e.byteLength;i++)n+=String.fromCharCode(t[i]);return n},isASCII:function(e){return"ascii"===this.parseHeader(this.bin2str(e)).format},parse:function(e){return e instanceof ArrayBuffer?this.isASCII(e)?this.parseASCII(this.bin2str(e)):this.parseBinary(e):this.parseASCII(e)},parseHeader:function(e){var t="",n=0,i=/ply([\s\S]*)end_header\s/.exec(e);null!==i&&(t=i[1],n=i[0].length);var r,o,s,a={comments:[],elements:[],headerLength:n},l=t.split("\n");function c(e,t){var n={type:e[0]};return"list"===n.type?(n.name=e[3],n.countType=e[1],n.itemType=e[2]):n.name=e[1],n.name in t&&(n.name=t[n.name]),n}for(var u=0;u<l.length;u++){var h=l[u];if(""!==(h=h.trim()))switch(o=(s=h.split(/\s+/)).shift(),h=s.join(" "),o){case"format":a.format=s[0],a.version=s[1];break;case"comment":a.comments.push(h);break;case"element":void 0!==r&&a.elements.push(r),(r={}).name=s[0],r.count=parseInt(s[1]),r.properties=[];break;case"property":r.properties.push(c(s,this.propertyNameMapping));break;default:console.log("unhandled",o,s)}}return void 0!==r&&a.elements.push(r),a},parseASCIINumber:function(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}},parseASCIIElement:function(e,t){for(var n=t.split(/\s+/),i={},r=0;r<e.length;r++)if("list"===e[r].type){for(var o=[],s=this.parseASCIINumber(n.shift(),e[r].countType),a=0;a<s;a++)o.push(this.parseASCIINumber(n.shift(),e[r].itemType));i[e[r].name]=o}else i[e[r].name]=this.parseASCIINumber(n.shift(),e[r].type);return i},parseASCII:function(e){var t,n=new Rr,i=this.parseHeader(e),r="";null!==(t=/end_header\s([\s\S]*)$/.exec(e))&&(r=t[1]);var o=r.split("\n"),s=0,a=0;n.useColor=!1;for(var l=0;l<o.length;l++){var c=o[l];if(""!==(c=c.trim())){a>=i.elements[s].count&&(s++,a=0);var u=this.parseASCIIElement(i.elements[s].properties,c);this.handleElement(n,i.elements[s].name,u),a++}}return this.postProcess(n)},postProcess:function(e){if(e.useColor){for(var t=0;t<e.faces.length;t++)e.faces[t].vertexColors=[e.colors[e.faces[t].a],e.colors[e.faces[t].b],e.colors[e.faces[t].c]];e.elementsNeedUpdate=!0}return e.computeBoundingSphere(),e},handleElement:function(e,t,n){if("vertex"===t){if(e.vertices.push(new mn(n.x,n.y,n.z)),"red"in n&&"green"in n&&"blue"in n){e.useColor=!0;var i=new Ri;i.setRGB(n.red/255,n.green/255,n.blue/255),e.colors.push(i)}}else if("face"===t){var r=n.vertex_indices;3===r.length?e.faces.push(new Ni(r[0],r[1],r[2])):4===r.length&&e.faces.push(new Ni(r[0],r[1],r[3]),new Ni(r[1],r[2],r[3]))}},binaryRead:function(e,t,n,i){switch(n){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,i),2];case"uint16":case"ushort":return[e.getUint16(t,i),2];case"int32":case"int":return[e.getInt32(t,i),4];case"uint32":case"uint":return[e.getUint32(t,i),4];case"float32":case"float":return[e.getFloat32(t,i),4];case"float64":case"double":return[e.getFloat64(t,i),8]}},binaryReadElement:function(e,t,n,i){for(var r,o={},s=0,a=0;a<n.length;a++)if("list"===n[a].type){var l=[],c=(r=this.binaryRead(e,t+s,n[a].countType,i))[0];s+=r[1];for(var u=0;u<c;u++)r=this.binaryRead(e,t+s,n[a].itemType,i),l.push(r[0]),s+=r[1];o[n[a].name]=l}else r=this.binaryRead(e,t+s,n[a].type,i),o[n[a].name]=r[0],s+=r[1];return[o,s]},parseBinary:function(e){for(var t,n=new Rr,i=this.parseHeader(this.bin2str(e)),r="binary_little_endian"===i.format,o=new DataView(e,i.headerLength),s=0,a=0;a<i.elements.length;a++)for(var l=0;l<i.elements[a].count;l++){s+=(t=this.binaryReadElement(o,s,i.elements[a].properties,r))[1];var c=t[0];this.handleElement(n,i.elements[a].name,c)}return this.postProcess(n)}};class OL extends LL{get type(){return"ply"}getLoader(){return new DL}}Cm.add("ply",OL);class NL extends QE{constructor(e,t){const n=t||{};super(e,n),this.delimiter=bp(n.delimiter,","),this.comment=bp(n.comment,"#"),this.columnNames=bp(n.columnNames,!1),this.table={name:this.name,path:this.path,columnNames:[],data:[]}}get type(){return"csv"}get __objName(){return"table"}_parse(){const e=this.table.data,t=new RegExp("\\s*"+this.delimiter+"\\s*");let n=0;this.streamer.eachChunkOfLines((i=>{const r=i.length;for(let o=0;o<r;++o){const r=i[o].trim();if(r.startsWith(this.comment))continue;const s=r.split(t);0===n?this.table.columnNames=s:r&&e.push(s),++n}}))}}Cm.add("csv",NL);class BL extends QE{constructor(e,t){const n=t||{};super(e,n),this.string=bp(n.string,!1),this.json={name:this.name,path:this.path,data:{}}}get type(){return"json"}get __objName(){return"json"}get isJson(){return!0}_parse(){this.streamer.isBinary()||this.string?this.json.data=JSON.parse(this.streamer.asText()):this.json.data=this.streamer.data}}Cm.add("json",BL);class FL extends QE{constructor(e,t){super(e,t||{}),this.msgpack={name:this.name,path:this.path,data:void 0}}get type(){return"msgpack"}get __objName(){return"msgpack"}get isBinary(){return!0}_parse(){e.Debug&&gm.time("MsgpackParser._parse "+this.name),this.msgpack.data=YP(this.streamer.data),e.Debug&&gm.timeEnd("MsgpackParser._parse "+this.name)}}Cm.add("msgpack",FL);class zL extends QE{constructor(e,t){super(e,t||{}),this.netcdf={name:this.name,path:this.path,data:void 0}}get type(){return"netcdf"}get __objName(){return"netcdf"}get isBinary(){return!0}_parse(){e.Debug&&gm.time("NetcdfParser._parse "+this.name),this.netcdf.data=new $I(this.streamer.data),e.Debug&&gm.timeEnd("NetcdfParser._parse "+this.name)}}Cm.add("netcdf",zL);class UL extends QE{constructor(e,t){super(e,t),this.text={name:this.name,path:this.path,data:""}}get type(){return"text"}get __objName(){return"text"}_parse(){this.text.data=this.streamer.asText()}}Cm.add("txt",UL),Cm.add("text",UL);const HL=/^['"]|['"]$/g,GL=/^<([\w-:.]+)\s*/,VL=/^([^<]*)/,jL=/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/;function $L(e){return e.replace(HL,"")}function WL(e){return e=e.trim().replace(/<!--[\s\S]*?-->/g,""),t();function t(){return{declaration:n(),root:i()}}function n(){if(!s(/^<\?xml\s*/))return;const e={attributes:{}};for(;!a()&&!l("?>");){const t=o();if(!t)return e;e.attributes[t.name]=t.value}return s(/\?>\s*/),e}function i(){const e=s(GL);if(!e)return;const t={name:e[1],attributes:{},children:[]};for(;!(a()||l(">")||l("?>")||l("/>"));){const e=o();if(!e)return t;t.attributes[e.name]=e.value}if(s(/^\s*\/>\s*/))return t;let n;for(s(/\??>\s*/),t.content=r();n=i();)t.children.push(n);return s(/^<\/[\w-:.]+>\s*/),t}function r(){const e=s(VL);return e?e[1]:""}function o(){const e=s(jL);if(e)return{name:e[1],value:$L(e[2])}}function s(t){const n=e.match(t);if(n)return e=e.slice(n[0].length),n}function a(){return 0===e.length}function l(t){return 0===e.indexOf(t)}}class qL extends QE{constructor(e,t){const n=t||{};super(e,n),this.useDomParser=bp(n.useDomParser,!1),this.xml={name:this.name,path:this.path,data:{}}}get type(){return"xml"}get __objName(){return"xml"}get isXml(){return!0}__xmlParser(e){return WL(e)}__domParser(e){return(new window.DOMParser).parseFromString(e,"text/xml")}_parse(){e.Debug&&gm.time("XmlParser._parse "+this.name),this.useDomParser?this.streamer.data instanceof Document?this.xml.data=this.streamer.data:this.xml.data=this.__domParser(this.streamer.asText()):this.xml.data=this.__xmlParser(this.streamer.asText()),e.Debug&&gm.timeEnd("XmlParser._parse "+this.name)}}function XL(e,t){const n=e.getNamedItem(t);return null!==n?n.value:""}function YL(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=XL(e,"icode").trim(),r=XL(e,"chain").trim(),o=XL(e,"altcode");let s=XL(e,"resnum");return i&&(s+="^"+i),r&&(s+=":"+r),t&&(s+="."+t),n&&o.trim()&&(s+="%"+o),s+="/"+(parseInt(XL(e,"model"))-1),s}function ZL(e){const t=XL(e,"chain").trim(),n=XL(e,"rescode"),i=XL(e,"resnum");let r="[".concat(n,"]").concat(i);return t&&(r+=":".concat(t)),r}function KL(e,t,n){void 0===e[t]?e[t]=n:e[t]|=n}function QL(e,t){return null!==e&&e.value===t}function JL(e){const t=e.inscode,n=e.chainname,i=e.atomname,r=e.altloc;let o=e.resno+"";return t&&(o+="^"+t),n&&(o+=":"+n),i&&(o+="."+i),r&&(o+="%"+r),o+="/"+e.modelIndex,o}function eR(e,t,n){let i=0;const r=t.getElementsByTagName("clash");for(let o=0,s=r.length;o<s;++o)if(e[XL(r[o].attributes,"cid")]){i+=1;break}return t.getElementsByTagName("angle-outlier").length>0&&(i+=1),t.getElementsByTagName("bond-outlier").length>0&&(i+=1),t.getElementsByTagName("plane-outlier").length>0&&(i+=1),QL(n.getNamedItem("rota"),"OUTLIER")&&(i+=1),QL(n.getNamedItem("rama"),"OUTLIER")&&(i+=1),QL(n.getNamedItem("RNApucker"),"outlier")&&(i+=1),i}Cm.add("xml",qL);class tR{constructor(e,t){this.name=e,this.path=t,this.rsrzDict={},this.rsccDict={},this.rciDict={},this.clashDict={},this.clashArray=[],this.geoDict={},this.geoAtomDict={},this.atomDict={},this.clashSele="NONE"}get type(){return"validation"}fromXml(t){e.Debug&&gm.time("Validation.fromXml");const n=this.rsrzDict,i=this.rsccDict,r=this.rciDict,o=this.clashDict,s=this.clashArray,a=this.geoDict,l=this.geoAtomDict,c=this.atomDict,u=t.getElementsByTagName("Entry");if(1===u.length){const e=u[0].getElementsByTagName("chemical_shift_list");if(1===e.length){const t=e[0].getElementsByTagName("random_coil_index");for(let e=0,n=t.length;e<n;++e){const n=t[e].attributes;r[ZL(n)]=parseFloat(XL(n,"value"))}}}const h=t.getElementsByTagName("ModelledSubgroup"),d={},p=[];e.Debug&&gm.time("Validation.fromXml#clashDict");for(let e=0,f=h.length;e<f;++e){const r=h[e],a=r.attributes,l=YL(a);null!==a.getNamedItem("rsrz")&&(n[l]=parseFloat(XL(a,"rsrz"))),null!==a.getNamedItem("rscc")&&(i[l]=parseFloat(XL(a,"rscc")));const u=t.createAttribute("sele");u.value=l,a.setNamedItem(u);const f=r.getElementsByTagName("clash");for(let e=0,t=f.length;e<t;++e){const t=f[e].attributes,n=XL(t,"atom");if("H"!==OS(n)){const e=XL(t,"cid"),i=YL(a,n,!0);if(c[i]=!0,void 0===d[e])d[e]={sele1:i,res1:l};else{const t=d[e];t.res1!==l&&(t.sele2=i,t.res2=l,p.push(t.res1,l),o[e]=t,s.push(t))}}}}e.Debug&&gm.timeEnd("Validation.fromXml#clashDict");for(let e=0,f=h.length;e<f;++e){const t=h[e],n=t.attributes,i=XL(n,"sele");if("."!==XL(n,"seq")){const e=eR(o,t,n);e>0&&(a[i]=e)}else{const e=t.getElementsByTagName("clash"),n=t.getElementsByTagName("mog-bond-outlier"),r=t.getElementsByTagName("mog-angle-outlier");if(n.length>0||r.length>0||e.length>0){const t={};l[i]=t;for(let n=0,i=e.length;n<i;++n){const i=e[n].attributes;o[XL(i,"cid")]&&KL(t,XL(i,"atom"),1)}for(let e=0,i=n.length;e<i;++e)XL(n[e].attributes,"atoms").split(",").forEach((function(e){KL(t,e,2)}));for(let e=0,n=r.length;e<n;++e)XL(r[e].attributes,"atoms").split(",").forEach((function(e){KL(t,e,4)}))}}}this.clashSele=p.length?p.join(" OR "):"NONE",e.Debug&&gm.timeEnd("Validation.fromXml")}getClashData(t){e.Debug&&gm.time("Validation.getClashData");const n=t||{},i=n.structure,r=i.atomSet,o=new Ri(bp(n.color,"#f0027f")),s=i.getAtomProxy(),a=i.getAtomProxy(),l=new mn,c=new mn,u=new mn,h=this.clashArray,d=h.length,p=new Float32Array(3*d),f=new Float32Array(3*d),m=yg(d,o.r,o.g,o.b),g=new Float32Array(d),y=new Float32Array(d);e.Debug&&gm.time("Validation.getClashData#atomDict");const v=this.atomDict;i.eachAtom((function(e){const t=JL(e);!0===v[t]&&(v[t]=e.index)})),e.Debug&&gm.timeEnd("Validation.getClashData#atomDict");let b=0;return h.forEach((function(e,t){if(s.index=v[e.sele1],a.index=v[e.sele2],void 0===s.index||void 0===a.index||!r.isSet(s.index,a.index))return;l.subVectors(a,s).setLength(s.vdw),c.copy(s).add(l),l.subVectors(s,a).setLength(a.vdw),u.copy(a).add(l);const n=s.distanceTo(a)/2,i=Math.sqrt(s.vdw*s.vdw-n*n),o=Math.sqrt(a.vdw*a.vdw-n*n);c.toArray(p,3*b),u.toArray(f,3*b),g[b]=(i+o)/2,y[b]=t,++b})),e.Debug&&gm.timeEnd("Validation.getClashData"),{position1:p.subarray(0,3*b),position2:f.subarray(0,3*b),color:m.subarray(0,3*b),color2:m.subarray(0,3*b),radius:g.subarray(0,b),picking:new xw(y.subarray(0,b),this,i)}}}class nR extends qL{constructor(e,t){super(e,t||{}),this.useDomParser=!0,this.validation=new tR(this.name,this.path)}get __objName(){return"validation"}get isXml(){return!0}_parse(){super._parse(),e.Debug&&gm.time("ValidationParser._parse "+this.name),this.validation.fromXml(this.xml.data),e.Debug&&gm.timeEnd("ValidationParser._parse "+this.name)}}function iR(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}return e}function rR(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)}function oR(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var o=0;o<i;o++)e[r+o]=t[n+o]}function sR(e){var t,n,i,r,o,s;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(s=new Uint8Array(i),r=0,t=0,n=e.length;t<n;t++)o=e[t],s.set(o,r),r+=o.length;return s}function aR(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,s=0;0!==n;){n-=s=n>2e3?2e3:n;do{o=o+(r=r+t[i++]|0)|0}while(--s);r%=65521,o%=65521}return r|o<<16|0}function lR(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}Cm.add("validation",nR);var cR=lR();function uR(e,t,n,i){var r=cR,o=i+n;e^=-1;for(var s=i;s<o;s++)e=e>>>8^r[255&(e^t[s])];return-1^e}var hR=30,dR=12;function pR(e,t){var n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,v,b,x,w,_,S,M,A,C;n=e.state,i=e.next_in,A=e.input,r=i+(e.avail_in-5),o=e.next_out,C=e.output,s=o-(t-e.avail_out),a=o+(e.avail_out-257),l=n.dmax,c=n.wsize,u=n.whave,h=n.wnext,d=n.window,p=n.hold,f=n.bits,m=n.lencode,g=n.distcode,y=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{f<15&&(p+=A[i++]<<f,f+=8,p+=A[i++]<<f,f+=8),b=m[p&y];t:for(;;){if(p>>>=x=b>>>24,f-=x,0===(x=b>>>16&255))C[o++]=65535&b;else{if(!(16&x)){if(0===(64&x)){b=m[(65535&b)+(p&(1<<x)-1)];continue t}if(32&x){n.mode=dR;break e}e.msg="invalid literal/length code",n.mode=hR;break e}w=65535&b,(x&=15)&&(f<x&&(p+=A[i++]<<f,f+=8),w+=p&(1<<x)-1,p>>>=x,f-=x),f<15&&(p+=A[i++]<<f,f+=8,p+=A[i++]<<f,f+=8),b=g[p&v];n:for(;;){if(p>>>=x=b>>>24,f-=x,!(16&(x=b>>>16&255))){if(0===(64&x)){b=g[(65535&b)+(p&(1<<x)-1)];continue n}e.msg="invalid distance code",n.mode=hR;break e}if(_=65535&b,f<(x&=15)&&(p+=A[i++]<<f,(f+=8)<x&&(p+=A[i++]<<f,f+=8)),(_+=p&(1<<x)-1)>l){e.msg="invalid distance too far back",n.mode=hR;break e}if(p>>>=x,f-=x,_>(x=o-s)){if((x=_-x)>u&&n.sane){e.msg="invalid distance too far back",n.mode=hR;break e}if(S=0,M=d,0===h){if(S+=c-x,x<w){w-=x;do{C[o++]=d[S++]}while(--x);S=o-_,M=C}}else if(h<x){if(S+=c+h-x,(x-=h)<w){w-=x;do{C[o++]=d[S++]}while(--x);if(S=0,h<w){w-=x=h;do{C[o++]=d[S++]}while(--x);S=o-_,M=C}}}else if(S+=h-x,x<w){w-=x;do{C[o++]=d[S++]}while(--x);S=o-_,M=C}for(;w>2;)C[o++]=M[S++],C[o++]=M[S++],C[o++]=M[S++],w-=3;w&&(C[o++]=M[S++],w>1&&(C[o++]=M[S++]))}else{S=o-_;do{C[o++]=C[S++],C[o++]=C[S++],C[o++]=C[S++],w-=3}while(w>2);w&&(C[o++]=C[S++],w>1&&(C[o++]=C[S++]))}break}}break}}while(i<r&&o<a);i-=w=f>>3,p&=(1<<(f-=w<<3))-1,e.next_in=i,e.next_out=o,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=o<a?a-o+257:257-(o-a),n.hold=p,n.bits=f}var fR=15,mR=852,gR=592,yR=0,vR=1,bR=2,xR=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],wR=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],_R=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],SR=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function MR(e,t,n,i,r,o,s,a){var l,c,u,h,d,p,f,m,g,y=a.bits,v=0,b=0,x=0,w=0,_=0,S=0,M=0,A=0,C=0,T=0,E=null,P=0,I=new Uint16Array(fR+1),L=new Uint16Array(fR+1),R=null,k=0;for(v=0;v<=fR;v++)I[v]=0;for(b=0;b<i;b++)I[t[n+b]]++;for(_=y,w=fR;w>=1&&0===I[w];w--);if(_>w&&(_=w),0===w)return r[o++]=20971520,r[o++]=20971520,a.bits=1,0;for(x=1;x<w&&0===I[x];x++);for(_<x&&(_=x),A=1,v=1;v<=fR;v++)if(A<<=1,(A-=I[v])<0)return-1;if(A>0&&(e===yR||1!==w))return-1;for(L[1]=0,v=1;v<fR;v++)L[v+1]=L[v]+I[v];for(b=0;b<i;b++)0!==t[n+b]&&(s[L[t[n+b]]++]=b);if(e===yR?(E=R=s,p=19):e===vR?(E=xR,P-=257,R=wR,k-=257,p=256):(E=_R,R=SR,p=-1),T=0,b=0,v=x,d=o,S=_,M=0,u=-1,h=(C=1<<_)-1,e===vR&&C>mR||e===bR&&C>gR)return 1;for(;;){f=v-M,s[b]<p?(m=0,g=s[b]):s[b]>p?(m=R[k+s[b]],g=E[P+s[b]]):(m=96,g=0),l=1<<v-M,x=c=1<<S;do{r[d+(T>>M)+(c-=l)]=f<<24|m<<16|g|0}while(0!==c);for(l=1<<v-1;T&l;)l>>=1;if(0!==l?(T&=l-1,T+=l):T=0,b++,0===--I[v]){if(v===w)break;v=t[n+s[b]]}if(v>_&&(T&h)!==u){for(0===M&&(M=_),d+=x,A=1<<(S=v-M);S+M<w&&!((A-=I[S+M])<=0);)S++,A<<=1;if(C+=1<<S,e===vR&&C>mR||e===bR&&C>gR)return 1;r[u=T&h]=_<<24|S<<16|d-o|0}}return 0!==T&&(r[d+T]=v-M<<24|64<<16|0),a.bits=_,0}var AR=0,CR=1,TR=2,ER=4,PR=5,IR=6,LR=0,RR=1,kR=2,DR=-2,OR=-3,NR=-4,BR=-5,FR=8,zR=1,UR=2,HR=3,GR=4,VR=5,jR=6,$R=7,WR=8,qR=9,XR=10,YR=11,ZR=12,KR=13,QR=14,JR=15,ek=16,tk=17,nk=18,ik=19,rk=20,ok=21,sk=22,ak=23,lk=24,ck=25,uk=26,hk=27,dk=28,pk=29,fk=30,mk=31,gk=852,yk=592;function vk(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function bk(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function xk(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=zR,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(gk),t.distcode=t.distdyn=new Int32Array(yk),t.sane=1,t.back=-1,LR):DR}function wk(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,xk(e)):DR}function _k(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?DR:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,wk(e))):DR}function Sk(e,t){var n,i;return e?(i=new bk,e.state=i,i.window=null,(n=_k(e,t))!==LR&&(e.state=null),n):DR}var Mk,Ak,Ck=!0;function Tk(e){if(Ck){var t;for(Mk=new Int32Array(512),Ak=new Int32Array(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(MR(CR,e.lens,0,288,Mk,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;MR(TR,e.lens,0,32,Ak,0,e.work,{bits:5}),Ck=!1}e.lencode=Mk,e.lenbits=9,e.distcode=Ak,e.distbits=5}function Ek(e,t,n,i){var r,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(oR(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((r=o.wsize-o.wnext)>i&&(r=i),oR(o.window,t,n-i,r,o.wnext),(i-=r)?(oR(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}function Pk(e,t){var n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y,v,b,x,w,_,S,M,A,C=0,T=new Uint8Array(4),E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return DR;(n=e.state).mode===ZR&&(n.mode=KR),s=e.next_out,r=e.output,l=e.avail_out,o=e.next_in,i=e.input,a=e.avail_in,c=n.hold,u=n.bits,h=a,d=l,S=LR;e:for(;;)switch(n.mode){case zR:if(0===n.wrap){n.mode=KR;break}for(;u<16;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}if(2&n.wrap&&35615===c){n.check=0,T[0]=255&c,T[1]=c>>>8&255,n.check=uR(n.check,T,2,0),c=0,u=0,n.mode=UR;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=fk;break}if((15&c)!==FR){e.msg="unknown compression method",n.mode=fk;break}if(u-=4,_=8+(15&(c>>>=4)),0===n.wbits)n.wbits=_;else if(_>n.wbits){e.msg="invalid window size",n.mode=fk;break}n.dmax=1<<_,e.adler=n.check=1,n.mode=512&c?XR:ZR,c=0,u=0;break;case UR:for(;u<16;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}if(n.flags=c,(255&n.flags)!==FR){e.msg="unknown compression method",n.mode=fk;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=fk;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&(T[0]=255&c,T[1]=c>>>8&255,n.check=uR(n.check,T,2,0)),c=0,u=0,n.mode=HR;case HR:for(;u<32;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}n.head&&(n.head.time=c),512&n.flags&&(T[0]=255&c,T[1]=c>>>8&255,T[2]=c>>>16&255,T[3]=c>>>24&255,n.check=uR(n.check,T,4,0)),c=0,u=0,n.mode=GR;case GR:for(;u<16;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&(T[0]=255&c,T[1]=c>>>8&255,n.check=uR(n.check,T,2,0)),c=0,u=0,n.mode=VR;case VR:if(1024&n.flags){for(;u<16;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&(T[0]=255&c,T[1]=c>>>8&255,n.check=uR(n.check,T,2,0)),c=0,u=0}else n.head&&(n.head.extra=null);n.mode=jR;case jR:if(1024&n.flags&&((p=n.length)>a&&(p=a),p&&(n.head&&(_=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),oR(n.head.extra,i,o,p,_)),512&n.flags&&(n.check=uR(n.check,i,p,o)),a-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=$R;case $R:if(2048&n.flags){if(0===a)break e;p=0;do{_=i[o+p++],n.head&&_&&n.length<65536&&(n.head.name+=String.fromCharCode(_))}while(_&&p<a);if(512&n.flags&&(n.check=uR(n.check,i,p,o)),a-=p,o+=p,_)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=WR;case WR:if(4096&n.flags){if(0===a)break e;p=0;do{_=i[o+p++],n.head&&_&&n.length<65536&&(n.head.comment+=String.fromCharCode(_))}while(_&&p<a);if(512&n.flags&&(n.check=uR(n.check,i,p,o)),a-=p,o+=p,_)break e}else n.head&&(n.head.comment=null);n.mode=qR;case qR:if(512&n.flags){for(;u<16;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}if(c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=fk;break}c=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=ZR;break;case XR:for(;u<32;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}e.adler=n.check=vk(c),c=0,u=0,n.mode=YR;case YR:if(0===n.havedict)return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=a,n.hold=c,n.bits=u,kR;e.adler=n.check=1,n.mode=ZR;case ZR:if(t===PR||t===IR)break e;case KR:if(n.last){c>>>=7&u,u-=7&u,n.mode=hk;break}for(;u<3;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}switch(n.last=1&c,u-=1,3&(c>>>=1)){case 0:n.mode=QR;break;case 1:if(Tk(n),n.mode=rk,t===IR){c>>>=2,u-=2;break e}break;case 2:n.mode=tk;break;case 3:e.msg="invalid block type",n.mode=fk}c>>>=2,u-=2;break;case QR:for(c>>>=7&u,u-=7&u;u<32;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}if((65535&c)!==(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=fk;break}if(n.length=65535&c,c=0,u=0,n.mode=JR,t===IR)break e;case JR:n.mode=ek;case ek:if(p=n.length){if(p>a&&(p=a),p>l&&(p=l),0===p)break e;oR(r,i,o,p,s),a-=p,o+=p,l-=p,s+=p,n.length-=p;break}n.mode=ZR;break;case tk:for(;u<14;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}if(n.nlen=257+(31&c),c>>>=5,u-=5,n.ndist=1+(31&c),c>>>=5,u-=5,n.ncode=4+(15&c),c>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=fk;break}n.have=0,n.mode=nk;case nk:for(;n.have<n.ncode;){for(;u<3;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}n.lens[E[n.have++]]=7&c,c>>>=3,u-=3}for(;n.have<19;)n.lens[E[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,M={bits:n.lenbits},S=MR(AR,n.lens,0,19,n.lencode,0,n.work,M),n.lenbits=M.bits,S){e.msg="invalid code lengths set",n.mode=fk;break}n.have=0,n.mode=ik;case ik:for(;n.have<n.nlen+n.ndist;){for(;y=(C=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}if(v<16)c>>>=g,u-=g,n.lens[n.have++]=v;else{if(16===v){for(A=g+2;u<A;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}if(c>>>=g,u-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=fk;break}_=n.lens[n.have-1],p=3+(3&c),c>>>=2,u-=2}else if(17===v){for(A=g+3;u<A;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}u-=g,_=0,p=3+(7&(c>>>=g)),c>>>=3,u-=3}else{for(A=g+7;u<A;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}u-=g,_=0,p=11+(127&(c>>>=g)),c>>>=7,u-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=fk;break}for(;p--;)n.lens[n.have++]=_}}if(n.mode===fk)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=fk;break}if(n.lenbits=9,M={bits:n.lenbits},S=MR(CR,n.lens,0,n.nlen,n.lencode,0,n.work,M),n.lenbits=M.bits,S){e.msg="invalid literal/lengths set",n.mode=fk;break}if(n.distbits=6,n.distcode=n.distdyn,M={bits:n.distbits},S=MR(TR,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,M),n.distbits=M.bits,S){e.msg="invalid distances set",n.mode=fk;break}if(n.mode=rk,t===IR)break e;case rk:n.mode=ok;case ok:if(a>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=a,n.hold=c,n.bits=u,pR(e,d),s=e.next_out,r=e.output,l=e.avail_out,o=e.next_in,i=e.input,a=e.avail_in,c=n.hold,u=n.bits,n.mode===ZR&&(n.back=-1);break}for(n.back=0;y=(C=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}if(y&&0===(240&y)){for(b=g,x=y,w=v;y=(C=n.lencode[w+((c&(1<<b+x)-1)>>b)])>>>16&255,v=65535&C,!(b+(g=C>>>24)<=u);){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}c>>>=b,u-=b,n.back+=b}if(c>>>=g,u-=g,n.back+=g,n.length=v,0===y){n.mode=uk;break}if(32&y){n.back=-1,n.mode=ZR;break}if(64&y){e.msg="invalid literal/length code",n.mode=fk;break}n.extra=15&y,n.mode=sk;case sk:if(n.extra){for(A=n.extra;u<A;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=ak;case ak:for(;y=(C=n.distcode[c&(1<<n.distbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}if(0===(240&y)){for(b=g,x=y,w=v;y=(C=n.distcode[w+((c&(1<<b+x)-1)>>b)])>>>16&255,v=65535&C,!(b+(g=C>>>24)<=u);){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}c>>>=b,u-=b,n.back+=b}if(c>>>=g,u-=g,n.back+=g,64&y){e.msg="invalid distance code",n.mode=fk;break}n.offset=v,n.extra=15&y,n.mode=lk;case lk:if(n.extra){for(A=n.extra;u<A;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=fk;break}n.mode=ck;case ck:if(0===l)break e;if(p=d-l,n.offset>p){if((p=n.offset-p)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=fk;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=r,f=s-n.offset,p=n.length;p>l&&(p=l),l-=p,n.length-=p;do{r[s++]=m[f++]}while(--p);0===n.length&&(n.mode=ok);break;case uk:if(0===l)break e;r[s++]=n.length,l--,n.mode=ok;break;case hk:if(n.wrap){for(;u<32;){if(0===a)break e;a--,c|=i[o++]<<u,u+=8}if(d-=l,e.total_out+=d,n.total+=d,d&&(e.adler=n.check=n.flags?uR(n.check,r,d,s-d):aR(n.check,r,d,s-d)),d=l,(n.flags?c:vk(c))!==n.check){e.msg="incorrect data check",n.mode=fk;break}c=0,u=0}n.mode=dk;case dk:if(n.wrap&&n.flags){for(;u<32;){if(0===a)break e;a--,c+=i[o++]<<u,u+=8}if(c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=fk;break}c=0,u=0}n.mode=pk;case pk:S=RR;break e;case fk:S=OR;break e;case mk:return NR;default:return DR}return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=a,n.hold=c,n.bits=u,(n.wsize||d!==e.avail_out&&n.mode<fk&&(n.mode<hk||t!==ER))&&Ek(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,n.total+=d,n.wrap&&d&&(e.adler=n.check=n.flags?uR(n.check,r,d,e.next_out-d):aR(n.check,r,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(n.mode===ZR?128:0)+(n.mode===rk||n.mode===JR?256:0),(0===h&&0===d||t===ER)&&S===LR&&(S=BR),S}function Ik(e){if(!e||!e.state)return DR;var t=e.state;return t.window&&(t.window=null),e.state=null,LR}function Lk(e,t){var n;return e&&e.state?0===(2&(n=e.state).wrap)?DR:(n.head=t,t.done=!1,LR):DR}function Rk(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&n.mode!==YR?DR:n.mode===YR&&aR(1,t,i,0)!==n.check?OR:Ek(e,t,i,i)?(n.mode=mk,NR):(n.havedict=1,LR):DR}var kk=!0,Dk=!0;try{String.fromCharCode.apply(null,[0])}catch(TD){kk=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(TD){Dk=!1}for(var Ok=new Uint8Array(256),Nk=0;Nk<256;Nk++)Ok[Nk]=Nk>=252?6:Nk>=248?5:Nk>=240?4:Nk>=224?3:Nk>=192?2:1;function Bk(e){var t,n,i,r,o,s=e.length,a=0;for(r=0;r<s;r++)55296===(64512&(n=e.charCodeAt(r)))&&r+1<s&&56320===(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),o=0,r=0;o<a;r++)55296===(64512&(n=e.charCodeAt(r)))&&r+1<s&&56320===(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t}function Fk(e,t){if(t<65537&&(e.subarray&&Dk||!e.subarray&&kk))return String.fromCharCode.apply(null,rR(e,t));for(var n="",i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n}function zk(e){for(var t=new Uint8Array(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t}function Uk(e,t){var n,i,r,o,s=t||e.length,a=new Array(2*s);for(i=0,n=0;n<s;)if((r=e[n++])<128)a[i++]=r;else if((o=Ok[r])>4)a[i++]=65533,n+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&n<s;)r=r<<6|63&e[n++],o--;o>1?a[i++]=65533:r<65536?a[i++]=r:(r-=65536,a[i++]=55296|r>>10&1023,a[i++]=56320|1023&r)}return Fk(a,i)}function Hk(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128===(192&e[n]);)n--;return n<0||0===n?t:n+Ok[e[n]]>t?n:t}Ok[254]=Ok[254]=1;var Gk=0,Vk=2,jk=4,$k=0,Wk=1,qk=2,Xk=-5,Yk={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function Zk(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function Kk(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Qk=Object.prototype.toString;function Jk(e){if(!(this instanceof Jk))return new Jk(e);this.options=iR({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Zk,this.strm.avail_out=0;var n=Sk(this.strm,t.windowBits);if(n!==$k)throw new Error(Yk[n]);this.header=new Kk,Lk(this.strm,this.header)}function eD(e,t){var n=new Jk(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function tD(e){let t;e instanceof ArrayBuffer&&(e=new Uint8Array(e));try{t=eD(e)}catch(CD){t=e}return t}Jk.prototype.push=function(e,t){var n,i,r,o,s,a,l=this.strm,c=this.options.chunkSize,u=this.options.dictionary,h=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?jk:Gk,"string"===typeof e?l.input=zk(e):"[object ArrayBuffer]"===Qk.call(e)?l.input=new Uint8Array(e):l.input=e,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new Uint8Array(c),l.next_out=0,l.avail_out=c),(n=Pk(l,Gk))===qk&&u&&(a="string"===typeof u?Bk(u):"[object ArrayBuffer]"===Qk.call(u)?new Uint8Array(u):u,n=Rk(this.strm,a)),n===Xk&&!0===h&&(n=$k,h=!1),n!==Wk&&n!==$k)return this.onEnd(n),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&n!==Wk&&(0!==l.avail_in||i!==jk&&i!==Vk)||("string"===this.options.to?(r=Hk(l.output,l.next_out),o=l.next_out-r,s=Uk(l.output,r),l.next_out=o,l.avail_out=c-o,o&&oR(l.output,l.output,r,o,0),this.onData(s)):this.onData(rR(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(h=!0)}while((l.avail_in>0||0===l.avail_out)&&n!==Wk);return n===Wk&&(i=jk),i===jk?(n=Ik(this.strm),this.onEnd(n),this.ended=!0,n===$k):i!==Vk||(this.onEnd($k),l.avail_out=0,!0)},Jk.prototype.onData=function(e){this.chunks.push(e)},Jk.prototype.onEnd=function(e){e===$k&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=sR(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},Em.add("gz",tD);class nD{}const iD="//files.rcsb.org/download/",rD="//mmtf.rcsb.org/v1.0/",oD=rD+"full/",sD=rD+"reduced/";class aD extends nD{getUrl(e){const t=Hm(e),n=t.name.substr(0,4);let i;return!["pdb","cif"].includes(t.ext)||!1!==t.compressed&&"gz"!==t.compressed?"mmtf"===t.ext?i=t.base.endsWith(".bb")?sD+n:oD+n:t.ext?(gm.warn("unsupported ext",t.ext),i=oD+n):i=oD+n:i=iD+t.path,Sp()+i}getExt(e){const t=Hm(e).ext;return t||"mmtf"}}Mm.add("rcsb",new aD);const lD="//pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/",cD="/SDF?record_type=3d";class uD extends nD{getUrl(e){const t=Hm(e),n=t.name;let i;return t.ext&&"sdf"!==t.ext?(gm.warn("unsupported ext",t.ext),i=lD+n+cD):i=lD+n+cD,Sp()+i}getExt(e){const t=Hm(e).ext;return t||"sdf"}}Mm.add("pubchem",new uD);class hD extends nD{getUrl(e){return e}getExt(e){return Hm(e).ext}}Mm.add("ftp",new hD),Mm.add("http",new hD),Mm.add("https",new hD);const dD="//alphafold.ebi.ac.uk/files/AF-",pD="-F1-model_v2.pdb";class fD extends nD{getUrl(e){const t=Hm(e),n=t.name;let i;return t.ext&&"pdb"!==t.ext?(gm.warn("unsupported AF ext",t.ext),i=dD+n+pD):i=dD+n+pD,Sp()+i}getExt(e){const t=Hm(e).ext;return t||"pdb"}}Mm.add("alphafold",new fD);const mD=/^((http|https|ftp):)*\/\//;class gD extends nD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";super(),this.baseUrl=e}getUrl(e){const t=Hm(e);let n=this.baseUrl+t.path;return mD.test(this.baseUrl)||(n=Ap(n)),n}getExt(e){return Hm(e).ext}}class yD extends nD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";super(),this.baseUrl=e}getListing(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="".concat(this.baseUrl,"dir/").concat(e);return"/"!==t[t.length-1]&&(t+="/"),Vm(t,{ext:"json"}).then((t=>({path:e,data:t.data})))}getUrl(e){const t=Hm(e);return"".concat(this.baseUrl,"file/").concat(t.path).concat(t.query)}getCountUrl(e){const t=Hm(e);return"".concat(this.baseUrl,"traj/numframes/").concat(t.path).concat(t.query)}getFrameUrl(e,t){const n=Hm(e);return"".concat(this.baseUrl,"traj/frame/").concat(t,"/").concat(n.path).concat(n.query)}getFrameParams(e,t){return"atomIndices=".concat(t.join(";"))}getPathUrl(e,t){const n=Hm(e);return"".concat(this.baseUrl,"traj/path/").concat(t,"/").concat(n.path).concat(n.query)}getExt(e){return Hm(e).ext}}function vD(){return{type:"boolean"}}function bD(){return{type:"color"}}function xD(e,t){return{type:"integer",max:e,min:t}}function wD(e,t,n){return{type:"number",precision:e,max:t,min:n}}function _D(e,t,n){return{type:"range",step:e,max:t,min:n}}function SD(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{type:"select",options:t.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:t})),{})}}const MD={backgroundColor:bD(),quality:SD("auto","low","medium","high"),sampleLevel:_D(1,5,-1),impostor:vD(),workerDefault:vD(),rotateSpeed:wD(1,10,0),zoomSpeed:wD(1,10,0),panSpeed:wD(1,10,0),clipNear:_D(1,100,0),clipFar:_D(1,100,0),clipDist:xD(200,0),clipMode:SD("scene","camera"),clipScale:SD("relative","absolute"),fogNear:_D(1,100,0),fogFar:_D(1,100,0),cameraType:SD("perspective","orthographic","stereo"),cameraEyeSep:wD(3,1,.01),cameraFov:_D(1,120,15),lightColor:bD(),lightIntensity:wD(2,10,0),ambientColor:bD(),ambientIntensity:wD(2,10,0),hoverTimeout:xD(1e4,-1),tooltip:vD(),mousePreset:SD(...Object.keys(P_))},AD="2.2.2";e.AngleRepresentation=GC,e.ArrowBuffer=ME,e.Assembly=yS,e.AxesRepresentation=lT,e.BackboneRepresentation=uT,e.BallAndStickRepresentation=cT,e.BaseRepresentation=hT,e.Box3=ni,e.BoxBuffer=PE,e.BufferRepresentation=mM,e.CartoonRepresentation=bT,e.Collection=JM,e.Color=Ri,e.Colormaker=wf,e.ColormakerRegistry=Sm,e.Component=QM,e.ComponentCollection=kA,e.ConeBuffer=wE,e.ContactRepresentation=xT,e.Counter=ig,e.CylinderBuffer=aT,e.DatasourceRegistry=Mm,e.DecompressorRegistry=Em,e.DihedralHistogramRepresentation=TT,e.DihedralRepresentation=wT,e.DistanceRepresentation=PT,e.EllipsoidBuffer=OE,e.Euler=Cn,e.Frames=iA,e.HelixorientRepresentation=kT,e.HyperballRepresentation=VT,e.Kdtree=hS,e.KeyActions=R_,e.LabelRepresentation=WT,e.LeftMouseButton=ry,e.LicoriceRepresentation=DT,e.LineRepresentation=XT,e.Matrix3=rn,e.Matrix4=Sn,e.MdsrvDatasource=yD,e.MeasurementDefaultParams=ym,e.MeshBuffer=w_,e.MiddleMouseButton=oy,e.MolecularSurface=JT,e.MolecularSurfaceRepresentation=eE,e.MouseActions=E_,e.OctahedronBuffer=UE,e.ParserRegistry=Cm,e.PdbWriter=Xm,e.PickingProxy=My,e.Plane=yi,e.PointBuffer=DM,e.PointRepresentation=tE,e.Quaternion=dn,e.Queue=$y,e.RepresentationCollection=eA,e.RepresentationElement=XM,e.RepresentationRegistry=Am,e.RibbonRepresentation=oE,e.RightMouseButton=sy,e.RocketRepresentation=sE,e.RopeRepresentation=aE,e.ScriptExtensions=wm,e.SdfWriter=Qm,e.Selection=Kf,e.Shape=fM,e.ShapeComponent=FA,e.Signal=Sf.Signal,e.SpacefillRepresentation=lE,e.SpatialHash=Fv,e.SphereBuffer=PM,e.Stage=BA,e.StaticDatasource=gD,e.StlWriter=ng,e.Structure=uM,e.StructureComponent=IA,e.StructureComponentDefaultParameters=PA,e.StructureRepresentation=AC,e.Superposition=rA,e.SurfaceComponent=LA,e.TetrahedronBuffer=$E,e.TextBuffer=FC,e.TorusBuffer=KE,e.TraceRepresentation=hE,e.TrajectoryPlayer=sA,e.TubeRepresentation=dE,e.UIStageParameters=MD,e.UnitcellRepresentation=pE,e.ValidationRepresentation=fE,e.Vector2=nn,e.Vector3=mn,e.Version=AD,e.Viewer=iy,e.Volume=f_,e.VolumeComponent=RA,e.WidelineBuffer=HC,e.autoLoad=Vm,e.concatStructures=BS,e.download=Tp,e.flatten=_p,e.getDataInfo=Gm,e.getFileInfo=Hm,e.getQuery=yp,e.guessElement=OS,e.setDebug=bm,e.setListingDatasource=Rm,e.setMeasurementDefaultParams=vm,e.setTrajectoryDatasource=km,e.superpose=EA,e.throttle=Ep,e.uniqueArray=Dp,Object.defineProperty(e,"__esModule",{value:!0})}(t)},463:(e,t,n)=>{"use strict";var i=n(791),r=n(296);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,a={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(a[e]=t,e=0;e<t.length;e++)s.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,i,r,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function b(e,t,n,i){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!h.call(f,e)||!h.call(p,e)&&(d.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),_=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),T=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),R=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var k=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=D&&e[D]||e["@@iterator"])?e:null}var N,B=Object.assign;function F(e){if(void 0===N)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);N=t&&t[1]||""}return"\n"+N+e}var z=!1;function U(e,t){if(!e||z)return"";z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),o=i.stack.split("\n"),s=r.length-1,a=o.length-1;1<=s&&0<=a&&r[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(r[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||r[s]!==o[a]){var l="\n"+r[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=a);break}}}finally{z=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function H(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 1:return e=U(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case _:return"Portal";case A:return"Profiler";case M:return"StrictMode";case P:return"Suspense";case I:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case T:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case L:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case R:t=e._payload,e=e._init;try{return G(e(t))}catch(n){}}return null}function V(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===M?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function j(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function $(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=$(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=$(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return B({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Z(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=j(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function K(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function Q(e,t){K(e,t);var n=j(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,j(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function J(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+j(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return B({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:j(n)}}function oe(e,t){var n=j(t.value),i=j(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,he=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=me(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ye=B({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var _e=null,Se=null,Me=null;function Ae(e){if(e=br(e)){if("function"!==typeof _e)throw Error(o(280));var t=e.stateNode;t&&(t=wr(t),_e(e.stateNode,e.type,t))}}function Ce(e){Se?Me?Me.push(e):Me=[e]:Se=e}function Te(){if(Se){var e=Se,t=Me;if(Me=Se=null,Ae(e),t)for(e=0;e<t.length;e++)Ae(t[e])}}function Ee(e,t){return e(t)}function Pe(){}var Ie=!1;function Le(e,t,n){if(Ie)return e(t,n);Ie=!0;try{return Ee(e,t,n)}finally{Ie=!1,(null!==Se||null!==Me)&&(Pe(),Te())}}function Re(e,t){var n=e.stateNode;if(null===n)return null;var i=wr(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var ke=!1;if(u)try{var De={};Object.defineProperty(De,"passive",{get:function(){ke=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(ue){ke=!1}function Oe(e,t,n,i,r,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Ne=!1,Be=null,Fe=!1,ze=null,Ue={onError:function(e){Ne=!0,Be=e}};function He(e,t,n,i,r,o,s,a,l){Ne=!1,Be=null,Oe.apply(Ue,arguments)}function Ge(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ve(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function je(e){if(Ge(e)!==e)throw Error(o(188))}function $e(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var s=r.alternate;if(null===s){if(null!==(i=r.return)){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return je(r),e;if(s===i)return je(r),t;s=s.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=s;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,i=s;break}if(l===i){a=!0,i=r,n=s;break}l=l.sibling}if(!a){for(l=s.child;l;){if(l===n){a=!0,n=s,i=r;break}if(l===i){a=!0,i=s,n=r;break}l=l.sibling}if(!a)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var qe=r.unstable_scheduleCallback,Xe=r.unstable_cancelCallback,Ye=r.unstable_shouldYield,Ze=r.unstable_requestPaint,Ke=r.unstable_now,Qe=r.unstable_getCurrentPriorityLevel,Je=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,ot=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/lt|0)|0},at=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~r;0!==a?i=ht(a):0!==(o&=s)&&(i=ht(o))}else 0!==(s=n&~r)?i=ht(s):0!==o&&(i=ht(o));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(o=t&-t)||16===r&&0!==(4194240&o)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-st(t)),i|=e[n],t&=~r;return i}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-st(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,_t,St,Mt,At,Ct=!1,Tt=[],Et=null,Pt=null,It=null,Lt=new Map,Rt=new Map,kt=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":Et=null;break;case"dragenter":case"dragleave":Pt=null;break;case"mouseover":case"mouseout":It=null;break;case"pointerover":case"pointerout":Lt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rt.delete(t.pointerId)}}function Nt(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=br(t))&&_t(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Bt(e){var t=vr(e.target);if(null!==t){var n=Ge(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ve(n)))return e.blockedOn=t,void At(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=br(n))&&_t(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);xe=i,n.target.dispatchEvent(i),xe=null,t.shift()}return!0}function zt(e,t,n){Ft(e)&&n.delete(t)}function Ut(){Ct=!1,null!==Et&&Ft(Et)&&(Et=null),null!==Pt&&Ft(Pt)&&(Pt=null),null!==It&&Ft(It)&&(It=null),Lt.forEach(zt),Rt.forEach(zt)}function Ht(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ut)))}function Gt(e){function t(t){return Ht(t,e)}if(0<Tt.length){Ht(Tt[0],e);for(var n=1;n<Tt.length;n++){var i=Tt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Et&&Ht(Et,e),null!==Pt&&Ht(Pt,e),null!==It&&Ht(It,e),Lt.forEach(t),Rt.forEach(t),n=0;n<kt.length;n++)(i=kt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<kt.length&&null===(n=kt[0]).blockedOn;)Bt(n),null===n.blockedOn&&kt.shift()}var Vt=x.ReactCurrentBatchConfig,jt=!0;function $t(e,t,n,i){var r=bt,o=Vt.transition;Vt.transition=null;try{bt=1,qt(e,t,n,i)}finally{bt=r,Vt.transition=o}}function Wt(e,t,n,i){var r=bt,o=Vt.transition;Vt.transition=null;try{bt=4,qt(e,t,n,i)}finally{bt=r,Vt.transition=o}}function qt(e,t,n,i){if(jt){var r=Yt(e,t,n,i);if(null===r)ji(e,t,i,Xt,n),Ot(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return Et=Nt(Et,e,t,n,i,r),!0;case"dragenter":return Pt=Nt(Pt,e,t,n,i,r),!0;case"mouseover":return It=Nt(It,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return Lt.set(o,Nt(Lt.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,Rt.set(o,Nt(Rt.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Ot(e,i),4&t&&-1<Dt.indexOf(e)){for(;null!==r;){var o=br(r);if(null!==o&&wt(o),null===(o=Yt(e,t,n,i))&&ji(e,t,i,Xt,n),o===r)break;r=o}null!==r&&i.stopPropagation()}else ji(e,t,i,null,n)}}var Xt=null;function Yt(e,t,n,i){if(Xt=null,null!==(e=vr(e=we(i))))if(null===(t=Ge(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ve(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function Zt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case Je:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var Kt=null,Qt=null,Jt=null;function en(){if(Jt)return Jt;var e,t,n=Qt,i=n.length,r="value"in Kt?Kt.value:Kt.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var s=i-e;for(t=1;t<=s&&n[i-t]===r[o-t];t++);return Jt=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,i,r,o){for(var s in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(r):r[s]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return B(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,an,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(cn),hn=B({},cn,{view:0,detail:0}),dn=on(hn),pn=B({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:An,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(sn=e.screenX-ln.screenX,an=e.screenY-ln.screenY):an=sn=0,ln=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:an}}),fn=on(pn),mn=on(B({},pn,{dataTransfer:0})),gn=on(B({},hn,{relatedTarget:0})),yn=on(B({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=B({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=on(vn),xn=on(B({},cn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_n={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Mn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function An(){return Mn}var Cn=B({},hn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?_n[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:An,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Tn=on(Cn),En=on(B({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pn=on(B({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:An})),In=on(B({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ln=B({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Rn=on(Ln),kn=[9,13,27,32],Dn=u&&"CompositionEvent"in window,On=null;u&&"documentMode"in document&&(On=document.documentMode);var Nn=u&&"TextEvent"in window&&!On,Bn=u&&(!Dn||On&&8<On&&11>=On),Fn=String.fromCharCode(32),zn=!1;function Un(e,t){switch(e){case"keyup":return-1!==kn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Gn=!1;var Vn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vn[e.type]:"textarea"===t}function $n(e,t,n,i){Ce(i),0<(t=Wi(t,"onChange")).length&&(n=new un("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Wn=null,qn=null;function Xn(e){Fi(e,0)}function Yn(e){if(q(xr(e)))return e}function Zn(e,t){if("change"===e)return t}var Kn=!1;if(u){var Qn;if(u){var Jn="oninput"in document;if(!Jn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Jn="function"===typeof ei.oninput}Qn=Jn}else Qn=!1;Kn=Qn&&(!document.documentMode||9<document.documentMode)}function ti(){Wn&&(Wn.detachEvent("onpropertychange",ni),qn=Wn=null)}function ni(e){if("value"===e.propertyName&&Yn(qn)){var t=[];$n(t,qn,e,we(e)),Le(Xn,t)}}function ii(e,t,n){"focusin"===e?(ti(),qn=n,(Wn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(qn)}function oi(e,t){if("click"===e)return Yn(t)}function si(e,t){if("input"===e||"change"===e)return Yn(t)}var ai="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function li(e,t){if(ai(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!h.call(t,r)||!ai(e[r],t[r]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function hi(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hi(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function di(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function pi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fi(e){var t=di(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=void 0===i.end?o:Math.min(i.end,r),!e.extend&&o>i&&(r=i,i=o,o=r),r=ui(n,o);var s=ui(n,i);r&&s&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mi=u&&"documentMode"in document&&11>=document.documentMode,gi=null,yi=null,vi=null,bi=!1;function xi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;bi||null==gi||gi!==X(i)||("selectionStart"in(i=gi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},vi&&li(vi,i)||(vi=i,0<(i=Wi(yi,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=gi)))}function wi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var _i={animationend:wi("Animation","AnimationEnd"),animationiteration:wi("Animation","AnimationIteration"),animationstart:wi("Animation","AnimationStart"),transitionend:wi("Transition","TransitionEnd")},Si={},Mi={};function Ai(e){if(Si[e])return Si[e];if(!_i[e])return e;var t,n=_i[e];for(t in n)if(n.hasOwnProperty(t)&&t in Mi)return Si[e]=n[t];return e}u&&(Mi=document.createElement("div").style,"AnimationEvent"in window||(delete _i.animationend.animation,delete _i.animationiteration.animation,delete _i.animationstart.animation),"TransitionEvent"in window||delete _i.transitionend.transition);var Ci=Ai("animationend"),Ti=Ai("animationiteration"),Ei=Ai("animationstart"),Pi=Ai("transitionend"),Ii=new Map,Li="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ri(e,t){Ii.set(e,t),l(t,[e])}for(var ki=0;ki<Li.length;ki++){var Di=Li[ki];Ri(Di.toLowerCase(),"on"+(Di[0].toUpperCase()+Di.slice(1)))}Ri(Ci,"onAnimationEnd"),Ri(Ti,"onAnimationIteration"),Ri(Ei,"onAnimationStart"),Ri("dblclick","onDoubleClick"),Ri("focusin","onFocus"),Ri("focusout","onBlur"),Ri(Pi,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Oi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ni=new Set("cancel close invalid load scroll toggle".split(" ").concat(Oi));function Bi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,s,a,l,c){if(He.apply(this,arguments),Ne){if(!Ne)throw Error(o(198));var u=Be;Ne=!1,Be=null,Fe||(Fe=!0,ze=u)}}(i,t,void 0,e),e.currentTarget=null}function Fi(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var s=i.length-1;0<=s;s--){var a=i[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&r.isPropagationStopped())break e;Bi(r,a,c),o=l}else for(s=0;s<i.length;s++){if(l=(a=i[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&r.isPropagationStopped())break e;Bi(r,a,c),o=l}}}if(Fe)throw e=ze,Fe=!1,ze=null,e}function zi(e,t){var n=t[mr];void 0===n&&(n=t[mr]=new Set);var i=e+"__bubble";n.has(i)||(Vi(t,e,2,!1),n.add(i))}function Ui(e,t,n){var i=0;t&&(i|=4),Vi(n,e,i,t)}var Hi="_reactListening"+Math.random().toString(36).slice(2);function Gi(e){if(!e[Hi]){e[Hi]=!0,s.forEach((function(t){"selectionchange"!==t&&(Ni.has(t)||Ui(t,!1,e),Ui(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Hi]||(t[Hi]=!0,Ui("selectionchange",!1,t))}}function Vi(e,t,n,i){switch(Zt(t)){case 1:var r=$t;break;case 4:r=Wt;break;default:r=qt}n=r.bind(null,t,n,e),r=void 0,!ke||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function ji(e,t,n,i,r){var o=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var s=i.tag;if(3===s||4===s){var a=i.stateNode.containerInfo;if(a===r||8===a.nodeType&&a.parentNode===r)break;if(4===s)for(s=i.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;s=s.return}for(;null!==a;){if(null===(s=vr(a)))return;if(5===(l=s.tag)||6===l){i=o=s;continue e}a=a.parentNode}}i=i.return}Le((function(){var i=o,r=we(n),s=[];e:{var a=Ii.get(e);if(void 0!==a){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Tn;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pn;break;case Ci:case Ti:case Ei:l=yn;break;case Pi:l=In;break;case"scroll":l=dn;break;case"wheel":l=Rn;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=En}var u=0!==(4&t),h=!u&&"scroll"===e,d=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=Re(f,d))&&u.push($i(f,m,p)))),h)break;f=f.return}0<u.length&&(a=new l(a,c,null,n,r),s.push({event:a,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!vr(c)&&!c[fr])&&(l||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?vr(c):null)&&(c!==(h=Ge(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=fn,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=En,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?a:xr(l),p=null==c?a:xr(c),(a=new u(m,f+"leave",l,n,r)).target=h,a.relatedTarget=p,m=null,vr(r)===i&&((u=new u(d,f+"enter",c,n,r)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,f=0,p=u=l;p;p=qi(p))f++;for(p=0,m=d;m;m=qi(m))p++;for(;0<f-p;)u=qi(u),f--;for(;0<p-f;)d=qi(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break e;u=qi(u),d=qi(d)}u=null}else u=null;null!==l&&Xi(s,a,l,u,!1),null!==c&&null!==h&&Xi(s,h,c,u,!0)}if("select"===(l=(a=i?xr(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=Zn;else if(jn(a))if(Kn)g=si;else{g=ri;var y=ii}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=oi);switch(g&&(g=g(e,i))?$n(s,g,n,r):(y&&y(e,a,i),"focusout"===e&&(y=a._wrapperState)&&y.controlled&&"number"===a.type&&ee(a,"number",a.value)),y=i?xr(i):window,e){case"focusin":(jn(y)||"true"===y.contentEditable)&&(gi=y,yi=i,vi=null);break;case"focusout":vi=yi=gi=null;break;case"mousedown":bi=!0;break;case"contextmenu":case"mouseup":case"dragend":bi=!1,xi(s,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":xi(s,n,r)}var v;if(Dn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Gn?Un(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Bn&&"ko"!==n.locale&&(Gn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Gn&&(v=en()):(Qt="value"in(Kt=r)?Kt.value:Kt.textContent,Gn=!0)),0<(y=Wi(i,b)).length&&(b=new xn(b,e,null,n,r),s.push({event:b,listeners:y}),v?b.data=v:null!==(v=Hn(n))&&(b.data=v))),(v=Nn?function(e,t){switch(e){case"compositionend":return Hn(t);case"keypress":return 32!==t.which?null:(zn=!0,Fn);case"textInput":return(e=t.data)===Fn&&zn?null:e;default:return null}}(e,n):function(e,t){if(Gn)return"compositionend"===e||!Dn&&Un(e,t)?(e=en(),Jt=Qt=Kt=null,Gn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Wi(i,"onBeforeInput")).length&&(r=new xn("onBeforeInput","beforeinput",null,n,r),s.push({event:r,listeners:i}),r.data=v))}Fi(s,t)}))}function $i(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;5===r.tag&&null!==o&&(r=o,null!=(o=Re(e,n))&&i.unshift($i(e,o,r)),null!=(o=Re(e,t))&&i.push($i(e,o,r))),e=e.return}return i}function qi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xi(e,t,n,i,r){for(var o=t._reactName,s=[];null!==n&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===i)break;5===a.tag&&null!==c&&(a=c,r?null!=(l=Re(n,o))&&s.unshift($i(n,l,a)):r||null!=(l=Re(n,o))&&s.push($i(n,l,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Yi=/\r\n?/g,Zi=/\u0000|\uFFFD/g;function Ki(e){return("string"===typeof e?e:""+e).replace(Yi,"\n").replace(Zi,"")}function Qi(e,t,n){if(t=Ki(t),Ki(e)!==t&&n)throw Error(o(425))}function Ji(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,or="function"===typeof Promise?Promise:void 0,sr="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof or?function(e){return or.resolve(null).then(e).catch(ar)}:ir;function ar(e){setTimeout((function(){throw e}))}function lr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void Gt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Gt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ur(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hr=Math.random().toString(36).slice(2),dr="__reactFiber$"+hr,pr="__reactProps$"+hr,fr="__reactContainer$"+hr,mr="__reactEvents$"+hr,gr="__reactListeners$"+hr,yr="__reactHandles$"+hr;function vr(e){var t=e[dr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fr]||n[dr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ur(e);null!==e;){if(n=e[dr])return n;e=ur(e)}return t}n=(e=n).parentNode}return null}function br(e){return!(e=e[dr]||e[fr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function wr(e){return e[pr]||null}var _r=[],Sr=-1;function Mr(e){return{current:e}}function Ar(e){0>Sr||(e.current=_r[Sr],_r[Sr]=null,Sr--)}function Cr(e,t){Sr++,_r[Sr]=e.current,e.current=t}var Tr={},Er=Mr(Tr),Pr=Mr(!1),Ir=Tr;function Lr(e,t){var n=e.type.contextTypes;if(!n)return Tr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in n)o[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Rr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function kr(){Ar(Pr),Ar(Er)}function Dr(e,t,n){if(Er.current!==Tr)throw Error(o(168));Cr(Er,t),Cr(Pr,n)}function Or(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(o(108,V(e)||"Unknown",r));return B({},n,i)}function Nr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Tr,Ir=Er.current,Cr(Er,e),Cr(Pr,Pr.current),!0}function Br(e,t,n){var i=e.stateNode;if(!i)throw Error(o(169));n?(e=Or(e,t,Ir),i.__reactInternalMemoizedMergedChildContext=e,Ar(Pr),Ar(Er),Cr(Er,e)):Ar(Pr),Cr(Pr,n)}var Fr=null,zr=!1,Ur=!1;function Hr(e){null===Fr?Fr=[e]:Fr.push(e)}function Gr(){if(!Ur&&null!==Fr){Ur=!0;var e=0,t=bt;try{var n=Fr;for(bt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Fr=null,zr=!1}catch(r){throw null!==Fr&&(Fr=Fr.slice(e+1)),qe(Je,Gr),r}finally{bt=t,Ur=!1}}return null}var Vr=[],jr=0,$r=null,Wr=0,qr=[],Xr=0,Yr=null,Zr=1,Kr="";function Qr(e,t){Vr[jr++]=Wr,Vr[jr++]=$r,$r=e,Wr=t}function Jr(e,t,n){qr[Xr++]=Zr,qr[Xr++]=Kr,qr[Xr++]=Yr,Yr=e;var i=Zr;e=Kr;var r=32-st(i)-1;i&=~(1<<r),n+=1;var o=32-st(t)+r;if(30<o){var s=r-r%5;o=(i&(1<<s)-1).toString(32),i>>=s,r-=s,Zr=1<<32-st(t)+r|n<<r|i,Kr=o+e}else Zr=1<<o|n<<r|i,Kr=e}function eo(e){null!==e.return&&(Qr(e,1),Jr(e,1,0))}function to(e){for(;e===$r;)$r=Vr[--jr],Vr[jr]=null,Wr=Vr[--jr],Vr[jr]=null;for(;e===Yr;)Yr=qr[--Xr],qr[Xr]=null,Kr=qr[--Xr],qr[Xr]=null,Zr=qr[--Xr],qr[Xr]=null}var no=null,io=null,ro=!1,oo=null;function so(e,t){var n=Rc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ao(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,io=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,io=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yr?{id:Zr,overflow:Kr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Rc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,io=null,!0);default:return!1}}function lo(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function co(e){if(ro){var t=io;if(t){var n=t;if(!ao(e,t)){if(lo(e))throw Error(o(418));t=cr(n.nextSibling);var i=no;t&&ao(e,t)?so(i,n):(e.flags=-4097&e.flags|2,ro=!1,no=e)}}else{if(lo(e))throw Error(o(418));e.flags=-4097&e.flags|2,ro=!1,no=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!ro)return uo(e),ro=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=io)){if(lo(e))throw po(),Error(o(418));for(;t;)so(e,t),t=cr(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){io=cr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}io=null}}else io=no?cr(e.stateNode.nextSibling):null;return!0}function po(){for(var e=io;e;)e=cr(e.nextSibling)}function fo(){io=no=null,ro=!1}function mo(e){null===oo?oo=[e]:oo.push(e)}var go=x.ReactCurrentBatchConfig;function yo(e,t){if(e&&e.defaultProps){for(var n in t=B({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var vo=Mr(null),bo=null,xo=null,wo=null;function _o(){wo=xo=bo=null}function So(e){var t=vo.current;Ar(vo),e._currentValue=t}function Mo(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Ao(e,t){bo=e,wo=xo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xa=!0),e.firstContext=null)}function Co(e){var t=e._currentValue;if(wo!==e)if(e={context:e,memoizedValue:t,next:null},null===xo){if(null===bo)throw Error(o(308));xo=e,bo.dependencies={lanes:0,firstContext:e}}else xo=xo.next=e;return t}var To=null;function Eo(e){null===To?To=[e]:To.push(e)}function Po(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Eo(t)):(n.next=r.next,r.next=n),t.interleaved=n,Io(e,i)}function Io(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Lo=!1;function Ro(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ko(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Do(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Oo(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Pl)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Io(e,n)}return null===(r=i.interleaved)?(t.next=t,Eo(i)):(t.next=r.next,r.next=t),i.interleaved=t,Io(e,n)}function No(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Bo(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?r=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Fo(e,t,n,i){var r=e.updateQueue;Lo=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==o){var h=r.baseState;for(s=0,u=c=l=null,a=o;;){var d=a.lane,p=a.eventTime;if((i&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,m=a;switch(d=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=m.payload)?f.call(p,h,d):f)||void 0===d)break e;h=B({},h,d);break e;case 2:Lo=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(d=r.effects)?r.effects=[a]:d.push(a))}else p={eventTime:p,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,s|=d;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(d=a).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{s|=r.lane,r=r.next}while(r!==t)}else null===o&&(r.shared.lanes=0);Bl|=s,e.lanes=s,e.memoizedState=h}}function zo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var Uo=(new i.Component).refs;function Ho(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:B({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Go={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=tc(),r=nc(e),o=Do(i,r);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Oo(e,o,r))&&(ic(t,e,r,i),No(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=tc(),r=nc(e),o=Do(i,r);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Oo(e,o,r))&&(ic(t,e,r,i),No(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),i=nc(e),r=Do(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Oo(e,r,i))&&(ic(t,e,i,n),No(t,e,i))}};function Vo(e,t,n,i,r,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!li(n,i)||!li(r,o))}function jo(e,t,n){var i=!1,r=Tr,o=t.contextType;return"object"===typeof o&&null!==o?o=Co(o):(r=Rr(t)?Ir:Er.current,o=(i=null!==(i=t.contextTypes)&&void 0!==i)?Lr(e,r):Tr),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Go,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function $o(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Go.enqueueReplaceState(t,t.state,null)}function Wo(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=Uo,Ro(e);var o=t.contextType;"object"===typeof o&&null!==o?r.context=Co(o):(o=Rr(t)?Ir:Er.current,r.context=Lr(e,o)),r.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(Ho(e,t,o,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Go.enqueueReplaceState(r,r.state,null),Fo(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function qo(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,e));var r=i,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=r.refs;t===Uo&&(t=r.refs={}),null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Xo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Yo(e){return(0,e._init)(e._payload)}function Zo(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Dc(e,t)).index=0,e.sibling=null,e}function s(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Fc(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){var o=n.type;return o===S?h(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===R&&Yo(o)===t.type)?((i=r(t,n.props)).ref=qo(e,t,n),i.return=e,i):((i=Oc(n.type,n.key,n.props,null,e.mode,i)).ref=qo(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=zc(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function h(e,t,n,i,o){return null===t||7!==t.tag?((t=Nc(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Oc(t.type,t.key,t.props,null,e.mode,n)).ref=qo(e,null,t),n.return=e,n;case _:return(t=zc(t,e.mode,n)).return=e,t;case R:return d(e,(0,t._init)(t._payload),n)}if(te(t)||O(t))return(t=Nc(t,e.mode,n,null)).return=e,t;Xo(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===r?c(e,t,n,i):null;case _:return n.key===r?u(e,t,n,i):null;case R:return p(e,t,(r=n._init)(n._payload),i)}if(te(n)||O(n))return null!==r?null:h(e,t,n,i,null);Xo(e,n)}return null}function f(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case w:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case _:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case R:return f(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||O(i))return h(t,e=e.get(n)||null,i,r,null);Xo(t,i)}return null}function m(r,o,a,l){for(var c=null,u=null,h=o,m=o=0,g=null;null!==h&&m<a.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var y=p(r,h,a[m],l);if(null===y){null===h&&(h=g);break}e&&h&&null===y.alternate&&t(r,h),o=s(y,o,m),null===u?c=y:u.sibling=y,u=y,h=g}if(m===a.length)return n(r,h),ro&&Qr(r,m),c;if(null===h){for(;m<a.length;m++)null!==(h=d(r,a[m],l))&&(o=s(h,o,m),null===u?c=h:u.sibling=h,u=h);return ro&&Qr(r,m),c}for(h=i(r,h);m<a.length;m++)null!==(g=f(h,r,m,a[m],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),o=s(g,o,m),null===u?c=g:u.sibling=g,u=g);return e&&h.forEach((function(e){return t(r,e)})),ro&&Qr(r,m),c}function g(r,a,l,c){var u=O(l);if("function"!==typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var h=u=null,m=a,g=a=0,y=null,v=l.next();null!==m&&!v.done;g++,v=l.next()){m.index>g?(y=m,m=null):y=m.sibling;var b=p(r,m,v.value,c);if(null===b){null===m&&(m=y);break}e&&m&&null===b.alternate&&t(r,m),a=s(b,a,g),null===h?u=b:h.sibling=b,h=b,m=y}if(v.done)return n(r,m),ro&&Qr(r,g),u;if(null===m){for(;!v.done;g++,v=l.next())null!==(v=d(r,v.value,c))&&(a=s(v,a,g),null===h?u=v:h.sibling=v,h=v);return ro&&Qr(r,g),u}for(m=i(r,m);!v.done;g++,v=l.next())null!==(v=f(m,r,g,v.value,c))&&(e&&null!==v.alternate&&m.delete(null===v.key?g:v.key),a=s(v,a,g),null===h?u=v:h.sibling=v,h=v);return e&&m.forEach((function(e){return t(r,e)})),ro&&Qr(r,g),u}return function e(i,o,s,l){if("object"===typeof s&&null!==s&&s.type===S&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case w:e:{for(var c=s.key,u=o;null!==u;){if(u.key===c){if((c=s.type)===S){if(7===u.tag){n(i,u.sibling),(o=r(u,s.props.children)).return=i,i=o;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===R&&Yo(c)===u.type){n(i,u.sibling),(o=r(u,s.props)).ref=qo(i,u,s),o.return=i,i=o;break e}n(i,u);break}t(i,u),u=u.sibling}s.type===S?((o=Nc(s.props.children,i.mode,l,s.key)).return=i,i=o):((l=Oc(s.type,s.key,s.props,null,i.mode,l)).ref=qo(i,o,s),l.return=i,i=l)}return a(i);case _:e:{for(u=s.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){n(i,o.sibling),(o=r(o,s.children||[])).return=i,i=o;break e}n(i,o);break}t(i,o),o=o.sibling}(o=zc(s,i.mode,l)).return=i,i=o}return a(i);case R:return e(i,o,(u=s._init)(s._payload),l)}if(te(s))return m(i,o,s,l);if(O(s))return g(i,o,s,l);Xo(i,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==o&&6===o.tag?(n(i,o.sibling),(o=r(o,s)).return=i,i=o):(n(i,o),(o=Fc(s,i.mode,l)).return=i,i=o),a(i)):n(i,o)}}var Ko=Zo(!0),Qo=Zo(!1),Jo={},es=Mr(Jo),ts=Mr(Jo),ns=Mr(Jo);function is(e){if(e===Jo)throw Error(o(174));return e}function rs(e,t){switch(Cr(ns,t),Cr(ts,e),Cr(es,Jo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ar(es),Cr(es,t)}function os(){Ar(es),Ar(ts),Ar(ns)}function ss(e){is(ns.current);var t=is(es.current),n=le(t,e.type);t!==n&&(Cr(ts,e),Cr(es,n))}function as(e){ts.current===e&&(Ar(es),Ar(ts))}var ls=Mr(0);function cs(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var us=[];function hs(){for(var e=0;e<us.length;e++)us[e]._workInProgressVersionPrimary=null;us.length=0}var ds=x.ReactCurrentDispatcher,ps=x.ReactCurrentBatchConfig,fs=0,ms=null,gs=null,ys=null,vs=!1,bs=!1,xs=0,ws=0;function _s(){throw Error(o(321))}function Ss(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ai(e[n],t[n]))return!1;return!0}function Ms(e,t,n,i,r,s){if(fs=s,ms=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ds.current=null===e||null===e.memoizedState?aa:la,e=n(i,r),bs){s=0;do{if(bs=!1,xs=0,25<=s)throw Error(o(301));s+=1,ys=gs=null,t.updateQueue=null,ds.current=ca,e=n(i,r)}while(bs)}if(ds.current=sa,t=null!==gs&&null!==gs.next,fs=0,ys=gs=ms=null,vs=!1,t)throw Error(o(300));return e}function As(){var e=0!==xs;return xs=0,e}function Cs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ys?ms.memoizedState=ys=e:ys=ys.next=e,ys}function Ts(){if(null===gs){var e=ms.alternate;e=null!==e?e.memoizedState:null}else e=gs.next;var t=null===ys?ms.memoizedState:ys.next;if(null!==t)ys=t,gs=e;else{if(null===e)throw Error(o(310));e={memoizedState:(gs=e).memoizedState,baseState:gs.baseState,baseQueue:gs.baseQueue,queue:gs.queue,next:null},null===ys?ms.memoizedState=ys=e:ys=ys.next=e}return ys}function Es(e,t){return"function"===typeof t?t(e):t}function Ps(e){var t=Ts(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=gs,r=i.baseQueue,s=n.pending;if(null!==s){if(null!==r){var a=r.next;r.next=s.next,s.next=a}i.baseQueue=r=s,n.pending=null}if(null!==r){s=r.next,i=i.baseState;var l=a=null,c=null,u=s;do{var h=u.lane;if((fs&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,a=i):c=c.next=d,ms.lanes|=h,Bl|=h}u=u.next}while(null!==u&&u!==s);null===c?a=i:c.next=l,ai(i,t.memoizedState)||(xa=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{s=r.lane,ms.lanes|=s,Bl|=s,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Is(e){var t=Ts(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,s=t.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{s=e(s,a.action),a=a.next}while(a!==r);ai(s,t.memoizedState)||(xa=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,i]}function Ls(){}function Rs(e,t){var n=ms,i=Ts(),r=t(),s=!ai(i.memoizedState,r);if(s&&(i.memoizedState=r,xa=!0),i=i.queue,js(Os.bind(null,n,i,e),[e]),i.getSnapshot!==t||s||null!==ys&&1&ys.memoizedState.tag){if(n.flags|=2048,zs(9,Ds.bind(null,n,i,r,t),void 0,null),null===Il)throw Error(o(349));0!==(30&fs)||ks(n,t,r)}return r}function ks(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ms.updateQueue)?(t={lastEffect:null,stores:null},ms.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ds(e,t,n,i){t.value=n,t.getSnapshot=i,Ns(t)&&Bs(e)}function Os(e,t,n){return n((function(){Ns(t)&&Bs(e)}))}function Ns(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ai(e,n)}catch(i){return!0}}function Bs(e){var t=Io(e,1);null!==t&&ic(t,e,1,-1)}function Fs(e){var t=Cs();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Es,lastRenderedState:e},t.queue=e,e=e.dispatch=na.bind(null,ms,e),[t.memoizedState,e]}function zs(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=ms.updateQueue)?(t={lastEffect:null,stores:null},ms.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Us(){return Ts().memoizedState}function Hs(e,t,n,i){var r=Cs();ms.flags|=e,r.memoizedState=zs(1|t,n,void 0,void 0===i?null:i)}function Gs(e,t,n,i){var r=Ts();i=void 0===i?null:i;var o=void 0;if(null!==gs){var s=gs.memoizedState;if(o=s.destroy,null!==i&&Ss(i,s.deps))return void(r.memoizedState=zs(t,n,o,i))}ms.flags|=e,r.memoizedState=zs(1|t,n,o,i)}function Vs(e,t){return Hs(8390656,8,e,t)}function js(e,t){return Gs(2048,8,e,t)}function $s(e,t){return Gs(4,2,e,t)}function Ws(e,t){return Gs(4,4,e,t)}function qs(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Xs(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Gs(4,4,qs.bind(null,t,e),n)}function Ys(){}function Zs(e,t){var n=Ts();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ss(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ks(e,t){var n=Ts();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ss(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Qs(e,t,n){return 0===(21&fs)?(e.baseState&&(e.baseState=!1,xa=!0),e.memoizedState=n):(ai(n,t)||(n=mt(),ms.lanes|=n,Bl|=n,e.baseState=!0),t)}function Js(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var i=ps.transition;ps.transition={};try{e(!1),t()}finally{bt=n,ps.transition=i}}function ea(){return Ts().memoizedState}function ta(e,t,n){var i=nc(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},ia(e))ra(t,n);else if(null!==(n=Po(e,t,n,i))){ic(n,e,i,tc()),oa(n,t,i)}}function na(e,t,n){var i=nc(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(ia(e))ra(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(r.hasEagerState=!0,r.eagerState=a,ai(a,s)){var l=t.interleaved;return null===l?(r.next=r,Eo(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(n=Po(e,t,r,i))&&(ic(n,e,i,r=tc()),oa(n,t,i))}}function ia(e){var t=e.alternate;return e===ms||null!==t&&t===ms}function ra(e,t){bs=vs=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function oa(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,vt(e,n)}}var sa={readContext:Co,useCallback:_s,useContext:_s,useEffect:_s,useImperativeHandle:_s,useInsertionEffect:_s,useLayoutEffect:_s,useMemo:_s,useReducer:_s,useRef:_s,useState:_s,useDebugValue:_s,useDeferredValue:_s,useTransition:_s,useMutableSource:_s,useSyncExternalStore:_s,useId:_s,unstable_isNewReconciler:!1},aa={readContext:Co,useCallback:function(e,t){return Cs().memoizedState=[e,void 0===t?null:t],e},useContext:Co,useEffect:Vs,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Hs(4194308,4,qs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Hs(4194308,4,e,t)},useInsertionEffect:function(e,t){return Hs(4,2,e,t)},useMemo:function(e,t){var n=Cs();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Cs();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=ta.bind(null,ms,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Cs().memoizedState=e},useState:Fs,useDebugValue:Ys,useDeferredValue:function(e){return Cs().memoizedState=e},useTransition:function(){var e=Fs(!1),t=e[0];return e=Js.bind(null,e[1]),Cs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=ms,r=Cs();if(ro){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Il)throw Error(o(349));0!==(30&fs)||ks(i,t,n)}r.memoizedState=n;var s={value:n,getSnapshot:t};return r.queue=s,Vs(Os.bind(null,i,s,e),[e]),i.flags|=2048,zs(9,Ds.bind(null,i,s,n,t),void 0,null),n},useId:function(){var e=Cs(),t=Il.identifierPrefix;if(ro){var n=Kr;t=":"+t+"R"+(n=(Zr&~(1<<32-st(Zr)-1)).toString(32)+n),0<(n=xs++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ws++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},la={readContext:Co,useCallback:Zs,useContext:Co,useEffect:js,useImperativeHandle:Xs,useInsertionEffect:$s,useLayoutEffect:Ws,useMemo:Ks,useReducer:Ps,useRef:Us,useState:function(){return Ps(Es)},useDebugValue:Ys,useDeferredValue:function(e){return Qs(Ts(),gs.memoizedState,e)},useTransition:function(){return[Ps(Es)[0],Ts().memoizedState]},useMutableSource:Ls,useSyncExternalStore:Rs,useId:ea,unstable_isNewReconciler:!1},ca={readContext:Co,useCallback:Zs,useContext:Co,useEffect:js,useImperativeHandle:Xs,useInsertionEffect:$s,useLayoutEffect:Ws,useMemo:Ks,useReducer:Is,useRef:Us,useState:function(){return Is(Es)},useDebugValue:Ys,useDeferredValue:function(e){var t=Ts();return null===gs?t.memoizedState=e:Qs(t,gs.memoizedState,e)},useTransition:function(){return[Is(Es)[0],Ts().memoizedState]},useMutableSource:Ls,useSyncExternalStore:Rs,useId:ea,unstable_isNewReconciler:!1};function ua(e,t){try{var n="",i=t;do{n+=H(i),i=i.return}while(i);var r=n}catch(o){r="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:r,digest:null}}function ha(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function da(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var pa="function"===typeof WeakMap?WeakMap:Map;function fa(e,t,n){(n=Do(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){$l||($l=!0,Wl=i),da(0,t)},n}function ma(e,t,n){(n=Do(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){da(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){da(0,t),"function"!==typeof i&&(null===ql?ql=new Set([this]):ql.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ga(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new pa;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Cc.bind(null,e,t,n),t.then(e,e))}function ya(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function va(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Do(-1,1)).tag=2,Oo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var ba=x.ReactCurrentOwner,xa=!1;function wa(e,t,n,i){t.child=null===e?Qo(t,null,n,i):Ko(t,e.child,n,i)}function _a(e,t,n,i,r){n=n.render;var o=t.ref;return Ao(t,r),i=Ms(e,t,n,i,o,r),n=As(),null===e||xa?(ro&&n&&eo(t),t.flags|=1,wa(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,$a(e,t,r))}function Sa(e,t,n,i,r){if(null===e){var o=n.type;return"function"!==typeof o||kc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Oc(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ma(e,t,o,i,r))}if(o=e.child,0===(e.lanes&r)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:li)(s,i)&&e.ref===t.ref)return $a(e,t,r)}return t.flags|=1,(e=Dc(o,i)).ref=t.ref,e.return=t,t.child=e}function Ma(e,t,n,i,r){if(null!==e){var o=e.memoizedProps;if(li(o,i)&&e.ref===t.ref){if(xa=!1,t.pendingProps=i=o,0===(e.lanes&r))return t.lanes=e.lanes,$a(e,t,r);0!==(131072&e.flags)&&(xa=!0)}}return Ta(e,t,n,i,r)}function Aa(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cr(Dl,kl),kl|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Cr(Dl,kl),kl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==o?o.baseLanes:n,Cr(Dl,kl),kl|=i}else null!==o?(i=o.baseLanes|n,t.memoizedState=null):i=n,Cr(Dl,kl),kl|=i;return wa(e,t,r,n),t.child}function Ca(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ta(e,t,n,i,r){var o=Rr(n)?Ir:Er.current;return o=Lr(t,o),Ao(t,r),n=Ms(e,t,n,i,o,r),i=As(),null===e||xa?(ro&&i&&eo(t),t.flags|=1,wa(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,$a(e,t,r))}function Ea(e,t,n,i,r){if(Rr(n)){var o=!0;Nr(t)}else o=!1;if(Ao(t,r),null===t.stateNode)ja(e,t),jo(t,n,i),Wo(t,n,i,r),i=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=Co(c):c=Lr(t,c=Rr(n)?Ir:Er.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate;h||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==i||l!==c)&&$o(t,s,i,c),Lo=!1;var d=t.memoizedState;s.state=d,Fo(t,i,s,r),l=t.memoizedState,a!==i||d!==l||Pr.current||Lo?("function"===typeof u&&(Ho(t,n,u,i),l=t.memoizedState),(a=Lo||Vo(t,n,a,i,d,l,c))?(h||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),s.props=i,s.state=l,s.context=c,i=a):("function"===typeof s.componentDidMount&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,ko(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:yo(t.type,a),s.props=c,h=t.pendingProps,d=s.context,"object"===typeof(l=n.contextType)&&null!==l?l=Co(l):l=Lr(t,l=Rr(n)?Ir:Er.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==h||d!==l)&&$o(t,s,i,l),Lo=!1,d=t.memoizedState,s.state=d,Fo(t,i,s,r);var f=t.memoizedState;a!==h||d!==f||Pr.current||Lo?("function"===typeof p&&(Ho(t,n,p,i),f=t.memoizedState),(c=Lo||Vo(t,n,c,i,d,f,l)||!1)?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(i,f,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),s.props=i,s.state=f,s.context=l,i=c):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return Pa(e,t,n,i,o,r)}function Pa(e,t,n,i,r,o){Ca(e,t);var s=0!==(128&t.flags);if(!i&&!s)return r&&Br(t,n,!1),$a(e,t,o);i=t.stateNode,ba.current=t;var a=s&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&s?(t.child=Ko(t,e.child,null,o),t.child=Ko(t,null,a,o)):wa(e,t,a,o),t.memoizedState=i.state,r&&Br(t,n,!0),t.child}function Ia(e){var t=e.stateNode;t.pendingContext?Dr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Dr(0,t.context,!1),rs(e,t.containerInfo)}function La(e,t,n,i,r){return fo(),mo(r),t.flags|=256,wa(e,t,n,i),t.child}var Ra,ka,Da,Oa,Na={dehydrated:null,treeContext:null,retryLane:0};function Ba(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fa(e,t,n){var i,r=t.pendingProps,s=ls.current,a=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&s)),i?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Cr(ls,1&s),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,a?(r=t.mode,a=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=Bc(l,r,0,null),e=Nc(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Ba(n),t.memoizedState=Na,e):za(t,l));if(null!==(s=e.memoizedState)&&null!==(i=s.dehydrated))return function(e,t,n,i,r,s,a){if(n)return 256&t.flags?(t.flags&=-257,Ua(e,t,a,i=ha(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=i.fallback,r=t.mode,i=Bc({mode:"visible",children:i.children},r,0,null),(s=Nc(s,r,a,null)).flags|=2,i.return=t,s.return=t,i.sibling=s,t.child=i,0!==(1&t.mode)&&Ko(t,e.child,null,a),t.child.memoizedState=Ba(a),t.memoizedState=Na,s);if(0===(1&t.mode))return Ua(e,t,a,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,Ua(e,t,a,i=ha(s=Error(o(419)),i,void 0))}if(l=0!==(a&e.childLanes),xa||l){if(null!==(i=Il)){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|a))?0:r)&&r!==s.retryLane&&(s.retryLane=r,Io(e,r),ic(i,e,r,-1))}return gc(),Ua(e,t,a,i=ha(Error(o(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Ec.bind(null,e),r._reactRetry=t,null):(e=s.treeContext,io=cr(r.nextSibling),no=t,ro=!0,oo=null,null!==e&&(qr[Xr++]=Zr,qr[Xr++]=Kr,qr[Xr++]=Yr,Zr=e.id,Kr=e.overflow,Yr=t),t=za(t,i.children),t.flags|=4096,t)}(e,t,l,r,i,s,n);if(a){a=r.fallback,l=t.mode,i=(s=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==s?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Dc(s,c)).subtreeFlags=14680064&s.subtreeFlags,null!==i?a=Dc(i,a):(a=Nc(a,l,n,null)).flags|=2,a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,l=null===(l=e.child.memoizedState)?Ba(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~n,t.memoizedState=Na,r}return e=(a=e.child).sibling,r=Dc(a,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function za(e,t){return(t=Bc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ua(e,t,n,i){return null!==i&&mo(i),Ko(t,e.child,null,n),(e=za(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ha(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Mo(e.return,t,n)}function Ga(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function Va(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(wa(e,t,i.children,n),0!==(2&(i=ls.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ha(e,n,t);else if(19===e.tag)Ha(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Cr(ls,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===cs(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Ga(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===cs(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Ga(t,!0,n,null,o);break;case"together":Ga(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ja(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function $a(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Bl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Dc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Wa(e,t){if(!ro)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function qa(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Xa(e,t,n){var i=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qa(t),null;case 1:case 17:return Rr(t.type)&&kr(),qa(t),null;case 3:return i=t.stateNode,os(),Ar(Pr),Ar(Er),hs(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(ac(oo),oo=null))),ka(e,t),qa(t),null;case 5:as(t);var r=is(ns.current);if(n=t.type,null!==e&&null!=t.stateNode)Da(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(o(166));return qa(t),null}if(e=is(es.current),ho(t)){i=t.stateNode,n=t.type;var s=t.memoizedProps;switch(i[dr]=t,i[pr]=s,e=0!==(1&t.mode),n){case"dialog":zi("cancel",i),zi("close",i);break;case"iframe":case"object":case"embed":zi("load",i);break;case"video":case"audio":for(r=0;r<Oi.length;r++)zi(Oi[r],i);break;case"source":zi("error",i);break;case"img":case"image":case"link":zi("error",i),zi("load",i);break;case"details":zi("toggle",i);break;case"input":Z(i,s),zi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},zi("invalid",i);break;case"textarea":re(i,s),zi("invalid",i)}for(var l in ve(n,s),r=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"===typeof c?i.textContent!==c&&(!0!==s.suppressHydrationWarning&&Qi(i.textContent,c,e),r=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&Qi(i.textContent,c,e),r=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&zi("scroll",i)}switch(n){case"input":W(i),J(i,s,!0);break;case"textarea":W(i),se(i);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(i.onclick=Ji)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[dr]=t,e[pr]=i,Ra(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,i),n){case"dialog":zi("cancel",e),zi("close",e),r=i;break;case"iframe":case"object":case"embed":zi("load",e),r=i;break;case"video":case"audio":for(r=0;r<Oi.length;r++)zi(Oi[r],e);r=i;break;case"source":zi("error",e),r=i;break;case"img":case"image":case"link":zi("error",e),zi("load",e),r=i;break;case"details":zi("toggle",e),r=i;break;case"input":Z(e,i),r=Y(e,i),zi("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=B({},i,{value:void 0}),zi("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),zi("invalid",e)}for(s in ve(n,r),c=r)if(c.hasOwnProperty(s)){var u=c[s];"style"===s?ge(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===s?"string"===typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"===typeof u&&de(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(a.hasOwnProperty(s)?null!=u&&"onScroll"===s&&zi("scroll",e):null!=u&&b(e,s,u,l))}switch(n){case"input":W(e),J(e,i,!1);break;case"textarea":W(e),se(e);break;case"option":null!=i.value&&e.setAttribute("value",""+j(i.value));break;case"select":e.multiple=!!i.multiple,null!=(s=i.value)?ne(e,!!i.multiple,s,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=Ji)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qa(t),null;case 6:if(e&&null!=t.stateNode)Oa(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(o(166));if(n=is(ns.current),is(es.current),ho(t)){if(i=t.stateNode,n=t.memoizedProps,i[dr]=t,(s=i.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Qi(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qi(i.nodeValue,n,0!==(1&e.mode))}s&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[dr]=t,t.stateNode=i}return qa(t),null;case 13:if(Ar(ls),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ro&&null!==io&&0!==(1&t.mode)&&0===(128&t.flags))po(),fo(),t.flags|=98560,s=!1;else if(s=ho(t),null!==i&&null!==i.dehydrated){if(null===e){if(!s)throw Error(o(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(o(317));s[dr]=t}else fo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qa(t),s=!1}else null!==oo&&(ac(oo),oo=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ls.current)?0===Ol&&(Ol=3):gc())),null!==t.updateQueue&&(t.flags|=4),qa(t),null);case 4:return os(),ka(e,t),null===e&&Gi(t.stateNode.containerInfo),qa(t),null;case 10:return So(t.type._context),qa(t),null;case 19:if(Ar(ls),null===(s=t.memoizedState))return qa(t),null;if(i=0!==(128&t.flags),null===(l=s.rendering))if(i)Wa(s,!1);else{if(0!==Ol||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=cs(e))){for(t.flags|=128,Wa(s,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(s=n).flags&=14680066,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Cr(ls,1&ls.current|2),t.child}e=e.sibling}null!==s.tail&&Ke()>Vl&&(t.flags|=128,i=!0,Wa(s,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=cs(l))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Wa(s,!0),null===s.tail&&"hidden"===s.tailMode&&!l.alternate&&!ro)return qa(t),null}else 2*Ke()-s.renderingStartTime>Vl&&1073741824!==n&&(t.flags|=128,i=!0,Wa(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=s.last)?n.sibling=l:t.child=l,s.last=l)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Ke(),t.sibling=null,n=ls.current,Cr(ls,i?1&n|2:1&n),t):(qa(t),null);case 22:case 23:return dc(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&kl)&&(qa(t),6&t.subtreeFlags&&(t.flags|=8192)):qa(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Ya(e,t){switch(to(t),t.tag){case 1:return Rr(t.type)&&kr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return os(),Ar(Pr),Ar(Er),hs(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return as(t),null;case 13:if(Ar(ls),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));fo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ar(ls),null;case 4:return os(),null;case 10:return So(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Ra=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},ka=function(){},Da=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,is(es.current);var o,s=null;switch(n){case"input":r=Y(e,r),i=Y(e,i),s=[];break;case"select":r=B({},r,{value:void 0}),i=B({},i,{value:void 0}),s=[];break;case"textarea":r=ie(e,r),i=ie(e,i),s=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=Ji)}for(u in ve(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&zi("scroll",e),s||l===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},Oa=function(e,t,n,i){n!==i&&(t.flags|=4)};var Za=!1,Ka=!1,Qa="function"===typeof WeakSet?WeakSet:Set,Ja=null;function el(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Ac(e,t,i)}else n.current=null}function tl(e,t,n){try{n()}catch(i){Ac(e,t,i)}}var nl=!1;function il(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,void 0!==o&&tl(t,n,o)}r=r.next}while(r!==i)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function ol(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[dr],delete t[pr],delete t[mr],delete t[gr],delete t[yr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Ji));else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}function ul(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}var hl=null,dl=!1;function pl(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(rt,n)}catch(a){}switch(n.tag){case 5:Ka||el(n,t);case 6:var i=hl,r=dl;hl=null,pl(e,t,n),dl=r,null!==(hl=i)&&(dl?(e=hl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):hl.removeChild(n.stateNode));break;case 18:null!==hl&&(dl?(e=hl,n=n.stateNode,8===e.nodeType?lr(e.parentNode,n):1===e.nodeType&&lr(e,n),Gt(e)):lr(hl,n.stateNode));break;case 4:i=hl,r=dl,hl=n.stateNode.containerInfo,dl=!0,pl(e,t,n),hl=i,dl=r;break;case 0:case 11:case 14:case 15:if(!Ka&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var o=r,s=o.destroy;o=o.tag,void 0!==s&&(0!==(2&o)||0!==(4&o))&&tl(n,t,s),r=r.next}while(r!==i)}pl(e,t,n);break;case 1:if(!Ka&&(el(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Ac(n,t,a)}pl(e,t,n);break;case 21:pl(e,t,n);break;case 22:1&n.mode?(Ka=(i=Ka)||null!==n.memoizedState,pl(e,t,n),Ka=i):pl(e,t,n);break;default:pl(e,t,n)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Qa),t.forEach((function(t){var i=Pc.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function gl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var s=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,dl=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===hl)throw Error(o(160));fl(s,a,r),hl=null,dl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(u){Ac(r,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)yl(t,e),t=t.sibling}function yl(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gl(t,e),vl(e),4&i){try{il(3,e,e.return),rl(3,e)}catch(g){Ac(e,e.return,g)}try{il(5,e,e.return)}catch(g){Ac(e,e.return,g)}}break;case 1:gl(t,e),vl(e),512&i&&null!==n&&el(n,n.return);break;case 5:if(gl(t,e),vl(e),512&i&&null!==n&&el(n,n.return),32&e.flags){var r=e.stateNode;try{de(r,"")}catch(g){Ac(e,e.return,g)}}if(4&i&&null!=(r=e.stateNode)){var s=e.memoizedProps,a=null!==n?n.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&K(r,s),be(l,a);var u=be(l,s);for(a=0;a<c.length;a+=2){var h=c[a],d=c[a+1];"style"===h?ge(r,d):"dangerouslySetInnerHTML"===h?he(r,d):"children"===h?de(r,d):b(r,h,d,u)}switch(l){case"input":Q(r,s);break;case"textarea":oe(r,s);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;null!=f?ne(r,!!s.multiple,f,!1):p!==!!s.multiple&&(null!=s.defaultValue?ne(r,!!s.multiple,s.defaultValue,!0):ne(r,!!s.multiple,s.multiple?[]:"",!1))}r[pr]=s}catch(g){Ac(e,e.return,g)}}break;case 6:if(gl(t,e),vl(e),4&i){if(null===e.stateNode)throw Error(o(162));r=e.stateNode,s=e.memoizedProps;try{r.nodeValue=s}catch(g){Ac(e,e.return,g)}}break;case 3:if(gl(t,e),vl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(g){Ac(e,e.return,g)}break;case 4:default:gl(t,e),vl(e);break;case 13:gl(t,e),vl(e),8192&(r=e.child).flags&&(s=null!==r.memoizedState,r.stateNode.isHidden=s,!s||null!==r.alternate&&null!==r.alternate.memoizedState||(Gl=Ke())),4&i&&ml(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Ka=(u=Ka)||h,gl(t,e),Ka=u):gl(t,e),vl(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!==(1&e.mode))for(Ja=e,h=e.child;null!==h;){for(d=Ja=h;null!==Ja;){switch(f=(p=Ja).child,p.tag){case 0:case 11:case 14:case 15:il(4,p,p.return);break;case 1:el(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){i=p,n=p.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Ac(i,n,g)}}break;case 5:el(p,p.return);break;case 22:if(null!==p.memoizedState){_l(d);continue}}null!==f?(f.return=p,Ja=f):_l(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{r=d.stateNode,u?"function"===typeof(s=r.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=d.stateNode,a=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",a))}catch(g){Ac(e,e.return,g)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(g){Ac(e,e.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:gl(t,e),vl(e),4&i&&ml(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var i=n;break e}n=n.return}throw Error(o(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(de(r,""),i.flags&=-33),ul(e,ll(e),r);break;case 3:case 4:var s=i.stateNode.containerInfo;cl(e,ll(e),s);break;default:throw Error(o(161))}}catch(a){Ac(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bl(e,t,n){Ja=e,xl(e,t,n)}function xl(e,t,n){for(var i=0!==(1&e.mode);null!==Ja;){var r=Ja,o=r.child;if(22===r.tag&&i){var s=null!==r.memoizedState||Za;if(!s){var a=r.alternate,l=null!==a&&null!==a.memoizedState||Ka;a=Za;var c=Ka;if(Za=s,(Ka=l)&&!c)for(Ja=r;null!==Ja;)l=(s=Ja).child,22===s.tag&&null!==s.memoizedState?Sl(r):null!==l?(l.return=s,Ja=l):Sl(r);for(;null!==o;)Ja=o,xl(o,t,n),o=o.sibling;Ja=r,Za=a,Ka=c}wl(e)}else 0!==(8772&r.subtreeFlags)&&null!==o?(o.return=r,Ja=o):wl(e)}}function wl(e){for(;null!==Ja;){var t=Ja;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ka||rl(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Ka)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:yo(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&zo(t,s,i);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}zo(t,a,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Gt(d)}}}break;default:throw Error(o(163))}Ka||512&t.flags&&ol(t)}catch(p){Ac(t,t.return,p)}}if(t===e){Ja=null;break}if(null!==(n=t.sibling)){n.return=t.return,Ja=n;break}Ja=t.return}}function _l(e){for(;null!==Ja;){var t=Ja;if(t===e){Ja=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Ja=n;break}Ja=t.return}}function Sl(e){for(;null!==Ja;){var t=Ja;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){Ac(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){Ac(t,r,l)}}var o=t.return;try{ol(t)}catch(l){Ac(t,o,l)}break;case 5:var s=t.return;try{ol(t)}catch(l){Ac(t,s,l)}}}catch(l){Ac(t,t.return,l)}if(t===e){Ja=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Ja=a;break}Ja=t.return}}var Ml,Al=Math.ceil,Cl=x.ReactCurrentDispatcher,Tl=x.ReactCurrentOwner,El=x.ReactCurrentBatchConfig,Pl=0,Il=null,Ll=null,Rl=0,kl=0,Dl=Mr(0),Ol=0,Nl=null,Bl=0,Fl=0,zl=0,Ul=null,Hl=null,Gl=0,Vl=1/0,jl=null,$l=!1,Wl=null,ql=null,Xl=!1,Yl=null,Zl=0,Kl=0,Ql=null,Jl=-1,ec=0;function tc(){return 0!==(6&Pl)?Ke():-1!==Jl?Jl:Jl=Ke()}function nc(e){return 0===(1&e.mode)?1:0!==(2&Pl)&&0!==Rl?Rl&-Rl:null!==go.transition?(0===ec&&(ec=mt()),ec):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Zt(e.type)}function ic(e,t,n,i){if(50<Kl)throw Kl=0,Ql=null,Error(o(185));yt(e,n,i),0!==(2&Pl)&&e===Il||(e===Il&&(0===(2&Pl)&&(Fl|=n),4===Ol&&lc(e,Rl)),rc(e,i),1===n&&0===Pl&&0===(1&t.mode)&&(Vl=Ke()+500,zr&&Gr()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-st(o),a=1<<s,l=r[s];-1===l?0!==(a&n)&&0===(a&i)||(r[s]=pt(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var i=dt(e,e===Il?Rl:0);if(0===i)null!==n&&Xe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Xe(n),1===t)0===e.tag?function(e){zr=!0,Hr(e)}(cc.bind(null,e)):Hr(cc.bind(null,e)),sr((function(){0===(6&Pl)&&Gr()})),n=null;else{switch(xt(i)){case 1:n=Je;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Ic(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if(Jl=-1,ec=0,0!==(6&Pl))throw Error(o(327));var n=e.callbackNode;if(Sc()&&e.callbackNode!==n)return null;var i=dt(e,e===Il?Rl:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=yc(e,i);else{t=i;var r=Pl;Pl|=2;var s=mc();for(Il===e&&Rl===t||(jl=null,Vl=Ke()+500,pc(e,t));;)try{bc();break}catch(l){fc(e,l)}_o(),Cl.current=s,Pl=r,null!==Ll?t=0:(Il=null,Rl=0,t=Ol)}if(0!==t){if(2===t&&(0!==(r=ft(e))&&(i=r,t=sc(e,r))),1===t)throw n=Nl,pc(e,0),lc(e,i),rc(e,Ke()),n;if(6===t)lc(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!ai(o(),r))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=yc(e,i))&&(0!==(s=ft(e))&&(i=s,t=sc(e,s))),1===t))throw n=Nl,pc(e,0),lc(e,i),rc(e,Ke()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(o(345));case 2:case 5:_c(e,Hl,jl);break;case 3:if(lc(e,i),(130023424&i)===i&&10<(t=Gl+500-Ke())){if(0!==dt(e,0))break;if(((r=e.suspendedLanes)&i)!==i){tc(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(_c.bind(null,e,Hl,jl),t);break}_c(e,Hl,jl);break;case 4:if(lc(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var a=31-st(i);s=1<<a,(a=t[a])>r&&(r=a),i&=~s}if(i=r,10<(i=(120>(i=Ke()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Al(i/1960))-i)){e.timeoutHandle=ir(_c.bind(null,e,Hl,jl),i);break}_c(e,Hl,jl);break;default:throw Error(o(329))}}}return rc(e,Ke()),e.callbackNode===n?oc.bind(null,e):null}function sc(e,t){var n=Ul;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=yc(e,t))&&(t=Hl,Hl=n,null!==t&&ac(t)),e}function ac(e){null===Hl?Hl=e:Hl.push.apply(Hl,e)}function lc(e,t){for(t&=~zl,t&=~Fl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),i=1<<n;e[n]=-1,t&=~i}}function cc(e){if(0!==(6&Pl))throw Error(o(327));Sc();var t=dt(e,0);if(0===(1&t))return rc(e,Ke()),null;var n=yc(e,t);if(0!==e.tag&&2===n){var i=ft(e);0!==i&&(t=i,n=sc(e,i))}if(1===n)throw n=Nl,pc(e,0),lc(e,t),rc(e,Ke()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,_c(e,Hl,jl),rc(e,Ke()),null}function uc(e,t){var n=Pl;Pl|=1;try{return e(t)}finally{0===(Pl=n)&&(Vl=Ke()+500,zr&&Gr())}}function hc(e){null!==Yl&&0===Yl.tag&&0===(6&Pl)&&Sc();var t=Pl;Pl|=1;var n=El.transition,i=bt;try{if(El.transition=null,bt=1,e)return e()}finally{bt=i,El.transition=n,0===(6&(Pl=t))&&Gr()}}function dc(){kl=Dl.current,Ar(Dl)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Ll)for(n=Ll.return;null!==n;){var i=n;switch(to(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&kr();break;case 3:os(),Ar(Pr),Ar(Er),hs();break;case 5:as(i);break;case 4:os();break;case 13:case 19:Ar(ls);break;case 10:So(i.type._context);break;case 22:case 23:dc()}n=n.return}if(Il=e,Ll=e=Dc(e.current,null),Rl=kl=t,Ol=0,Nl=null,zl=Fl=Bl=0,Hl=Ul=null,null!==To){for(t=0;t<To.length;t++)if(null!==(i=(n=To[t]).interleaved)){n.interleaved=null;var r=i.next,o=n.pending;if(null!==o){var s=o.next;o.next=r,i.next=s}n.pending=i}To=null}return e}function fc(e,t){for(;;){var n=Ll;try{if(_o(),ds.current=sa,vs){for(var i=ms.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}vs=!1}if(fs=0,ys=gs=ms=null,bs=!1,xs=0,Tl.current=null,null===n||null===n.return){Ol=1,Nl=t,Ll=null;break}e:{var s=e,a=n.return,l=n,c=t;if(t=Rl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=ya(a);if(null!==f){f.flags&=-257,va(f,a,l,0,t),1&f.mode&&ga(s,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){ga(s,u,t),gc();break e}c=Error(o(426))}else if(ro&&1&l.mode){var y=ya(a);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),va(y,a,l,0,t),mo(ua(c,l));break e}}s=c=ua(c,l),4!==Ol&&(Ol=2),null===Ul?Ul=[s]:Ul.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Bo(s,fa(0,c,t));break e;case 1:l=c;var v=s.type,b=s.stateNode;if(0===(128&s.flags)&&("function"===typeof v.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===ql||!ql.has(b)))){s.flags|=65536,t&=-t,s.lanes|=t,Bo(s,ma(s,l,t));break e}}s=s.return}while(null!==s)}wc(n)}catch(x){t=x,Ll===n&&null!==n&&(Ll=n=n.return);continue}break}}function mc(){var e=Cl.current;return Cl.current=sa,null===e?sa:e}function gc(){0!==Ol&&3!==Ol&&2!==Ol||(Ol=4),null===Il||0===(268435455&Bl)&&0===(268435455&Fl)||lc(Il,Rl)}function yc(e,t){var n=Pl;Pl|=2;var i=mc();for(Il===e&&Rl===t||(jl=null,pc(e,t));;)try{vc();break}catch(r){fc(e,r)}if(_o(),Pl=n,Cl.current=i,null!==Ll)throw Error(o(261));return Il=null,Rl=0,Ol}function vc(){for(;null!==Ll;)xc(Ll)}function bc(){for(;null!==Ll&&!Ye();)xc(Ll)}function xc(e){var t=Ml(e.alternate,e,kl);e.memoizedProps=e.pendingProps,null===t?wc(e):Ll=t,Tl.current=null}function wc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Xa(n,t,kl)))return void(Ll=n)}else{if(null!==(n=Ya(n,t)))return n.flags&=32767,void(Ll=n);if(null===e)return Ol=6,void(Ll=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ll=t);Ll=t=e}while(null!==t);0===Ol&&(Ol=5)}function _c(e,t,n){var i=bt,r=El.transition;try{El.transition=null,bt=1,function(e,t,n,i){do{Sc()}while(null!==Yl);if(0!==(6&Pl))throw Error(o(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-st(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}(e,s),e===Il&&(Ll=Il=null,Rl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Xl||(Xl=!0,Ic(tt,(function(){return Sc(),null}))),s=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||s){s=El.transition,El.transition=null;var a=bt;bt=1;var l=Pl;Pl|=4,Tl.current=null,function(e,t){if(er=jt,pi(e=di())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch(w){n=null;break e}var a=0,l=-1,c=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==r&&3!==d.nodeType||(l=a+r),d!==s||0!==i&&3!==d.nodeType||(c=a+i),3===d.nodeType&&(a+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++u===r&&(l=a),p===s&&++h===i&&(c=a),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},jt=!1,Ja=t;null!==Ja;)if(e=(t=Ja).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Ja=e;else for(;null!==Ja;){t=Ja;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,y=m.memoizedState,v=t.stateNode,b=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:yo(t.type,g),y);v.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(o(163))}}catch(w){Ac(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Ja=e;break}Ja=t.return}m=nl,nl=!1}(e,n),yl(n,e),fi(tr),jt=!!er,tr=er=null,e.current=n,bl(n,e,r),Ze(),Pl=l,bt=a,El.transition=s}else e.current=n;if(Xl&&(Xl=!1,Yl=e,Zl=r),s=e.pendingLanes,0===s&&(ql=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Ke()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if($l)throw $l=!1,e=Wl,Wl=null,e;0!==(1&Zl)&&0!==e.tag&&Sc(),s=e.pendingLanes,0!==(1&s)?e===Ql?Kl++:(Kl=0,Ql=e):Kl=0,Gr()}(e,t,n,i)}finally{El.transition=r,bt=i}return null}function Sc(){if(null!==Yl){var e=xt(Zl),t=El.transition,n=bt;try{if(El.transition=null,bt=16>e?16:e,null===Yl)var i=!1;else{if(e=Yl,Yl=null,Zl=0,0!==(6&Pl))throw Error(o(331));var r=Pl;for(Pl|=4,Ja=e.current;null!==Ja;){var s=Ja,a=s.child;if(0!==(16&Ja.flags)){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Ja=u;null!==Ja;){var h=Ja;switch(h.tag){case 0:case 11:case 15:il(8,h,s)}var d=h.child;if(null!==d)d.return=h,Ja=d;else for(;null!==Ja;){var p=(h=Ja).sibling,f=h.return;if(sl(h),h===u){Ja=null;break}if(null!==p){p.return=f,Ja=p;break}Ja=f}}}var m=s.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}Ja=s}}if(0!==(2064&s.subtreeFlags)&&null!==a)a.return=s,Ja=a;else e:for(;null!==Ja;){if(0!==(2048&(s=Ja).flags))switch(s.tag){case 0:case 11:case 15:il(9,s,s.return)}var v=s.sibling;if(null!==v){v.return=s.return,Ja=v;break e}Ja=s.return}}var b=e.current;for(Ja=b;null!==Ja;){var x=(a=Ja).child;if(0!==(2064&a.subtreeFlags)&&null!==x)x.return=a,Ja=x;else e:for(a=b;null!==Ja;){if(0!==(2048&(l=Ja).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(_){Ac(l,l.return,_)}if(l===a){Ja=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Ja=w;break e}Ja=l.return}}if(Pl=r,Gr(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(rt,e)}catch(_){}i=!0}return i}finally{bt=n,El.transition=t}}return!1}function Mc(e,t,n){e=Oo(e,t=fa(0,t=ua(n,t),1),1),t=tc(),null!==e&&(yt(e,1,t),rc(e,t))}function Ac(e,t,n){if(3===e.tag)Mc(e,e,n);else for(;null!==t;){if(3===t.tag){Mc(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===ql||!ql.has(i))){t=Oo(t,e=ma(t,e=ua(n,e),1),1),e=tc(),null!==t&&(yt(t,1,e),rc(t,e));break}}t=t.return}}function Cc(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,Il===e&&(Rl&n)===n&&(4===Ol||3===Ol&&(130023424&Rl)===Rl&&500>Ke()-Gl?pc(e,0):zl|=n),rc(e,t)}function Tc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=tc();null!==(e=Io(e,t))&&(yt(e,t,n),rc(e,n))}function Ec(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Tc(e,n)}function Pc(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(o(314))}null!==i&&i.delete(t),Tc(e,n)}function Ic(e,t){return qe(e,t)}function Lc(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rc(e,t,n,i){return new Lc(e,t,n,i)}function kc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dc(e,t){var n=e.alternate;return null===n?((n=Rc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Oc(e,t,n,i,r,s){var a=2;if(i=e,"function"===typeof e)kc(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case S:return Nc(n.children,r,s,t);case M:a=8,r|=8;break;case A:return(e=Rc(12,n,t,2|r)).elementType=A,e.lanes=s,e;case P:return(e=Rc(13,n,t,r)).elementType=P,e.lanes=s,e;case I:return(e=Rc(19,n,t,r)).elementType=I,e.lanes=s,e;case k:return Bc(n,r,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:a=10;break e;case T:a=9;break e;case E:a=11;break e;case L:a=14;break e;case R:a=16,i=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Rc(a,n,t,r)).elementType=e,t.type=i,t.lanes=s,t}function Nc(e,t,n,i){return(e=Rc(7,e,i,t)).lanes=n,e}function Bc(e,t,n,i){return(e=Rc(22,e,i,t)).elementType=k,e.lanes=n,e.stateNode={isHidden:!1},e}function Fc(e,t,n){return(e=Rc(6,e,null,t)).lanes=n,e}function zc(e,t,n){return(t=Rc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Uc(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Hc(e,t,n,i,r,o,s,a,l){return e=new Uc(e,t,n,a,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Rc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ro(o),e}function Gc(e){if(!e)return Tr;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Rr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Rr(n))return Or(e,n,t)}return t}function Vc(e,t,n,i,r,o,s,a,l){return(e=Hc(n,i,!0,e,0,o,0,a,l)).context=Gc(null),n=e.current,(o=Do(i=tc(),r=nc(n))).callback=void 0!==t&&null!==t?t:null,Oo(n,o,r),e.current.lanes=r,yt(e,r,i),rc(e,i),e}function jc(e,t,n,i){var r=t.current,o=tc(),s=nc(r);return n=Gc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Do(o,s)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Oo(r,t,s))&&(ic(e,r,s,o),No(e,r,s)),s}function $c(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function qc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}Ml=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Pr.current)xa=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xa=!1,function(e,t,n){switch(t.tag){case 3:Ia(t),fo();break;case 5:ss(t);break;case 1:Rr(t.type)&&Nr(t);break;case 4:rs(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Cr(vo,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Cr(ls,1&ls.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fa(e,t,n):(Cr(ls,1&ls.current),null!==(e=$a(e,t,n))?e.sibling:null);Cr(ls,1&ls.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Va(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Cr(ls,ls.current),i)break;return null;case 22:case 23:return t.lanes=0,Aa(e,t,n)}return $a(e,t,n)}(e,t,n);xa=0!==(131072&e.flags)}else xa=!1,ro&&0!==(1048576&t.flags)&&Jr(t,Wr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;ja(e,t),e=t.pendingProps;var r=Lr(t,Er.current);Ao(t,n),r=Ms(null,t,i,e,r,n);var s=As();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Rr(i)?(s=!0,Nr(t)):s=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Ro(t),r.updater=Go,t.stateNode=r,r._reactInternals=t,Wo(t,i,e,n),t=Pa(null,t,i,!0,s,n)):(t.tag=0,ro&&s&&eo(t),wa(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(ja(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return kc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===L)return 14}return 2}(i),e=yo(i,e),r){case 0:t=Ta(null,t,i,e,n);break e;case 1:t=Ea(null,t,i,e,n);break e;case 11:t=_a(null,t,i,e,n);break e;case 14:t=Sa(null,t,i,yo(i.type,e),n);break e}throw Error(o(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Ta(e,t,i,r=t.elementType===i?r:yo(i,r),n);case 1:return i=t.type,r=t.pendingProps,Ea(e,t,i,r=t.elementType===i?r:yo(i,r),n);case 3:e:{if(Ia(t),null===e)throw Error(o(387));i=t.pendingProps,r=(s=t.memoizedState).element,ko(e,t),Fo(t,i,null,n);var a=t.memoizedState;if(i=a.element,s.isDehydrated){if(s={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=La(e,t,i,n,r=ua(Error(o(423)),t));break e}if(i!==r){t=La(e,t,i,n,r=ua(Error(o(424)),t));break e}for(io=cr(t.stateNode.containerInfo.firstChild),no=t,ro=!0,oo=null,n=Qo(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fo(),i===r){t=$a(e,t,n);break e}wa(e,t,i,n)}t=t.child}return t;case 5:return ss(t),null===e&&co(t),i=t.type,r=t.pendingProps,s=null!==e?e.memoizedProps:null,a=r.children,nr(i,r)?a=null:null!==s&&nr(i,s)&&(t.flags|=32),Ca(e,t),wa(e,t,a,n),t.child;case 6:return null===e&&co(t),null;case 13:return Fa(e,t,n);case 4:return rs(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Ko(t,null,i,n):wa(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,_a(e,t,i,r=t.elementType===i?r:yo(i,r),n);case 7:return wa(e,t,t.pendingProps,n),t.child;case 8:case 12:return wa(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,s=t.memoizedProps,a=r.value,Cr(vo,i._currentValue),i._currentValue=a,null!==s)if(ai(s.value,a)){if(s.children===r.children&&!Pr.current){t=$a(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){a=s.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===s.tag){(c=Do(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Mo(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(o(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Mo(a,n,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}wa(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Ao(t,n),i=i(r=Co(r)),t.flags|=1,wa(e,t,i,n),t.child;case 14:return r=yo(i=t.type,t.pendingProps),Sa(e,t,i,r=yo(i.type,r),n);case 15:return Ma(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:yo(i,r),ja(e,t),t.tag=1,Rr(i)?(e=!0,Nr(t)):e=!1,Ao(t,n),jo(t,i,r),Wo(t,i,r,n),Pa(null,t,i,!0,e,n);case 19:return Va(e,t,n);case 22:return Aa(e,t,n)}throw Error(o(156,t.tag))};var Xc="function"===typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Zc(e){this._internalRoot=e}function Kc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function eu(e,t,n,i,r){var o=n._reactRootContainer;if(o){var s=o;if("function"===typeof r){var a=r;r=function(){var e=$c(s);a.call(e)}}jc(t,s,e,r)}else s=function(e,t,n,i,r){if(r){if("function"===typeof i){var o=i;i=function(){var e=$c(s);o.call(e)}}var s=Vc(t,i,e,0,null,!1,0,"",Jc);return e._reactRootContainer=s,e[fr]=s.current,Gi(8===e.nodeType?e.parentNode:e),hc(),s}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var a=i;i=function(){var e=$c(l);a.call(e)}}var l=Hc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[fr]=l.current,Gi(8===e.nodeType?e.parentNode:e),hc((function(){jc(t,l,n,i)})),l}(n,t,e,r,i);return $c(s)}Zc.prototype.render=Yc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));jc(e,t,null,null)},Zc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hc((function(){jc(null,e,null,null)})),t[fr]=null}},Zc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Mt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<kt.length&&0!==t&&t<kt[n].priority;n++);kt.splice(n,0,e),0===n&&Bt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(vt(t,1|n),rc(t,Ke()),0===(6&Pl)&&(Vl=Ke()+500,Gr()))}break;case 13:hc((function(){var t=Io(e,1);if(null!==t){var n=tc();ic(t,e,1,n)}})),qc(e,1)}},_t=function(e){if(13===e.tag){var t=Io(e,134217728);if(null!==t)ic(t,e,134217728,tc());qc(e,134217728)}},St=function(e){if(13===e.tag){var t=nc(e),n=Io(e,t);if(null!==n)ic(n,e,t,tc());qc(e,t)}},Mt=function(){return bt},At=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},_e=function(e,t,n){switch(t){case"input":if(Q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=wr(i);if(!r)throw Error(o(90));q(i),Q(i,r)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ee=uc,Pe=hc;var tu={usingClientEntryPoint:!1,Events:[br,xr,wr,Ce,Te,uc]},nu={findFiberByHostInstance:vr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},iu={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=$e(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{rt=ru.inject(iu),ot=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(t))throw Error(o(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:_,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Kc(e))throw Error(o(299));var n=!1,i="",r=Xc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Hc(e,1,!1,null,0,n,0,i,r),e[fr]=t.current,Gi(8===e.nodeType?e.parentNode:e),new Yc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=$e(t))?null:e.stateNode},t.flushSync=function(e){return hc(e)},t.hydrate=function(e,t,n){if(!Qc(t))throw Error(o(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Kc(e))throw Error(o(405));var i=null!=n&&n.hydratedSources||null,r=!1,s="",a=Xc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=Vc(t,null,e,1,null!=n?n:null,r,0,s,a),e[fr]=t.current,Gi(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Zc(t)},t.render=function(e,t,n){if(!Qc(t))throw Error(o(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Qc(e))throw Error(o(40));return!!e._reactRootContainer&&(hc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[fr]=null}))})),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Qc(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return eu(e,t,n,!1,i)},t.version="18.2.0-next-9e3b772b8-20220608"},250:(e,t,n)=>{"use strict";var i=n(164);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},164:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(463)},374:(e,t,n)=>{"use strict";var i=n(791),r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,o={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,i)&&!l.hasOwnProperty(i)&&(o[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===o[i]&&(o[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:u,props:o,_owner:a.current}}t.jsx=c,t.jsxs=c},117:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function v(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var x=b.prototype=new v;x.constructor=b,m(x,y.prototype),x.isPureReactComponent=!0;var w=Array.isArray,_=Object.prototype.hasOwnProperty,S={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function A(e,t,i){var r,o={},s=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)_.call(t,r)&&!M.hasOwnProperty(r)&&(o[r]=t[r]);var l=arguments.length-2;if(1===l)o.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===o[r]&&(o[r]=l[r]);return{$$typeof:n,type:e,key:s,ref:a,props:o,_owner:S.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var T=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function P(e,t,r,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return s=s(l=e),e=""===o?"."+E(l,0):o,w(s)?(r="",null!=e&&(r=e.replace(T,"$&/")+"/"),P(s,t,r,"",(function(e){return e}))):null!=s&&(C(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,r+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(T,"$&/")+"/")+e)),t.push(s)),1;if(l=0,o=""===o?".":o+":",w(e))for(var c=0;c<e.length;c++){var u=o+E(a=e[c],c);l+=P(a,t,r,u,s)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(a=e.next()).done;)l+=P(a=a.value,t,r,u=o+E(a,c++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function I(e,t,n){if(null==e)return e;var i=[],r=0;return P(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function L(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R={current:null},k={transition:null},D={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:k,ReactCurrentOwner:S};t.Children={map:I,forEach:function(e,t,n){I(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return I(e,(function(){t++})),t},toArray:function(e){return I(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=r,t.Profiler=s,t.PureComponent=b,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),o=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=S.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)_.call(t,c)&&!M.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:n,type:e.type,key:o,ref:s,props:r,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=A,t.createFactory=function(e){var t=A.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:L}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=k.transition;k.transition={};try{e()}finally{k.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return R.current.useCallback(e,t)},t.useContext=function(e){return R.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return R.current.useDeferredValue(e)},t.useEffect=function(e,t){return R.current.useEffect(e,t)},t.useId=function(){return R.current.useId()},t.useImperativeHandle=function(e,t,n){return R.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return R.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return R.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return R.current.useMemo(e,t)},t.useReducer=function(e,t,n){return R.current.useReducer(e,t,n)},t.useRef=function(e){return R.current.useRef(e)},t.useState=function(e){return R.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return R.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return R.current.useTransition()},t.version="18.2.0"},791:(e,t,n)=>{"use strict";e.exports=n(117)},184:(e,t,n)=>{"use strict";e.exports=n(374)},813:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<o(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,s=r>>>1;i<s;){var a=2*(i+1)-1,l=e[a],c=a+1,u=e[c];if(0>o(l,n))c<r&&0>o(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[a]=n,i=a);else{if(!(c<r&&0>o(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function w(e){if(g=!1,x(e),!m)if(null!==i(c))m=!0,k(_);else{var t=i(u);null!==t&&D(w,t.startTime-e)}}function _(e,n){m=!1,g&&(g=!1,v(C),C=-1),f=!0;var o=p;try{for(x(n),d=i(c);null!==d&&(!(d.expirationTime>n)||e&&!P());){var s=d.callback;if("function"===typeof s){d.callback=null,p=d.priorityLevel;var a=s(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?d.callback=a:d===i(c)&&r(c),x(n)}else r(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&D(w,h.startTime-n),l=!1}return l}finally{d=null,p=o,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,M=!1,A=null,C=-1,T=5,E=-1;function P(){return!(t.unstable_now()-E<T)}function I(){if(null!==A){var e=t.unstable_now();E=e;var n=!0;try{n=A(!0,e)}finally{n?S():(M=!1,A=null)}}else M=!1}if("function"===typeof b)S=function(){b(I)};else if("undefined"!==typeof MessageChannel){var L=new MessageChannel,R=L.port2;L.port1.onmessage=I,S=function(){R.postMessage(null)}}else S=function(){y(I,0)};function k(e){A=e,M||(M=!0,S())}function D(e,n){C=y((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,k(_))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===i(c)&&e===i(u)&&(g?(v(C),C=-1):g=!0,D(w,o-s))):(e.sortIndex=a,n(c,e),m||f||(m=!0,k(_))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},296:(e,t,n)=>{"use strict";e.exports=n(813)},613:e=>{e.exports=function(e,t,n,i){var r=n?n.call(i,e,t):void 0;if(void 0!==r)return!!r;if(e===t)return!0;if("object"!==typeof e||!e||"object"!==typeof t||!t)return!1;var o=Object.keys(e),s=Object.keys(t);if(o.length!==s.length)return!1;for(var a=Object.prototype.hasOwnProperty.bind(t),l=0;l<o.length;l++){var c=o[l];if(!a(c))return!1;var u=e[c],h=t[c];if(!1===(r=n?n.call(i,u,h,c):void 0)||void 0===r&&u!==h)return!1}return!0}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0,(()=>{"use strict";var e=n(791),t=n(250),i=n(764),r=n(184);const o=function(t){let{representation:n,mask:o,componentFile:s}=t;const a=(0,e.useRef)(null),[l,c]=(0,e.useState)("");return(0,e.useEffect)((()=>{const e=new i.Stage("viewport");return a.current=e,()=>{a.current&&a.current.dispose()}}),[]),(0,e.useEffect)((()=>{void 0!==s&&(a.current.removeAllComponents(),a.current.loadFile(s,{ext:"pdb"}).then((e=>{e.structureView.hideAtoms=o.hideAtoms,e.structureView.extraBonds=o.extraBonds,e.structureView.showAtoms=o.showAtoms,e.addRepresentation(n),a.current.autoView()})))}),[s]),(0,e.useEffect)((()=>{if(a.current&&a.current.compList.length>0){const e=a.current.compList[0];e.reprList.length>0&&e.removeAllRepresentations(),e.addRepresentation(n),e.autoView()}}),[n]),(0,e.useEffect)((()=>{if(a.current&&a.current.compList.length>0){const e=a.current.compList[0];e.structureView.hideAtoms=o.hideAtoms,e.structureView.showAtoms=o.showAtoms,e.structureView.extraBonds=o.extraBonds,e.reprList.length>0&&e.removeAllRepresentations(),e.addRepresentation(n)}}),[o]),(0,r.jsx)("div",{children:(0,r.jsx)("div",{id:"viewport",style:{width:"100%",height:"500px"}})})};function s(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var a=function(){return a=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},a.apply(this,arguments)};Object.create;function l(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}Object.create;var c=n(613),u=n.n(c),h="-ms-",d="-moz-",p="-webkit-",f="comm",m="rule",g="decl",y="@import",v="@keyframes",b="@layer",x=Math.abs,w=String.fromCharCode,_=Object.assign;function S(e){return e.trim()}function M(e,t){return(e=t.exec(e))?e[0]:e}function A(e,t,n){return e.replace(t,n)}function C(e,t,n){return e.indexOf(t,n)}function T(e,t){return 0|e.charCodeAt(t)}function E(e,t,n){return e.slice(t,n)}function P(e){return e.length}function I(e){return e.length}function L(e,t){return t.push(e),e}function R(e,t){return e.filter((function(e){return!M(e,t)}))}var k=1,D=1,O=0,N=0,B=0,F="";function z(e,t,n,i,r,o,s,a){return{value:e,root:t,parent:n,type:i,props:r,children:o,line:k,column:D,length:s,return:"",siblings:a}}function U(e,t){return _(z("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function H(e){for(;e.root;)e=U(e.root,{children:[e]});L(e,e.siblings)}function G(){return B=N>0?T(F,--N):0,D--,10===B&&(D=1,k--),B}function V(){return B=N<O?T(F,N++):0,D++,10===B&&(D=1,k++),B}function j(){return T(F,N)}function $(){return N}function W(e,t){return E(F,e,t)}function q(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function X(e){return k=D=1,O=P(F=e),N=0,[]}function Y(e){return F="",e}function Z(e){return S(W(N-1,J(91===e?e+2:40===e?e+1:e)))}function K(e){for(;(B=j())&&B<33;)V();return q(e)>2||q(B)>3?"":" "}function Q(e,t){for(;--t&&V()&&!(B<48||B>102||B>57&&B<65||B>70&&B<97););return W(e,$()+(t<6&&32==j()&&32==V()))}function J(e){for(;V();)switch(B){case e:return N;case 34:case 39:34!==e&&39!==e&&J(B);break;case 40:41===e&&J(e);break;case 92:V()}return N}function ee(e,t){for(;V()&&e+B!==57&&(e+B!==84||47!==j()););return"/*"+W(t,N-1)+"*"+w(47===e?e:V())}function te(e){for(;!q(j());)V();return W(e,N)}function ne(e,t){for(var n="",i=0;i<e.length;i++)n+=t(e[i],i,e,t)||"";return n}function ie(e,t,n,i){switch(e.type){case b:if(e.children.length)break;case y:case g:return e.return=e.return||e.value;case f:return"";case v:return e.return=e.value+"{"+ne(e.children,i)+"}";case m:if(!P(e.value=e.props.join(",")))return""}return P(n=ne(e.children,i))?e.return=e.value+"{"+n+"}":""}function re(e,t,n){switch(function(e,t){return 45^T(e,0)?(((t<<2^T(e,0))<<2^T(e,1))<<2^T(e,2))<<2^T(e,3):0}(e,t)){case 5103:return p+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return p+e+e;case 4789:return d+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return p+e+d+e+h+e+e;case 5936:switch(T(e,t+11)){case 114:return p+e+h+A(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return p+e+h+A(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return p+e+h+A(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return p+e+h+e+e;case 6165:return p+e+h+"flex-"+e+e;case 5187:return p+e+A(e,/(\w+).+(:[^]+)/,p+"box-$1$2"+h+"flex-$1$2")+e;case 5443:return p+e+h+"flex-item-"+A(e,/flex-|-self/g,"")+(M(e,/flex-|baseline/)?"":h+"grid-row-"+A(e,/flex-|-self/g,""))+e;case 4675:return p+e+h+"flex-line-pack"+A(e,/align-content|flex-|-self/g,"")+e;case 5548:return p+e+h+A(e,"shrink","negative")+e;case 5292:return p+e+h+A(e,"basis","preferred-size")+e;case 6060:return p+"box-"+A(e,"-grow","")+p+e+h+A(e,"grow","positive")+e;case 4554:return p+A(e,/([^-])(transform)/g,"$1"+p+"$2")+e;case 6187:return A(A(A(e,/(zoom-|grab)/,p+"$1"),/(image-set)/,p+"$1"),e,"")+e;case 5495:case 3959:return A(e,/(image-set\([^]*)/,p+"$1$`$1");case 4968:return A(A(e,/(.+:)(flex-)?(.*)/,p+"box-pack:$3"+h+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+p+e+e;case 4200:if(!M(e,/flex-|baseline/))return h+"grid-column-align"+E(e,t)+e;break;case 2592:case 3360:return h+A(e,"template-","")+e;case 4384:case 3616:return n&&n.some((function(e,n){return t=n,M(e.props,/grid-\w+-end/)}))?~C(e+(n=n[t].value),"span",0)?e:h+A(e,"-start","")+e+h+"grid-row-span:"+(~C(n,"span",0)?M(n,/\d+/):+M(n,/\d+/)-+M(e,/\d+/))+";":h+A(e,"-start","")+e;case 4896:case 4128:return n&&n.some((function(e){return M(e.props,/grid-\w+-start/)}))?e:h+A(A(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return A(e,/(.+)-inline(.+)/,p+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(P(e)-1-t>6)switch(T(e,t+1)){case 109:if(45!==T(e,t+4))break;case 102:return A(e,/(.+:)(.+)-([^]+)/,"$1"+p+"$2-$3$1"+d+(108==T(e,t+3)?"$3":"$2-$3"))+e;case 115:return~C(e,"stretch",0)?re(A(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return A(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,(function(t,n,i,r,o,s,a){return h+n+":"+i+a+(r?h+n+"-span:"+(o?s:+s-+i)+a:"")+e}));case 4949:if(121===T(e,t+6))return A(e,":",":"+p)+e;break;case 6444:switch(T(e,45===T(e,14)?18:11)){case 120:return A(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+p+(45===T(e,14)?"inline-":"")+"box$3$1"+p+"$2$3$1"+h+"$2box$3")+e;case 100:return A(e,":",":"+h)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return A(e,"scroll-","scroll-snap-")+e}return e}function oe(e,t,n,i){if(e.length>-1&&!e.return)switch(e.type){case g:return void(e.return=re(e.value,e.length,n));case v:return ne([U(e,{value:A(e.value,"@","@"+p)})],i);case m:if(e.length)return function(e,t){return e.map(t).join("")}(n=e.props,(function(t){switch(M(t,i=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":H(U(e,{props:[A(t,/:(read-\w+)/,":"+d+"$1")]})),H(U(e,{props:[t]})),_(e,{props:R(n,i)});break;case"::placeholder":H(U(e,{props:[A(t,/:(plac\w+)/,":"+p+"input-$1")]})),H(U(e,{props:[A(t,/:(plac\w+)/,":"+d+"$1")]})),H(U(e,{props:[A(t,/:(plac\w+)/,h+"input-$1")]})),H(U(e,{props:[t]})),_(e,{props:R(n,i)})}return""}))}}function se(e){return Y(ae("",null,null,null,[""],e=X(e),0,[0],e))}function ae(e,t,n,i,r,o,s,a,l){for(var c=0,u=0,h=s,d=0,p=0,f=0,m=1,g=1,y=1,v=0,b="",_=r,S=o,M=i,E=b;g;)switch(f=v,v=V()){case 40:if(108!=f&&58==T(E,h-1)){-1!=C(E+=A(Z(v),"&","&\f"),"&\f",x(c?a[c-1]:0))&&(y=-1);break}case 34:case 39:case 91:E+=Z(v);break;case 9:case 10:case 13:case 32:E+=K(f);break;case 92:E+=Q($()-1,7);continue;case 47:switch(j()){case 42:case 47:L(ce(ee(V(),$()),t,n,l),l);break;default:E+="/"}break;case 123*m:a[c++]=P(E)*y;case 125*m:case 59:case 0:switch(v){case 0:case 125:g=0;case 59+u:-1==y&&(E=A(E,/\f/g,"")),p>0&&P(E)-h&&L(p>32?ue(E+";",i,n,h-1,l):ue(A(E," ","")+";",i,n,h-2,l),l);break;case 59:E+=";";default:if(L(M=le(E,t,n,c,u,r,a,b,_=[],S=[],h,o),o),123===v)if(0===u)ae(E,t,M,M,_,o,h,a,S);else switch(99===d&&110===T(E,3)?100:d){case 100:case 108:case 109:case 115:ae(e,M,M,i&&L(le(e,M,M,0,0,r,a,b,r,_=[],h,S),S),r,S,h,a,i?_:S);break;default:ae(E,M,M,M,[""],S,0,a,S)}}c=u=p=0,m=y=1,b=E="",h=s;break;case 58:h=1+P(E),p=f;default:if(m<1)if(123==v)--m;else if(125==v&&0==m++&&125==G())continue;switch(E+=w(v),v*m){case 38:y=u>0?1:(E+="\f",-1);break;case 44:a[c++]=(P(E)-1)*y,y=1;break;case 64:45===j()&&(E+=Z(V())),d=j(),u=h=P(b=E+=te($())),v++;break;case 45:45===f&&2==P(E)&&(m=0)}}return o}function le(e,t,n,i,r,o,s,a,l,c,u,h){for(var d=r-1,p=0===r?o:[""],f=I(p),g=0,y=0,v=0;g<i;++g)for(var b=0,w=E(e,d+1,d=x(y=s[g])),_=e;b<f;++b)(_=S(y>0?p[b]+" "+w:A(w,/&\f/g,p[b])))&&(l[v++]=_);return z(e,t,n,0===r?m:a,l,c,u,h)}function ce(e,t,n,i){return z(e,t,n,f,w(B),E(e,2,-2),0,i)}function ue(e,t,n,i,r){return z(e,t,n,g,E(e,0,i),E(e,i+1,-1),i,r)}const he={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1};var de="undefined"!=typeof process&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}&&({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_ATTR||{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_ATTR)||"data-styled",pe="active",fe="data-styled-version",me="6.1.8",ge="/*!sc*/\n",ye="undefined"!=typeof window&&"HTMLElement"in window,ve=Boolean("boolean"==typeof SC_DISABLE_SPEEDY?SC_DISABLE_SPEEDY:"undefined"!=typeof process&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY&&""!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY?"false"!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY&&{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY:"undefined"!=typeof process&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY&&""!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY&&("false"!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY&&{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY)),be=(new Set,Object.freeze([])),xe=Object.freeze({});function we(e,t,n){return void 0===n&&(n=xe),e.theme!==n.theme&&e.theme||t||n.theme}var _e=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),Se=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,Me=/(^-|-$)/g;function Ae(e){return e.replace(Se,"-").replace(Me,"")}var Ce=/(a)(d)/gi,Te=52,Ee=function(e){return String.fromCharCode(e+(e>25?39:97))};function Pe(e){var t,n="";for(t=Math.abs(e);t>Te;t=t/Te|0)n=Ee(t%Te)+n;return(Ee(t%Te)+n).replace(Ce,"$1-$2")}var Ie,Le=5381,Re=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},ke=function(e){return Re(Le,e)};function De(e){return Pe(ke(e)>>>0)}function Oe(e){return e.displayName||e.name||"Component"}function Ne(e){return"string"==typeof e&&!0}var Be="function"==typeof Symbol&&Symbol.for,Fe=Be?Symbol.for("react.memo"):60115,ze=Be?Symbol.for("react.forward_ref"):60112,Ue={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},He={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},Ge={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Ve=((Ie={})[ze]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Ie[Fe]=Ge,Ie);function je(e){return("type"in(t=e)&&t.type.$$typeof)===Fe?Ge:"$$typeof"in e?Ve[e.$$typeof]:Ue;var t}var $e=Object.defineProperty,We=Object.getOwnPropertyNames,qe=Object.getOwnPropertySymbols,Xe=Object.getOwnPropertyDescriptor,Ye=Object.getPrototypeOf,Ze=Object.prototype;function Ke(e,t,n){if("string"!=typeof t){if(Ze){var i=Ye(t);i&&i!==Ze&&Ke(e,i,n)}var r=We(t);qe&&(r=r.concat(qe(t)));for(var o=je(e),s=je(t),a=0;a<r.length;++a){var l=r[a];if(!(l in He||n&&n[l]||s&&l in s||o&&l in o)){var c=Xe(t,l);try{$e(e,l,c)}catch(e){}}}}return e}function Qe(e){return"function"==typeof e}function Je(e){return"object"==typeof e&&"styledComponentId"in e}function et(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function tt(e,t){if(0===e.length)return"";for(var n=e[0],i=1;i<e.length;i++)n+=t?t+e[i]:e[i];return n}function nt(e){return null!==e&&"object"==typeof e&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function it(e,t,n){if(void 0===n&&(n=!1),!n&&!nt(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var i=0;i<t.length;i++)e[i]=it(e[i],t[i]);else if(nt(t))for(var i in t)e[i]=it(e[i],t[i]);return e}function rt(e,t){Object.defineProperty(e,"toString",{value:t})}function ot(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var st=function(){function e(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return e.prototype.indexOfGroup=function(e){for(var t=0,n=0;n<e;n++)t+=this.groupSizes[n];return t},e.prototype.insertRules=function(e,t){if(e>=this.groupSizes.length){for(var n=this.groupSizes,i=n.length,r=i;e>=r;)if((r<<=1)<0)throw ot(16,"".concat(e));this.groupSizes=new Uint32Array(r),this.groupSizes.set(n),this.length=r;for(var o=i;o<r;o++)this.groupSizes[o]=0}for(var s=this.indexOfGroup(e+1),a=(o=0,t.length);o<a;o++)this.tag.insertRule(s,t[o])&&(this.groupSizes[e]++,s++)},e.prototype.clearGroup=function(e){if(e<this.length){var t=this.groupSizes[e],n=this.indexOfGroup(e),i=n+t;this.groupSizes[e]=0;for(var r=n;r<i;r++)this.tag.deleteRule(n)}},e.prototype.getGroup=function(e){var t="";if(e>=this.length||0===this.groupSizes[e])return t;for(var n=this.groupSizes[e],i=this.indexOfGroup(e),r=i+n,o=i;o<r;o++)t+="".concat(this.tag.getRule(o)).concat(ge);return t},e}(),at=new Map,lt=new Map,ct=1,ut=function(e){if(at.has(e))return at.get(e);for(;lt.has(ct);)ct++;var t=ct++;return at.set(e,t),lt.set(t,e),t},ht=function(e,t){ct=t+1,at.set(e,t),lt.set(t,e)},dt="style[".concat(de,"][").concat(fe,'="').concat(me,'"]'),pt=new RegExp("^".concat(de,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),ft=function(e,t,n){for(var i,r=n.split(","),o=0,s=r.length;o<s;o++)(i=r[o])&&e.registerName(t,i)},mt=function(e,t){for(var n,i=(null!==(n=t.textContent)&&void 0!==n?n:"").split(ge),r=[],o=0,s=i.length;o<s;o++){var a=i[o].trim();if(a){var l=a.match(pt);if(l){var c=0|parseInt(l[1],10),u=l[2];0!==c&&(ht(u,c),ft(e,u,l[3]),e.getTag().insertRules(c,r)),r.length=0}else r.push(a)}}};function gt(){return n.nc}var yt=function(e){var t=document.head,n=e||t,i=document.createElement("style"),r=function(e){var t=Array.from(e.querySelectorAll("style[".concat(de,"]")));return t[t.length-1]}(n),o=void 0!==r?r.nextSibling:null;i.setAttribute(de,pe),i.setAttribute(fe,me);var s=gt();return s&&i.setAttribute("nonce",s),n.insertBefore(i,o),i},vt=function(){function e(e){this.element=yt(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(e){if(e.sheet)return e.sheet;for(var t=document.styleSheets,n=0,i=t.length;n<i;n++){var r=t[n];if(r.ownerNode===e)return r}throw ot(17)}(this.element),this.length=0}return e.prototype.insertRule=function(e,t){try{return this.sheet.insertRule(t,e),this.length++,!0}catch(e){return!1}},e.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},e.prototype.getRule=function(e){var t=this.sheet.cssRules[e];return t&&t.cssText?t.cssText:""},e}(),bt=function(){function e(e){this.element=yt(e),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(e,t){if(e<=this.length&&e>=0){var n=document.createTextNode(t);return this.element.insertBefore(n,this.nodes[e]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},e.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},e}(),xt=function(){function e(e){this.rules=[],this.length=0}return e.prototype.insertRule=function(e,t){return e<=this.length&&(this.rules.splice(e,0,t),this.length++,!0)},e.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},e.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},e}(),wt=ye,_t={isServer:!ye,useCSSOMInjection:!ve},St=function(){function e(e,t,n){void 0===e&&(e=xe),void 0===t&&(t={});var i=this;this.options=a(a({},_t),e),this.gs=t,this.names=new Map(n),this.server=!!e.isServer,!this.server&&ye&&wt&&(wt=!1,function(e){for(var t=document.querySelectorAll(dt),n=0,i=t.length;n<i;n++){var r=t[n];r&&r.getAttribute(de)!==pe&&(mt(e,r),r.parentNode&&r.parentNode.removeChild(r))}}(this)),rt(this,(function(){return function(e){for(var t=e.getTag(),n=t.length,i="",r=function(n){var r=function(e){return lt.get(e)}(n);if(void 0===r)return"continue";var o=e.names.get(r),s=t.getGroup(n);if(void 0===o||0===s.length)return"continue";var a="".concat(de,".g").concat(n,'[id="').concat(r,'"]'),l="";void 0!==o&&o.forEach((function(e){e.length>0&&(l+="".concat(e,","))})),i+="".concat(s).concat(a,'{content:"').concat(l,'"}').concat(ge)},o=0;o<n;o++)r(o);return i}(i)}))}return e.registerId=function(e){return ut(e)},e.prototype.reconstructWithOptions=function(t,n){return void 0===n&&(n=!0),new e(a(a({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(e=function(e){var t=e.useCSSOMInjection,n=e.target;return e.isServer?new xt(n):t?new vt(n):new bt(n)}(this.options),new st(e)));var e},e.prototype.hasNameForId=function(e,t){return this.names.has(e)&&this.names.get(e).has(t)},e.prototype.registerName=function(e,t){if(ut(e),this.names.has(e))this.names.get(e).add(t);else{var n=new Set;n.add(t),this.names.set(e,n)}},e.prototype.insertRules=function(e,t,n){this.registerName(e,t),this.getTag().insertRules(ut(e),n)},e.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},e.prototype.clearRules=function(e){this.getTag().clearGroup(ut(e)),this.clearNames(e)},e.prototype.clearTag=function(){this.tag=void 0},e}(),Mt=/&/g,At=/^\s*\/\/.*$/gm;function Ct(e,t){return e.map((function(e){return"rule"===e.type&&(e.value="".concat(t," ").concat(e.value),e.value=e.value.replaceAll(",",",".concat(t," ")),e.props=e.props.map((function(e){return"".concat(t," ").concat(e)}))),Array.isArray(e.children)&&"@keyframes"!==e.type&&(e.children=Ct(e.children,t)),e}))}function Tt(e){var t,n,i,r=void 0===e?xe:e,o=r.options,s=void 0===o?xe:o,a=r.plugins,l=void 0===a?be:a,c=function(e,i,r){return r.startsWith(n)&&r.endsWith(n)&&r.replaceAll(n,"").length>0?".".concat(t):e},u=l.slice();u.push((function(e){e.type===m&&e.value.includes("&")&&(e.props[0]=e.props[0].replace(Mt,n).replace(i,c))})),s.prefix&&u.push(oe),u.push(ie);var h=function(e,r,o,a){void 0===r&&(r=""),void 0===o&&(o=""),void 0===a&&(a="&"),t=a,n=r,i=new RegExp("\\".concat(n,"\\b"),"g");var l=e.replace(At,""),c=se(o||r?"".concat(o," ").concat(r," { ").concat(l," }"):l);s.namespace&&(c=Ct(c,s.namespace));var h,d=[];return ne(c,function(e){var t=I(e);return function(n,i,r,o){for(var s="",a=0;a<t;a++)s+=e[a](n,i,r,o)||"";return s}}(u.concat((h=function(e){return d.push(e)},function(e){e.root||(e=e.return)&&h(e)})))),d};return h.hash=l.length?l.reduce((function(e,t){return t.name||ot(15),Re(e,t.name)}),Le).toString():"",h}var Et=new St,Pt=Tt(),It=e.createContext({shouldForwardProp:void 0,styleSheet:Et,stylis:Pt}),Lt=(It.Consumer,e.createContext(void 0));function Rt(){return(0,e.useContext)(It)}function kt(t){var n=(0,e.useState)(t.stylisPlugins),i=n[0],r=n[1],o=Rt().styleSheet,s=(0,e.useMemo)((function(){var e=o;return t.sheet?e=t.sheet:t.target&&(e=e.reconstructWithOptions({target:t.target},!1)),t.disableCSSOMInjection&&(e=e.reconstructWithOptions({useCSSOMInjection:!1})),e}),[t.disableCSSOMInjection,t.sheet,t.target,o]),a=(0,e.useMemo)((function(){return Tt({options:{namespace:t.namespace,prefix:t.enableVendorPrefixes},plugins:i})}),[t.enableVendorPrefixes,t.namespace,i]);(0,e.useEffect)((function(){u()(i,t.stylisPlugins)||r(t.stylisPlugins)}),[t.stylisPlugins]);var l=(0,e.useMemo)((function(){return{shouldForwardProp:t.shouldForwardProp,styleSheet:s,stylis:a}}),[t.shouldForwardProp,s,a]);return e.createElement(It.Provider,{value:l},e.createElement(Lt.Provider,{value:a},t.children))}var Dt=function(){function e(e,t){var n=this;this.inject=function(e,t){void 0===t&&(t=Pt);var i=n.name+t.hash;e.hasNameForId(n.id,i)||e.insertRules(n.id,i,t(n.rules,i,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=t,rt(this,(function(){throw ot(12,String(n.name))}))}return e.prototype.getName=function(e){return void 0===e&&(e=Pt),this.name+e.hash},e}(),Ot=function(e){return e>="A"&&e<="Z"};function Nt(e){for(var t="",n=0;n<e.length;n++){var i=e[n];if(1===n&&"-"===i&&"-"===e[0])return e;Ot(i)?t+="-"+i.toLowerCase():t+=i}return t.startsWith("ms-")?"-"+t:t}var Bt=function(e){return null==e||!1===e||""===e},Ft=function(e){var t,n,i=[];for(var r in e){var o=e[r];e.hasOwnProperty(r)&&!Bt(o)&&(Array.isArray(o)&&o.isCss||Qe(o)?i.push("".concat(Nt(r),":"),o,";"):nt(o)?i.push.apply(i,l(l(["".concat(r," {")],Ft(o),!1),["}"],!1)):i.push("".concat(Nt(r),": ").concat((t=r,null==(n=o)||"boolean"==typeof n||""===n?"":"number"!=typeof n||0===n||t in he||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return i};function zt(e,t,n,i){return Bt(e)?[]:Je(e)?[".".concat(e.styledComponentId)]:Qe(e)?!Qe(r=e)||r.prototype&&r.prototype.isReactComponent||!t?[e]:zt(e(t),t,n,i):e instanceof Dt?n?(e.inject(n,i),[e.getName(i)]):[e]:nt(e)?Ft(e):Array.isArray(e)?Array.prototype.concat.apply(be,e.map((function(e){return zt(e,t,n,i)}))):[e.toString()];var r}function Ut(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(Qe(n)&&!Je(n))return!1}return!0}var Ht=ke(me),Gt=function(){function e(e,t,n){this.rules=e,this.staticRulesId="",this.isStatic=(void 0===n||n.isStatic)&&Ut(e),this.componentId=t,this.baseHash=Re(Ht,t),this.baseStyle=n,St.registerId(t)}return e.prototype.generateAndInjectStyles=function(e,t,n){var i=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,t,n):"";if(this.isStatic&&!n.hash)if(this.staticRulesId&&t.hasNameForId(this.componentId,this.staticRulesId))i=et(i,this.staticRulesId);else{var r=tt(zt(this.rules,e,t,n)),o=Pe(Re(this.baseHash,r)>>>0);if(!t.hasNameForId(this.componentId,o)){var s=n(r,".".concat(o),void 0,this.componentId);t.insertRules(this.componentId,o,s)}i=et(i,o),this.staticRulesId=o}else{for(var a=Re(this.baseHash,n.hash),l="",c=0;c<this.rules.length;c++){var u=this.rules[c];if("string"==typeof u)l+=u;else if(u){var h=tt(zt(u,e,t,n));a=Re(a,h+c),l+=h}}if(l){var d=Pe(a>>>0);t.hasNameForId(this.componentId,d)||t.insertRules(this.componentId,d,n(l,".".concat(d),void 0,this.componentId)),i=et(i,d)}}return i},e}(),Vt=e.createContext(void 0);Vt.Consumer;var jt={};new Set;function $t(t,n,i){var r=Je(t),o=t,s=!Ne(t),l=n.attrs,c=void 0===l?be:l,u=n.componentId,h=void 0===u?function(e,t){var n="string"!=typeof e?"sc":Ae(e);jt[n]=(jt[n]||0)+1;var i="".concat(n,"-").concat(De(me+n+jt[n]));return t?"".concat(t,"-").concat(i):i}(n.displayName,n.parentComponentId):u,d=n.displayName,p=void 0===d?function(e){return Ne(e)?"styled.".concat(e):"Styled(".concat(Oe(e),")")}(t):d,f=n.displayName&&n.componentId?"".concat(Ae(n.displayName),"-").concat(n.componentId):n.componentId||h,m=r&&o.attrs?o.attrs.concat(c).filter(Boolean):c,g=n.shouldForwardProp;if(r&&o.shouldForwardProp){var y=o.shouldForwardProp;if(n.shouldForwardProp){var v=n.shouldForwardProp;g=function(e,t){return y(e,t)&&v(e,t)}}else g=y}var b=new Gt(i,f,r?o.componentStyle:void 0);function x(t,n){return function(t,n,i){var r=t.attrs,o=t.componentStyle,s=t.defaultProps,l=t.foldedComponentIds,c=t.styledComponentId,u=t.target,h=e.useContext(Vt),d=Rt(),p=t.shouldForwardProp||d.shouldForwardProp,f=we(n,h,s)||xe,m=function(e,t,n){for(var i,r=a(a({},t),{className:void 0,theme:n}),o=0;o<e.length;o+=1){var s=Qe(i=e[o])?i(r):i;for(var l in s)r[l]="className"===l?et(r[l],s[l]):"style"===l?a(a({},r[l]),s[l]):s[l]}return t.className&&(r.className=et(r.className,t.className)),r}(r,n,f),g=m.as||u,y={};for(var v in m)void 0===m[v]||"$"===v[0]||"as"===v||"theme"===v&&m.theme===f||("forwardedAs"===v?y.as=m.forwardedAs:p&&!p(v,g)||(y[v]=m[v]));var b=function(e,t){var n=Rt();return e.generateAndInjectStyles(t,n.styleSheet,n.stylis)}(o,m),x=et(l,c);return b&&(x+=" "+b),m.className&&(x+=" "+m.className),y[Ne(g)&&!_e.has(g)?"class":"className"]=x,y.ref=i,(0,e.createElement)(g,y)}(w,t,n)}x.displayName=p;var w=e.forwardRef(x);return w.attrs=m,w.componentStyle=b,w.displayName=p,w.shouldForwardProp=g,w.foldedComponentIds=r?et(o.foldedComponentIds,o.styledComponentId):"",w.styledComponentId=f,w.target=r?o.target:t,Object.defineProperty(w,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(e){this._foldedDefaultProps=r?function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=0,r=t;i<r.length;i++)it(e,r[i],!0);return e}({},o.defaultProps,e):e}}),rt(w,(function(){return".".concat(w.styledComponentId)})),s&&Ke(w,t,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),w}function Wt(e,t){for(var n=[e[0]],i=0,r=t.length;i<r;i+=1)n.push(t[i],e[i+1]);return n}var qt=function(e){return Object.assign(e,{isCss:!0})};function Xt(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Qe(e)||nt(e))return qt(zt(Wt(be,l([e],t,!0))));var i=e;return 0===t.length&&1===i.length&&"string"==typeof i[0]?zt(i):qt(zt(Wt(i,t)))}function Yt(e,t,n){if(void 0===n&&(n=xe),!t)throw ot(1,t);var i=function(i){for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return e(t,n,Xt.apply(void 0,l([i],r,!1)))};return i.attrs=function(i){return Yt(e,t,a(a({},n),{attrs:Array.prototype.concat(n.attrs,i).filter(Boolean)}))},i.withConfig=function(i){return Yt(e,t,a(a({},n),i))},i}var Zt=function(e){return Yt($t,e)},Kt=Zt;_e.forEach((function(e){Kt[e]=Zt(e)}));!function(){function e(e,t){this.rules=e,this.componentId=t,this.isStatic=Ut(e),St.registerId(this.componentId+1)}e.prototype.createStyles=function(e,t,n,i){var r=i(tt(zt(this.rules,t,n,i)),""),o=this.componentId+e;n.insertRules(o,o,r)},e.prototype.removeStyles=function(e,t){t.clearRules(this.componentId+e)},e.prototype.renderStyles=function(e,t,n,i){e>2&&St.registerId(this.componentId+e),this.removeStyles(e,n),this.createStyles(e,t,n,i)}}();var Qt,Jt,en,tn,nn,rn,on;(function(){function t(){var t=this;this._emitSheetCSS=function(){var e=t.instance.toString(),n=gt(),i=tt([n&&'nonce="'.concat(n,'"'),"".concat(de,'="true"'),"".concat(fe,'="').concat(me,'"')].filter(Boolean)," ");return"<style ".concat(i,">").concat(e,"</style>")},this.getStyleTags=function(){if(t.sealed)throw ot(2);return t._emitSheetCSS()},this.getStyleElement=function(){var n;if(t.sealed)throw ot(2);var i=((n={})[de]="",n[fe]=me,n.dangerouslySetInnerHTML={__html:t.instance.toString()},n),r=gt();return r&&(i.nonce=r),[e.createElement("style",a({},i,{key:"sc-0-0"}))]},this.seal=function(){t.sealed=!0},this.instance=new St({isServer:!0}),this.sealed=!1}t.prototype.collectStyles=function(t){if(this.sealed)throw ot(2);return e.createElement(kt,{sheet:this.instance},t)},t.prototype.interleaveWithNodeStream=function(e){throw ot(3)}})(),"__sc-".concat(de,"__");const sn=Kt.div(Qt||(Qt=s(["\n\tdisplay:flex;\n\n"]))),an=Kt.div(Jt||(Jt=s(["\n\tdisplay:flex;\n\tflex-direction: column;\n\n"]))),ln=Kt.div(en||(en=s(["\n\tcolor: #ddd;\n\tmargin: 1rem;\n"]))),cn=Kt.ul(tn||(tn=s(["\n\tdisplay: flex;\n\tflex-direction: column;\t\n"]))),un=Kt.li(nn||(nn=s(["\n\tdisplay: block;\n\n\tpadding: 0 20px;\n\n\tmargin-bottom: 0.5px;\n\tline-height: 36px;\n\n\tcolor: #ddd;\n\n\ttext-decoration: none;\n\n\ttext-shadow: 0 -1px #2e3131;\n\n\tborder: 1px solid rgba(0, 0, 0, 0.2);\n\n\tcursor: pointer;\n"]))),hn=Kt(un)(rn||(rn=s(["\n\n\t&:hover {\n\tbackground: #708090;\n\t}\n\n"]))),dn=Kt(un)(on||(on=s(["\n\tbackground: #708090;\n\n"])));const pn=function(e){let{setComponentFile:t}=e;return(0,r.jsx)(ln,{children:(0,r.jsx)("input",{type:"file",accept:".pdb",onChange:async e=>{const n=e.target.files[0];n&&t(n)}})})};const fn=function(e){let t,{variants:n,selectedVariant:i,handleVariantChange:o}=e;const s=[];for(const a in n)t=n[a].label,a==i?s.push((0,r.jsx)(dn,{"data-val":a,onClick:o,children:t},a)):s.push((0,r.jsx)(hn,{"data-val":a,onClick:o,children:t},a));return(0,r.jsx)(cn,{children:s})};const mn=function(){const[t,n]=(0,e.useState)("ball+stick"),[i,s]=(0,e.useState)({hideAtoms:[],showAtoms:[],extraBonds:[]}),[a,l]=(0,e.useState)(void 0),[c,u]=(0,e.useState)(void 0);function h(){s({showAtoms:[],hideAtoms:[],extraBonds:[]})}const d={alpha_carbon_skeleton:void 0,CIHBS:void 0};return(0,r.jsxs)("div",{className:"App",children:[(0,r.jsx)(o,{representation:t,mask:i,componentFile:a}),(0,r.jsxs)(sn,{children:[(0,r.jsx)(an,{children:(0,r.jsx)(pn,{setComponentFile:e=>{const t=new FormData;t.append("file",e);try{fetch("http://localhost:8000/upload_structure",{method:"POST",body:t,credentials:"include"}).ok||console.log("Failed to upload file"),h(),u(void 0),l(e),console.log("File uploaded successfully")}catch(n){console.error("Error uploading file:",n)}}})}),(0,r.jsx)(an,{children:(0,r.jsx)(fn,{variants:{"ball+stick":{label:"Ball + Stick"},line:{label:"Lines"}},selectedVariant:t,handleVariantChange:function(e){const t=e.currentTarget.dataset.val;n(t)}})}),(0,r.jsx)(an,{children:(0,r.jsx)(fn,{variants:{alpha_carbon_skeleton:{label:"Alpha-Carbon Skeleton"},CIHBS:{label:"Ion-Hydrogen Bonds System"},test_alg:{label:"Test Algorithm"}},selectedVariant:c,handleVariantChange:e=>{let t=e.currentTarget.dataset.val;u((e=>{let n=t==e?void 0:t;if(void 0==n)return h(),n;if(void 0!==d[n])return s(d[n]),n;{const e={alg:n};fetch("http://localhost:8000/exec_algorithm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"}).then((e=>(e.ok||(console.error("Error"),h(),n=void 0),e.json()))).then((e=>{d[n]=e,s(e)})).catch((e=>{n=void 0}))}return n}))}})})]})]})};t.createRoot(document.getElementById("root")).render((0,r.jsx)(mn,{}))})()})();
//# sourceMappingURL=main.03690a18.js.map